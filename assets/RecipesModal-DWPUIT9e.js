import{j as t,a as ct}from"./vendor-react-sS2eXbVN.js";import{f as L,h as lt}from"./index-C8mEmM0-.js";import{g as N}from"./game-data-dkqy868O.js";import{h as gt,T as bt,r as jt,D as St,b as wt}from"./solvers-BVGGMuln.js";import"./vendor-xyflow-DS7HY60D.js";import"./vendor-elk-CE1VHGi0.js";const F=(e,i=4)=>{if(typeof e!="number")return"—";if(e===0)return"0";const o=Math.abs(e);return o>=1e6?(e/1e6).toFixed(2)+"M":o>=1e3?(e/1e3).toFixed(2)+"k":o>=1?parseFloat(e.toFixed(3)).toString():parseFloat(e.toFixed(i)).toString()},at=(e,i)=>{let o=e.cycle_time;if((typeof o!="number"||o<=0)&&(o=1),i&&gt(i.id)){const u=bt[i.id];if((u==null?void 0:u.type)==="steam_input"&&jt(e)){const y=e.tempDependentInputTemp??St;o=wt(i.id,y,o)}}return(typeof o!="number"||o<=0)&&(o=1),o},kt=(e,i)=>{const o=e.power_consumption;return typeof o=="number"?lt(o*i):typeof o=="object"&&o!==null&&"max"in o?lt(o.max*i)+" max":"Var"},Et=(e,i)=>{if(typeof e.pollution!="number")return"—";const o=e.pollution*i;return F(o,3)+"%/hr"},Tt=(e,i)=>typeof(e==null?void 0:e.cost)!="number"?"—":"$"+F(Math.ceil(i)*e.cost),Y={Deficiencies:"var(--handle-input-deficient)","Model Count":"var(--color-primary)",Excesses:"var(--tier-5-color)",Pollution:"var(--handle-output-excess)",Power:"var(--tier-3-color)",Cost:"var(--tier-4-color)"},Ct=({activeWeights:e})=>{const x=2*Math.PI*52,k=e.length,n=e.map((r,a)=>k-a),b=n.reduce((r,a)=>r+a,0),m=n.map(r=>r/b);let j=0;const l=e.map((r,a)=>{const v=m[a]*x,C={weight:r,color:Y[r]||"#888",dash:v,gap:x-v,offset:j};return j+=v,C});return t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[t.jsxs("svg",{width:140,height:140,style:{transform:"rotate(-90deg)"},children:[l.map(r=>t.jsx("circle",{cx:70,cy:70,r:52,fill:"none",stroke:r.color,strokeWidth:18,strokeDasharray:`${r.dash} ${r.gap}`,strokeDashoffset:-r.offset,style:{transition:"stroke-dasharray 0.4s"}},r.weight)),t.jsx("circle",{cx:70,cy:70,r:52-18/2-4,fill:"var(--bg-secondary)"}),t.jsx("circle",{cx:70,cy:70,r:52+18/2+2,fill:"none",stroke:"var(--border-light)",strokeWidth:1})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"3px",width:"100%"},children:e.map((r,a)=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",flexShrink:0,background:Y[r]||"#888"}}),t.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)",flex:1,lineHeight:1.2},children:r}),t.jsxs("span",{style:{fontSize:"10px",color:"var(--text-muted)",fontFamily:"monospace"},children:[(m[a]*100).toFixed(0),"%"]})]},r))}),t.jsxs("div",{style:{fontSize:"10px",color:"var(--text-muted)",textAlign:"center",lineHeight:1.4},children:["Chart shows relative rank.",t.jsx("br",{}),"Each tier = 1000× actual weight."]})]})},Dt=({activeWeights:e,unusedWeights:i,setActiveWeights:o,setUnusedWeights:u,targetProducts:y,nodes:w,productionSolution:x,hasTempDependentCycle:k,TEMP_DEPENDENT_MACHINES:n})=>{const b=[...e,...i],m={width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"var(--radius-sm)",border:"1px solid var(--border-primary)",background:"var(--bg-main)",color:"var(--text-primary)",cursor:"pointer",fontSize:"14px",lineHeight:1,flexShrink:0,transition:"opacity 0.15s",padding:0},j=e.length;return t.jsx("div",{style:{display:"flex",gap:"0",height:"calc(90vh - 180px)"},children:t.jsxs("div",{style:{flex:1,display:"flex",gap:"32px"},children:[t.jsxs("div",{style:{flex:"0 0 260px",display:"flex",flexDirection:"column",gap:"16px"},children:[t.jsx("h3",{style:{color:"var(--color-primary)",fontSize:"var(--font-size-lg)",fontWeight:700,textAlign:"center",margin:0},children:"Solver Configuration"}),t.jsxs("div",{style:{background:"var(--bg-main)",borderRadius:"var(--radius-md)",border:"1px solid var(--border-light)",padding:"20px",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",flex:1},children:[t.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",fontWeight:600},children:"Objective Priority Influence"}),t.jsx(Ct,{activeWeights:e})]}),t.jsx("button",{onClick:()=>{o(["Deficiencies","Model Count","Excesses","Pollution","Power","Cost"]),u([])},className:"btn btn-secondary",style:{padding:"8px 12px",fontSize:"var(--font-size-sm)"},children:"Restore Defaults"})]}),t.jsx("div",{style:{width:"2px",background:"var(--border-divider)",flexShrink:0}}),t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"5px",paddingTop:"44px"},children:[t.jsx("div",{style:{fontSize:"11px",color:"var(--text-muted)",marginBottom:"4px",fontWeight:600},children:"PRIORITY ORDER — TOP IS HIGHEST"}),b.map(l=>{const r=e.includes(l),a=l==="Deficiencies",v=e.indexOf(l),C=r?"var(--color-primary)":"var(--border-light)",T=r&&!a&&v>1,B=r&&!a&&v<j-1,$=()=>o(S=>{const h=[...S],E=h.indexOf(l);return[h[E-1],h[E]]=[h[E],h[E-1]],h}),q=()=>o(S=>{const h=[...S],E=h.indexOf(l);return[h[E+1],h[E]]=[h[E],h[E+1]],h}),W=()=>{r?(o(S=>S.filter(h=>h!==l)),u(S=>[...S,l])):(u(S=>S.filter(h=>h!==l)),o(S=>[...S,l]))};return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",padding:"6px 8px",background:"var(--bg-secondary)",border:`2px solid ${C}`,borderRadius:"var(--radius-sm)",opacity:r?1:.45,transition:"opacity 0.2s, border-color 0.2s"},children:[t.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",flexShrink:0,background:Y[l]||"#888",opacity:r?1:.5}}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1px"},children:[t.jsx("button",{onClick:$,disabled:!T,style:{...m,opacity:T?1:.2,cursor:T?"pointer":"default"},title:"Move up",children:"↑"}),t.jsx("button",{onClick:q,disabled:!B,style:{...m,opacity:B?1:.2,cursor:B?"pointer":"default"},title:"Move down",children:"↓"})]}),t.jsx("span",{style:{flex:1,fontWeight:600,fontSize:"12px",color:r?"var(--text-primary)":"var(--text-secondary)",userSelect:"none"},children:l}),t.jsx("button",{onClick:a?void 0:W,disabled:a,style:{...m,width:"50px",fontSize:"10px",fontWeight:600,opacity:a?.2:1,cursor:a?"default":"pointer",color:r?"#fca5a5":"#86efac",borderColor:r?"rgba(239,68,68,0.4)":"rgba(34,197,94,0.4)"},title:a?"Always active":r?"Disable":"Enable",children:a?"—":r?"Off":"On"})]},l)})]})]})})},Ot=(e,i)=>{const o=new Map(e.map(n=>[n.id,n])),u=new Map;e.forEach(n=>u.set(n.id,[]));const y=new Map;e.forEach(n=>y.set(n.id,new Set)),i.forEach(n=>{var m;const b=parseInt(((m=n.sourceHandle)==null?void 0:m.split("-")[1])??"0");u.has(n.target)&&u.get(n.target).push({childId:n.source,outputIdx:b}),y.has(n.source)&&y.get(n.source).add(n.target)});const w=new Set(e.filter(n=>y.get(n.id).size>1).map(n=>n.id)),x=new Set(e.filter(n=>y.get(n.id).size===0).map(n=>n.id));return{roots:e.filter(n=>x.has(n.id)||w.has(n.id)),childrenOf:u,nodeMap:o,sharedNodeIds:w,naturalRootIds:x}},c={product:360,rate:90,machine:170,count:70,power:110,pollution:90,cost:90},M=Object.values(c).reduce((e,i)=>e+i,0),R={fontSize:"11px",fontWeight:700,color:"var(--text-muted)",padding:"4px 6px",userSelect:"none",letterSpacing:"0.04em",textTransform:"uppercase"},f={fontSize:"12px",color:"var(--text-secondary)",padding:"3px 6px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},dt=({node:e,depth:i,connectingOutputIdx:o,childrenOf:u,nodeMap:y,ancestorIds:w,onLocateNode:x,sharedNodeIds:k,naturalRootIds:n,productionSolution:b})=>{var V,X,J;const[m,j]=ct.useState(!1),{recipe:l,machine:r,machineCount:a=0}=e.data||{};if(!l||!r)return null;const v=l.isMineshaftDrill||l.id==="r_mineshaft_drill",C=at(l,r),T=o!=null?(V=l.outputs)==null?void 0:V[o]:(X=l.outputs)==null?void 0:X[0],B=T?L(T.product_id,N):l.name;let $=0;T&&typeof T.quantity=="number"&&($=v?T.quantity*a:T.quantity/C*a);const q=kt(l,a),W=Et(l,a),S=Tt(r,a),h=u.get(e.id)||[],E=h.length>0,xt=new Set([...w,e.id]),pt=i*18,ft=r.tier===1?"var(--tier-1-color)":r.tier===2?"var(--tier-2-color)":r.tier===3?"var(--tier-3-color)":r.tier===4?"var(--tier-4-color)":"var(--tier-5-color)",U=(J=b==null?void 0:b.flows)==null?void 0:J.byNode[e.id];let G=!1,Q=!1;U&&(l.inputs.forEach((p,D)=>{var A,z;if(typeof p.quantity!="number")return;const O=v?p.quantity*a:p.quantity/C*a,_=((z=(A=U.inputFlows)==null?void 0:A[D])==null?void 0:z.connected)||0;O-_>.001&&(Q=!0)}),l.outputs.forEach((p,D)=>{var z,H;const O=p.originalQuantity??p.quantity;if(typeof O!="number")return;const _=v?O*a:O/C*a,A=((H=(z=U.outputFlows)==null?void 0:z[D])==null?void 0:H.connected)||0;_-A>.001&&(G=!0)}));const ht=i===0?"var(--bg-secondary)":i%2===0?"var(--bg-main)":"rgba(255,255,255,0.015)",ut=Q?"color-mix(in srgb, var(--handle-input-deficient) 9%, transparent)":G?"color-mix(in srgb, var(--handle-output-excess) 9%, transparent)":ht;return t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",background:ut,borderBottom:"1px solid var(--border-light)",minWidth:M,borderLeft:i===0?"3px solid var(--color-primary)":"3px solid transparent"},children:[t.jsxs("div",{style:{...f,width:c.product,flexShrink:0,display:"flex",alignItems:"center",gap:"4px"},children:[i>0&&t.jsx("span",{style:{display:"inline-block",width:pt,flexShrink:0}}),E?t.jsx("button",{onClick:()=>j(p=>!p),style:{background:"none",border:"none",cursor:"pointer",color:"var(--color-primary)",fontSize:"10px",padding:"0 2px",flexShrink:0,lineHeight:1},title:m?"Expand":"Collapse",children:m?"▶":"▼"}):t.jsx("span",{style:{width:"14px",flexShrink:0}}),t.jsx("span",{style:{color:i===0?"var(--text-primary)":"var(--text-secondary)",fontWeight:i===0?700:400,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:i===0?"13px":"12px"},children:B})]}),t.jsxs("div",{style:{...f,width:c.rate,flexShrink:0,textAlign:"right",color:"var(--stat-value)",fontFamily:"monospace"},children:[F($,4),"/s"]}),t.jsx("div",{style:{...f,width:c.machine,flexShrink:0},children:t.jsx("span",{onClick:()=>x&&x(e.id),style:{color:ft,fontWeight:500,fontSize:"12px",cursor:x?"pointer":"default",textDecoration:x?"underline dotted":"none",textUnderlineOffset:"3px"},title:x?`Locate ${r.name} on canvas`:void 0,children:r.name})}),t.jsx("div",{style:{...f,width:c.count,flexShrink:0,textAlign:"right",fontFamily:"monospace",color:"var(--color-primary)"},children:F(a,3)}),t.jsx("div",{style:{...f,width:c.power,flexShrink:0,textAlign:"right",color:"var(--tier-3-color)"},children:q}),t.jsx("div",{style:{...f,width:c.pollution,flexShrink:0,textAlign:"right",color:"var(--stat-positive)"},children:W}),t.jsx("div",{style:{...f,width:c.cost,flexShrink:0,textAlign:"right",color:"var(--stat-value)"},children:S})]}),!m&&h.map(({childId:p,outputIdx:D},O)=>{var A,z,H,tt,et,rt,it,ot,nt;if(k!=null&&k.has(p)&&!w.has(p)){const g=y.get(p),d=(A=g==null?void 0:g.data)==null?void 0:A.recipe,s=(z=g==null?void 0:g.data)==null?void 0:z.machine,I=((H=g==null?void 0:g.data)==null?void 0:H.machineCount)||0,P=D!=null?(tt=d==null?void 0:d.outputs)==null?void 0:tt[D]:(et=d==null?void 0:d.outputs)==null?void 0:et[0],Z=P?L(P.product_id,N):(d==null?void 0:d.name)||p,K=(d==null?void 0:d.isMineshaftDrill)||(d==null?void 0:d.id)==="r_mineshaft_drill",yt=d&&s?at(d,s):1;let st=0;P&&typeof P.quantity=="number"&&(st=K?P.quantity*I:P.quantity/yt*I);const mt=(s==null?void 0:s.tier)===1?"var(--tier-1-color)":(s==null?void 0:s.tier)===2?"var(--tier-2-color)":(s==null?void 0:s.tier)===3?"var(--tier-3-color)":(s==null?void 0:s.tier)===4?"var(--tier-4-color)":"var(--tier-5-color)",vt=(i+1)*18;return t.jsxs("div",{style:{display:"flex",alignItems:"center",background:"color-mix(in srgb, var(--color-primary) 7%, transparent)",borderBottom:"1px solid var(--border-light)",borderLeft:"3px solid var(--color-primary)",minWidth:M},children:[t.jsxs("div",{style:{...f,width:c.product,flexShrink:0,display:"flex",alignItems:"center",gap:"4px"},children:[t.jsx("span",{style:{display:"inline-block",width:vt,flexShrink:0}}),t.jsx("span",{style:{width:"14px",flexShrink:0}}),t.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"12px"},children:Z})]}),t.jsxs("div",{style:{...f,width:c.rate,flexShrink:0,textAlign:"right",color:"var(--stat-value)",fontFamily:"monospace"},children:[F(st,4),"/s"]}),t.jsx("div",{style:{...f,width:c.machine,flexShrink:0},children:s&&t.jsx("span",{style:{color:mt,fontWeight:500,fontSize:"12px"},children:s.name})}),t.jsx("div",{style:{...f,width:c.count,flexShrink:0,textAlign:"right",fontFamily:"monospace",color:"var(--color-primary)"},children:F(I,3)}),t.jsx("div",{style:{...f,width:c.power,flexShrink:0}}),t.jsx("div",{style:{...f,width:c.pollution,flexShrink:0}}),t.jsx("div",{style:{...f,width:c.cost,flexShrink:0}})]},`shared-${p}-${O}`)}if(w.has(p)){const g=y.get(p),d=(rt=g==null?void 0:g.data)==null?void 0:rt.recipe,s=(it=g==null?void 0:g.data)==null?void 0:it.machine,I=D!=null?(ot=d==null?void 0:d.outputs)==null?void 0:ot[D]:(nt=d==null?void 0:d.outputs)==null?void 0:nt[0],P=I?L(I.product_id,N):(d==null?void 0:d.name)||p,Z=(s==null?void 0:s.tier)===1?"var(--tier-1-color)":(s==null?void 0:s.tier)===2?"var(--tier-2-color)":(s==null?void 0:s.tier)===3?"var(--tier-3-color)":(s==null?void 0:s.tier)===4?"var(--tier-4-color)":"var(--tier-5-color)",K=(i+1)*18;return t.jsxs("div",{style:{display:"flex",alignItems:"center",background:"color-mix(in srgb, var(--tier-4-color) 7%, transparent)",borderBottom:"1px solid var(--border-light)",borderLeft:"3px solid var(--tier-4-color)",minWidth:M},children:[t.jsxs("div",{style:{...f,width:c.product,flexShrink:0,display:"flex",alignItems:"center",gap:"4px"},children:[t.jsx("span",{style:{display:"inline-block",width:K,flexShrink:0}}),t.jsx("span",{style:{width:"14px",flexShrink:0}}),t.jsx("span",{style:{color:"var(--tier-4-color)",fontStyle:"italic",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"12px"},children:P})]}),t.jsx("div",{style:{...f,width:c.rate,flexShrink:0,textAlign:"right",color:"var(--tier-4-color)",fontSize:"11px",fontStyle:"italic"},children:"cycle"}),t.jsx("div",{style:{...f,width:c.machine,flexShrink:0},children:s&&t.jsx("span",{onClick:()=>x&&x(p),style:{color:Z,fontWeight:500,fontSize:"12px",cursor:x?"pointer":"default",textDecoration:x?"underline dotted":"none",textUnderlineOffset:"3px"},title:x?`Locate ${s.name} on canvas`:void 0,children:s.name})}),t.jsx("div",{style:{...f,width:c.count,flexShrink:0}}),t.jsx("div",{style:{...f,width:c.power,flexShrink:0}}),t.jsx("div",{style:{...f,width:c.pollution,flexShrink:0}}),t.jsx("div",{style:{...f,width:c.cost,flexShrink:0}})]},`cycle-${p}-${O}`)}const _=y.get(p);return _?t.jsx(dt,{node:_,depth:i+1,connectingOutputIdx:D,childrenOf:u,nodeMap:y,ancestorIds:xt,onLocateNode:x,sharedNodeIds:k,naturalRootIds:n,productionSolution:b},`${p}-${i}-${O}`):null})]})},zt=({nodes:e,edges:i,recipeTabFilter:o,setRecipeTabFilter:u,productionSolution:y,onLocateNode:w})=>{const{roots:x,childrenOf:k,nodeMap:n,sharedNodeIds:b,naturalRootIds:m}=ct.useMemo(()=>Ot(e,i),[e,i]),j=x;return e.length===0?t.jsx("div",{className:"empty-state",children:"No recipes on canvas."}):t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"calc(90vh - 230px)"},children:[t.jsx("div",{style:{display:"flex",gap:"8px",marginBottom:"12px",alignItems:"center",justifyContent:"flex-end"},children:t.jsxs("span",{style:{fontSize:"11px",color:"var(--text-muted)"},children:[j.length," root node",j.length!==1?"s":""," · click ▼/▶ to collapse"]})}),t.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"auto",border:"1px solid var(--border-light)",borderRadius:"var(--radius-md)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",background:"var(--bg-secondary)",borderBottom:"2px solid var(--border-primary)",position:"sticky",top:0,zIndex:2,minWidth:M},children:[t.jsx("div",{style:{...R,width:c.product,flexShrink:0},children:"Product"}),t.jsx("div",{style:{...R,width:c.rate,flexShrink:0,textAlign:"right"},children:"Rate/s"}),t.jsx("div",{style:{...R,width:c.machine,flexShrink:0},children:"Machine"}),t.jsx("div",{style:{...R,width:c.count,flexShrink:0,textAlign:"right"},children:"Count"}),t.jsx("div",{style:{...R,width:c.power,flexShrink:0,textAlign:"right"},children:"Power"}),t.jsx("div",{style:{...R,width:c.pollution,flexShrink:0,textAlign:"right"},children:"Pollution"}),t.jsx("div",{style:{...R,width:c.cost,flexShrink:0,textAlign:"right"},children:"Cost"})]}),j.length===0?t.jsx("div",{style:{padding:"20px",color:"var(--text-muted)",textAlign:"center",fontSize:"13px"},children:"No recipes match the current filter."}):j.map(l=>t.jsx(dt,{node:l,depth:0,connectingOutputIdx:null,childrenOf:k,nodeMap:n,ancestorIds:new Set,onLocateNode:w,sharedNodeIds:b,naturalRootIds:m,productionSolution:y},l.id))]})]})},Bt=({onClose:e,tab:i,onTabChange:o,activeWeights:u,unusedWeights:y,setActiveWeights:w,setUnusedWeights:x,targetProducts:k,productionSolution:n,nodes:b,edges:m,recipeTabFilter:j,setRecipeTabFilter:l,onLocateNode:r})=>{const a=(v,C)=>t.jsx("button",{onClick:()=>o(v),className:i===v?"btn btn-primary":"btn btn-secondary",style:{flex:1,borderRadius:"var(--radius-sm) var(--radius-sm) 0 0",borderBottom:i===v?"3px solid var(--color-primary)":"none",minWidth:"auto"},children:C});return t.jsx("div",{className:"modal-overlay",onClick:e,children:t.jsxs("div",{className:"modal",onClick:v=>v.stopPropagation(),style:{width:"1400px",maxWidth:"95vw",maxHeight:"90vh"},children:[t.jsx("h2",{className:"modal-title",children:"Recipes"}),t.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px",borderBottom:"2px solid var(--border-divider)"},children:[a("targets","Solver & Targets"),a("canvas","Canvas Recipes")]}),i==="targets"?t.jsx(Dt,{activeWeights:u,unusedWeights:y,setActiveWeights:w,setUnusedWeights:x,targetProducts:k,nodes:b,productionSolution:n}):t.jsx(zt,{nodes:b,edges:m,recipeTabFilter:j,setRecipeTabFilter:l,productionSolution:n,onLocateNode:r}),t.jsx("button",{onClick:e,className:"btn btn-secondary",style:{width:"100%",marginTop:"16px"},children:"Close"})]})})};export{Bt as default};
