import{a as m,j as i}from"./vendor-react-sS2eXbVN.js";const k=["Tip: Lock nodes to prevent the solver from changing their machine counts.","Tip: Use Shift+Click on a node to mark it as a target recipe.","Tip: Capped nodes will not exceed their set machine count during solving.","Tip: Connect excess outputs to inputs of other machines to reduce waste.","Tip: The LP solver prioritizes eliminating deficiencies above all else, other variables are compared using weighted sums.","Tip: Adjust objective weights in the view recipes panel to change what the solver optimizes for â€” reorder or disable Model Count, Excesses, Pollution, Power, and Cost.","Tip: Remove unused weights entirely to simplify the model â€” fewer active objectives means faster solving.","Tip: Line types and paths can be changed in the Theme Editor to make complex networks easier to read.","Tip: Excess and deficiency highlight colors are customizable in the Theme Editor â€” make them stand out more against your chosen theme.","Tip: Add different ways of producing an item to see which is better, solver will pick the flow with the least cost according to weights used.","Tip: Double-click a handle to auto-balance a single connection without running the full solver.","Tip: Middle-click a node to duplicate it â€” useful for quickly scaling up a production line.","Tip: Use the per-second display mode to directly compare production rates across different recipe cycle times.","Tip: Machine Count Modes â€” Free (ğŸ”“) allows LP/suggestions to change count, Capped (ğŸ“Š) limits max value, Locked (ğŸ”’) prevents all changes.","Tip: Handle colors indicate flow status â€” deficient inputs and excess outputs are highlighted.","Tip: Click input/output rectangles to auto-create and connect matching recipes.","Tip: Use Apply to All when editing machine counts to propagate changes through connected nodes.","Tip: Favorite recipes (â­) appear at the top of the recipe selector for quick access."],D=()=>{m.useEffect(()=>{const x="lp-spinner-keyframes";if(!document.getElementById(x)){const d=document.createElement("style");d.id=x,d.textContent=`
        @keyframes lp-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes lp-dot-fade { 0%, 100% { opacity: 0.15; } 50% { opacity: 1; } }
      `,document.head.appendChild(d)}},[]);const r=10,s=20,e=26;return i.jsx("svg",{width:"52",height:"52",style:{flexShrink:0,animation:"lp-spin 1.1s linear infinite",willChange:"transform"},children:Array.from({length:r}).map((x,d)=>{const g=d/r*2*Math.PI-Math.PI/2,y=e+s*Math.cos(g),h=e+s*Math.sin(g),u=2+d/(r-1)*3.5,w=-(d/r)*1.1;return i.jsx("circle",{cx:y,cy:h,r:u/2,fill:"var(--color-primary)",style:{animation:`lp-dot-fade 1.1s ease-in-out ${w}s infinite`,transformOrigin:`${y}px ${h}px`}},d)})})},L=({phase:r,nodeSnapshot:s,result:e,onCancel:x,onApply:d,onLocateNode:g})=>{const[y,h]=m.useState(0),[u,w]=m.useState(()=>Math.floor(Math.random()*k.length)),T=m.useRef(Date.now()),N=m.useRef([]);m.useEffect(()=>{if(r!=="loading")return;T.current=Date.now(),h(0);const n=setInterval(()=>h(Date.now()-T.current),100),t=setInterval(()=>{w(o=>{const a=N.current,c=k.map((f,A)=>A),l=c.filter(f=>!a.includes(f)&&f!==o),p=l.length>0?l:c.filter(f=>f!==o),b=p[Math.floor(Math.random()*p.length)];return N.current=[...a,b].slice(-5),b})},4e3);return()=>{clearInterval(n),clearInterval(t)}},[r]);const C=n=>{var c,l,p;const t=s==null?void 0:s.find(b=>b.id===n),o=((c=t==null?void 0:t.data)==null?void 0:c.machineName)||"",a=((p=(l=t==null?void 0:t.data)==null?void 0:l.recipe)==null?void 0:p.name)||n;return o?`${o} â€“ ${a}`:a},S=n=>{var o,a,c;const t=s==null?void 0:s.find(l=>l.id===n);return((o=t==null?void 0:t.data)==null?void 0:o.machineName)||((c=(a=t==null?void 0:t.data)==null?void 0:a.recipe)==null?void 0:c.name)||n},z=n=>{var t,o;return((o=(t=s==null?void 0:s.find(a=>a.id===n))==null?void 0:t.data)==null?void 0:o.machineCount)||0},v=n=>typeof n=="number"?Number.isInteger(n)?n.toString():n.toFixed(3):"0",I=n=>i.jsx("div",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"14px",marginBottom:"8px"},children:n}),j=(n,t)=>i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",background:"var(--bg-main)",borderRadius:"var(--radius-sm)",padding:"6px 12px",fontSize:"12px"},children:[i.jsx("span",{style:{color:"var(--text-secondary)"},children:n}),i.jsx("span",{style:{color:"var(--text-primary)",fontWeight:600},children:String(t)})]},n),E=()=>i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"24px",padding:"32px 24px"},children:[i.jsx(D,{}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{color:"var(--text-primary)",fontSize:"18px",fontWeight:700,marginBottom:"6px"},children:"Solving Production Network..."}),i.jsxs("div",{style:{color:"var(--color-primary)",fontSize:"26px",fontWeight:700,fontVariantNumeric:"tabular-nums"},children:[(y/1e3).toFixed(1),"s"]})]}),i.jsx("div",{style:{background:"var(--bg-main)",border:"1px solid var(--border-primary)",borderRadius:"var(--radius-sm)",padding:"12px 16px",color:"var(--text-secondary)",fontSize:"13px",textAlign:"center",minHeight:"44px",display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"340px"},children:k[u]}),i.jsx("button",{onClick:x,className:"btn btn-secondary",style:{minWidth:"100px"},children:"Cancel"})]}),M=()=>{const n=(e==null?void 0:e.deficientNodes)||[];return i.jsxs("div",{style:{padding:"24px",display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("span",{style:{fontSize:"28px"},children:"âš ï¸"}),i.jsxs("div",{children:[i.jsx("div",{style:{color:"var(--text-primary)",fontSize:"15px",fontWeight:700},children:"Insufficient Input Supply"}),i.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"13px",marginTop:"2px"},children:"These recipes need more input than is currently being produced."})]})]}),n.length>0&&i.jsx("div",{style:{maxHeight:"280px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"6px"},children:n.map((t,o)=>i.jsxs("div",{style:{background:"rgba(239,68,68,0.08)",border:"1px solid rgba(239,68,68,0.35)",borderRadius:"var(--radius-sm)",padding:"10px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"},children:[i.jsx("div",{style:{flex:1,minWidth:0},children:i.jsx("div",{style:{color:"var(--text-primary)",fontWeight:600,fontSize:"13px"},children:S(t.nodeId)})}),i.jsx("button",{onClick:()=>{x(),g(t.nodeId)},className:"btn btn-secondary",style:{padding:"6px 12px",fontSize:"12px",whiteSpace:"nowrap",flexShrink:0},children:"Locate"})]},o))}),i.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"13px",background:"var(--bg-main)",padding:"10px 12px",borderRadius:"var(--radius-sm)"},children:"Add more production for the needed products or connect existing producers to resolve these deficiencies."}),i.jsx("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:i.jsx("button",{onClick:x,className:"btn btn-primary",children:"Close"})})]})},R=()=>{const n=e==null?void 0:e.updates,t=n&&n.size>0,o=t?Array.from(n.entries()).sort((a,c)=>C(a[0]).localeCompare(C(c[0]))):[];return i.jsxs("div",{style:{padding:"24px",display:"flex",flexDirection:"column",gap:"20px",maxHeight:"70vh",overflowY:"auto"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx("span",{style:{fontSize:"26px"},children:e!=null&&e.success?"âœ…":e!=null&&e.solverError||e!=null&&e.error?"âŒ":"â„¹ï¸"}),i.jsxs("div",{children:[i.jsx("div",{style:{color:"var(--text-primary)",fontSize:"15px",fontWeight:700},children:e!=null&&e.success?"Computation Complete":e!=null&&e.solverError||e!=null&&e.error?"Solver Error":"No Solution Found"}),i.jsx("div",{style:{color:e!=null&&e.success?"var(--text-secondary)":"#fca5a5",fontSize:"12px",marginTop:"2px"},children:(e==null?void 0:e.message)||(e==null?void 0:e.error)||"An unknown error occurred."})]})]}),!(e!=null&&e.solverError)&&!(e!=null&&e.error)&&i.jsxs("div",{children:[I(`Machine Count Changes (${o.length})`),t?i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px",maxHeight:"240px",overflowY:"auto"},children:o.map(([a,c])=>{const l=z(a),p=c-l;return i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",background:"var(--bg-main)",borderRadius:"var(--radius-sm)",padding:"7px 12px",fontSize:"13px"},children:[i.jsx("span",{style:{color:"var(--text-primary)",fontWeight:500,marginRight:"12px"},children:C(a)}),i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px",fontVariantNumeric:"tabular-nums",flexShrink:0},children:[i.jsx("span",{style:{color:"var(--text-secondary)"},children:v(l)}),i.jsx("span",{style:{color:"var(--text-muted)"},children:"â†’"}),i.jsx("span",{style:{color:"var(--text-primary)",fontWeight:700},children:v(c)}),i.jsx("span",{style:{color:p>0?"#86efac":"#fca5a5",fontSize:"11px",fontWeight:600,minWidth:"40px",textAlign:"right"},children:p>0?`+${v(p)}`:v(p)})]})]},a)})}):i.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"13px",padding:"10px 12px",background:"var(--bg-main)",borderRadius:"var(--radius-sm)"},children:"No changes â€” network is already balanced."})]}),i.jsxs("div",{children:[I("Solver Info"),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[!(e!=null&&e.solverError)&&!(e!=null&&e.error)&&j("Nodes Updated",o.length),!(e!=null&&e.solverError)&&!(e!=null&&e.error)&&j("Converged",e!=null&&e.converged?"Yes":"No"),!(e!=null&&e.solverError)&&!(e!=null&&e.error)&&j("Iterations",(e==null?void 0:e.iterations)??"â€”"),(e==null?void 0:e.elapsedMs)!=null&&j("Solve Time",`${(e.elapsedMs/1e3).toFixed(2)}s`)]})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:x,className:"btn btn-secondary",children:"Dismiss"}),t&&i.jsx("button",{onClick:()=>d(e),className:"btn btn-primary",children:"Apply Changes"})]})]})};return i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal",onClick:n=>n.stopPropagation(),style:{width:"460px",padding:0,overflow:"hidden"},children:[i.jsx("div",{style:{background:"var(--bg-secondary)",borderBottom:"2px solid var(--border-divider)",padding:"14px 20px"},children:i.jsxs("h2",{className:"modal-title",style:{margin:0},children:[r==="loading"&&"âš™ï¸ LP Solver",r==="deficiency_confirm"&&"âš ï¸ Insufficient Input Supply",r==="results"&&"ğŸ“Š Results"]})}),r==="loading"&&E(),r==="deficiency_confirm"&&M(),r==="results"&&R()]})})};export{k as TIPS,L as default};
