import{a as s,j as t}from"./vendor-react-sS2eXbVN.js";import{g as W,a as T,s as P,r as U,l as _,d as H}from"./index-CeSG4dMj.js";import"./vendor-xyflow-DS7HY60D.js";import"./game-data-dkqy868O.js";import"./solvers-BVGGMuln.js";import"./vendor-elk-CE1VHGi0.js";const q=({onClose:o,onLoad:w,currentCanvas:k,onImport:v,onExportCanvas:y})=>{const[d,E]=s.useState({}),[c,g]=s.useState(""),[h,p]=s.useState(null),[x,r]=s.useState(""),[m,f]=s.useState(null),[R,D]=s.useState("Untitled"),[F,n]=s.useState(!0),[b,S]=s.useState(!1);s.useEffect(()=>{i()},[]);const i=async()=>{n(!0);try{const e=await W();E(e);const a=localStorage.getItem("industrialist_current_save_id");f(a);const l=await T();D(l)}catch(e){console.error("Error loading saves:",e)}finally{n(!1)}},j=async()=>{if(!c.trim()){alert("Please enter a name for your save");return}S(!0);try{const e=await P(c.trim(),k);e?(g(""),await i(),alert(`Canvas saved as "${e.name}"`)):alert("Failed to save canvas")}catch(e){console.error("Error saving:",e),alert("Failed to save canvas")}finally{S(!1)}},L=async e=>{if(window.confirm("Load this save? Your current canvas will be replaced.")){n(!0);try{const a=await _(e);a?(f(e),w(a),o()):alert("Failed to load save")}catch(a){console.error("Error loading:",a),alert("Failed to load save")}finally{n(!1)}}},z=async e=>{const a=d[e];if(window.confirm(`Delete save "${a.name}"? This cannot be undone.`))try{await H(e)?await i():alert("Failed to delete save")}catch(l){console.error("Error deleting:",l),alert("Failed to delete save")}},B=e=>{p(e),r(d[e].name)},C=async e=>{if(!x.trim()){alert("Name cannot be empty");return}try{await U(e,x.trim())?(await i(),p(null),r("")):alert("Failed to rename save")}catch(a){console.error("Error renaming:",a),alert("Failed to rename save")}},N=()=>{p(null),r("")},I=e=>new Date(e).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),u=Object.values(d).sort((e,a)=>a.timestamp-e.timestamp);return t.jsx("div",{className:"modal-overlay",onClick:o,children:t.jsxs("div",{className:"modal",onClick:e=>e.stopPropagation(),style:{width:"700px",maxHeight:"85vh"},children:[t.jsx("h2",{className:"modal-title",children:"Save Manager"}),t.jsxs("div",{style:{marginBottom:"20px",padding:"15px",background:"var(--bg-main)",borderRadius:"var(--radius-md)",border:"2px solid var(--border-divider)"},children:[t.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"13px",marginBottom:"10px"},children:["Current Canvas: ",t.jsx("span",{style:{color:"var(--color-primary)",fontWeight:600},children:R})]}),t.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px"},children:[t.jsx("input",{type:"text",value:c,onChange:e=>g(e.target.value),onKeyPress:e=>e.key==="Enter"&&j(),placeholder:"Enter save name...",className:"input",style:{flex:1}}),t.jsx("button",{onClick:j,className:"btn btn-primary",style:{minWidth:"120px"},disabled:b,children:b?"Saving...":"Save Current"})]}),t.jsxs("div",{style:{paddingTop:"10px",borderTop:"1px solid var(--border-divider)"},children:[t.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"13px",marginBottom:"8px",fontWeight:600},children:"Import/Export"}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("button",{onClick:()=>{v&&v()},className:"btn btn-secondary",style:{flex:1,padding:"8px 12px",fontSize:"13px"},children:"ðŸ“¥ Import Canvas"}),t.jsx("button",{onClick:()=>{y&&y()},className:"btn btn-secondary",style:{flex:1,padding:"8px 12px",fontSize:"13px"},children:"ðŸ“¤ Export Canvas"})]})]})]}),t.jsxs("div",{className:"modal-content",style:{maxHeight:"calc(85vh - 250px)",overflowY:"auto"},children:[t.jsxs("h3",{style:{color:"var(--text-primary)",fontSize:"15px",fontWeight:600,marginBottom:"12px"},children:["Saved Canvases (",u.length,")"]}),F?t.jsx("div",{className:"empty-state",children:"Loading saves..."}):u.length===0?t.jsx("div",{className:"empty-state",children:"No saves yet. Save your current canvas to get started."}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:u.map(e=>t.jsxs("div",{style:{padding:"15px",background:m===e.id?"rgba(212, 166, 55, 0.15)":"var(--bg-main)",border:m===e.id?"2px solid var(--color-primary)":"2px solid var(--border-light)",borderRadius:"var(--radius-md)",transition:"all 0.2s"},children:[h===e.id?t.jsx("div",{style:{marginBottom:"10px"},children:t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("input",{type:"text",value:x,onChange:a=>r(a.target.value),onKeyPress:a=>{a.key==="Enter"&&C(e.id),a.key==="Escape"&&N()},className:"input",style:{flex:1},autoFocus:!0}),t.jsx("button",{onClick:()=>C(e.id),className:"btn btn-primary",style:{padding:"8px 16px"},children:"âœ“"}),t.jsx("button",{onClick:N,className:"btn btn-secondary",style:{padding:"8px 16px"},children:"âœ—"})]})}):t.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"10px"},children:t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:{color:"var(--text-primary)",fontSize:"15px",fontWeight:600,marginBottom:"4px"},children:[e.name,m===e.id&&t.jsx("span",{style:{marginLeft:"8px",fontSize:"11px",color:"var(--color-primary)",fontWeight:600,padding:"2px 6px",background:"rgba(212, 166, 55, 0.2)",borderRadius:"4px"},children:"CURRENT"})]}),t.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:[I(e.timestamp)," â€¢ ",e.nodeCount," nodes"]})]})}),h!==e.id&&t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("button",{onClick:()=>L(e.id),className:"btn btn-primary",style:{flex:1,padding:"8px 16px"},children:"Load"}),t.jsx("button",{onClick:()=>B(e.id),className:"btn btn-secondary",style:{flex:1,padding:"8px 16px"},children:"Rename"}),t.jsx("button",{onClick:()=>z(e.id),className:"btn btn-delete",style:{padding:"8px 16px"},children:"Delete"})]})]},e.id))})]}),t.jsx("button",{onClick:o,className:"btn btn-secondary",style:{marginTop:"20px",width:"100%"},children:"Close"})]})})};export{q as default,H as deleteSave,T as getCurrentSaveName,W as getSaves,_ as loadSave,U as renameSave,P as saveCurrent};
