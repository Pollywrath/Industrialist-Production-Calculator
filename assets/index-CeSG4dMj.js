const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HelpModal-aQHrwfcs.js","assets/vendor-react-sS2eXbVN.js","assets/ComputeModal-BAdoJ3BY.js","assets/SaveManager-DT06NkgO.js","assets/vendor-xyflow-DS7HY60D.js","assets/vendor-xyflow-BZV40eAE.css","assets/game-data-dkqy868O.js","assets/solvers-BVGGMuln.js","assets/vendor-elk-CE1VHGi0.js","assets/DataManager-DrJ2xv6U.js"])))=>i.map(i=>d[i]);
import{j as e,a as m,b as aa,R as Ot,d as oa}from"./vendor-react-sS2eXbVN.js";import{H as sa,P as Pn,u as la,a as kn,b as ca,c as da,d as Tn,i as ua,B as pa,C as ma,M as fa,e as Nn}from"./vendor-xyflow-DS7HY60D.js";import{p as Ye,b as Qr,c as Jt,a as Jr,d as Gt,e as Pr,f as ha,h as Gr,i as Yr,g as ve,F as ga,j as Gn,k as sn,l as kr,m as Yn,n as Xn,o as ln,q as Zn,r as ei,s as Xt,D as xa,C as ya,t as ba,u as va,v as ot,w as Xr,x as Zr,y as en,z as xe,A as ti,B as Sr,E as tn,M as _a,G as Ca,H as it,I as Sa,J as In,K as Fn,L as En,N as ja,O as Dn,P as Rn,Q as Bn,R as wa,S as Ma,T as Pa}from"./game-data-dkqy868O.js";import{H as xt,g as On,c as cn,f as Tr,n as ka,a as Ta,h as mt,T as bt,r as vt,D as st,b as yt,i as ri,d as Na,e as kt,j as ni,k as Ge,s as Ln,l as Ia,m as Fa,o as Ea,p as Da}from"./solvers-BVGGMuln.js";import{E as Ra}from"./vendor-elk-CE1VHGi0.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))c(u);new MutationObserver(u=>{for(const h of u)if(h.type==="childList")for(const p of h.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&c(p)}).observe(document,{childList:!0,subtree:!0});function i(u){const h={};return u.integrity&&(h.integrity=u.integrity),u.referrerPolicy&&(h.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?h.credentials="include":u.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function c(u){if(u.ep)return;u.ep=!0;const h=i(u);fetch(u.href,h)}})();const Ba="modulepreload",Oa=function(t){return"/Industrialist-Production-Calculator/"+t},$n={},Dr=function(n,i,c){let u=Promise.resolve();if(i&&i.length>0){let p=function(N){return Promise.all(N.map($=>Promise.resolve($).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};document.getElementsByTagName("link");const y=document.querySelector("meta[property=csp-nonce]"),D=(y==null?void 0:y.nonce)||(y==null?void 0:y.getAttribute("nonce"));u=p(i.map(N=>{if(N=Oa(N),N in $n)return;$n[N]=!0;const $=N.endsWith(".css"),S=$?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${N}"]${S}`))return;const k=document.createElement("link");if(k.rel=$?"stylesheet":Ba,$||(k.as="script"),k.crossOrigin="",k.href=N,D&&k.setAttribute("nonce",D),document.head.appendChild(k),$)return new Promise((W,I)=>{k.addEventListener("load",W),k.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${N}`)))})}))}function h(p){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=p,window.dispatchEvent(y),!y.defaultPrevented)throw p}return u.then(p=>{for(const y of p||[])y.status==="rejected"&&h(y.reason);return n().catch(h)})},dn=t=>t==="Variable"||typeof t=="string"&&t.toLowerCase().includes("variable"),La=t=>t==="p_variableproduct",pt=(t,n,i)=>{if(La(t))return i==="item"?"Variable Item":i==="fluid"?"Variable Fluid":"Variable Product";if(t==="p_any_item")return"Variable Item";if(t==="p_any_fluid")return"Variable Fluid";const c=n(t);return c?c.name:"Unknown Product"},$a=t=>dn(t)?"Variable":typeof t=="number"?t.toString():t,Ut=t=>typeof t=="number"?t>=1e6?`${(t/1e6).toFixed(2)}MMF/s`:t>=1e3?`${(t/1e3).toFixed(2)}kMF/s`:`${t.toFixed(2)}MF/s`:t,Aa=t=>{if(dn(t))return"Variable";if(typeof t=="object"&&t!==null){if("drilling"in t&&"idle"in t)return{drilling:Ut(t.drilling),idle:Ut(t.idle)};if("max"in t&&"average"in t)return{max:Ut(t.max),average:Ut(t.average)}}return Ut(t)},Ha=t=>dn(t)?"Variable":typeof t=="number"?`${t.toFixed(3)}%/hr`:typeof t=="string"?t.includes("%")?t:`${t}%/hr`:t,An=(t,n)=>{const i=$a(t.quantity),c=pt(t.product_id,n);return`${i}x ${c}`},Hn=t=>t?t>=1e6?`${(t/1e6).toFixed(1)} MMF/s`:t>=1e3?`${(t/1e3).toFixed(1)} kMF/s`:`${t.toFixed(0)} MF/s`:"N/A",za=(t,n,i)=>{switch(t){case"drill":return Wa();case"assembler":return qa();case"treeFarm":return Va(i);case"firebox":return Ua(n);case"temperature":return Ka(n);case"boiler":return Qa();case"chemicalPlant":return Ja();case"wasteFacility":return Ga();case"liquidDump":return Ya();case"liquidBurner":return Xa();default:return null}},Wa=()=>({title:"Mineshaft Drill Settings",defaultSettings:{drillHead:"",consumable:"none",machineOil:!1,depth:""},fields:[{type:"select",key:"drillHead",label:"Drill Head:",options:[{value:"",label:"None (Variable)"},...xa.map(t=>({value:t.id,label:t.name}))]},{type:"select",key:"consumable",label:"Consumable:",options:ya.map(t=>({value:t.id,label:t.name}))},{type:"checkbox",key:"machineOil",label:"Machine Oil (2/s)"},{type:"select",key:"depth",label:"Target Depth:",options:[{value:"",label:"None (Variable)"},...ba().map(t=>({value:t.toString(),label:`${t} m`}))]}],calculateMetrics:t=>t.drillHead&&t.depth?Xt(t.drillHead,t.consumable,t.machineOil,parseInt(t.depth)):null,renderMetrics:t=>e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{color:"#f5d56a",fontWeight:600,marginBottom:"12px"},children:"Calculated Metrics:"}),e.jsxs("div",{style:{color:"#999",lineHeight:"1.6",marginBottom:"12px"},children:[e.jsxs("div",{children:["Deterioration: ",t.deteriorationRate.toFixed(4),"%/s"]}),e.jsxs("div",{children:["Life Time: ",t.lifeTime.toFixed(2),"s"]}),e.jsxs("div",{children:["Replacement: ",t.replacementTime.toFixed(2),"s"]}),e.jsxs("div",{children:["Travel Time: ",t.travelTime.toFixed(2),"s"]}),e.jsxs("div",{children:["Total Cycle: ",t.totalCycleTime.toFixed(2),"s"]}),e.jsxs("div",{children:["Efficiency: ",(t.dutyCycle*100).toFixed(1),"%"]})]})]}),onApply:t=>{const n=Zn(t.drillHead,t.consumable,t.machineOil,t.depth?parseInt(t.depth):null),i=ei(t.drillHead,t.consumable,t.machineOil,t.depth?parseInt(t.depth):null),c=t.drillHead&&t.depth?Xt(t.drillHead,t.consumable,t.machineOil,parseInt(t.depth)):null;return{settings:t,inputs:n,outputs:i,metrics:c}}}),qa=()=>({title:"Logic Assembler Settings",defaultSettings:{outerStage:"",innerStage:"",machineOil:!1,tickCircuitDelay:0},fields:[{type:"dual-select",key:"microchip",outerKey:"outerStage",innerKey:"innerStage",label:"Target Microchip:",outerOptions:[1,2,3,4,5,6,7,8],innerOptions:[2,4,8,16,32,64],suffix:"Microchip",renderPreview:t=>{const n=t.outerStage,i=t.innerStage,c=n&&i?parseInt(n)===1?`${i}x Microchip`:`${n}x${i}x Microchip`:"";return c?e.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:c}):null}},{type:"checkbox",key:"machineOil",label:"Machine Oil (0.3/s, 5x speed)"},{type:"number",key:"tickCircuitDelay",label:"Tick Circuit Delay (ticks):",min:0,step:.1,placeholder:"0",parse:t=>t===""?0:parseFloat(t)}],calculateMetrics:t=>{const i=!t.outerStage||!t.innerStage?"":t.outerStage==="1"||parseInt(t.outerStage)===1?`p_${t.innerStage}x_microchip`:`p_${t.outerStage}x${t.innerStage}x_microchip`;return i?ln(i,t.machineOil,t.tickCircuitDelay):null},renderMetrics:t=>e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{color:"#f5d56a",fontWeight:600,marginBottom:"12px"},children:"Calculated Metrics:"}),e.jsxs("div",{style:{color:"#999",lineHeight:"1.6",marginBottom:"12px"},children:[e.jsxs("div",{children:["Total Stages: ",t.totalStages]}),e.jsxs("div",{children:["Total Steps: ",t.totalSteps]}),e.jsxs("div",{children:["Avg Step Time: ",t.avgStepTime,"s"]}),e.jsxs("div",{children:["Cycle Time: ",t.cycleTime.toFixed(2),"s"]})]}),e.jsxs("div",{style:{borderTop:"1px solid rgba(212, 166, 55, 0.3)",paddingTop:"10px",marginBottom:"10px"},children:[e.jsx("div",{style:{color:"#f5d56a",fontWeight:600,marginBottom:"6px"},children:"Power Consumption:"}),e.jsxs("div",{style:{color:"#999",lineHeight:"1.6",paddingLeft:"10px"},children:[e.jsxs("div",{children:["Max: ",(t.maxPowerConsumption/1e3).toFixed(2)," kMF/s"]}),e.jsxs("div",{children:["Avg: ",(t.avgPowerConsumption/1e3).toFixed(2)," kMF/s"]})]})]}),e.jsxs("div",{style:{borderTop:"1px solid rgba(212, 166, 55, 0.3)",paddingTop:"10px"},children:[e.jsx("div",{style:{color:"var(--settings-input-label)",fontWeight:600,marginBottom:"6px"},children:"Materials per Cycle:"}),e.jsxs("div",{style:{color:"#999",lineHeight:"1.5",fontSize:"12px",paddingLeft:"10px"},children:[e.jsxs("div",{children:["Logic Plates: ",t.logicPlates]}),e.jsxs("div",{children:["Copper Wires: ",t.copperWires]}),e.jsxs("div",{children:["Semiconductors: ",t.semiconductors]}),e.jsxs("div",{children:["Gold Wires: ",t.goldWires]})]})]})]}),onApply:t=>{var p,y;const n={outerStage:t.outerStage||((p=t.microchip)==null?void 0:p.outer)||"",innerStage:t.innerStage||((y=t.microchip)==null?void 0:y.inner)||"",machineOil:t.machineOil,tickCircuitDelay:t.tickCircuitDelay},c=!n.outerStage||!n.innerStage?"":parseInt(n.outerStage)===1?`p_${n.innerStage}x_microchip`:`p_${n.outerStage}x${n.innerStage}x_microchip`,u=Yn(c,n.machineOil),h=Xn(c,n.machineOil);return{settings:n,inputs:u,outputs:h,metrics:null}}}),Va=t=>({title:"Tree Farm Settings",defaultSettings:{trees:450,harvesters:20,sprinklers:24,outputs:8,controller:1},fields:[{type:"number",key:"trees",label:"Trees (max 500):",min:1,max:500,step:1,hasError:n=>n>500||n<1},{type:"number",key:"harvesters",label:"Harvesters:",min:1,step:1,hasError:n=>n<1},{type:"number",key:"sprinklers",label:"Sprinklers:",min:1,step:1,hasError:n=>n<1,hint:function(n){const i=va(n);return`Requires ${i} water tank${i!==1?"s":""} (3 sprinklers per tank)`}},{type:"number",key:"outputs",label:"Outputs:",min:1,step:1,hasError:n=>n<1},{type:"number",key:"controller",label:"Controller:",min:1,max:1,step:1,disabled:()=>!0}],calculateMetrics:n=>kr(n.trees,n.harvesters,n.sprinklers,n.outputs,n.controller,t),renderMetrics:(n,i)=>e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{color:"#f5d56a",fontWeight:600,marginBottom:"12px"},children:"Calculated Metrics:"}),e.jsxs("div",{style:{color:"#999",lineHeight:"1.6",marginBottom:"12px"},children:[e.jsxs("div",{children:["Growth Time: ",n.growthTime,"s (at ",typeof t=="number"?t.toFixed(1):t,"% pollution)"]}),e.jsxs("div",{children:["Water Tanks: ",n.waterTanks]}),e.jsxs("div",{children:["Sustainable Rate: ",n.sustainableHarvestRate.toFixed(4)," trees/s"]}),e.jsxs("div",{children:["Max Harvest Rate: ",n.maxHarvestRate.toFixed(4)," trees/s"]}),e.jsxs("div",{children:["Actual Rate: ",n.actualHarvestRate.toFixed(4)," trees/s"]}),e.jsxs("div",{children:["Power: ",(n.avgPowerConsumption/1e3).toFixed(2)," kMF/s"]}),n.isTreeLimited&&e.jsx("div",{style:{color:"var(--settings-output-label)",marginTop:"8px",fontStyle:"italic"},children:"âš ï¸ Limited by tree regrowth rate"})]})]}),hasErrors:n=>n.trees>500||n.trees<1||n.harvesters<1||n.sprinklers<1||n.outputs<1,onApply:(n,i)=>{const c=Gn(n.sprinklers),u=sn(n.trees,n.harvesters,t);return{settings:n,inputs:c,outputs:u,metrics:null}}}),Ua=t=>({title:"Industrial Firebox Settings",defaultSettings:{fuel:"p_coal"},fields:[{type:"select",key:"fuel",label:"Fuel Type:",options:ga.map(n=>({value:n.id,label:`${n.name} (${(n.energy/1e3).toFixed(0)}k energy)`}))}],calculateMetrics:n=>Gr(t.id,n.fuel),renderMetrics:(n,i)=>e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{color:"#f5d56a",fontWeight:600,marginBottom:"12px"},children:"Calculated Metrics:"}),e.jsxs("div",{style:{color:"#999",lineHeight:"1.6",marginBottom:"12px"},children:[e.jsxs("div",{children:["Energy Needed: ",(n.energyNeeded/1e3).toFixed(0),"k"]}),e.jsxs("div",{children:["Fuel Energy: ",(n.fuelEnergy/1e3).toFixed(0),"k per unit"]}),e.jsxs("div",{children:["Wait Time: ",n.waitTime.toFixed(2),"s"]}),n.additionalWait>0&&e.jsxs("div",{children:["Additional Wait: +",n.additionalWait,"s"]}),e.jsxs("div",{style:{fontWeight:600,marginTop:"8px",color:"#f5d56a"},children:["Total Cycle: ",n.cycleTime.toFixed(2),"s"]}),e.jsxs("div",{children:["Fuel Per Cycle: ",n.fuelPerCycle.toFixed(2)," units"]}),e.jsxs("div",{style:{fontSize:"11px",fontStyle:"italic",marginTop:"8px",color:"var(--text-muted)"},children:["Rate: ",(1/n.cycleTime).toFixed(4)," cycles/s"]})]}),e.jsxs("div",{style:{borderTop:"1px solid rgba(212, 166, 55, 0.3)",paddingTop:"12px"},children:[e.jsx("div",{style:{color:"var(--settings-input-label)",fontWeight:600,marginBottom:"8px",fontSize:"12px"},children:"Inputs (per cycle):"}),e.jsx("div",{style:{color:"#999",lineHeight:"1.5",fontSize:"12px"},children:Yr(t.inputs,i.fuel,t.id).map((c,u)=>{const h=typeof c.quantity=="number"?c.quantity.toFixed(4):c.quantity,p=pt(c.product_id,ve);return e.jsxs("div",{children:[h,"x ",p]},u)})})]})]}),onApply:(n,i)=>{const c=Gr(i.id,n.fuel),u=Yr(i.inputs,n.fuel,i.id);return{settings:n,inputs:u,outputs:[],metrics:c}}}),Ka=t=>{var c,u;const n=t.machine_id,i=xt[n];return{title:`${i.name} Settings`,defaultSettings:{temperature:((u=(c=i.tempOptions)==null?void 0:c[0])==null?void 0:u.temp)||120},fields:[{type:"select",key:"temperature",label:"Output Temperature:",parse:h=>parseInt(h),options:i.tempOptions.map(h=>({value:h.temp,label:`${Tr(h.temp)} - ${Hn(h.power)}`}))},{type:"info-box",key:"temperature",title:"Preview:",render:(h,p)=>{const y=p.temperature,D=On(n,y);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Output Temperature: ",Tr(y)]}),e.jsxs("div",{children:["Power Consumption: ",Hn(D)]})]})}}],onApply:(h,p)=>{const y=On(n,h.temperature),D=p.outputs.map(N=>({...N,temperature:cn(n,h)}));return{settings:h,inputs:[],outputs:D,metrics:y}}}},Qa=()=>({title:"Boiler Settings",defaultSettings:{heatLoss:0},fields:[{type:"number",key:"heatLoss",label:"Heat Loss (Â°C):",min:0,max:50,step:.1,placeholder:"8",hint:"Temperature loss when converting hot water to steam. Default is 0Â°C."},{type:"info-box",title:"How it works:",render:t=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["â€¢ Boiler uses the ",e.jsx("strong",{children:"second input"})," (hot water coolant) temperature"]}),e.jsxs("div",{children:["â€¢ Steam output temp = Coolant temp - ",t,"Â°C"]}),e.jsx("div",{children:"â€¢ If output temp < 100Â°C, no steam is produced"}),e.jsx("div",{children:"â€¢ Water output is cooled (no temperature)"}),e.jsxs("div",{style:{marginTop:"8px",fontStyle:"italic",fontSize:"12px"},children:["Tip: For 100Â°C steam with ",t,"Â°C loss, use ",100+t,"Â°C coolant"]})]})}],onApply:t=>({settings:t,inputs:[],outputs:[],metrics:null})}),Ja=()=>({title:"Chemical Plant Settings",defaultSettings:{speedFactor:100,efficiencyFactor:100},fields:[{type:"number-buttons",key:"speedFactor",label:"Speed Factor",min:50,max:200,step:5,defaultValue:100},{type:"number-buttons",key:"efficiencyFactor",label:"Efficiency Factor",min:80,max:120,step:5,defaultValue:100}],calculateMetrics:t=>ha(t.speedFactor,t.efficiencyFactor),renderMetrics:t=>e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{color:"#f5d56a",fontWeight:600,marginBottom:"12px"},children:"Applied Multipliers:"}),e.jsxs("div",{style:{color:"#999",lineHeight:"1.6"},children:[e.jsxs("div",{children:["Input Multiplier: ",t.inputMultiplier.toFixed(4),"x"]}),e.jsxs("div",{children:["Output Multiplier: ",t.outputMultiplier.toFixed(4),"x"]}),e.jsxs("div",{children:["Power Multiplier: ",t.powerMultiplier.toFixed(4),"x"]})]}),e.jsxs("div",{style:{marginTop:"12px",fontSize:"11px",color:"var(--text-muted)",fontStyle:"italic"},children:[e.jsx("div",{children:"â€¢ Speed affects input/output quantities and power"}),e.jsx("div",{children:"â€¢ Efficiency affects input quantities and power"}),e.jsx("div",{children:"â€¢ Effects combine additively"})]})]}),onApply:t=>({settings:t,inputs:[],outputs:[],metrics:null})}),Ga=()=>{const t=Ye.filter(i=>i.type==="item").sort((i,c)=>i.name.localeCompare(c.name)),n=Ye.filter(i=>i.type==="fluid").sort((i,c)=>i.name.localeCompare(c.name));return{title:"Underground Waste Facility Settings",defaultSettings:{itemProductId:"p_any_item",fluidProductId:"p_any_fluid",itemSearchTerm:"",fluidSearchTerm:""},fields:[{type:"text-input",key:"itemSearchTerm",label:"Search Items:",placeholder:"Search items...",noMargin:!0},{type:"select",key:"itemProductId",label:"Item Input Product:",options:[{value:"p_any_item",label:"Any Item"},...t.map(i=>({value:i.id,label:i.name}))]},{type:"text-input",key:"fluidSearchTerm",label:"Search Fluids:",placeholder:"Search fluids...",noMargin:!0},{type:"select",key:"fluidProductId",label:"Fluid Input Product:",options:[{value:"p_any_fluid",label:"Any Fluid"},...n.map(i=>({value:i.id,label:i.name}))]},{type:"info-box",title:"ðŸ’¡ How it works:",background:"rgba(59, 130, 246, 0.1)",titleColor:"#60a5fa",render:()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"â€¢ Each input accepts up to 240/s"}),e.jsx("div",{children:"â€¢ Fixed requirements per cycle:"}),e.jsx("div",{style:{marginLeft:"15px"},children:"- 4.8 Concrete Blocks/s"}),e.jsx("div",{style:{marginLeft:"15px"},children:"- 2.4 Lead Ingots/s"})]})}],onApply:i=>{const c=Pr(0,0,i.itemProductId,i.fluidProductId);return{settings:i,inputs:c,outputs:[],metrics:null}}}},Ya=()=>{const t=Ye.filter(n=>n.type==="fluid").sort((n,i)=>n.name.localeCompare(i.name));return{title:"Liquid Dump Info",defaultSettings:{fluidProductId0:"p_any_fluid",fluidProductId1:"p_any_fluid",searchTerm:""},fields:[{type:"text-input",key:"searchTerm",label:"Search Products:",placeholder:"Search fluids...",noMargin:!0},...Array(2).fill(0).map((n,i)=>({type:"select",key:`fluidProductId${i}`,label:`Input ${i+1} Product:`,options:[{value:"p_any_fluid",label:"Any Fluid"},...t.map(c=>({value:c.id,label:c.name}))]})),{type:"info-box",title:"Pollution Calculation:",render:(n,i)=>{const c=[i.fluidProductId0,i.fluidProductId1],u=Jr(c),h=Gt(u);return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"â€¢ Water variants: 0%/hr"}),e.jsx("div",{children:"â€¢ Residue: 8.64%/hr per /s"}),e.jsx("div",{children:"â€¢ Other fluids: 0.0216%/hr per /s"}),e.jsx("div",{style:{marginTop:"10px",paddingTop:"10px",borderTop:"1px solid rgba(212, 166, 55, 0.3)"},children:e.jsxs("strong",{children:["Current Pollution: ",h.toFixed(4),"%/hr"]})})]})}},{type:"info-box",title:"ðŸ’¡ How it works:",background:"rgba(59, 130, 246, 0.1)",titleColor:"#60a5fa",render:()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"â€¢ Each input accepts up to 15/s of the selected fluid"}),e.jsx("div",{children:"â€¢ Connect fluids to dispose of them"}),e.jsx("div",{children:"â€¢ Water variants produce no pollution"})]})}],onApply:n=>{const i=[n.fluidProductId0,n.fluidProductId1],c=Jr(i);return{settings:{fluidProductIds:i,searchTerm:n.searchTerm},inputs:c,outputs:[],metrics:null}}}},Xa=()=>{const t=Ye.filter(n=>n.type==="fluid").sort((n,i)=>n.name.localeCompare(i.name));return{title:"Liquid Burner Info",defaultSettings:{fluidProductId0:"p_any_fluid",fluidProductId1:"p_any_fluid",fluidProductId2:"p_any_fluid",fluidProductId3:"p_any_fluid",fluidProductId4:"p_any_fluid",fluidProductId5:"p_any_fluid",fluidProductId6:"p_any_fluid",fluidProductId7:"p_any_fluid",searchTerm:""},fields:[{type:"text-input",key:"searchTerm",label:"Search Products:",placeholder:"Search fluids...",noMargin:!0},...Array(8).fill(0).map((n,i)=>({type:"select",key:`fluidProductId${i}`,label:`Input ${i+1} Product:`,options:[{value:"p_any_fluid",label:"Any Fluid"},...t.map(c=>({value:c.id,label:c.name}))]})),{type:"info-box",title:"Pollution Calculation:",render:(n,i)=>{const c=Array(8).fill(0).map((p,y)=>i[`fluidProductId${y}`]),u=Qr(c),h=Jt(u);return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"â€¢ Water variants: 0%/hr"}),e.jsx("div",{children:"â€¢ Residue: 8.64%/hr per /s"}),e.jsx("div",{children:"â€¢ Other fluids: 0.0216%/hr per /s"}),e.jsx("div",{style:{marginTop:"10px",paddingTop:"10px",borderTop:"1px solid rgba(212, 166, 55, 0.3)"},children:e.jsxs("strong",{children:["Current Pollution: ",h.toFixed(4),"%/hr"]})})]})}},{type:"info-box",title:"ðŸ’¡ How it works:",background:"rgba(59, 130, 246, 0.1)",titleColor:"#60a5fa",render:()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"â€¢ Each input accepts up to 15/s of the selected fluid"}),e.jsx("div",{children:"â€¢ Connect fluids to burn them for energy disposal"}),e.jsx("div",{children:"â€¢ Water variants produce no pollution"})]})}],onApply:n=>{const i=Array(8).fill(0).map((u,h)=>n[`fluidProductId${h}`]),c=Qr(i);return{settings:{fluidProductIds:i,searchTerm:n.searchTerm},inputs:c,outputs:[],metrics:null}}}},Za=({recipeType:t,nodeId:n,currentSettings:i,recipe:c,globalPollution:u,onSettingsChange:h,onClose:p})=>{var B;const y=za(t,c,u),[D,N]=m.useState(i||y.defaultSettings),$=m.useRef(null),S=w=>{const V=$.current;if(!V)return;const Q=V.scrollHeight>V.clientHeight,L=V.scrollTop===0&&w.deltaY<0,A=V.scrollTop+V.clientHeight>=V.scrollHeight&&w.deltaY>0;Q&&!L&&!A||w.preventDefault(),w.stopPropagation()},k=(w,V)=>{N(typeof w=="object"?Q=>({...Q,...w}):Q=>({...Q,[w]:V}))},W=()=>{const w=y.onApply(D,c);switch(t){case"drill":case"assembler":case"treeFarm":case"wasteFacility":case"liquidDump":case"liquidBurner":h(n,w.settings,w.inputs,w.outputs);break;case"firebox":h(n,w.settings,w.inputs,w.metrics);break;case"temperature":h(n,w.settings,w.outputs,w.metrics);break;case"boiler":case"chemicalPlant":h(n,w.settings);break;default:h(n,w.settings,w.inputs,w.outputs,w.metrics)}p()},I=()=>{N(y.defaultSettings)},H=y.calculateMetrics?y.calculateMetrics(D,c):null;return aa.createPortal(e.jsx("div",{className:"drill-settings-overlay",onClick:p,children:e.jsxs("div",{ref:$,className:"drill-settings-bubble",onClick:w=>w.stopPropagation(),onDoubleClick:w=>w.stopPropagation(),onWheel:S,children:[e.jsx("h3",{className:"drill-settings-title",children:y.title}),e.jsxs("div",{className:"drill-settings-content",children:[y.fields.map((w,V)=>e.jsx(eo,{field:w,value:D[w.key],settings:D,onChange:(Q,L)=>{w.type==="dual-select"?k(Q,L):k(w.key,Q)}},V)),H&&y.renderMetrics&&e.jsx("div",{className:"drill-setting-group",style:{marginTop:"20px",padding:"12px",background:"rgba(212, 166, 55, 0.1)",borderRadius:"8px",fontSize:"13px"},children:y.renderMetrics(H,D)})]}),e.jsxs("div",{className:"drill-settings-buttons",children:[e.jsx("button",{onClick:I,className:"btn btn-secondary",children:"Reset"}),e.jsx("button",{onClick:W,className:"btn btn-primary",disabled:(B=y.hasErrors)==null?void 0:B.call(y,D),children:"Apply"})]})]})}),document.body)},eo=({field:t,value:n,settings:i,onChange:c})=>{var u,h;switch(t.type){case"select":return e.jsxs("div",{className:"drill-setting-group",children:[e.jsx("label",{className:"drill-setting-label",children:t.label}),e.jsx("select",{value:n,onChange:p=>c(t.parse?t.parse(p.target.value):p.target.value),className:"select",disabled:(u=t.disabled)==null?void 0:u.call(t,i),children:t.options.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))}),t.hint&&e.jsx("p",{style:{fontSize:"11px",color:"var(--text-secondary)",marginTop:"4px"},children:typeof t.hint=="function"?t.hint(n,i):t.hint})]});case"checkbox":return e.jsx("div",{className:"drill-setting-group drill-setting-checkbox",children:e.jsxs("label",{className:"drill-setting-label",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:p=>c(p.target.checked),className:"drill-checkbox"}),e.jsx("span",{children:t.label})]})});case"number":return e.jsxs("div",{className:"drill-setting-group",children:[e.jsx("label",{className:"drill-setting-label",children:t.label}),e.jsx("input",{type:"number",min:t.min,max:t.max,step:t.step,value:n,onChange:p=>c(t.parse?t.parse(p.target.value):parseFloat(p.target.value)),className:"input",placeholder:t.placeholder,style:(h=t.hasError)!=null&&h.call(t,n)?{borderColor:"#ef4444"}:{}}),t.hint&&e.jsx("p",{style:{fontSize:"11px",color:"var(--text-secondary)",marginTop:"4px"},children:typeof t.hint=="function"?t.hint(n,i):t.hint})]});case"number-buttons":return e.jsxs("div",{className:"drill-setting-group",children:[e.jsx("label",{className:"drill-setting-label",children:t.label}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("button",{onClick:()=>c(Math.max(t.min,n-t.step)),disabled:n<=t.min,className:"btn btn-secondary",style:{padding:"8px 16px",minWidth:"auto",fontSize:"18px",opacity:n<=t.min?.5:1,cursor:n<=t.min?"not-allowed":"pointer"},children:"â–¼"}),e.jsx("div",{style:{flex:1,textAlign:"center",padding:"12px",background:"var(--bg-main)",border:"2px solid var(--border-primary)",borderRadius:"var(--radius-sm)",color:"var(--text-primary)",fontSize:"20px",fontWeight:700},children:n}),e.jsx("button",{onClick:()=>c(Math.min(t.max,n+t.step)),disabled:n>=t.max,className:"btn btn-secondary",style:{padding:"8px 16px",minWidth:"auto",fontSize:"18px",opacity:n>=t.max?.5:1,cursor:n>=t.max?"not-allowed":"pointer"},children:"â–²"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"var(--text-secondary)",marginTop:"8px"},children:[e.jsxs("span",{children:["Min: ",t.min]}),e.jsxs("span",{children:["Default: ",t.defaultValue]}),e.jsxs("span",{children:["Max: ",t.max]})]})]});case"text-input":return e.jsxs("div",{className:"drill-setting-group",children:[e.jsx("label",{className:"drill-setting-label",children:t.label}),e.jsx("input",{type:"text",value:n,onChange:p=>c(p.target.value),placeholder:t.placeholder,className:"input",style:{marginBottom:t.noMargin?0:"15px"}})]});case"dual-select":return e.jsxs("div",{className:"drill-setting-group",children:[e.jsx("label",{className:"drill-setting-label",children:t.label}),e.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[e.jsxs("select",{value:i[t.outerKey]||"",onChange:p=>{const y=p.target.value;c(t.outerKey,y),y&&parseInt(y)>1&&c(t.innerKey,"64")},className:"select",style:{flex:1},children:[e.jsx("option",{value:"",children:"Outer"}),t.outerOptions.map(p=>e.jsxs("option",{value:p,children:[p,"x"]},p))]}),e.jsxs("select",{value:i[t.innerKey]||"",onChange:p=>c(t.innerKey,p.target.value),className:"select",style:{flex:1},disabled:i[t.outerKey]&&parseInt(i[t.outerKey])>1,children:[e.jsx("option",{value:"",children:"Inner"}),i[t.outerKey]&&parseInt(i[t.outerKey])>1?e.jsx("option",{value:"64",children:"64x"}):t.innerOptions.map(p=>e.jsxs("option",{value:p,children:[p,"x"]},p))]}),e.jsx("span",{style:{color:"#f5d56a",fontWeight:600,whiteSpace:"nowrap"},children:t.suffix})]}),t.renderPreview&&t.renderPreview(i)]});case"info-box":return e.jsxs("div",{className:"drill-setting-group",style:{marginTop:t.marginTop||"20px",padding:"12px",background:t.background||"rgba(212, 166, 55, 0.1)",borderRadius:"8px",fontSize:"13px"},children:[e.jsx("div",{style:{color:t.titleColor||"#f5d56a",fontWeight:600,marginBottom:"8px"},children:t.title}),e.jsx("div",{style:{color:"#999",lineHeight:"1.6"},children:t.render(n,i)})]});default:return null}},Yt=44,rn=8,zn=10,Wn=20,qn=380,to=120,gr=t=>typeof t=="number"?Math.round(t*1e4)/1e4:t,ro=m.memo(({data:t,id:n})=>{var Ze,nr,oe,ir,Ee,Ht;const{recipe:i,machine:c,machineCount:u,displayMode:h,machineDisplayMode:p,onInputClick:y,onOutputClick:D,isTarget:N,onDrillSettingsChange:$,onLogicAssemblerSettingsChange:S,onTreeFarmSettingsChange:k,onIndustrialFireboxSettingsChange:W,onTemperatureSettingsChange:I,onBoilerSettingsChange:H,onChemicalPlantSettingsChange:B,globalPollution:w,flows:V,isMobile:Q,mobileActionMode:L,onMachineCountModeChange:A,zoomLevel:q}=t,Y=!q||q>=.25,[O,K]=m.useState(null);if(!(i!=null&&i.inputs)||!(i!=null&&i.outputs)||!c)return null;const re=i.isMineshaftDrill||i.id==="r_mineshaft_drill",ne=i.isLogicAssembler||i.id==="r_logic_assembler",ie=i.isTreeFarm||i.id==="r_tree_farm",de=i.isWasteFacility||i.id==="r_underground_waste_facility",E=i.isLiquidDump||i.id==="r_liquid_dump",ae=i.isLiquidBurner||i.id==="r_liquid_burner",te=re||ne||ie||de||E||ae,ue=ka(c.id),Tt=Ta(c.id),lt=xt[c.id],Xe=c.id==="m_industrial_firebox"&&i.id!=="r_industrial_firebox_07",Fe=c.id==="m_chemical_plant",Te=mt(c.id),Le=Te?bt[c.id]:null;let pe=i.cycle_time;const Se=pe==="Variable"||typeof pe!="number"||pe<=0;if(Se&&!te?pe="Variable":Se&&te&&(pe=1),Te&&(Le==null?void 0:Le.type)==="steam_input"&&typeof pe=="number"&&!(c.id==="m_steam_cracking_plant"&&!vt(i))){const b=i.tempDependentInputTemp??st;pe=yt(c.id,b,pe)}const ct={outputs:[]};if(lt){const b=lt.type==="boiler",fe=(Ze=i.outputs)==null?void 0:Ze.some(De=>["p_water","p_filtered_water","p_distilled_water"].includes(De.product_id)),Ct=(nr=i.outputs)==null?void 0:nr.some(De=>["p_steam","p_low_pressure_steam","p_high_pressure_steam"].includes(De.product_id)),ar=(oe=i.inputs)==null?void 0:oe.some(De=>["p_water","p_filtered_water","p_distilled_water"].includes(De.product_id)),It=i.id==="r_industrial_firebox_07",or=c.id==="m_industrial_firebox";(!or||or&&!It&&(ar||fe))&&((ir=i.outputs)==null||ir.forEach((De,$e)=>{if(ri(De.product_id)&&De.temperature!=null){const Be=["p_water","p_filtered_water","p_distilled_water"].includes(De.product_id),Me=["p_steam","p_low_pressure_steam","p_high_pressure_steam"].includes(De.product_id);b?Me&&Ct&&ct.outputs.push({temp:De.temperature,index:$e}):(Be&&fe||Me&&Ct)&&ct.outputs.push({temp:De.temperature,index:$e})}}))}const J=m.useCallback(b=>{if(b==="Variable")return"Variable";if(typeof b!="number")return String(b);if(pe==="Variable")return h==="perSecond"?"Variable":String(gr(b));let fe=h==="perSecond"?b/pe:b;return p==="total"&&(fe*=u||0),String(gr(fe))},[pe,h,p,u]),X=m.useCallback(b=>{if(b==="Variable"||typeof b!="number")return b;if(h==="perSecond")return"1s";if(b>=60){const fe=Math.floor(b/60),Ct=b%60;return`${fe}m ${gr(Ct)}s`}return`${gr(b)}s`},[h]),ee=m.useMemo(()=>X(pe),[pe,X]);let ye=i.power_consumption,he=i.pollution;p==="total"&&typeof u=="number"&&u>0&&(typeof i.power_consumption=="number"?ye=i.power_consumption*u:typeof i.power_consumption=="object"&&i.power_consumption!==null&&i.power_consumption!=="Variable"&&("drilling"in i.power_consumption&&"idle"in i.power_consumption?ye={drilling:typeof i.power_consumption.drilling=="number"?i.power_consumption.drilling*u:i.power_consumption.drilling,idle:typeof i.power_consumption.idle=="number"?i.power_consumption.idle*u:i.power_consumption.idle}:"max"in i.power_consumption&&"average"in i.power_consumption&&(ye={max:typeof i.power_consumption.max=="number"?i.power_consumption.max*u:i.power_consumption.max,average:typeof i.power_consumption.average=="number"?i.power_consumption.average*u:i.power_consumption.average})),typeof i.pollution=="number"&&(he=i.pollution*u));const se=Aa(ye),Re=typeof se=="object"&&se!==null&&("drilling"in se&&"idle"in se||"max"in se&&"average"in se),le=i.power_type==="HV"?" HV":"",ge=i.inputs.length,Ce=i.outputs.length,_e=Math.max(ge,Ce,1),je=ge>0,we=Ce>0,Nt=qn-zn*2,Lt=je&&we?Math.floor((Nt-Wn)/2):je?Nt:0,er=je&&we?Math.floor((Nt-Wn)/2):we?Nt:0,tr=qn,rr=_e*Yt+(_e-1)*rn+24,$t=to+rr+12,be=u??0,At=Number.isInteger(be)?be.toString():be.toFixed(2),ht=t.machineCountMode||"free",pn=p==="total"?{color:"var(--text-muted)",opacity:.5}:{};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`custom-node ${N?"target":""}`,style:{width:tr,height:$t},onMouseDownCapture:b=>{b.button===1&&(b.preventDefault(),b.stopPropagation(),t.onMiddleClick&&t.onMiddleClick(n))},children:[e.jsxs("div",{className:"node-info-area",children:[ct.outputs.length>0&&e.jsx("div",{onDoubleClick:b=>b.stopPropagation(),style:{position:"absolute",top:"10px",left:"10px",background:"var(--bg-secondary)",border:"2px solid var(--border-primary)",borderRadius:"var(--radius-sm)",padding:"4px 8px",fontSize:"11px",fontWeight:700,color:"var(--output-text)",zIndex:5},children:ct.outputs.map((b,fe)=>e.jsx("div",{children:Tr(b.temp)},`output-${fe}`))}),Te&&(Le==null?void 0:Le.type)==="steam_input"&&vt(i)&&e.jsx("div",{onDoubleClick:b=>b.stopPropagation(),style:{position:"absolute",top:"10px",left:"10px",background:"var(--bg-secondary)",border:"2px solid var(--input-border)",borderRadius:"var(--radius-sm)",padding:"4px 8px",fontSize:"11px",fontWeight:700,color:"var(--input-text)",zIndex:5},children:Tr(i.tempDependentInputTemp??st)}),re&&e.jsx("button",{onClick:b=>{b.stopPropagation(),K("drill")},onDoubleClick:b=>b.stopPropagation(),className:"drill-settings-button",title:"Configure Drill",children:"âš™ï¸"}),ne&&e.jsx("button",{onClick:b=>{b.stopPropagation(),K("assembler")},onDoubleClick:b=>b.stopPropagation(),className:"drill-settings-button",title:"Configure Assembler",children:"âš™ï¸"}),ie&&e.jsx("button",{onClick:b=>{b.stopPropagation(),K("treeFarm")},onDoubleClick:b=>b.stopPropagation(),className:"drill-settings-button",title:"Configure Tree Farm",children:"âš™ï¸"}),Xe&&e.jsx("button",{onClick:b=>{b.stopPropagation(),K("firebox")},onDoubleClick:b=>b.stopPropagation(),className:"drill-settings-button",title:"Configure Firebox",children:"âš™ï¸"}),Fe&&e.jsx("button",{onClick:b=>{b.stopPropagation(),K("chemicalPlant")},onDoubleClick:b=>b.stopPropagation(),className:"drill-settings-button",title:"Configure Chemical Plant",children:"âš™ï¸"}),de&&e.jsx("button",{onClick:b=>{b.stopPropagation(),K("wasteFacility")},onDoubleClick:b=>b.stopPropagation(),className:"drill-settings-button",title:"Configure Waste Facility",children:"âš™ï¸"}),E&&e.jsx("button",{onClick:b=>{b.stopPropagation(),K("liquidDump")},onDoubleClick:b=>b.stopPropagation(),className:"drill-settings-button",title:"Liquid Dump Info",children:"âš™ï¸"}),ae&&e.jsx("button",{onClick:b=>{b.stopPropagation(),K("liquidBurner")},onDoubleClick:b=>b.stopPropagation(),className:"drill-settings-button",title:"Liquid Burner Info",children:"âš™ï¸"}),ue&&e.jsx("button",{onClick:b=>{b.stopPropagation(),K("temperature")},onDoubleClick:b=>b.stopPropagation(),className:"drill-settings-button",title:"Configure Temperature",children:"âš™ï¸"}),Tt&&e.jsx("button",{onClick:b=>{b.stopPropagation(),K("boiler")},onDoubleClick:b=>b.stopPropagation(),className:"drill-settings-button",title:"Configure Boiler",style:{right:"10px"},children:"âš™ï¸"}),e.jsx("div",{className:"node-recipe-name",title:i.name,children:i.name}),e.jsxs("div",{className:"node-stats-row",children:[e.jsxs("div",{className:"node-stats",style:{gap:Re?"1px":"3px",minHeight:"65px",visibility:Y?"visible":"hidden"},children:[e.jsxs("div",{className:"node-stat-row",children:[e.jsx("span",{className:"node-stat-label",children:"Cycle:"})," ",ee]}),Re?"drilling"in se?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"node-stat-row",children:[e.jsx("span",{className:"node-stat-label",children:"Power (Drilling):"})," ",se.drilling,le]}),e.jsxs("div",{className:"node-stat-row",children:[e.jsx("span",{className:"node-stat-label",children:"Power (Idle):"})," ",se.idle,le]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"node-stat-row",children:[e.jsx("span",{className:"node-stat-label",children:"Power (Max):"})," ",se.max,le]}),e.jsxs("div",{className:"node-stat-row",children:[e.jsx("span",{className:"node-stat-label",children:"Power (Avg):"})," ",se.average,le]})]}):e.jsxs("div",{className:"node-stat-row",children:[e.jsx("span",{className:"node-stat-label",children:"Power:"})," ",se,le]}),e.jsxs("div",{className:"node-stat-row",children:[e.jsx("span",{className:"node-stat-label",children:"Pollution:"})," ",Ha(he)]})]}),e.jsxs("div",{className:"node-machine-info",style:{visibility:Y?"visible":"hidden"},children:[e.jsx("div",{className:"node-machine-name",title:c.name,style:{color:c.tier===1?"var(--tier-1-color)":c.tier===2?"var(--tier-2-color)":c.tier===3?"var(--tier-3-color)":c.tier===4?"var(--tier-4-color)":(c.tier===5,"var(--tier-5-color)")},children:c.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("div",{className:"node-machine-count",style:pn,title:p==="total"?"Machine count (display mode: Total)":"Double-click node to edit",children:At}),ht!=="free"&&e.jsx("button",{onClick:b=>{b.stopPropagation(),A&&A(n,ht,u)},onDoubleClick:b=>b.stopPropagation(),style:{background:"none",border:"none",cursor:"pointer",fontSize:"14px",lineHeight:1,opacity:.8,padding:"2px",display:"flex",alignItems:"center",transition:"opacity 0.2s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.8",title:ht==="locked"?`Locked: LP/suggestions cannot change (cap: ${((Ee=t.cappedMachineCount)==null?void 0:Ee.toFixed(2))||u.toFixed(2)})
Click to unlock`:`Capped: LP/suggestions max ${((Ht=t.cappedMachineCount)==null?void 0:Ht.toFixed(2))||u.toFixed(2)}
Click to lock`,children:ht==="locked"?"ðŸ”’":"ðŸ“Š"})]})]})]})]}),e.jsxs("div",{className:"node-io-area",children:[e.jsxs("div",{className:"node-io-columns",style:{gridTemplateColumns:je&&we?`${Lt}px 1fr ${er}px`:"1fr",padding:`0 ${zn}px`},children:[je&&e.jsx("div",{className:"node-io-column node-io-left",children:i.inputs.map((b,fe)=>e.jsx("div",{className:"node-rect-wrapper",children:e.jsx(Vn,{side:"left",index:fe,width:Lt,input:b,onClick:y,nodeId:n,formatQuantity:J,isMobile:t.isMobile,mobileActionMode:t.mobileActionMode})},`left-${n}-${fe}-${b.product_id}`))}),je&&we&&e.jsx("div",{className:"node-io-gap"}),we&&e.jsx("div",{className:"node-io-column node-io-right",children:i.outputs.map((b,fe)=>e.jsx("div",{className:"node-rect-wrapper",children:e.jsx(Vn,{side:"right",index:fe,width:er,input:b,onClick:D,nodeId:n,formatQuantity:J,isMobile:t.isMobile,mobileActionMode:t.mobileActionMode})},`right-${n}-${fe}-${b.product_id}`))})]}),e.jsxs("div",{className:"node-handles-container",children:[i.inputs.map((b,fe)=>e.jsx(Un,{side:"left",index:fe,onClick:y,nodeId:n,productId:b.product_id,flows:t.flows,onHandleDoubleClick:t.onHandleDoubleClick,suggestions:t.suggestions,input:b,data:t,leftCount:ge,rightCount:Ce},`handle-left-${n}-${fe}`)),i.outputs.map((b,fe)=>e.jsx(Un,{side:"right",index:fe,onClick:D,nodeId:n,productId:b.product_id,flows:t.flows,onHandleDoubleClick:t.onHandleDoubleClick,suggestions:t.suggestions,input:b,data:t,leftCount:ge,rightCount:Ce},`handle-right-${n}-${fe}`))]})]})]}),O&&e.jsx(Za,{recipeType:O,nodeId:n,currentSettings:O==="drill"?i.drillSettings:O==="assembler"?i.assemblerSettings:O==="treeFarm"?i.treeFarmSettings:O==="firebox"?i.fireboxSettings:O==="temperature"||O==="boiler"?i.temperatureSettings:O==="chemicalPlant"?i.chemicalPlantSettings:O==="wasteFacility"?i.wasteFacilitySettings:O==="liquidDump"?i.liquidDumpSettings:O==="liquidBurner"?i.liquidBurnerSettings:{},recipe:i,globalPollution:w||0,onSettingsChange:O==="drill"?$:O==="assembler"?S:O==="treeFarm"?k:O==="firebox"?W:O==="temperature"?I:O==="boiler"?H:O==="chemicalPlant"?B:O==="wasteFacility"?t.onWasteFacilitySettingsChange:O==="liquidDump"?t.onLiquidDumpSettingsChange:O==="liquidBurner"?t.onLiquidBurnerSettingsChange:()=>{},onClose:()=>K(null)})]})},(t,n)=>{if(t.data===n.data&&t.id===n.id)return!0;if(t.id!==n.id)return!1;const i=t.data,c=n.data;return!(i.recipe!==c.recipe||i.machineCount!==c.machineCount||i.flows!==c.flows||i.suggestions!==c.suggestions||i.displayMode!==c.displayMode||i.machineDisplayMode!==c.machineDisplayMode||i.isTarget!==c.isTarget||i.zoomLevel!==c.zoomLevel||i.machineCountMode!==c.machineCountMode)}),Vn=({side:t,index:n,width:i,input:c,onClick:u,nodeId:h,formatQuantity:p,isMobile:y,mobileActionMode:D})=>{const N=t==="left",$=pt(c.product_id,ve,c.acceptedType),S=p(c.quantity),k=!y||D==="pan";return e.jsx("div",{onClick:W=>{u&&k&&(W.stopPropagation(),u(c.product_id,h,n,W))},title:`${S}x ${$}`,className:`node-rect ${N?"input":"output"} ${u?"clickable":""}`,style:{width:`${i}px`,height:`${Yt}px`,minWidth:`${i}px`},children:e.jsxs("span",{className:"node-rect-text",children:[S,"x ",$]})})},Un=({side:t,index:n,onClick:i,nodeId:c,productId:u,flows:h,onHandleDoubleClick:p,suggestions:y,input:D,data:N,leftCount:$,rightCount:S})=>{var ie,de;const I=(E,ae)=>{const te=Math.max(Math.abs(E),Math.abs(ae))*1e-4,ue=Math.max(te,1e-6);return Math.abs(E)>ue},H=getComputedStyle(document.documentElement),B=H.getPropertyValue("--handle-input-supplied").trim(),w=H.getPropertyValue("--handle-input-deficient").trim(),V=H.getPropertyValue("--handle-output-connected").trim(),Q=H.getPropertyValue("--handle-output-excess").trim();let L=t==="left"?B:V;if(h){const E=t==="left"?(ie=h.inputFlows)==null?void 0:ie[n]:(de=h.outputFlows)==null?void 0:de[n];if(E){const ae=t==="left"?E.needed-E.connected:E.produced-E.connected,te=t==="left"?E.needed:E.produced;I(ae,te)&&ae>0&&(L=t==="left"?w:Q)}}const A=ve(u),Y=(A==null?void 0:A.type)==="fluid"||u==="p_any_fluid"?"50%":"2px",ne=12+(Math.max($,S)-(t==="left"?$:S))*(Yt+rn)/2+n*(Yt+rn)+Yt/2+11;return e.jsx(sa,{type:t==="left"?"target":"source",position:t==="left"?Pn.Left:Pn.Right,id:`${t}-${n}`,style:{background:L,width:"12px",height:"12px",border:"2px solid #1a1a1a",borderRadius:Y,cursor:"pointer",position:"absolute",[t==="left"?"left":"right"]:"0",top:`${ne}px`,transform:t==="left"?"translate(-50%, -50%)":"translate(50%, -50%)"},onClick:E=>{i&&E.ctrlKey&&(E.stopPropagation(),i(u,c,n,E))},onDoubleClick:E=>{p&&(E.stopPropagation(),p(c,t,n,u,y))}})},no=t=>{if(t.length<2)return"";if(t.length===2){const i=t[1].x-t[0].x,c=t[0].x+i/3,u=t[1].x-i/3;return`M ${t[0].x} ${t[0].y} C ${c} ${t[0].y} ${u} ${t[1].y} ${t[1].x} ${t[1].y}`}let n=`M ${t[0].x} ${t[0].y}`;for(let i=0;i<t.length-1;i++){const c=t[Math.max(0,i-1)],u=t[i],h=t[i+1],p=t[Math.min(t.length-1,i+2)],y=u.x+(h.x-c.x)/6,D=u.y+(h.y-c.y)/6,N=h.x-(p.x-u.x)/6,$=h.y-(p.y-u.y)/6;n+=` C ${y} ${D} ${N} ${$} ${h.x} ${h.y}`}return n},io=(t,n,i)=>{const c=i.x-n.x,u=i.y-n.y,h=c*c+u*u;if(h===0)return Math.hypot(t.x-n.x,t.y-n.y);const p=Math.max(0,Math.min(1,((t.x-n.x)*c+(t.y-n.y)*u)/h));return Math.hypot(t.x-(n.x+p*c),t.y-(n.y+p*u))},ao=(t,n)=>{let i=1/0,c=1;for(let u=0;u<n.length-1;u++){const h=io(t,n[u],n[u+1]);h<i&&(i=h,c=u+1)}return c};let Kt=!1,jr=!1;const xr=t=>{jr=t},oo=({id:t,sourceX:n,sourceY:i,targetX:c,targetY:u,data:h,selected:p})=>{const y=(h==null?void 0:h.edgePath)||"orthogonal",D=(h==null?void 0:h.edgeStyle)||"animated",N=(h==null?void 0:h.bezierPoints)??[],$=(h==null?void 0:h.orthoMidX)??null,S=(h==null?void 0:h.orthoMidY)??null,[k,W]=m.useState(!1),[I,H]=m.useState(!1),[B,w]=m.useState(null),[V,Q]=m.useState(null),L=m.useRef(!1),A=m.useRef(null),q=m.useRef(-1),Y=m.useRef(null),O=m.useRef(null),K=m.useRef(null),{setEdges:re,screenToFlowPosition:ne}=la(),ie=kn(J=>J.nodes.some(X=>X.dragging)),de=kn(J=>J.connectionNodeId!=null),E=c-n,ae=y==="orthogonal"&&E<60,te=40,ue=m.useMemo(()=>{if(ae)return null;if($!==null){const J=Math.min(n,c)+20,X=Math.max(n,c)-20;return Math.max(J,Math.min(X,$))}return(n+c)/2},[n,c,$,ae]),Tt=m.useMemo(()=>ae?S??(i+u)/2:null,[i,u,S,ae]),{pathD:lt,handlePos:Xe,midlineSegment:Fe}=m.useMemo(()=>{if(y==="straight")return{pathD:`M ${n} ${i} L ${c} ${u}`,handlePos:null};if(y==="bezier"){const J=[{x:n,y:i},...N,{x:c,y:u}];return{pathD:no(J),handlePos:null,midlineSegment:null}}if(ae){const J=n+te,X=c-te,ee=Tt;return{pathD:`M ${n} ${i} L ${J} ${i} L ${J} ${ee} L ${X} ${ee} L ${X} ${u} L ${c} ${u}`,handlePos:{x:(J+X)/2,y:ee},midlineSegment:{pathD:`M ${J} ${ee} L ${X} ${ee}`,clampMinX:Math.min(J,X),clampMaxX:Math.max(J,X)}}}return{pathD:`M ${n} ${i} L ${ue} ${i} L ${ue} ${u} L ${c} ${u}`,handlePos:{x:ue,y:(i+u)/2},midlineSegment:{pathD:`M ${ue} ${Math.min(i,u)} L ${ue} ${Math.max(i,u)}`,clampMinY:Math.min(i,u),clampMaxY:Math.max(i,u)}}},[y,n,i,c,u,N,ue,Tt,ae]),Te=m.useMemo(()=>{if(!Xe)return null;const J=I?A.current:B;return!J||!Fe?Xe:ae?{x:Math.max(Fe.clampMinX,Math.min(Fe.clampMaxX,J.x)),y:Xe.y}:{x:Xe.x,y:Math.max(Fe.clampMinY,Math.min(Fe.clampMaxY,J.y))}},[I,B,Fe,Xe,ae]),Le=m.useCallback((J,X)=>{const ee=Y.current;if(!ee)return null;const ye=ee.getTotalLength();if(ye===0)return null;const he=ee.getScreenCTM();if(!he)return null;const se=Math.min(120,Math.ceil(ye/8)+20);let Re=1/0,le=null;for(let ge=0;ge<=se;ge++){const Ce=ee.getPointAtLength(ge/se*ye),_e=he.a*Ce.x+he.c*Ce.y+he.e,je=he.b*Ce.x+he.d*Ce.y+he.f,we=Math.hypot(_e-J,je-X);we<Re&&(Re=we,le={x:Ce.x,y:Ce.y})}return{screenDist:Re,flowPoint:le}},[]),pe=m.useCallback((J,X,ee=-1)=>{if(J.button!==0||jr||Kt&&!L.current)return;J.stopPropagation(),J.preventDefault();const ye=ne({x:J.clientX,y:J.clientY}),he=X==="bezier-new"&&O.current?O.current:ye;A.current=he,w(he),L.current=!0,H(!0),Kt=!0,X==="bezier-new"?re(le=>le.map(ge=>{if(ge.id!==t)return ge;const Ce=ge.data.bezierPoints||[],_e=[{x:n,y:i},...Ce,{x:c,y:u}],je=ao(he,_e)-1;q.current=je;const we=[...Ce];return we.splice(je,0,{x:he.x,y:he.y}),{...ge,data:{...ge.data,bezierPoints:we}}})):X==="bezier-move"&&(q.current=ee);const se=le=>{if(!L.current)return;const ge=ne({x:le.clientX,y:le.clientY});re(Ce=>Ce.map(_e=>{if(_e.id!==t)return _e;if(X==="bezier-new"||X==="bezier-move"){const je=q.current;if(je<0)return _e;const we=[..._e.data.bezierPoints||[]];return je>=we.length?_e:(we[je]={x:ge.x,y:ge.y},{..._e,data:{..._e.data,bezierPoints:we}})}return X==="ortho"?{..._e,data:{..._e.data,orthoMidX:ge.x}}:X==="orthoY"?{..._e,data:{..._e.data,orthoMidY:ge.y}}:_e}))},Re=()=>{L.current=!1,H(!1),Kt=!1,A.current=null,q.current=-1,w(null),Q(null),window.removeEventListener("mousemove",se),window.removeEventListener("mouseup",Re)};window.addEventListener("mousemove",se),window.addEventListener("mouseup",Re)},[t,n,i,c,u,re,ne]),Se=m.useCallback(J=>{re(X=>X.map(ee=>{if(ee.id!==t)return ee;const ye=(ee.data.bezierPoints||[]).filter((he,se)=>se!==J);return{...ee,data:{...ee.data,bezierPoints:ye}}}))},[t,re]),ct=D==="animated"?"custom-edge custom-edge-animated":D==="dashed"?"custom-edge custom-edge-dashed":"custom-edge custom-edge-solid";return e.jsxs("g",{onMouseEnter:()=>W(!0),onMouseLeave:()=>{L.current||W(!1)},children:[e.jsx("path",{id:t,className:ct,d:lt,fill:"none"}),e.jsx("path",{d:lt,fill:"none",stroke:"transparent",strokeWidth:20,style:{cursor:"pointer"},pointerEvents:"stroke"}),y==="bezier"&&e.jsxs(e.Fragment,{children:[e.jsx("path",{ref:Y,d:lt,fill:"none",stroke:"transparent",strokeWidth:6,style:{cursor:V?"crosshair":"default"},pointerEvents:"stroke",onMouseMove:J=>{if(jr||Kt&&!L.current)return;const X=J.clientX,ee=J.clientY;K.current||(K.current=requestAnimationFrame(()=>{K.current=null;const ye=Le(X,ee);ye&&ye.screenDist<=5?(O.current=ye.flowPoint,Q(ye.flowPoint)):(O.current=null,Q(null))}))},onMouseLeave:()=>{L.current||(K.current&&(cancelAnimationFrame(K.current),K.current=null),Q(null),O.current=null)},onMouseDown:J=>{O.current&&pe(J,"bezier-new")}}),V&&!I&&e.jsx("circle",{cx:V.x,cy:V.y,r:5,fill:"var(--color-primary)",opacity:.5,pointerEvents:"none"}),(k||p||I)&&N.map((J,X)=>e.jsxs("g",{children:[e.jsx("circle",{cx:J.x,cy:J.y,r:6,fill:"var(--bg-secondary)",stroke:"var(--color-primary)",strokeWidth:2,style:{cursor:"grab"},pointerEvents:"all",onMouseDown:ee=>{if(ee.stopPropagation(),ee.ctrlKey||ee.metaKey){Se(X);return}pe(ee,"bezier-move",X)},onDoubleClick:ee=>{ee.stopPropagation(),Se(X)}}),e.jsx("circle",{cx:J.x,cy:J.y,r:20,fill:"transparent",stroke:"none",pointerEvents:"all",onMouseEnter:()=>W(!0),onMouseLeave:()=>{L.current||W(!1)},onMouseDown:ee=>{if(ee.stopPropagation(),ee.ctrlKey||ee.metaKey){Se(X);return}pe(ee,"bezier-move",X)},onDoubleClick:ee=>{ee.stopPropagation(),Se(X)}})]},X))]}),y==="orthogonal"&&Xe&&Fe&&e.jsxs(e.Fragment,{children:[e.jsx("path",{d:Fe.pathD,fill:"none",stroke:"transparent",strokeWidth:16,style:{cursor:ae?"ns-resize":"ew-resize"},pointerEvents:"stroke",onMouseMove:J=>{jr||Kt&&!L.current||w(ne({x:J.clientX,y:J.clientY}))},onMouseLeave:()=>{L.current||w(null)},onMouseDown:J=>pe(J,ae?"orthoY":"ortho")}),(B!==null||I)&&!ie&&!de&&Te&&(ae?e.jsx("rect",{x:Te.x-14,y:Te.y-5,width:28,height:10,rx:3,fill:"var(--bg-secondary)",stroke:"var(--color-primary)",strokeWidth:2,style:{cursor:"ns-resize"},pointerEvents:"none"}):e.jsx("rect",{x:Te.x-5,y:Te.y-14,width:10,height:28,rx:3,fill:"var(--bg-secondary)",stroke:"var(--color-primary)",strokeWidth:2,style:{cursor:"ew-resize"},pointerEvents:"none"}))]})]})},so=m.memo(oo),Bt={colorPrimary:"#d4a637",colorPrimaryHover:"#f5d56a",colorPrimaryDark:"#0a0a0a",colorSecondary:"#1a1a1a",bgMain:"#0a0a0a",bgSecondary:"#1a1a1a",textPrimary:"#f5d56a",textSecondary:"#999999",textMuted:"#aaaaaa",statValue:"#e0e0e0",borderPrimary:"#d4a637",borderLight:"#333333",borderDivider:"#d4a63755",inputBg:"#1a3a2a",inputBorder:"#22c55e",inputText:"#86efac",outputBg:"#3a1a1a",outputBorder:"#ef4444",outputText:"#fca5a5",deleteBg:"#3a1a1a",deleteColor:"#ef4444",deleteHoverBg:"#ef4444",deleteHoverColor:"#0a0a0a",nodeBg:"#1a1a1a",nodeBorder:"#d4a637",nodeTargetBg:"#2d2416",nodeTargetBorder:"#f5d56a",handleInputSupplied:"#22c55e",handleInputDeficient:"#ef4444",handleOutputConnected:"#ef4444",handleOutputExcess:"#22c55e",statPositive:"#86efac",statNegative:"#fca5a5",settingsInputLabel:"#86efac",settingsOutputLabel:"#fca5a5",tier1Color:"#888888",tier2Color:"#4ade80",tier3Color:"#60a5fa",tier4Color:"#c084fc",tier5Color:"#fbbf24",edgePath:"orthogonal",edgeStyle:"animated"},lo=[{id:"default",name:"Golden Industrial (Default)",description:"Original golden theme with warm tones",theme:Bt},{id:"dracula",name:"Dracula",description:"Grimace Shake",theme:{colorPrimary:"#bd93f9",colorPrimaryHover:"#d6acff",colorPrimaryDark:"#282a36",colorSecondary:"#44475a",bgMain:"#282a36",bgSecondary:"#44475a",textPrimary:"#f8f8f2",textSecondary:"#6272a4",textMuted:"#6272a4",statValue:"#f8f8f2",borderPrimary:"#bd93f9",borderLight:"#44475a",borderDivider:"#bd93f955",inputBg:"#1a2a3a",inputBorder:"#50fa7b",inputText:"#50fa7b",outputBg:"#3a1a2a",outputBorder:"#ff5555",outputText:"#ff79c6",deleteBg:"#44475a",deleteColor:"#ff5555",deleteHoverBg:"#ff5555",deleteHoverColor:"#282a36",nodeBg:"#44475a",nodeBorder:"#bd93f9",nodeTargetBg:"#5a4a6a",nodeTargetBorder:"#ff79c6",handleInputSupplied:"#50fa7b",handleInputDeficient:"#ff5555",handleOutputConnected:"#ff5555",handleOutputExcess:"#50fa7b",statPositive:"#50fa7b",statNegative:"#ff5555",settingsInputLabel:"#50fa7b",settingsOutputLabel:"#ff79c6",tier1Color:"#999999",tier2Color:"#50fa7b",tier3Color:"#8be9fd",tier4Color:"#bd93f9",tier5Color:"#f1fa8c",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"nord",name:"Nord",description:"Cool arctic bluish palette",theme:{colorPrimary:"#88c0d0",colorPrimaryHover:"#8fbcbb",colorPrimaryDark:"#2e3440",colorSecondary:"#3b4252",bgMain:"#2e3440",bgSecondary:"#3b4252",textPrimary:"#eceff4",textSecondary:"#d8dee9",textMuted:"#4c566a",statValue:"#e5e9f0",borderPrimary:"#88c0d0",borderLight:"#4c566a",borderDivider:"#88c0d055",inputBg:"#2a3a3a",inputBorder:"#a3be8c",inputText:"#a3be8c",outputBg:"#3a2a2a",outputBorder:"#bf616a",outputText:"#d08770",deleteBg:"#3b4252",deleteColor:"#bf616a",deleteHoverBg:"#bf616a",deleteHoverColor:"#2e3440",nodeBg:"#3b4252",nodeBorder:"#88c0d0",nodeTargetBg:"#4c5a68",nodeTargetBorder:"#8fbcbb",handleInputSupplied:"#a3be8c",handleInputDeficient:"#bf616a",handleOutputConnected:"#bf616a",handleOutputExcess:"#a3be8c",statPositive:"#a3be8c",statNegative:"#bf616a",settingsInputLabel:"#a3be8c",settingsOutputLabel:"#d08770",tier1Color:"#999999",tier2Color:"#a3be8c",tier3Color:"#88c0d0",tier4Color:"#b48ead",tier5Color:"#ebcb8b",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"solarized-dark",name:"Solarized Dark",description:"Precision dark theme with balanced contrast",theme:{colorPrimary:"#268bd2",colorPrimaryHover:"#2aa198",colorPrimaryDark:"#002b36",colorSecondary:"#073642",bgMain:"#002b36",bgSecondary:"#073642",textPrimary:"#839496",textSecondary:"#586e75",textMuted:"#657b83",statValue:"#93a1a1",borderPrimary:"#268bd2",borderLight:"#073642",borderDivider:"#268bd255",inputBg:"#073a3a",inputBorder:"#859900",inputText:"#859900",outputBg:"#3a0707",outputBorder:"#dc322f",outputText:"#cb4b16",deleteBg:"#073642",deleteColor:"#dc322f",deleteHoverBg:"#dc322f",deleteHoverColor:"#002b36",nodeBg:"#073642",nodeBorder:"#268bd2",nodeTargetBg:"#0f4a52",nodeTargetBorder:"#2aa198",handleInputSupplied:"#859900",handleInputDeficient:"#dc322f",handleOutputConnected:"#dc322f",handleOutputExcess:"#859900",statPositive:"#859900",statNegative:"#dc322f",settingsInputLabel:"#859900",settingsOutputLabel:"#cb4b16",tier1Color:"#93a1a1",tier2Color:"#859900",tier3Color:"#268bd2",tier4Color:"#6c71c4",tier5Color:"#b58900",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"solarized-light",name:"Solarized Light",description:"For those who want to burn their eyes out",theme:{colorPrimary:"#268bd2",colorPrimaryHover:"#2aa198",colorPrimaryDark:"#fdf6e3",colorSecondary:"#eee8d5",bgMain:"#fdf6e3",bgSecondary:"#eee8d5",textPrimary:"#657b83",textSecondary:"#586e75",textMuted:"#93a1a1",statValue:"#073642",borderPrimary:"#268bd2",borderLight:"#93a1a1",borderDivider:"#268bd255",inputBg:"#e5f5e5",inputBorder:"#859900",inputText:"#859900",outputBg:"#f5e5e5",outputBorder:"#dc322f",outputText:"#cb4b16",deleteBg:"#eee8d5",deleteColor:"#dc322f",deleteHoverBg:"#dc322f",deleteHoverColor:"#fdf6e3",nodeBg:"#eee8d5",nodeBorder:"#268bd2",nodeTargetBg:"#d9d2c2",nodeTargetBorder:"#2aa198",handleInputSupplied:"#859900",handleInputDeficient:"#dc322f",handleOutputConnected:"#dc322f",handleOutputExcess:"#859900",statPositive:"#859900",statNegative:"#dc322f",settingsInputLabel:"#859900",settingsOutputLabel:"#cb4b16",tier1Color:"#839496",tier2Color:"#859900",tier3Color:"#268bd2",tier4Color:"#6c71c4",tier5Color:"#b58900",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"midnight",name:"Midnight Blue",description:"Deep blue dark theme",theme:{colorPrimary:"#4a9eff",colorPrimaryHover:"#70b4ff",colorPrimaryDark:"#0a0e1a",colorSecondary:"#151a2e",bgMain:"#0a0e1a",bgSecondary:"#151a2e",textPrimary:"#e0e6ff",textSecondary:"#8892b0",textMuted:"#a8b2d1",statValue:"#ccd6f6",borderPrimary:"#4a9eff",borderLight:"#233554",borderDivider:"#4a9eff55",inputBg:"#1a2a3a",inputBorder:"#64ffda",inputText:"#64ffda",outputBg:"#3a1a2a",outputBorder:"#ff6b9d",outputText:"#ffa7c4",deleteBg:"#151a2e",deleteColor:"#ff6b9d",deleteHoverBg:"#ff6b9d",deleteHoverColor:"#0a0e1a",nodeBg:"#151a2e",nodeBorder:"#4a9eff",nodeTargetBg:"#1e2a45",nodeTargetBorder:"#70b4ff",handleInputSupplied:"#64ffda",handleInputDeficient:"#ff6b9d",handleOutputConnected:"#ff6b9d",handleOutputExcess:"#64ffda",statPositive:"#64ffda",statNegative:"#ff6b9d",settingsInputLabel:"#64ffda",settingsOutputLabel:"#ffa7c4",tier1Color:"#9099b0",tier2Color:"#64ffda",tier3Color:"#4a9eff",tier4Color:"#c792ea",tier5Color:"#ffcb6b",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"forest",name:"Forest Green",description:"Natural green theme",theme:{colorPrimary:"#5fb573",colorPrimaryHover:"#7fc794",colorPrimaryDark:"#0a1a0f",colorSecondary:"#152820",bgMain:"#0a1a0f",bgSecondary:"#152820",textPrimary:"#c8e6c9",textSecondary:"#81c784",textMuted:"#a5d6a7",statValue:"#e0f2e0",borderPrimary:"#5fb573",borderLight:"#2e4a35",borderDivider:"#5fb57355",inputBg:"#1a3a2a",inputBorder:"#66bb6a",inputText:"#a5d6a7",outputBg:"#3a1a1a",outputBorder:"#ef5350",outputText:"#ff8a80",deleteBg:"#152820",deleteColor:"#ef5350",deleteHoverBg:"#ef5350",deleteHoverColor:"#0a1a0f",nodeBg:"#152820",nodeBorder:"#5fb573",nodeTargetBg:"#243a2d",nodeTargetBorder:"#7fc794",handleInputSupplied:"#66bb6a",handleInputDeficient:"#ef5350",handleOutputConnected:"#ef5350",handleOutputExcess:"#66bb6a",statPositive:"#a5d6a7",statNegative:"#ff8a80",settingsInputLabel:"#a5d6a7",settingsOutputLabel:"#ff8a80",tier1Color:"#9e9e9e",tier2Color:"#66bb6a",tier3Color:"#42a5f5",tier4Color:"#ab47bc",tier5Color:"#ffca28",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"sunset",name:"Sunset Orange",description:"Warm sunset-inspired theme, steampunk-esque",theme:{colorPrimary:"#ff8c42",colorPrimaryHover:"#ffaa6f",colorPrimaryDark:"#1a0f0a",colorSecondary:"#281912",bgMain:"#1a0f0a",bgSecondary:"#281912",textPrimary:"#ffe4d1",textSecondary:"#ffb88c",textMuted:"#ffc9a3",statValue:"#fff0e0",borderPrimary:"#ff8c42",borderLight:"#4a2e1f",borderDivider:"#ff8c4255",inputBg:"#2a3a1a",inputBorder:"#a3e048",inputText:"#c6f68d",outputBg:"#3a1a1a",outputBorder:"#ff5555",outputText:"#ff8787",deleteBg:"#281912",deleteColor:"#ff5555",deleteHoverBg:"#ff5555",deleteHoverColor:"#1a0f0a",nodeBg:"#281912",nodeBorder:"#ff8c42",nodeTargetBg:"#3d2a1a",nodeTargetBorder:"#ffaa6f",handleInputSupplied:"#a3e048",handleInputDeficient:"#ff5555",handleOutputConnected:"#ff5555",handleOutputExcess:"#a3e048",statPositive:"#c6f68d",statNegative:"#ff8787",settingsInputLabel:"#c6f68d",settingsOutputLabel:"#ff8787",tier1Color:"#a89984",tier2Color:"#a3e048",tier3Color:"#83a598",tier4Color:"#d3869b",tier5Color:"#fabd2f",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"cyberpunk",name:"Cyberpunk",description:"Neon-inspired futuristic theme",theme:{colorPrimary:"#00ff9f",colorPrimaryHover:"#00ffbf",colorPrimaryDark:"#0a0a15",colorSecondary:"#1a1a2e",bgMain:"#0a0a15",bgSecondary:"#1a1a2e",textPrimary:"#00ff9f",textSecondary:"#00d4aa",textMuted:"#00b494",statValue:"#d0fff0",borderPrimary:"#00ff9f",borderLight:"#16213e",borderDivider:"#00ff9f55",inputBg:"#1a2a3a",inputBorder:"#00ff9f",inputText:"#00ffbf",outputBg:"#3a1a2a",outputBorder:"#ff006e",outputText:"#ff4d9d",deleteBg:"#1a1a2e",deleteColor:"#ff006e",deleteHoverBg:"#ff006e",deleteHoverColor:"#0a0a15",nodeBg:"#1a1a2e",nodeBorder:"#00ff9f",nodeTargetBg:"#2a2a45",nodeTargetBorder:"#00ffbf",handleInputSupplied:"#00ff9f",handleInputDeficient:"#ff006e",handleOutputConnected:"#ff006e",handleOutputExcess:"#00ff9f",statPositive:"#00ffbf",statNegative:"#ff4d9d",settingsInputLabel:"#00ffbf",settingsOutputLabel:"#ff4d9d",tier1Color:"#9999aa",tier2Color:"#00ff9f",tier3Color:"#00d4ff",tier4Color:"#d946ef",tier5Color:"#ffd700",edgePath:"orthogonal",edgeStyle:"animated"}}],Nr=t=>{const n=document.documentElement;Object.entries(t).forEach(([i,c])=>{const u="--"+i.replace(/([A-Z])/g,"-$1").toLowerCase();n.style.setProperty(u,c)})},wr=()=>{try{const t=localStorage.getItem("industrialist_theme");return t?JSON.parse(t):Bt}catch{return Bt}},nn=t=>localStorage.setItem("industrialist_theme",JSON.stringify(t)),co=()=>(Nr(Bt),nn(Bt),Bt),uo=({onClose:t})=>{const[n,i]=m.useState(wr()),[c,u]=m.useState(!1),h=S=>{const k={edgePath:n.edgePath||"orthogonal",edgeStyle:n.edgeStyle||"animated"},W={...S.theme,...k};i(W),Nr(W),nn(W)},p=(S,k)=>{const W={...n,[S]:k};i(W),Nr(W),nn(W)},y=()=>{const S=co();i(S)},D=[{title:"Primary Colors",colors:[{key:"colorPrimary",label:"Primary"},{key:"colorPrimaryHover",label:"Primary Hover"},{key:"colorPrimaryDark",label:"Primary Dark"},{key:"colorSecondary",label:"Secondary"}]},{title:"Background Colors",colors:[{key:"bgMain",label:"Main Background"},{key:"bgSecondary",label:"Secondary Background"}]},{title:"Text Colors",colors:[{key:"textPrimary",label:"Primary Text"},{key:"textSecondary",label:"Secondary Text"},{key:"textMuted",label:"Muted Text"},{key:"statValue",label:"Stat Values (Cycle/Power/Pollution)"}]},{title:"Border Colors",colors:[{key:"borderPrimary",label:"Primary Border"},{key:"borderLight",label:"Light Border"},{key:"borderDivider",label:"Divider"}]},{title:"Input/Output Colors",colors:[{key:"inputBg",label:"Input Background"},{key:"inputBorder",label:"Input Border"},{key:"inputText",label:"Input Text"},{key:"outputBg",label:"Output Background"},{key:"outputBorder",label:"Output Border"},{key:"outputText",label:"Output Text"}]},{title:"Node Colors",colors:[{key:"nodeBg",label:"Node Background"},{key:"nodeBorder",label:"Node Border"},{key:"nodeTargetBg",label:"Target Node Background"},{key:"nodeTargetBorder",label:"Target Node Border"}]},{title:"Delete Button",colors:[{key:"deleteBg",label:"Background"},{key:"deleteColor",label:"Color"},{key:"deleteHoverBg",label:"Hover Background"},{key:"deleteHoverColor",label:"Hover Color"}]},{title:"Node Handles",colors:[{key:"handleInputSupplied",label:"Input Supplied"},{key:"handleInputDeficient",label:"Input Deficient"},{key:"handleOutputConnected",label:"Output Connected"},{key:"handleOutputExcess",label:"Output Excess"}]},{title:"Statistics & Settings",colors:[{key:"statPositive",label:"Positive Stats"},{key:"statNegative",label:"Negative Stats"},{key:"settingsInputLabel",label:"Settings Input Label"},{key:"settingsOutputLabel",label:"Settings Output Label"}]},{title:"Machine Tier Colors",colors:[{key:"tier1Color",label:"Tier 1 (Grey)"},{key:"tier2Color",label:"Tier 2 (Green)"},{key:"tier3Color",label:"Tier 3 (Blue)"},{key:"tier4Color",label:"Tier 4 (Purple)"},{key:"tier5Color",label:"Tier 5 (Yellow)"}]}],N=[{value:"bezier",label:"Bezier (Curved)"},{value:"straight",label:"Straight"},{value:"orthogonal",label:"Orthogonal (90Â° angles)"}],$=[{value:"animated",label:"Animated Dash"},{value:"dashed",label:"Static Dash"},{value:"solid",label:"Solid Line"}];return e.jsx("div",{className:"modal-overlay",onClick:t,children:e.jsxs("div",{className:"modal",onClick:S=>S.stopPropagation(),style:{width:c?"700px":"600px",maxHeight:"85vh"},children:[e.jsx("h2",{className:"modal-title",children:"Theme Editor"}),c?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(!1),className:"btn btn-secondary btn-back",children:"â† Back to Presets"}),e.jsxs("div",{className:"modal-content",style:{maxHeight:"55vh"},children:[e.jsxs("div",{className:"theme-group",children:[e.jsx("h3",{className:"theme-group-title",children:"Edge Settings"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"theme-color-label",children:"Path Type:"}),e.jsx("select",{value:n.edgePath||"bezier",onChange:S=>p("edgePath",S.target.value),className:"select",style:{marginTop:"6px"},children:N.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"theme-color-label",children:"Line Style:"}),e.jsx("select",{value:n.edgeStyle||"animated",onChange:S=>p("edgeStyle",S.target.value),className:"select",style:{marginTop:"6px"},children:$.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))})]})]})]}),D.map(S=>e.jsxs("div",{className:"theme-group",children:[e.jsx("h3",{className:"theme-group-title",children:S.title}),e.jsx("div",{className:"theme-color-grid",children:S.colors.map(k=>{const W=n[k.key]||"#000000",I=W.length>7?W.substring(0,7):W;return e.jsxs("div",{className:"theme-color-item",children:[e.jsx("label",{className:"theme-color-label",children:k.label}),e.jsxs("div",{className:"theme-color-inputs",children:[e.jsx("input",{type:"color",value:I,onChange:H=>{const B=n[k.key];if(B&&B.length>7){const w=B.substring(7);p(k.key,H.target.value+w)}else p(k.key,H.target.value)},className:"theme-color-picker"}),e.jsx("input",{type:"text",value:n[k.key],onChange:H=>p(k.key,H.target.value),className:"input theme-color-text"})]})]},k.key)})})]},S.title))]}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"20px"},children:[e.jsx("button",{onClick:y,className:"btn btn-secondary",style:{flex:1},children:"Reset to Default"}),e.jsx("button",{onClick:t,className:"btn btn-primary",style:{flex:1},children:"Done"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"modal-content",style:{maxHeight:"60vh"},children:[e.jsx("div",{style:{marginBottom:"20px"},children:e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"14px",marginBottom:"15px",textAlign:"center"},children:"Choose a preset theme or customize your own"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:lo.map(S=>e.jsx("div",{onClick:()=>h(S),className:"theme-preset-card",style:{padding:"15px",background:"var(--bg-main)",border:"2px solid var(--border-primary)",borderRadius:"8px",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s"},onMouseEnter:k=>{k.currentTarget.style.transform="scale(1.02)",k.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)"},onMouseLeave:k=>{k.currentTarget.style.transform="scale(1)",k.currentTarget.style.boxShadow="none"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"4px"},children:S.name}),e.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:S.description})]}),e.jsx("div",{style:{display:"flex",gap:"6px"},children:[S.theme.colorPrimary,S.theme.bgMain,S.theme.inputBorder,S.theme.outputBorder].map((k,W)=>e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"4px",background:k,border:"1px solid rgba(255,255,255,0.2)"}},W))})]})},S.id))})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"20px"},children:[e.jsx("button",{onClick:()=>u(!0),className:"btn btn-secondary",style:{flex:1},children:"Advanced Editing"}),e.jsx("button",{onClick:t,className:"btn btn-primary",style:{flex:1},children:"Close"})]})]})]})})},po="industrialist_db",mo=1,Ie="canvas_saves",Zt="industrialist_current_save_id";let yr=null;const _t=()=>new Promise((t,n)=>{if(yr){t(yr);return}const i=indexedDB.open(po,mo);i.onerror=()=>{console.error("IndexedDB failed to open:",i.error),n(i.error)},i.onsuccess=()=>{yr=i.result,t(yr)},i.onupgradeneeded=c=>{const u=c.target.result;if(!u.objectStoreNames.contains(Ie)){const h=u.createObjectStore(Ie,{keyPath:"id"});h.createIndex("timestamp","timestamp",{unique:!1}),h.createIndex("name","name",{unique:!1})}}}),fo=async()=>{try{const t=await _t();return new Promise((n,i)=>{const h=t.transaction([Ie],"readonly").objectStore(Ie).getAll();h.onsuccess=()=>{const p=h.result,y={};p.forEach(D=>{y[D.id]=D}),n(y)},h.onerror=()=>{console.error("Error getting saves:",h.error),i(h.error)}})}catch(t){return console.error("Error accessing IndexedDB:",t),{}}},Xo=async(t,n)=>{var i;try{const c=await _t(),u=`save_${Date.now()}`,h=(n.edges||[]).map(y=>{const{edgePath:D,edgeStyle:N,...$}=y.data||{};return{...y,data:$}}),p={id:u,name:t||"Untitled Save",timestamp:Date.now(),nodeCount:((i=n.nodes)==null?void 0:i.length)||0,data:{...n,edges:h}};return new Promise((y,D)=>{const S=c.transaction([Ie],"readwrite").objectStore(Ie).add(p);S.onsuccess=()=>{localStorage.setItem(Zt,u),y(p)},S.onerror=()=>{console.error("Error saving canvas:",S.error),D(S.error)}})}catch(c){return console.error("Error saving to IndexedDB:",c),null}},Zo=async t=>{try{const n=await _t();return new Promise((i,c)=>{const p=n.transaction([Ie],"readonly").objectStore(Ie).get(t);p.onsuccess=()=>{const y=p.result;y?(localStorage.setItem(Zt,t),i(y.data)):i(null)},p.onerror=()=>{console.error("Error loading save:",p.error),c(p.error)}})}catch(n){return console.error("Error loading from IndexedDB:",n),null}},es=async t=>{try{const n=await _t();return new Promise((i,c)=>{const p=n.transaction([Ie],"readwrite").objectStore(Ie).delete(t);p.onsuccess=()=>{localStorage.getItem(Zt)===t&&localStorage.removeItem(Zt),i(!0)},p.onerror=()=>{console.error("Error deleting save:",p.error),c(p.error)}})}catch(n){return console.error("Error deleting from IndexedDB:",n),!1}},ts=async(t,n)=>{try{const i=await _t();return new Promise((c,u)=>{const p=i.transaction([Ie],"readwrite").objectStore(Ie),y=p.get(t);y.onsuccess=()=>{const D=y.result;if(D){D.name=n;const N=p.put(D);N.onsuccess=()=>c(!0),N.onerror=()=>{console.error("Error updating save:",N.error),u(N.error)}}else c(!1)},y.onerror=()=>{console.error("Error getting save for rename:",y.error),u(y.error)}})}catch(i){return console.error("Error renaming in IndexedDB:",i),!1}},rs=async()=>{try{const t=localStorage.getItem(Zt);if(!t)return"Untitled";const n=await _t();return new Promise(i=>{const h=n.transaction([Ie],"readonly").objectStore(Ie).get(t);h.onsuccess=()=>{const p=h.result;i((p==null?void 0:p.name)||"Untitled")},h.onerror=()=>{console.error("Error getting current save name:",h.error),i("Untitled")}})}catch{return"Untitled"}},ho=async()=>{const t="industrialist_saves";try{const n=localStorage.getItem(t);if(!n)return;const i=JSON.parse(n),c=Object.keys(i);if(c.length===0){localStorage.removeItem(t);return}const u=await _t(),h=await fo();if(Object.keys(h).length>0){localStorage.removeItem(t);return}for(const p of c){const y=i[p];await new Promise((D,N)=>{const k=u.transaction([Ie],"readwrite").objectStore(Ie).add(y);k.onsuccess=()=>D(),k.onerror=()=>{console.error(`Error migrating save ${p}:`,k.error),D()}})}localStorage.removeItem(t),console.log(`Migrated ${c.length} saves from localStorage to IndexedDB`)}catch(n){console.error("Error during migration:",n)}},go=async()=>{try{await _t(),await ho()}catch(t){console.error("Failed to initialize save system:",t)}},Ir="industrialist_custom_products",Fr="industrialist_custom_machines",Er="industrialist_custom_recipes",xo=(t,n,i)=>{localStorage.getItem(Ir)||localStorage.setItem(Ir,JSON.stringify(t)),localStorage.getItem(Fr)||localStorage.setItem(Fr,JSON.stringify(n)),localStorage.getItem(Er)||localStorage.setItem(Er,JSON.stringify(i))},yo=()=>{try{const t=localStorage.getItem(Ir);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading custom products:",t),[]}},bo=()=>{try{const t=localStorage.getItem(Fr);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading custom machines:",t),[]}},vo=()=>{try{const t=localStorage.getItem(Er);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading custom recipes:",t),[]}},_o=t=>{try{return localStorage.setItem(Ir,JSON.stringify(t)),!0}catch(n){return console.error("Error saving custom products:",n),!1}},Co=t=>{try{return localStorage.setItem(Fr,JSON.stringify(t)),!0}catch(n){return console.error("Error saving custom machines:",n),!1}},So=t=>{try{return localStorage.setItem(Er,JSON.stringify(t)),!0}catch(n){return console.error("Error saving custom recipes:",n),!1}},jo=t=>_o(t),wo=t=>Co(t),Mo=t=>So(t),br=t=>typeof t=="number"?Math.round(t*1e4)/1e4:t,at=t=>typeof t!="number"?t:t>=1e9?br(t/1e9)+"B":t>=1e6?br(t/1e6)+"M":t>=1e3?br(t/1e3)+"k":br(t),Kr=t=>t>=1e6?`${(t/1e6).toFixed(2)} MMF/s`:t>=1e3?`${(t/1e3).toFixed(2)} kMF/s`:`${t.toFixed(2)} MF/s`,Po=t=>{const n=["p_coal","p_coke_fuel","p_planks","p_oak_log"],i=["r_industrial_firebox_01","r_industrial_firebox_02","r_industrial_firebox_03","r_industrial_firebox_04","r_industrial_firebox_05","r_industrial_firebox_06"];return ot.filter(u=>{if(["r_mineshaft_drill_01","r_logic_assembler_01"].includes(u.id))return!1;const h=["r_liquid_dump","r_liquid_burner"].includes(u.id),p=u.id==="r_underground_waste_facility"&&["p_concrete_block","p_lead_ingot"].includes(t);if(h||u.id==="r_underground_waste_facility"&&!p)return!1;const y=u.inputs.some(N=>N.product_id===t&&N.product_id!=="p_variableproduct"),D=n.includes(t)&&i.includes(u.id)&&u.inputs.some(N=>N.product_id==="p_variableproduct");return y||D||p})},ko=t=>ot.filter(n=>!["r_mineshaft_drill_01","r_logic_assembler_01"].includes(n.id)&&n.outputs.some(i=>i.product_id===t&&i.product_id!=="p_variableproduct")),vr=t=>{const n=ot.filter(i=>i.machine_id===t);return t==="m_underground_waste_facility"?[Xr]:t==="m_liquid_dump"?[Zr]:t==="m_liquid_burner"?[en]:n},ii=(t,n,i,c,u=ni)=>{const h=(c==null?void 0:c.minSteamTemp)||100;return t.map(p=>{if(i){if(p.product_id==="p_steam"){const y=Math.max(n,u),D=p.originalQuantity!==void 0?p.originalQuantity:p.quantity;return y<h?{...p,temperature:y,quantity:0,originalQuantity:D}:{...p,temperature:y,quantity:D,originalQuantity:D}}return p}if(ri(p.product_id)){const y=Math.max(n,u);return{...p,temperature:y}}return p})},Qt=(t,n)=>{let i={...t};const c=xt[n];if(c){const h=Na(n),p=c.type==="boiler",y=p?kt:ni,D=p?{...h,coolantTemp:kt}:h;let N=null;if(c.type==="product_dependent"&&t.inputs){const k=t.inputs.find(W=>["p_water","p_filtered_water","p_distilled_water"].includes(W.product_id));N=(k==null?void 0:k.product_id)||null}const $=cn(n,D,y,N,p?kt:null),S=ii(t.outputs,$,p,c,y);i={...i,outputs:S,temperatureSettings:D}}if(mt(n)){const h=bt[n];(h==null?void 0:h.type)==="steam_input"&&(i={...i,tempDependentInputTemp:st})}return i},To=(t,n,i,c,u,h,p)=>{if(!i||!n)return 1;const y=n.data.recipe,D=n.data.machineCount||0,N=xe(y.machine_id);let $=y.cycle_time;if((typeof $!="number"||$<=0)&&($=1),N&&mt(N.id)){const B=bt[N.id];if((B==null?void 0:B.type)==="steam_input"&&(N.id!=="m_steam_cracking_plant"||vt(y))){const w=y.tempDependentInputTemp??st;$=yt(N.id,w,$)}}const S=ai(t,i,null,u,h,c);let k=S.cycle_time;(typeof k!="number"||k<=0)&&(k=1);const W=xe(S.machine_id);if(W&&mt(W.id)){const B=bt[W.id];if((B==null?void 0:B.type)==="steam_input"&&(W.id!=="m_steam_cracking_plant"||vt(S))){const w=S.tempDependentInputTemp??st;k=yt(W.id,w,k)}}let I=0,H=!1;if(p&&p.byNode&&p.byNode[n.id]){const B=p.byNode[n.id];if(i.isOutput){const w=B.outputFlows[i.outputIndex];if(w){H=!0;const V=w.produced-w.connected;I=Math.max(0,V)}}else{const w=B.inputFlows[i.inputIndex];if(w){H=!0;const V=w.needed-w.connected;I=Math.max(0,V)}}}if(H&&I===0)return 0;if(!H)if(i.isOutput){const B=y.outputs[i.outputIndex];if(B){const w=B.originalQuantity!==void 0?B.originalQuantity:B.quantity;typeof w=="number"&&(I=w/$*D)}}else{const B=y.inputs[i.inputIndex];B&&typeof B.quantity=="number"&&(I=B.quantity/$*D)}if(i.isOutput){const B=S.inputs.find(w=>w.product_id===i.productId);if(B&&typeof B.quantity=="number"&&B.quantity>0){const w=B.quantity/k;return I/w}}else{const B=S.outputs.find(w=>w.product_id===i.productId);if(B){const w=B.originalQuantity!==void 0?B.originalQuantity:B.quantity;if(typeof w=="number"&&w>0){const V=w/k;return I/V}}}return 1},ai=(t,n,i,c,u,h)=>{var D,N,$,S,k,W,I,H,B,w,V,Q;let p={...t};const y=xe(t.machine_id);if(!oi(p))return p;if((y==null?void 0:y.id)==="m_industrial_firebox"&&ti(t.id)){const L=["p_coal","p_coke_fuel","p_planks","p_oak_log"];let A=((D=c==null?void 0:c.fireboxConfig)==null?void 0:D.fuel)||"p_coke_fuel";const q=(n==null?void 0:n.productId)||(i==null?void 0:i.id);q&&L.includes(q)&&(A=q);const Y=Gr(t.id,A);return Y&&(p={...p,inputs:Yr(t.inputs,A,t.id),fireboxSettings:{fuel:A},cycle_time:Y.cycleTime,power_consumption:0}),p}if(t.isMineshaftDrill||t.id==="r_mineshaft_drill"){const L=((N=c==null?void 0:c.drillConfig)==null?void 0:N.drillHead)||"steel",A=(($=c==null?void 0:c.drillConfig)==null?void 0:$.consumable)||"hydrochloric_acid",q=((S=c==null?void 0:c.drillConfig)==null?void 0:S.machineOil)!==void 0?c.drillConfig.machineOil:!0,Y=["p_copper_drill_head","p_iron_drill_head","p_steel_drill_head","p_tungsten_carbide_drill_head"],O={p_copper_drill_head:"copper",p_iron_drill_head:"iron",p_steel_drill_head:"steel",p_tungsten_carbide_drill_head:"tungsten_carbide"};let K=L,re=100;const ne=(n==null?void 0:n.productId)||(i==null?void 0:i.id);if(ne)if(Y.includes(ne))K=O[ne];else if(n!=null&&n.isOutput)re=100;else{const ae=h(ne,K,A,q);ae&&(re=ae)}const ie=Zn(K,A,q,re),de=ei(K,A,q,re),E=Xt(K,A,q,re);return p={...p,inputs:ie.length>0?ie:[{product_id:"p_variableproduct",quantity:"Variable"}],outputs:de.length>0?de:[{product_id:"p_variableproduct",quantity:"Variable"}],drillSettings:{drillHead:K,consumable:A,machineOil:q,depth:re},cycle_time:1,power_consumption:E?{max:E.drillingPower*1e6,average:(E.drillingPower*E.lifeTime+E.idlePower*(E.replacementTime+E.travelTime))/E.totalCycleTime*1e6}:"Variable",pollution:E?E.pollution:"Variable"},p}if(t.isLogicAssembler||t.id==="r_logic_assembler"){const L=((k=c==null?void 0:c.assemblerConfig)==null?void 0:k.outerStage)||1,A=((W=c==null?void 0:c.assemblerConfig)==null?void 0:W.innerStage)||2,q=((I=c==null?void 0:c.assemblerConfig)==null?void 0:I.machineOil)!==void 0?c.assemblerConfig.machineOil:!0,Y=((H=c==null?void 0:c.assemblerConfig)==null?void 0:H.tickCircuitDelay)||0;let O=L===1?`p_${A}x_microchip`:`p_${L}x${A}x_microchip`;const K=(n==null?void 0:n.productId)||(i==null?void 0:i.id);K&&K.includes("microchip")&&(O=K);const re=Yn(O,q),ne=Xn(O,q),ie=ln(O,q,Y),de=O.match(/p_(?:(\d+)x)?(\d+)x_microchip/),E=de&&de[1]?parseInt(de[1]):1,ae=de?parseInt(de[2]):A;return p={...p,inputs:re.length>0?re:[{product_id:"p_logic_plate",quantity:"Variable"},{product_id:"p_copper_wire",quantity:"Variable"},{product_id:"p_semiconductor",quantity:"Variable"},{product_id:"p_gold_wire",quantity:"Variable"}],outputs:ne.length>0?ne:[{product_id:"p_variableproduct",quantity:"Variable"}],assemblerSettings:{outerStage:E,innerStage:ae,machineOil:q,tickCircuitDelay:Y},cycle_time:ie?ie.cycleTime:"Variable",power_consumption:ie?{max:ie.maxPowerConsumption,average:ie.avgPowerConsumption}:"Variable"},p}if(t.isTreeFarm||t.id==="r_tree_farm"){const L=((B=c==null?void 0:c.treeFarmConfig)==null?void 0:B.trees)||450,A=((w=c==null?void 0:c.treeFarmConfig)==null?void 0:w.harvesters)||20,q=((V=c==null?void 0:c.treeFarmConfig)==null?void 0:V.sprinklers)||24,Y=((Q=c==null?void 0:c.treeFarmConfig)==null?void 0:Q.outputs)||8,O=1,K=Gn(q),re=sn(L,A,u),ne=kr(L,A,q,Y,O,u);return p={...p,inputs:K.length>0?K:[{product_id:"p_water",quantity:"Variable"}],outputs:re.length>0?re:[{product_id:"p_oak_log",quantity:"Variable"}],treeFarmSettings:{trees:L,harvesters:A,sprinklers:q,outputs:Y,controller:O},cycle_time:1,power_consumption:ne?ne.avgPowerConsumption:"Variable",pollution:0},p}if(t.isWasteFacility||t.id==="r_underground_waste_facility"){let L="p_any_item",A="p_any_fluid";const q=(n==null?void 0:n.productId)||(i==null?void 0:i.id);if(q)if(q==="p_concrete_block"||q==="p_lead_ingot")L="p_fission_byproducts",A="p_depleted_uf6_waste";else{const K=ve(q);(K==null?void 0:K.type)==="item"?(L=q,A="p_any_fluid"):(K==null?void 0:K.type)==="fluid"&&(L="p_any_item",A=q)}else L="p_fission_byproducts",A="p_depleted_uf6_waste";const Y=Pr(0,0,L,A),O=Sr(0,0);return p={...p,inputs:Y,outputs:[],wasteFacilitySettings:{itemProductId:L,fluidProductId:A,itemFlowRate:0,fluidFlowRate:0},cycle_time:O.cycleTime,power_consumption:1e6,pollution:0},p}if(t.isLiquidDump||t.id==="r_liquid_dump"){let L=["p_water","p_residue"];const A=(n==null?void 0:n.productId)||(i==null?void 0:i.id);if(A){const O=ve(A);(O==null?void 0:O.type)==="fluid"&&(L=[A,A])}const q=Jr(L),Y=Gt(q);return p={...p,inputs:q,outputs:[],liquidDumpSettings:{fluidProductIds:L},cycle_time:1,power_consumption:0,pollution:Y},p}if(t.isLiquidBurner||t.id==="r_liquid_burner"){let L=["p_water","p_filtered_water","p_distilled_water","p_steam","p_oxygen","p_hydrogen","p_residue","p_depleted_uf6_waste"];const A=(n==null?void 0:n.productId)||(i==null?void 0:i.id);if(A){const O=ve(A);(O==null?void 0:O.type)==="fluid"&&(L=Array(8).fill(A))}const q=Qr(L),Y=Jt(q);return p={...p,inputs:q,outputs:[],liquidBurnerSettings:{fluidProductIds:L},cycle_time:1,power_consumption:0,pollution:Y},p}return p},No=t=>t==="r_mineshaft_drill"?["p_copper_drill_head","p_iron_drill_head","p_steel_drill_head","p_tungsten_carbide_drill_head","p_water","p_acetic_acid","p_hydrochloric_acid","p_sulfuric_acid","p_machine_oil"]:t==="r_logic_assembler"?["p_logic_plate","p_copper_wire","p_semiconductor","p_gold_wire","p_machine_oil"]:t==="r_tree_farm"?["p_water"]:["r_industrial_firebox_01","r_industrial_firebox_02","r_industrial_firebox_03","r_industrial_firebox_04","r_industrial_firebox_05","r_industrial_firebox_06"].includes(t)?["p_coal","p_coke_fuel","p_planks","p_oak_log"]:t==="r_underground_waste_facility"?["p_any_item","p_any_fluid","p_concrete_blocks","p_lead_ingot"]:t==="r_liquid_dump"||t==="r_liquid_burner"?["p_any_fluid"]:[],Io=t=>{if(t==="r_mineshaft_drill"){const n=new Set;return Object.values(tn).forEach(i=>{i.forEach(c=>n.add(c.product_id))}),Array.from(n)}return t==="r_logic_assembler"?_a.map(n=>n.productId):t==="r_tree_farm"?["p_oak_log"]:[]},oi=t=>t.isMineshaftDrill||t.id==="r_mineshaft_drill"||t.isLogicAssembler||t.id==="r_logic_assembler"||t.isTreeFarm||t.id==="r_tree_farm"||t.isWasteFacility||t.id==="r_underground_waste_facility"||t.isLiquidDump||t.id==="r_liquid_dump"||t.isLiquidBurner||t.id==="r_liquid_burner"||t.machine_id==="m_industrial_firebox"&&ti(t.id),Kn=1e-6,Fo=(t,n,i,c,u,h=null)=>{if(n<Kn)return new Map([[t,i]]);const p=i/n,y=new Map;y.set(t,i);const D=new Map;D.set(t,p);const N=new Set([t]),$=[t];for(;$.length>0;){const I=$.shift(),H=c.nodes[I];H&&(H.outputs.forEach(B=>{var V;(((V=c.products[B.productId])==null?void 0:V.connections.filter(Q=>Q.sourceNodeId===I))||[]).forEach(Q=>{N.has(Q.targetNodeId)||(N.add(Q.targetNodeId),$.push(Q.targetNodeId))})}),H.inputs.forEach(B=>{var V;(((V=c.products[B.productId])==null?void 0:V.connections.filter(Q=>Q.targetNodeId===I))||[]).forEach(Q=>{N.has(Q.sourceNodeId)||(N.add(Q.sourceNodeId),$.push(Q.sourceNodeId))})}))}const S=10;let k=0,W=!0;for(;W&&k<S;)W=!1,k++,N.forEach(I=>{var Y;if(I===t)return;const H=c.nodes[I];if(!H)return;const B=(Y=h==null?void 0:h.find(O=>O.id===I))==null?void 0:Y.data,w=(B==null?void 0:B.machineCountMode)||H.machineCountMode||"free";if(w==="locked")return;const V=H.machineCount||0;if(V<Kn)return;const Q=[],L=[];if(H.outputs.forEach((O,K)=>{var ne;(((ne=c.products[O.productId])==null?void 0:ne.connections.filter(ie=>ie.sourceNodeId===I&&ie.sourceOutputIndex===K))||[]).forEach(ie=>{const de=D.get(ie.targetNodeId);de!==void 0&&(Q.push(de),L.push({type:"output",productId:O.productId,targetNodeId:ie.targetNodeId,ratio:de}))})}),H.inputs.forEach((O,K)=>{var ne;(((ne=c.products[O.productId])==null?void 0:ne.connections.filter(ie=>ie.targetNodeId===I&&ie.targetInputIndex===K))||[]).forEach(ie=>{const de=D.get(ie.sourceNodeId);de!==void 0&&(Q.push(de),L.push({type:"input",productId:O.productId,sourceNodeId:ie.sourceNodeId,ratio:de}))})}),Q.length===0)return;const A=Math.max(...Q),q=D.get(I)||1;if(Math.abs(A-q)>1e-4){D.set(I,A);let O=V*A;if(w==="capped"){const K=(B==null?void 0:B.cappedMachineCount)||H.cappedMachineCount;typeof K=="number"&&(O=Math.min(O,K))}y.set(I,O),W=!0}});return y},an=44,si=8,on=120,Mr=380,Eo=new Ra,li=t=>{var h,p,y;const n=(h=t.data)==null?void 0:h.recipe;if(!n)return on+100;const i=Math.max(((p=n.inputs)==null?void 0:p.length)||0,((y=n.outputs)==null?void 0:y.length)||0,1),u=i*an+(i-1)*si+24;return on+u+12},Qn=t=>on+12+t*(an+si)+an/2,Do=(t,n)=>{const i=new Map;t.forEach(h=>i.set(h.id,new Set)),n.forEach(h=>{i.has(h.source)&&i.has(h.target)&&(i.get(h.source).add(h.target),i.get(h.target).add(h.source))});const c=new Set,u=[];return t.forEach(h=>{var D;if(c.has(h.id))return;const p=new Set,y=[h.id];for(;y.length>0;){const N=y.pop();c.has(N)||(c.add(N),p.add(N),(D=i.get(N))==null||D.forEach($=>{c.has($)||y.push($)}))}u.push(p)}),u},Ro=async(t,n,i={})=>{const c=i.edgePath||"orthogonal",u=c==="straight"?"POLYLINE":"ORTHOGONAL",h=c==="straight"?"260":"200",p=t.map(S=>{var Q,L,A;const k=Mr,W=li(S),I=(Q=S.data)==null?void 0:Q.recipe,H=((L=I==null?void 0:I.inputs)==null?void 0:L.length)||0,B=((A=I==null?void 0:I.outputs)==null?void 0:A.length)||0,w=Array.from({length:H},(q,Y)=>({id:`${S.id}__left-${Y}`,properties:{"port.side":"WEST","port.index":Y},x:0,y:Qn(Y)})),V=Array.from({length:B},(q,Y)=>({id:`${S.id}__right-${Y}`,properties:{"port.side":"EAST","port.index":Y},x:k,y:Qn(Y)}));return{id:S.id,width:k,height:W,ports:[...w,...V],properties:{portConstraints:"FIXED_POS"}}}),y=new Map;t.forEach((S,k)=>y.set(S.id,k));const D=n.map(S=>{const k=y.get(S.source)??0,W=y.get(S.target)??0;return{id:S.id,sources:[`${S.source}__${S.sourceHandle||"right-0"}`],targets:[`${S.target}__${S.targetHandle||"left-0"}`],properties:W<=k?{"elk.layered.feedbackEdge":"true"}:{}}}),N={id:"root",properties:{algorithm:"layered","elk.direction":"RIGHT","elk.edgeRouting":u,"elk.layered.crossingMinimization.strategy":"LAYER_SWEEP","elk.layered.nodePlacement.strategy":"BRANDES_KOEPF","elk.layered.spacing.nodeNodeBetweenLayers":h,"elk.spacing.nodeNode":h,"elk.layered.spacing.edgeNodeBetweenLayers":"100","elk.layered.spacing.edgeEdgeBetweenLayers":c==="straight"?"40":"20","elk.spacing.edgeNode":c==="orthogonal"?"80":"20","elk.layered.feedbackEdges":"true","elk.padding":"[top=120, left=120, bottom=120, right=120]"},children:p,edges:D},$=await Eo.layout(N);return{children:$.children||[],edges:$.edges||[]}},Bo=t=>{var D;const n=[...t].sort((N,$)=>$.bounds.width-N.bounds.width),i=200,c=Math.max(3e3,(((D=n[0])==null?void 0:D.bounds.width)||0)+i*2),u=new Map;let h=0,p=0,y=0;return n.forEach((N,$)=>{h>0&&h+N.bounds.width>c&&(p+=y+i,h=0,y=0),u.set($,{offsetX:h,offsetY:p}),h+=N.bounds.width+i,y=Math.max(y,N.bounds.height)}),{sorted:n,positions:u}},Oo=async(t,n,i={})=>{if(!t||t.length===0)return{nodes:t,edges:n};const c=i.edgePath||"orthogonal",u=Do(t,n),h=new Map(t.map(I=>[I.id,I])),p=new Map(n.map(I=>[I.id,I])),y=await Promise.all(u.map(async I=>{const H=[...I].map(w=>h.get(w)),B=n.filter(w=>I.has(w.source)&&I.has(w.target));try{const{children:w,edges:V}=await Ro(H,B,i);let Q=1/0,L=1/0,A=-1/0,q=-1/0;return w.forEach(Y=>{Q=Math.min(Q,Y.x),L=Math.min(L,Y.y),A=Math.max(A,Y.x+Y.width),q=Math.max(q,Y.y+Y.height)}),{layoutedChildren:w,layoutedEdges:V,bounds:{x:Q,y:L,width:A-Q,height:q-L}}}catch(w){return console.error("ELK layout failed for component:",w),{layoutedChildren:H.map(V=>({id:V.id,x:V.position.x,y:V.position.y,width:Mr,height:li(V)})),layoutedEdges:[],bounds:{x:0,y:0,width:Mr,height:200}}}})),{sorted:D,positions:N}=Bo(y),$=new Map;D.forEach((I,H)=>{const{offsetX:B,offsetY:w}=N.get(H);I.layoutedChildren.forEach(V=>{$.set(V.id,{x:V.x-I.bounds.x+B,y:V.y-I.bounds.y+w})})});const S=new Map;D.forEach((I,H)=>{const{offsetX:B,offsetY:w}=N.get(H),V=L=>L-I.bounds.x+B,Q=L=>L-I.bounds.y+w;I.layoutedEdges.forEach(L=>{var q;const A=p.get(L.id);if(A){if(c==="bezier"){S.set(L.id,{bezierPoints:[],orthoMidX:void 0,orthoMidY:void 0});return}if(c==="orthogonal"){const Y=(q=L.sections)==null?void 0:q[0];if(!Y)return;const O=(Y.bendPoints||[]).map(E=>({x:V(E.x),y:Q(E.y)}));if(O.length===0)return;const K=$.get(A.source),re=$.get(A.target);if(!K||!re)return;const ne=K.x+Mr;if(re.x<=ne+60){const E=O.slice(1,-1);if(E.length>0){const ae=E.reduce((te,ue)=>te+ue.y,0)/E.length;S.set(L.id,{orthoMidY:ae,orthoMidX:void 0})}}else{const E=O.reduce((ae,te)=>ae+te.x,0)/O.length;S.set(L.id,{orthoMidX:E,orthoMidY:void 0})}}}})});const k=t.map(I=>{const H=$.get(I.id);return H?{...I,position:H}:I}),W=n.map(I=>{const H=S.get(I.id);return H?{...I,data:{...I.data,...H}}:I});return{nodes:k,edges:W}},Lo=Ot.lazy(()=>Dr(()=>import("./HelpModal-aQHrwfcs.js"),__vite__mapDeps([0,1,2]))),$o=Ot.lazy(()=>Dr(()=>import("./SaveManager-DT06NkgO.js"),__vite__mapDeps([3,1,4,5,6,7,8]))),Ao=Ot.lazy(()=>Dr(()=>import("./DataManager-DrJ2xv6U.js"),__vite__mapDeps([9,1,4,5,6,7,8]))),Ho=Ot.lazy(()=>Dr(()=>import("./ComputeModal-BAdoJ3BY.js"),__vite__mapDeps([2,1]))),zo=()=>e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",background:"var(--bg-secondary)",border:"2px solid var(--border-primary)",borderRadius:"var(--radius-lg)",padding:"40px 60px",boxShadow:"var(--shadow-lg)"},children:[e.jsxs("svg",{width:"52",height:"52",style:{animation:"lp-spin 1.1s linear infinite"},viewBox:"0 0 52 52",children:[e.jsx("style",{children:"@keyframes lp-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"}),Array.from({length:10}).map((t,n)=>{const i=n/10*2*Math.PI-Math.PI/2,c=26+20*Math.cos(i),u=26+20*Math.sin(i);return e.jsx("circle",{cx:c,cy:u,r:1+n/9*1.75,fill:"var(--color-primary)",opacity:.2+n/9*.8},n)})]}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"var(--font-size-sm)"},children:"Loading..."})]})}),Wo={custom:ro},qo={custom:so},_r=t=>typeof t=="number"?t.toFixed(4):"0",Cr=({productName:t,connectedFlow:n,currentExcess:i,onTargetExcessCommit:c,styleType:u})=>{const[h,p]=m.useState(""),[y,D]=m.useState(!1),N=y?h:_r(i),$=()=>{if(!y)return;const H=parseFloat(h);isNaN(H)||c(H),D(!1),p("")},S=u==="input",k=S?"var(--input-bg)":"var(--output-bg)",W=S?"var(--input-border)":"var(--output-border)",I=S?"var(--input-text)":"var(--output-text)";return e.jsxs("div",{style:{marginBottom:"10px",padding:"8px",background:k,border:`1px solid ${W}`,borderRadius:"var(--radius-sm)"},children:[e.jsx("div",{style:{color:I,fontSize:"12px",marginBottom:"6px",fontWeight:600},children:t}),e.jsxs("div",{style:{fontSize:"11px",color:"var(--text-muted)",marginBottom:"6px"},children:["Connected: ",_r(n),"/s"]}),e.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)",marginBottom:"6px"},children:[S?"Current Deficiency:":"Current Excess:"," ",_r(Math.abs(i)),"/s"]}),e.jsx("div",{style:{fontSize:"10px",color:"var(--text-muted)",marginBottom:"4px"},children:S?"Target Additional Demand:":"Target Excess:"}),e.jsx("input",{type:"text",value:N,onFocus:()=>{D(!0),p(_r(i))},onChange:H=>p(H.target.value),onBlur:$,onKeyPress:H=>H.key==="Enter"&&$(),className:"input",style:{padding:"6px",fontSize:"13px",width:"100%"}}),e.jsx("div",{style:{color:"var(--text-muted)",fontSize:"10px",marginTop:"4px",textAlign:"right"},children:"/s"})]})},Jn=t=>{if(t<0)return 0;const n=1+5429*t/7322;return Math.pow(Math.log(n),1.1)};function Vo(){const[t,n,i]=ca([]),[c,u,h]=da([]),[p,y]=m.useState(0),[D,N]=m.useState(!1),[$,S]=m.useState(!1),[k,W]=m.useState(null),[I,H]=m.useState(null),[B,w]=m.useState("product"),[V,Q]=m.useState("button"),[L,A]=m.useState(""),[q,Y]=m.useState("name_asc"),[O,K]=m.useState("all"),[re,ne]=m.useState("all"),[ie,de]=m.useState("all"),[E,ae]=m.useState(null),[te,ue]=m.useState([]),[Tt,lt]=m.useState(!1),[Xe,Fe]=m.useState(!1),[Te,Le]=m.useState("targets"),[pe,Se]=m.useState(0),[ct,J]=m.useState(!1),[X,ee]=m.useState(null),[ye,he]=m.useState(""),[se,Re]=m.useState(null),[le,ge]=m.useState("free"),[Ce,_e]=m.useState(!1),[je,we]=m.useState(!1),[Nt,Lt]=m.useState(!1),[er,tr]=m.useState(!1),[un,rr]=m.useState(!1),[ft,$t]=m.useState(!1),[be,At]=m.useState(()=>{const r=wr();return{edgePath:r.edgePath||"orthogonal",edgeStyle:r.edgeStyle||"animated"}}),[ht,pn]=m.useState(!1),[Ze,nr]=m.useState(!1),[oe,ir]=m.useState(!1),[Ee,Ht]=m.useState("pan"),[b,fe]=m.useState(0),[Ct,ar]=m.useState(!1);m.useEffect(()=>{oe&&Ze&&ft&&$t(!1)},[oe,Ze,ft]);const[It,or]=m.useState(!0),[zt,De]=m.useState(1),[$e,Be]=m.useState({}),[Me,ci]=m.useState("perSecond"),[Ne,di]=m.useState("total"),[et,gt]=m.useState([]),[We,Ae]=m.useState(null),[qe,He]=m.useState(null),[Ve,ze]=m.useState(null),[Ue,Ke]=m.useState(null),[Ft,tt]=m.useState(null),[Rr,mn]=m.useState({}),[Qe,Br]=m.useState(null),[Or,Lr]=m.useState({}),[sr,ui]=m.useState("all"),[Et,Wt]=m.useState(["Deficiencies","Model Count","Excesses","Pollution","Power","Cost"]),[$r,Ar]=m.useState([]),[fn,pi]=m.useState({x:0,y:0}),[St,jt]=m.useState(null),qt=m.useRef(null),dt=m.useRef(null),mi=m.useRef(null),Dt=m.useRef(null),fi=getComputedStyle(document.documentElement).getPropertyValue("--color-primary").trim().toLowerCase()==="#5fb573"?"Plant Statistics":"Plan Statistics",Hr=m.useRef(null),lr=m.useRef([]),hi=m.useCallback(r=>{const o=r.filter(l=>l.type!=="remove"),s=o.filter(l=>l.type==="position"),a=o.filter(l=>l.type!=="position");s.length>0&&i(s),a.length>0&&(lr.current.push(...a),Hr.current&&clearTimeout(Hr.current),Hr.current=setTimeout(()=>{lr.current.length>0&&(i(lr.current),lr.current=[])},50))},[i]),gi=m.useCallback(r=>{h(r)},[h]);m.useEffect(()=>{const r=wr();Nr(r),At({edgePath:r.edgePath||"orthogonal",edgeStyle:r.edgeStyle||"animated"}),xo(Ye,it,ot);const o=()=>{const l="ontouchstart"in window||navigator.maxTouchPoints>0,d=window.matchMedia("(pointer: coarse)").matches,f=window.matchMedia("(hover: none)").matches,g=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);ir(l&&d||l&&f||g)};o(),window.addEventListener("resize",o);const s=window.matchMedia("(pointer: coarse)"),a=window.matchMedia("(hover: none)");return s.addEventListener("change",o),a.addEventListener("change",o),()=>{window.removeEventListener("resize",o),s.removeEventListener("change",o),a.removeEventListener("change",o)}},[]);const Je=m.useCallback(()=>({onInputClick:Si,onOutputClick:ji,isMobile:oe,mobileActionMode:Ee,onDrillSettingsChange:wi,onLogicAssemblerSettingsChange:Mi,onTreeFarmSettingsChange:Pi,onIndustrialFireboxSettingsChange:ki,onTemperatureSettingsChange:Ti,onBoilerSettingsChange:Ni,onChemicalPlantSettingsChange:Fi,onWasteFacilitySettingsChange:Ei,onLiquidDumpSettingsChange:Di,onLiquidBurnerSettingsChange:Ri,onMiddleClick:$i,onHandleDoubleClick:Ii,onMachineCountModeChange:Wi}),[oe,Ee]);m.useEffect(()=>{go().catch(a=>{console.error("Failed to initialize save system:",a)});const r=Ca();if(!(r!=null&&r.nodes))return;const o=Je(),s=r.nodes.map(a=>{var f,g,C,M;const l=xe((g=(f=a.data)==null?void 0:f.recipe)==null?void 0:g.machine_id);let d=(C=a.data)==null?void 0:C.recipe;return l&&d&&!((M=d.outputs)!=null&&M.some(F=>F.temperature!==void 0))&&(d=Qt(d,l.id)),{...a,data:{...a.data,recipe:d,machine:l,machineCount:a.data.machineCount??1,displayMode:Me,machineDisplayMode:Ne,...o,globalPollution:b,flows:null,suggestions:[]}}});n(s),u((r.edges||[]).map(a=>{const{edgePath:l,edgeStyle:d,...f}=a.data||{};return{...a,data:{...f,...be}}})),ue(r.targetProducts||[]),Be(r.soldProducts||{}),gt(r.favoriteRecipes||[]),Ae(r.lastDrillConfig||null),He(r.lastAssemblerConfig||null),ze(r.lastTreeFarmConfig||null),Ke(r.lastFireboxConfig||null),tt(r.lastWasteFacilityConfig||null),y(r.nodeId||0),Se(r.targetIdCounter||0)},[]),m.useEffect(()=>{n(r=>{let o=!1;const s=r.map(a=>a.data.displayMode===Me&&a.data.machineDisplayMode===Ne&&a.data.zoomLevel===zt?a:(o=!0,{...a,data:{...a.data,displayMode:Me,machineDisplayMode:Ne,zoomLevel:zt}}));return o?s:r})},[Me,Ne,zt,n]),m.useEffect(()=>{u(r=>{let o=!1;const s=r.map(a=>{var l,d;return((l=a.data)==null?void 0:l.edgePath)===be.edgePath&&((d=a.data)==null?void 0:d.edgeStyle)===be.edgeStyle?a:(o=!0,{...a,data:be})});return o?s:r})},[be,u]);const wt=m.useCallback(r=>({id:r.id,type:r.type,position:r.position,sourcePosition:r.sourcePosition,targetPosition:r.targetPosition,data:{recipe:r.data.recipe,machineCount:r.data.machineCount,machineCountMode:r.data.machineCountMode,cappedMachineCount:r.data.cappedMachineCount,isTarget:r.data.isTarget,leftHandles:r.data.leftHandles,rightHandles:r.data.rightHandles}}),[]);m.useEffect(()=>{const r={nodes:t.map(wt),edges:c,targetProducts:te,nodeId:p,targetIdCounter:pe,soldProducts:$e,favoriteRecipes:et,lastDrillConfig:We,lastAssemblerConfig:qe,lastTreeFarmConfig:Ve,lastFireboxConfig:Ue,lastWasteFacilityConfig:Ft};localStorage.setItem("industrialist_canvas_state",JSON.stringify(r))},[t,c,te,p,pe,$e,et,We,qe,Ve,Ue,Ft,wt]);const xi=m.useCallback(()=>{var l,d;let r=0,o=0,s=0;const a=t.length;for(let f=0;f<a;f++){const g=t[f],{recipe:C,machine:M,machineCount:F=0}=g.data||{};if(!C)continue;const x=typeof C.pollution=="number"?C.pollution:parseFloat(C.pollution);!isNaN(x)&&isFinite(x)&&(o+=x*F);const _=(((l=C.inputs)==null?void 0:l.length)||0)+(((d=C.outputs)==null?void 0:d.length)||0),j=Math.ceil(F);if((M==null?void 0:M.id)==="m_industrial_firebox"){s+=j*(1+_*2);continue}if((M==null?void 0:M.id)==="m_tree_farm"&&C.treeFarmSettings){const{trees:T,harvesters:z,sprinklers:Z,controller:me,outputs:ce}=C.treeFarmSettings,ke=typeof C.power_consumption=="number"?C.power_consumption:0;r+=ke*F;const Oe=Math.ceil(Z/3),Pe=C.power_type==="HV"?2:Math.ceil(ke/15e5)*2,Vt=T+z+Z+Oe*3+me+ce*3+Pe;s+=j*Vt;continue}const v=C.power_consumption;let P=0;typeof v=="number"?(P=v,r+=v*F):typeof v=="object"&&v!==null&&"max"in v&&(P=v.max,r+=P*F);const R=C.power_type==="HV"?2:Math.ceil(P/15e5)*2;s+=j*(1+R+_*2)}return{totalPower:r,totalPollution:o,totalModelCount:s}},[t]),Mt=m.useMemo(()=>xi(),[t]);m.useEffect(()=>{if(It||Mt.totalPollution===0)return;const r=setInterval(()=>{if(Ct)return;const o=Mt.totalPollution/3600;fe(s=>{if(typeof s!="number"||isNaN(s)||!isFinite(s))return s;const a=parseFloat((s+o).toFixed(4));return a!==s?a:s})},1e3);return()=>clearInterval(r)},[Mt.totalPollution,Ct,It]),m.useEffect(()=>{const r=setInterval(Ge,2e4);return()=>clearInterval(r)},[]);const cr=m.useRef(null),hn=m.useRef(b);m.useEffect(()=>{if(!(Math.abs(b-hn.current)<.01))return hn.current=b,cr.current&&clearTimeout(cr.current),cr.current=setTimeout(()=>{n(r=>{let o=!1;const s=r.map(a=>{const{recipe:l,machine:d,globalPollution:f}=a.data||{};if(l!=null&&l.isTreeFarm&&l.treeFarmSettings){const{trees:g,harvesters:C,sprinklers:M,outputs:F,controller:x}=l.treeFarmSettings,_=sn(g,C,b),j=kr(g,C,M,F,x,b);return o=!0,{...a,data:{...a.data,recipe:{...l,outputs:_,power_consumption:j?j.avgPowerConsumption:"Variable"},globalPollution:b}}}if((d==null?void 0:d.id)==="m_air_separation_unit"){const g=Jn(b),C=l.outputs.map(M=>M.product_id==="p_residue"?{...M,quantity:parseFloat(g.toFixed(6))}:M);return o=!0,{...a,data:{...a.data,recipe:{...l,outputs:C},globalPollution:b}}}return f!==b?(o=!0,{...a,data:{...a.data,globalPollution:b}}):a});return o?s:r})},250),()=>clearTimeout(cr.current)},[b,n]);const[G,yi]=m.useState(()=>Ln([],[],{skipTemperature:!0})),dr=m.useRef(null),gn=m.useRef(""),zr=m.useRef(!1),Wr=m.useRef(null),U=m.useCallback((r="general")=>{Wr.current=r,zr.current=!0},[]);m.useEffect(()=>{if(zr.current)return dr.current&&clearTimeout(dr.current),dr.current=setTimeout(()=>{const r=`${t.length}-${c.length}-${t.map(o=>{var s,a,l,d,f,g,C,M,F,x,_,j,v;return`${o.id}:${(s=o.data)==null?void 0:s.machineCount}:${JSON.stringify(((l=(a=o.data)==null?void 0:a.recipe)==null?void 0:l.temperatureSettings)||{})}:${JSON.stringify(((f=(d=o.data)==null?void 0:d.recipe)==null?void 0:f.drillSettings)||{})}:${JSON.stringify(((C=(g=o.data)==null?void 0:g.recipe)==null?void 0:C.assemblerSettings)||{})}:${JSON.stringify(((F=(M=o.data)==null?void 0:M.recipe)==null?void 0:F.treeFarmSettings)||{})}:${JSON.stringify(((_=(x=o.data)==null?void 0:x.recipe)==null?void 0:_.fireboxSettings)||{})}:${JSON.stringify(((v=(j=o.data)==null?void 0:j.recipe)==null?void 0:v.chemicalPlantSettings)||{})}`}).join(",")}`;if(r!==gn.current){const o=Wr.current||"general",s=["connection","node","temperatureSettings","boilerSettings"].includes(o);console.log(`[Recalculation] Reason: ${o}, Temperature propagation: ${s}`);const a=Ln(t,c,{skipTemperature:!s,previousTemperatureData:s?null:G==null?void 0:G.temperatureData});yi(a),gn.current=r}zr.current=!1,Wr.current=null},100),()=>clearTimeout(dr.current)},[t,c,G]);const xn=m.useMemo(()=>Ia(G),[G]),yn=m.useMemo(()=>Fa(G),[G]),ur=m.useRef(null),bn=m.useRef(null),vn=m.useCallback((r,o,s)=>{var g,C,M,F,x,_;const a=(g=r.data)==null?void 0:g.recipe,l=o.byNode[r.id];if(r.data.flows===l&&r.data.suggestions===s)return r;const d=r.data.flows!==l,f=r.data.suggestions!==s&&(((C=r.data.suggestions)==null?void 0:C.length)!==(s==null?void 0:s.length)||JSON.stringify(r.data.suggestions)!==JSON.stringify(s||[]));if(a!=null&&a.isWasteFacility){const j=Math.min(((M=l==null?void 0:l.inputFlows[0])==null?void 0:M.connected)||0,240),v=Math.min(((F=l==null?void 0:l.inputFlows[1])==null?void 0:F.connected)||0,240),P=a.wasteFacilitySettings||{};if(!d&&!f&&P.itemFlowRate===j&&P.fluidFlowRate===v)return r;const R=Sr(j,v),T=Pr(j,v,a.inputs[0].product_id,a.inputs[1].product_id);return{...r,data:{...r.data,recipe:{...a,inputs:T,cycle_time:R.cycleTime,wasteFacilitySettings:{...P,itemFlowRate:j,fluidFlowRate:v}},flows:l||null,suggestions:s||[],zoomLevel:r.data.zoomLevel}}}if(a!=null&&a.isLiquidDump){const j=((x=r.data)==null?void 0:x.machineCount)||1,v=a.inputs.map((R,T)=>{var Z;return Math.min(((Z=l==null?void 0:l.inputFlows[T])==null?void 0:Z.connected)||0,15*j)/j}),P=Gt(a.inputs,v);return!d&&!f&&a.pollution===P?r:{...r,data:{...r.data,recipe:{...a,pollution:P},flows:l||null,suggestions:s||[],zoomLevel:r.data.zoomLevel}}}if(a!=null&&a.isLiquidBurner){const j=((_=r.data)==null?void 0:_.machineCount)||1,v=a.inputs.map((R,T)=>{var Z;return Math.min(((Z=l==null?void 0:l.inputFlows[T])==null?void 0:Z.connected)||0,15*j)/j}),P=Jt(a.inputs,v);return!d&&!f&&a.pollution===P?r:{...r,data:{...r.data,recipe:{...a,pollution:P},flows:l||null,suggestions:s||[],zoomLevel:r.data.zoomLevel}}}return!d&&!f?r:{...r,data:{...r.data,flows:l||null,suggestions:s||[],zoomLevel:r.data.zoomLevel}}},[]);m.useEffect(()=>{var r;if((r=G==null?void 0:G.flows)!=null&&r.byNode&&bn.current!==G.flows)return bn.current=G.flows,ur.current&&clearTimeout(ur.current),ur.current=setTimeout(()=>{n(o=>{let s=o;G.temperatureData&&(s=Ea(o,G.temperatureData,G.graph));let a=!1;const l=s.map(d=>{const f=vn(d,G.flows,G.suggestions);return f!==d&&(a=!0),f});return a?l:o})},250),()=>clearTimeout(ur.current)},[G,n,vn]);const pr=m.useMemo(()=>xn.map(r=>{const o=te.some(s=>{var l,d,f;const a=t.find(g=>g.id===s.recipeBoxId);return(f=(d=(l=a==null?void 0:a.data)==null?void 0:l.recipe)==null?void 0:d.outputs)==null?void 0:f.some(g=>g.product_id===r.productId)});return{...r,isSold:$e[r.productId]??(o&&typeof r.product.price=="number"&&r.product.price>1)}}),[xn,$e,te,t]),_n=m.useMemo(()=>pr.reduce((r,o)=>o.isSold&&typeof o.product.price=="number"?r+o.product.price*o.excessRate:r,0),[pr]),bi=m.useMemo(()=>{const r=new Map,o=new Map,s=(l,d,f)=>{r.set(l,(r.get(l)||0)+d),o.has(l)||o.set(l,f)};t.forEach(l=>{var C,M,F,x,_,j;const{machine:d,machineCount:f=0,recipe:g}=l.data||{};if(d){if(d.id==="m_tree_farm"&&(g!=null&&g.treeFarmSettings)){const{trees:v,harvesters:P,sprinklers:R,outputs:T,controller:z}=g.treeFarmSettings,Z=Math.ceil(R/3);s("m_tree",Math.ceil(v*f),((C=xe("m_tree"))==null?void 0:C.cost)||0),s("m_farm_harvester",Math.ceil(P*f),((M=xe("m_farm_harvester"))==null?void 0:M.cost)||0),s("m_tree_farm_sprinkler",Math.ceil(R*f),((F=xe("m_tree_farm_sprinkler"))==null?void 0:F.cost)||0),s("m_tree_farm_water_tank",Math.ceil(Z*f),((x=xe("m_tree_farm_water_tank"))==null?void 0:x.cost)||0),s("m_tree_farm_output",Math.ceil(T*f),((_=xe("m_tree_farm_output"))==null?void 0:_.cost)||0),s("m_tree_farm_controller",Math.ceil(z*f),((j=xe("m_tree_farm_controller"))==null?void 0:j.cost)||0);return}s(d.id,Math.ceil(f),typeof d.cost=="number"?d.cost:0)}});const a=Array.from(r.entries()).map(([l,d])=>{const f=it.find(C=>C.id===l),g=o.get(l);return{machineId:l,machine:f,count:d,cost:g,totalCost:d*g}}).sort((l,d)=>l.machine.name.localeCompare(d.machine.name));return{stats:a,totalCost:a.reduce((l,d)=>l+d.totalCost,0)}},[t,it]),rt=(r,o)=>n(s=>s.map(a=>a.id===r?{...a,data:o(a.data)}:a)),mr=m.useCallback((r,o,s,a)=>{const l=Object.keys(tn).map(g=>parseInt(g));let d=null,f=0;return l.forEach(g=>{const M=tn[g].find(F=>F.product_id===r);if(M){const F=Xt(o,s,a,g);if(F){const x=a?1.1:1,_=M.quantity*x*F.dutyCycle;_>f&&(f=_,d=g)}}}),d},[]),vi=m.useCallback((r,o,s)=>{const a={drillConfig:We,assemblerConfig:qe,treeFarmConfig:Ve,fireboxConfig:Ue},l=(G==null?void 0:G.flows)||null;return To(r,o,s,mr,a,b,l)},[We,qe,Ve,Ue,mr,b,G]),_i=m.useCallback(r=>{const o=t.find(d=>d.id===r.source),s=t.find(d=>d.id===r.target);if(!o||!s)return;const a=o.data.recipe.outputs[parseInt(r.sourceHandle.split("-")[1])],l=s.data.recipe.inputs[parseInt(r.targetHandle.split("-")[1])];if(!(!a||!l)){if(l.isAnyProduct){const d=ve(a.product_id);if(l.acceptedType&&(d==null?void 0:d.type)!==l.acceptedType)return;n(f=>f.map(g=>{var F;if(g.id!==s.id)return g;const C=parseInt(r.targetHandle.split("-")[1]),M=[...g.data.recipe.inputs];if(M[C]={...M[C],product_id:a.product_id,isAnyProduct:!1},g.data.recipe.isWasteFacility){const x=g.data.recipe.wasteFacilitySettings||{},_=(F=G==null?void 0:G.flows)==null?void 0:F.byNode[r.source],j=parseInt(r.sourceHandle.split("-")[1]),v=_!=null&&_.outputFlows[j]?_.outputFlows[j].produced-_.outputFlows[j].connected:0,P=Math.min(v,240);C===0?x.itemFlowRate=P:C===1&&(x.fluidFlowRate=P);const R=Sr(x.itemFlowRate||0,x.fluidFlowRate||0),T=Pr(x.itemFlowRate||0,x.fluidFlowRate||0,C===0?a.product_id:M[0].product_id,C===1?a.product_id:M[1].product_id);return{...g,data:{...g.data,recipe:{...g.data.recipe,inputs:T,cycle_time:R.cycleTime,wasteFacilitySettings:x}}}}if(g.data.recipe.isLiquidDump||g.data.recipe.isLiquidBurner){const x=g.data.recipe.isLiquidDump?Gt(M):Jt(M);return{...g,data:{...g.data,recipe:{...g.data.recipe,inputs:M,pollution:x}}}}return{...g,data:{...g.data,recipe:{...g.data.recipe,inputs:M}}}}))}else if(a.product_id!==l.product_id)return;u(d=>Tn({...r,type:"custom",animated:!1,data:be},d)),Ge(),U("connection")}},[u,t,be,U,n,G]),fr=()=>{N(!1),W(null),H(null),w("product"),A(""),Y("name_asc"),K("all"),ne("all"),ae(null),Q("button"),mn({}),de("all")},Ci=m.useCallback(()=>{N(!0),ae(null),Q("button")},[]),Si=m.useCallback((r,o,s,a)=>{if(a!=null&&a.ctrlKey){u(d=>d.filter(f=>!(f.target===o&&f.targetHandle===`left-${s}`))),Ge(),U("connection");return}const l=ve(r);l&&(N(!0),W(l),ae({nodeId:o,inputIndex:s,productId:r}),Q("rectangle"),ne("producers"))},[u,oe,Ee,U]),ji=m.useCallback((r,o,s,a)=>{var C,M;if(a!=null&&a.ctrlKey){u(F=>F.filter(x=>!(x.source===o&&x.sourceHandle===`right-${s}`))),Ge(),U("connection");return}const l=Vr.current.find(F=>F.id===o),d=(M=(C=l==null?void 0:l.data)==null?void 0:C.recipe)==null?void 0:M.machine_id,f=d&&xt[d],g=ve(r);g&&(N(!0),W(g),ae({nodeId:o,outputIndex:s,productId:r,isOutput:!0,isFromHeatSource:!!f}),Q("rectangle"),ne("consumers"))},[u,oe,Ee,U]),nt=m.useCallback((r,o,s)=>{u(a=>{const l=a.filter(d=>{var f,g,C,M;if(d.source===r){const F=parseInt(d.sourceHandle.split("-")[1]);if(F>=s.length)return!1;const x=s[F],_=t.find(P=>P.id===d.target);if(!_)return!1;const j=parseInt(d.targetHandle.split("-")[1]),v=(g=(f=_.data)==null?void 0:f.recipe)==null?void 0:g.inputs[j];if(!v||v.product_id!==x.product_id)return!1}if(d.target===r){const F=parseInt(d.targetHandle.split("-")[1]);if(F>=o.length)return!1;const x=o[F],_=t.find(P=>P.id===d.source);if(!_)return!1;const j=parseInt(d.sourceHandle.split("-")[1]),v=(M=(C=_.data)==null?void 0:C.recipe)==null?void 0:M.outputs[j];if(!v||v.product_id!==x.product_id)return!1}return!0});return l.length!==a.length&&(Ge(),U("connection")),l})},[u,t,U]),wi=m.useCallback((r,o,s,a)=>{Ae({drillHead:o.drillHead,consumable:o.consumable,machineOil:o.machineOil});const l=o.drillHead&&o.depth?Xt(o.drillHead,o.consumable,o.machineOil,o.depth):null;rt(r,d=>({...d,recipe:{...d.recipe,inputs:s.length>0?s:[{product_id:"p_variableproduct",quantity:"Variable"}],outputs:a.length>0?a:[{product_id:"p_variableproduct",quantity:"Variable"}],drillSettings:o,cycle_time:1,power_consumption:l?{max:l.drillingPower*1e6,average:(l.drillingPower*l.lifeTime+l.idlePower*(l.replacementTime+l.travelTime))/l.totalCycleTime*1e6}:"Variable",pollution:l?l.pollution:"Variable"},leftHandles:Math.max(s.length,1),rightHandles:Math.max(a.length,1)})),nt(r,s,a),U("settings")},[nt,U]),Mi=m.useCallback((r,o,s,a)=>{He({outerStage:o.outerStage,innerStage:o.innerStage,machineOil:o.machineOil,tickCircuitDelay:o.tickCircuitDelay});const d=!o.outerStage||!o.innerStage?"":o.outerStage===1?`p_${o.innerStage}x_microchip`:`p_${o.outerStage}x${o.innerStage}x_microchip`,f=d?ln(d,o.machineOil,o.tickCircuitDelay):null;rt(r,g=>({...g,recipe:{...g.recipe,inputs:s.length>0?s:[{product_id:"p_logic_plate",quantity:"Variable"},{product_id:"p_copper_wire",quantity:"Variable"},{product_id:"p_semiconductor",quantity:"Variable"},{product_id:"p_gold_wire",quantity:"Variable"}],outputs:a.length>0?a:[{product_id:"p_variableproduct",quantity:"Variable"}],assemblerSettings:o,cycle_time:f?f.cycleTime:"Variable",power_consumption:f?{max:f.maxPowerConsumption,average:f.avgPowerConsumption}:"Variable"},leftHandles:Math.max(s.length,1),rightHandles:Math.max(a.length,1)})),nt(r,s,a),U("settings")},[nt,U]),Pi=m.useCallback((r,o,s,a)=>{ze({trees:o.trees,harvesters:o.harvesters,sprinklers:o.sprinklers,outputs:o.outputs});const l=kr(o.trees,o.harvesters,o.sprinklers,o.outputs,o.controller,b);rt(r,d=>({...d,recipe:{...d.recipe,inputs:s.length>0?s:[{product_id:"p_water",quantity:"Variable"}],outputs:a.length>0?a:[{product_id:"p_oak_log",quantity:"Variable"}],treeFarmSettings:o,cycle_time:1,power_consumption:l?l.avgPowerConsumption:"Variable",pollution:0},leftHandles:Math.max(s.length,1),rightHandles:Math.max(a.length,1)})),u(d=>d.filter(f=>{if(f.source===r||f.target===r){const g=parseInt((f.source===r?f.sourceHandle:f.targetHandle).split("-")[1]);return f.source===r?g<a.length:g<s.length}return!0})),U("settings")},[u,b,U]),ki=m.useCallback((r,o,s,a)=>{Ke({fuel:o.fuel}),rt(r,l=>({...l,recipe:{...l.recipe,inputs:s,fireboxSettings:o,cycle_time:a?a.cycleTime:l.recipe.cycle_time,power_consumption:0}})),U("settings")},[U]),Ti=m.useCallback((r,o,s,a)=>{n(l=>l.map(d=>{if(d.id!==r)return d;const f=xe(d.data.recipe.machine_id),g=mt(f==null?void 0:f.id);let C=d.data.recipe.power_type;(f==null?void 0:f.id)==="m_electric_water_heater"&&(C=o.temperature>=320?"HV":"MV");let M={...d.data.recipe,outputs:s,temperatureSettings:o,power_consumption:a??d.data.recipe.power_consumption,power_type:C};if((f==null?void 0:f.id)==="m_water_treatment_plant"&&g){const F=o.temperature||st,x=yt(f.id,F,1),_=90*x,j=17.6,v=17.6;M={...M,inputs:M.inputs.map(P=>P.product_id==="p_water"?{...P,quantity:j*x,originalQuantity:j}:P.product_id==="p_distilled_water"?{...P,quantity:v*x,originalQuantity:v}:P),outputs:M.outputs.map(P=>P.product_id==="p_steam"?{...P,quantity:_,originalQuantity:90}:P)}}return{...d,data:{...d.data,recipe:M}}})),U("temperatureSettings")},[n,U]),Ni=m.useCallback((r,o)=>{n(s=>s.map(a=>{if(a.id!==r)return a;const l=xe(a.data.recipe.machine_id),d=xt[l==null?void 0:l.id];return!d||d.type!=="boiler"?a:{...a,data:{...a.data,recipe:{...a.data.recipe,temperatureSettings:o}}}})),U("boilerSettings")},[n,U]),Ii=m.useCallback((r,o,s,a,l)=>{const d=o==="right"?"output":"input",f=l==null?void 0:l.find(g=>g.nodeId===r&&g.handleType===d&&g.handleIndex===s);f&&(n(g=>g.map(C=>{var _,j;if(C.id!==r)return C;const M=((_=C.data)==null?void 0:_.machineCountMode)||"free",F=(j=C.data)==null?void 0:j.cappedMachineCount;if(M==="locked")return console.log(`Node ${r} is locked - suggestion ignored`),C;let x=f.suggestedMachineCount;return M==="capped"&&typeof F=="number"&&x>F&&(console.log(`Node ${r} is capped at ${F} - clamping suggestion from ${x} to ${F}`),x=F),{...C,data:{...C.data,machineCount:x}}})),U("machineCount"))},[n,U]),Fi=m.useCallback((r,o)=>{n(s=>s.map(a=>{if(a.id!==r)return a;const l=xe(a.data.recipe.machine_id);if((l==null?void 0:l.id)!=="m_chemical_plant")return a;const d=ot.find(g=>g.id===a.data.recipe.id);if(!d)return a;const f=Sa(d,o.speedFactor,o.efficiencyFactor);return{...a,data:{...a.data,recipe:f}}})),U("settings")},[n,U]),Ei=m.useCallback((r,o,s,a)=>{tt({itemProductId:o.itemProductId,fluidProductId:o.fluidProductId}),n(l=>l.map(d=>{if(d.id!==r)return d;const f=d.data.recipe.wasteFacilitySettings||{},g=f.itemFlowRate||0,C=f.fluidFlowRate||0,M=Sr(g,C);return{...d,data:{...d.data,recipe:{...d.data.recipe,inputs:s.length>0?s:d.data.recipe.inputs,wasteFacilitySettings:{...o,itemFlowRate:g,fluidFlowRate:C},cycle_time:M.cycleTime},leftHandles:Math.max(s.length,1)}}})),nt(r,s,a),U("settings")},[nt,U,n]),Di=m.useCallback((r,o,s,a)=>{n(l=>l.map(d=>d.id!==r?d:{...d,data:{...d.data,recipe:{...d.data.recipe,inputs:s.length>0?s:d.data.recipe.inputs,liquidDumpSettings:o,pollution:Gt(s)},leftHandles:Math.max(s.length,1)}})),nt(r,s,a),U("settings")},[nt,U,n]),Ri=m.useCallback((r,o,s,a)=>{n(l=>l.map(d=>d.id!==r?d:{...d,data:{...d.data,recipe:{...d.data.recipe,inputs:s.length>0?s:d.data.recipe.inputs,liquidBurnerSettings:o,pollution:Jt(s)},leftHandles:Math.max(s.length,1)}})),nt(r,s,a),U("settings")},[nt,U,n]),ut=m.useCallback((r,o=null)=>{var _,j;const s=xe(r.machine_id);if(!s||!r.inputs||!r.outputs){alert("Error: Invalid machine or recipe data");return}let a=Qt(r,s.id);const l=`node-${p}`,d=E?t.find(v=>v.id===E.nodeId):null;let f;if(d)f={x:d.position.x+(E.isOutput?400:-400),y:d.position.y};else if(dt.current&&qt.current){const v=qt.current.getBoundingClientRect(),P=dt.current.screenToFlowPosition({x:v.left+v.width/2,y:v.top+v.height/2}),R=320,T=300,z=50;let Z={x:P.x-R/2,y:P.y-T/2},me=0;for(;me<20&&t.some(Pe=>{const Vt=Math.abs(Pe.position.x-Z.x),ia=Math.abs(Pe.position.y-Z.y);return Vt<R+z&&ia<T+z});){const ke=me/20*Math.PI*2,Oe=100+me*50;Z={x:P.x-R/2+Math.cos(ke)*Oe,y:P.y-T/2+Math.sin(ke)*Oe},me++}f=Z}else f={x:Math.random()*400+100,y:Math.random()*300+100};if(((_=xt[s.id])==null?void 0:_.type)==="boiler"){const v={heatLoss:((j=a.temperatureSettings)==null?void 0:j.heatLoss)??0,coolantTemp:kt},P=cn(s.id,v,kt,null,kt),R=xt[s.id],T=ii(a.outputs,P,!0,R,kt);a={...a,outputs:T,temperatureSettings:v}}const C={drillConfig:We,assemblerConfig:qe,treeFarmConfig:Ve,fireboxConfig:Ue};if(oi(a)&&(a=ai(a,E,k,C,b,mr),a.drillSettings&&Ae({drillHead:a.drillSettings.drillHead,consumable:a.drillSettings.consumable,machineOil:a.drillSettings.machineOil}),a.assemblerSettings&&He({outerStage:a.assemblerSettings.outerStage,innerStage:a.assemblerSettings.innerStage,machineOil:a.assemblerSettings.machineOil,tickCircuitDelay:a.assemblerSettings.tickCircuitDelay}),a.treeFarmSettings&&ze({trees:a.treeFarmSettings.trees,harvesters:a.treeFarmSettings.harvesters,sprinklers:a.treeFarmSettings.sprinklers,outputs:a.treeFarmSettings.outputs}),a.fireboxSettings&&Ke({fuel:a.fireboxSettings.fuel})),s.id==="m_air_separation_unit"){const v=Jn(b),P=a.outputs.map(R=>R.product_id==="p_residue"?{...R,quantity:parseFloat(v.toFixed(6))}:R);a={...a,outputs:P}}const M=o!==null?o:Rr[r.id]??1,F=Je(),x={id:l,type:"custom",position:f,data:{recipe:a,machine:s,machineCount:M,machineCountMode:"free",cappedMachineCount:void 0,displayMode:Me,machineDisplayMode:Ne,leftHandles:Math.max(a.inputs.length,1),rightHandles:Math.max(a.outputs.length,1),...F,globalPollution:b,isTarget:!1,flows:null,suggestions:[],zoomLevel:zt},sourcePosition:"right",targetPosition:"left"};return n(v=>{const P=[...v,x];return U("node"),E&&M>0&&setTimeout(()=>{var z,Z,me;const R=E.isOutput?"inputs":"outputs";let T=-1;if((a.isWasteFacility||a.id==="r_underground_waste_facility")&&!E.isOutput)E.productId==="p_concrete_block"?T=2:E.productId==="p_lead_ingot"?T=3:T=a[R].findIndex(ce=>ce.product_id===E.productId);else if(E.isOutput&&E.isFromHeatSource){const ce=xe(a.machine_id);if(ce&&((z=xt[ce.id])==null?void 0:z.type)==="boiler"&&a.inputs.length>=2){const Oe=(Z=a.inputs[0])==null?void 0:Z.product_id,Pe=(me=a.inputs[1])==null?void 0:me.product_id;Oe===Pe&&Pe===E.productId||Pe===E.productId?T=1:T=a[R].findIndex(Vt=>Vt.product_id===E.productId)}else T=a[R].findIndex(Oe=>Oe.product_id===E.productId)}else T=a[R].findIndex(ce=>ce.product_id===E.productId);if(T!==-1){const ce=E.isOutput?E.outputIndex:T,ke=E.isOutput?T:E.inputIndex,Oe={source:E.isOutput?E.nodeId:l,sourceHandle:`right-${ce}`,target:E.isOutput?l:E.nodeId,targetHandle:`left-${ke}`,type:"custom",animated:!1,data:be};u(Pe=>Tn(Oe,Pe)),Ge(),U("connection")}},50),P}),y(v=>v+1),U(),l},[p,t,n,u,Me,Ne,We,qe,Ve,Ue,mr,Rr,b,k,U,E,be,Je]),Rt=m.useCallback(r=>{n(o=>o.filter(s=>s.id!==r)),u(o=>o.filter(s=>s.source!==r&&s.target!==r)),ue(o=>o.filter(s=>s.recipeBoxId!==r)),Ge(),U("node")},[n,u,U]),qr=m.useCallback(r=>{var s;te.find(a=>a.recipeBoxId===r.id)?(ue(a=>a.filter(l=>l.recipeBoxId!==r.id)),n(a=>a.map(l=>l.id===r.id?{...l,data:{...l.data,isTarget:!1}}:l))):(s=r.data)!=null&&s.recipe&&(ue(a=>[...a,{id:`target_${pe}`,recipeBoxId:r.id}]),Se(a=>a+1),n(a=>a.map(l=>l.id===r.id?{...l,data:{...l.data,isTarget:!0}}:l)))},[te,pe,n]),hr=m.useCallback((r,o,s,a)=>{var R;const l=te.find(T=>T.id===r);if(!l)return;const d=t.find(T=>T.id===l.recipeBoxId);if(!d)return;const{recipe:f,machine:g,machineCount:C=0}=d.data||{};if(!f)return;const M=f.isMineshaftDrill||f.id==="r_mineshaft_drill";let F=f.cycle_time;if((typeof F!="number"||F<=0)&&(F=1),mt(g==null?void 0:g.id)){const T=bt[g.id];if((T==null?void 0:T.type)==="steam_input"&&vt(f)){const z=f.tempDependentInputTemp??st;F=yt(g.id,z,F)}}(typeof F!="number"||F<=0)&&(F=1);const _=(R=G==null?void 0:G.flows)==null?void 0:R.byNode[l.recipeBoxId];if(!_)return;let j=0,v=0;if(o==="output"){const T=_.outputFlows[s];if(!T)return;j=T.connected;const z=f.outputs[s],Z=z.originalQuantity!==void 0?z.originalQuantity:z.quantity;v=M?Z:Z/F}else{const T=_.inputFlows[s];if(!T)return;j=T.connected;const z=f.inputs[s];v=M?z.quantity:z.quantity/F}if(v<=0)return;const P=(j+a)/v;rt(l.recipeBoxId,T=>({...T,machineCount:P})),U("machineCount")},[te,t,G,U]),Cn=m.useCallback(r=>{const o=te.find(s=>s.id===r);o&&(ue(s=>s.filter(a=>a.id!==r)),rt(o.recipeBoxId,s=>({...s,isTarget:!1})))},[te]),Bi=m.useCallback((r,o)=>{if(oe){if(Ee==="target"){qr(o);return}else if(Ee==="delete"){Rt(o.id);return}}r.shiftKey&&!r.ctrlKey&&!r.altKey?qr(o):r.ctrlKey&&r.altKey&&Rt(o.id)},[oe,Ee,qr,Rt]),Oi=m.useCallback((r,o)=>{var s,a;r.stopPropagation(),ee(o.id),he(String(((s=o.data)==null?void 0:s.machineCount)??0)),ge(((a=o.data)==null?void 0:a.machineCountMode)||"free"),J(!0)},[]),Vr=m.useRef(t),Li=m.useRef(c);m.useEffect(()=>{Vr.current=t},[t]),m.useEffect(()=>{Li.current=c},[c]);const $i=m.useCallback(r=>{const o=Vr.current.find(s=>s.id===r);o&&Br({recipe:{...o.data.recipe},machine:o.data.machine,machineCount:o.data.machineCount})},[]),Ai=m.useCallback(r=>{if(!qt.current)return;const o=qt.current.getBoundingClientRect();pi({x:r.clientX-o.left,y:r.clientY-o.top})},[]),Hi=m.useCallback(r=>{if(!Qe||r.button!==0||(r.stopPropagation(),!dt.current))return;const o=dt.current.screenToFlowPosition({x:r.clientX,y:r.clientY});o.x-=160,o.y-=150;const s=`node-${p}`,a=Je(),l={id:s,type:"custom",position:o,data:{recipe:Qe.recipe,machine:Qe.machine,machineCount:Qe.machineCount,displayMode:Me,machineDisplayMode:Ne,leftHandles:Qe.recipe.inputs.length,rightHandles:Qe.recipe.outputs.length,...a,globalPollution:b,isTarget:!1,flows:null,suggestions:[]},sourcePosition:"right",targetPosition:"left"};n(d=>[...d,l]),y(d=>d+1),Br(null),U("node")},[Qe,p,Me,Ne,b,n,Je,U]),zi=m.useCallback(r=>{r.button===2&&Br(null)},[]),Ur=m.useCallback((r=!1)=>{var s,a;let o=parseFloat(ye);if(isNaN(o)||o<0){if(se){alert("Machine count must be 0 or greater. Please enter a valid number.");return}o=0}if(X&&!se){const l=t.find(g=>g.id===X),d=((s=l==null?void 0:l.data)==null?void 0:s.machineCount)||0;let f=(a=l==null?void 0:l.data)==null?void 0:a.cappedMachineCount;if(le==="capped"?f=o:le==="free"&&(f=void 0),r&&d>0&&o!==d){const g=Da(t,c),C=G==null?void 0:G.flows;if(C){const M=Fo(X,d,o,g,C,t);n(F=>F.map(x=>{const _=M.get(x.id);return x.id===X?{...x,data:{...x.data,machineCount:o,machineCountMode:le,cappedMachineCount:f}}:_!==void 0?{...x,data:{...x.data,machineCount:_}}:x}))}else rt(X,M=>({...M,machineCount:o,machineCountMode:le,cappedMachineCount:f}))}else rt(X,g=>({...g,machineCount:o,machineCountMode:le,cappedMachineCount:f}))}else se&&rt(se,l=>({...l,machineCount:o}));J(!1),ee(null),he(""),ge("free"),Re(null),U("machineCount")},[X,ye,le,se,t,c,G,n,Rt,U]),Sn=m.useCallback(()=>{se&&(Rt(se),N(!0),W(null),H(null),w("product")),J(!1),ee(null),he(""),ge("free"),Re(null)},[se,Rt]),Wi=m.useCallback((r,o,s)=>{let a,l;o==="free"?(a="capped",l=s):o==="capped"?(a="locked",l=s):(a="free",l=void 0),n(d=>d.map(f=>f.id!==r?f:{...f,data:{...f.data,machineCountMode:a,cappedMachineCount:l}}))},[n]),qi=m.useCallback(async()=>{const{nodes:r,edges:o}=await Oo(t,c,be);n(r),u(o)},[t,c,be,n,u]),Vi=m.useCallback(()=>{if(te.length===0){alert("No target recipes. Please add target recipes (Shift+Click a node) before computing.");return}const r=t.map(d=>{var f;return{id:d.id,data:{recipe:d.data.recipe,machineCount:d.data.machineCount,machineName:((f=d.data.machine)==null?void 0:f.name)||""}}}),o=Date.now();jt({phase:"loading",nodeSnapshot:r});const s=t.map(d=>({id:d.id,data:{recipe:d.data.recipe,machine:d.data.machine,machineCount:d.data.machineCount,machineCountMode:d.data.machineCountMode,cappedMachineCount:d.data.cappedMachineCount}})),a=c.map(d=>({id:d.id,source:d.source,target:d.target,sourceHandle:d.sourceHandle,targetHandle:d.targetHandle})),l=new Worker(new URL("/Industrialist-Production-Calculator/assets/lpWorker-OrhV5hQw.js",import.meta.url),{type:"module"});Dt.current=l,l.onmessage=d=>{Dt.current=null,l.terminate();const f=Date.now()-o,{result:g,deficiencyResult:C}=d.data,M={...g,elapsedMs:f},F=C?{...C,elapsedMs:f}:null;if(!g.success&&g.hasDeficiency){jt(x=>({...x,phase:"deficiency_confirm",result:M,deficiencyResult:F}));return}jt(x=>({...x,phase:"results",result:M}))},l.onerror=d=>{Dt.current=null,l.terminate(),jt(null),console.error("[LP Worker] Error:",d),alert("An error occurred while computing. Check the console for details.")},l.postMessage({nodes:s,edges:a,targetProducts:te,activeWeights:Et,unusedWeights:$r,machines:it})},[te,t,c,Et,$r,n,U]),Ui=m.useCallback(()=>{Dt.current&&(Dt.current.terminate(),Dt.current=null),jt(null)},[]),Ki=m.useCallback(()=>{jt(r=>r?{...r,phase:"results",result:r.deficiencyResult}:null)},[]),Qi=m.useCallback(r=>{r!=null&&r.success&&(n(o=>o.map(s=>{const a=r.updates.get(s.id);return a!==void 0?{...s,data:{...s.data,machineCount:a}}:s})),U("machineCount")),jt(null)},[n,U]),Ji=m.useCallback(r=>{dt.current&&dt.current.fitView({nodes:[{id:r}],padding:.6,duration:600,maxZoom:1.5})},[]),jn=()=>{if(!k)return[];const r=ve(k.id),o=ko(k.id),s=Po(k.id),a=[Dn,Rn,Bn,Xr,Zr,en],l=a.filter(g=>Io(g.id).includes(k.id)),d=a.filter(g=>{if(No(g.id).includes(k.id))return!0;if(r){if(g.id==="r_underground_waste_facility")return!!["p_concrete_block","p_lead_ingot"].includes(k.id);if(g.id==="r_liquid_dump"||g.id==="r_liquid_burner")return!1}return!1}),f=a.filter(g=>g.id==="r_liquid_dump"||g.id==="r_liquid_burner"?(r==null?void 0:r.type)==="fluid":g.id==="r_underground_waste_facility"?!["p_concrete_block","p_lead_ingot"].includes(k.id):!1);return re==="producers"?[...o,...l]:re==="consumers"?[...s,...d]:re==="disposal"?f:Array.from(new Map([...o,...s,...l,...d,...f].map(g=>[g.id,g])).values())};m.useEffect(()=>{if(D){const r=B==="product"?jn():vr(I==null?void 0:I.id),o=E?t.find(a=>a.id===E.nodeId):null,s={};r.forEach(a=>{s[a.id]=vi(a,o,E)}),mn(s)}},[D,B,k,I,E,t,re]);const Pt=m.useCallback(()=>{n([]),u([]),y(0),ue([]),Se(0),Be({}),Ae(null),He(null),ze(null),Ke(null),tt(null),Ge()},[n,u,y,ue,Se,Be,Ae,He,ze,Ke,tt]),Gi=m.useCallback(()=>{const r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=o=>{var l;const s=(l=o.target.files)==null?void 0:l[0];if(!s)return;const a=new FileReader;a.onload=d=>{try{const f=JSON.parse(d.target.result);if(!f.canvas){alert("This file does not contain canvas data. Please use the Data Manager to import game data (products, machines, recipes).");return}const g=f.canvas.nodes||[],C=[];if(g.forEach(x=>{var j,v,P,R,T,z,Z,me;const _=(v=(j=x.data)==null?void 0:j.recipe)==null?void 0:v.machine_id;_&&!xe(_)&&C.push(`Machine: ${_}`),(T=(R=(P=x.data)==null?void 0:P.recipe)==null?void 0:R.inputs)==null||T.forEach(ce=>{ce.product_id!=="p_variableproduct"&&!ve(ce.product_id)&&C.push(`Product: ${ce.product_id}`)}),(me=(Z=(z=x.data)==null?void 0:z.recipe)==null?void 0:Z.outputs)==null||me.forEach(ce=>{ce.product_id!=="p_variableproduct"&&!ve(ce.product_id)&&C.push(`Product: ${ce.product_id}`)})}),C.length>0){const x=[...new Set(C)];alert(`Cannot import canvas - missing items:
${x.slice(0,10).join(`
`)}${x.length>10?`
...and ${x.length-10} more`:""}`);return}if(!window.confirm("Import this canvas? Your current canvas will be replaced."))return;const M=Je(),F=g.map(x=>{var v,P,R,T;const _=xe((P=(v=x.data)==null?void 0:v.recipe)==null?void 0:P.machine_id);let j=(R=x.data)==null?void 0:R.recipe;return _&&j&&!((T=j.outputs)!=null&&T.some(z=>z.temperature!==void 0))&&(j=Qt(j,_.id)),{...x,data:{...x.data,recipe:j,machine:_,machineCount:x.data.machineCount??1,displayMode:Me,machineDisplayMode:Ne,...M,globalPollution:b,flows:null,suggestions:[]}}});Pt(),setTimeout(()=>{n(F),u((f.canvas.edges||[]).map(x=>{const{edgePath:_,edgeStyle:j,...v}=x.data||{};return{...x,data:{...v,...be}}})),ue(f.canvas.targetProducts||[]),Be(f.canvas.soldProducts||{}),gt(f.canvas.favoriteRecipes||[]),Ae(f.canvas.lastDrillConfig||null),He(f.canvas.lastAssemblerConfig||null),ze(f.canvas.lastTreeFarmConfig||null),Ke(f.canvas.lastFireboxConfig||null),tt(f.canvas.lastWasteFacilityConfig||null),y(f.canvas.nodeId||0),Se(f.canvas.targetIdCounter||0),Ge(),U("node")},50),alert("Canvas imported successfully!")}catch(f){alert(`Import failed: ${f.message}`)}},a.readAsText(s)},r.click()},[Me,Ne,b,Je,Pt,n,u,ue,Be,gt,Ae,He,ze,Ke,tt,y,Se,U]),Yi=m.useCallback(r=>{var a;const o=(a=r.target.files)==null?void 0:a[0];if(!o)return;const s=new FileReader;s.onload=l=>{var d,f;try{const g=JSON.parse(l.target.result),C=g.products||g.machines||g.recipes,M=g.canvas;if(C){const F=new Map((g.products||[]).map(P=>[P.id,P])),x=Array.from(F.values()),_=new Set(((d=g.machines)==null?void 0:d.map(P=>P.id))||[]),j=(g.recipes||[]).filter(P=>_.has(P.machine_id)),v=[...Ye];if(x.forEach(P=>{const R=v.findIndex(T=>T.id===P.id);R>=0?v[R]=P:v.push(P)}),In(v),((f=g.machines)==null?void 0:f.length)>0){const P=[...it],R=new Set(g.machines.map(z=>z.id)),T=ot.filter(z=>!R.has(z.machine_id));g.machines.forEach(z=>{const Z=P.findIndex(me=>me.id===z.id);Z>=0?P[Z]=z:P.push(z)}),Fn(P),En([...T,...j])}if(!M){alert("Data import successful!"),window.location.reload();return}}if(M){const F=g.canvas.nodes||[],x=[];if(F.forEach(v=>{var R,T,z,Z,me,ce,ke,Oe;const P=(T=(R=v.data)==null?void 0:R.recipe)==null?void 0:T.machine_id;P&&!xe(P)&&x.push(`Machine: ${P}`),(me=(Z=(z=v.data)==null?void 0:z.recipe)==null?void 0:Z.inputs)==null||me.forEach(Pe=>{Pe.product_id!=="p_variableproduct"&&!ve(Pe.product_id)&&x.push(`Product: ${Pe.product_id}`)}),(Oe=(ke=(ce=v.data)==null?void 0:ce.recipe)==null?void 0:ke.outputs)==null||Oe.forEach(Pe=>{Pe.product_id!=="p_variableproduct"&&!ve(Pe.product_id)&&x.push(`Product: ${Pe.product_id}`)})}),x.length>0){const v=[...new Set(x)];alert(`Cannot import canvas - missing items:
${v.slice(0,10).join(`
`)}${v.length>10?`
...and ${v.length-10} more`:""}`),r.target.value="";return}if(!window.confirm("Clear current canvas and load imported layout?")){r.target.value="";return}const _=Je(),j=F.map(v=>{var T,z,Z,me;const P=xe((z=(T=v.data)==null?void 0:T.recipe)==null?void 0:z.machine_id);let R=(Z=v.data)==null?void 0:Z.recipe;return P&&R&&!((me=R.outputs)!=null&&me.some(ce=>ce.temperature!==void 0))&&(R=Qt(R,P.id)),{...v,data:{...v.data,recipe:R,machine:P,machineCount:v.data.machineCount??1,displayMode:Me,machineDisplayMode:Ne,..._,globalPollution:b,flows:null,suggestions:[]}}});Pt(),setTimeout(()=>{n(j),u((g.canvas.edges||[]).map(v=>{const{edgePath:P,edgeStyle:R,...T}=v.data||{};return{...v,data:{...T,...be}}})),ue(g.canvas.targetProducts||[]),Be(g.canvas.soldProducts||{}),gt(g.canvas.favoriteRecipes||[]),Ae(g.canvas.lastDrillConfig||null),He(g.canvas.lastAssemblerConfig||null),ze(g.canvas.lastTreeFarmConfig||null),Ke(g.canvas.lastFireboxConfig||null),tt(g.canvas.lastWasteFacilityConfig||null),y(g.canvas.nodeId||0),Se(g.canvas.targetIdCounter||0),Ge(),U("node")},50),alert("Canvas import successful!")}}catch(g){alert(`Import failed: ${g.message}`)}},s.readAsText(o),r.target.value=""},[Me,Ne,b,Je,Pt,n,u,ue,Be,gt,Ae,He,ze,y,Se]);m.useCallback(()=>{const r=new Blob([JSON.stringify({products:Ye,machines:it,recipes:ot},null,2)],{type:"application/json"}),o=URL.createObjectURL(r),s=document.createElement("a");s.href=o,s.download=`industrialist-data-${Date.now()}.json`,s.click(),URL.revokeObjectURL(o)},[Ye,it,ot]);const Xi=m.useCallback(()=>{const r=c.map(d=>{const{edgePath:f,edgeStyle:g,...C}=d.data||{};return{...d,data:C}}),o={nodes:t.map(wt),edges:r,targetProducts:te,nodeId:p,targetIdCounter:pe,soldProducts:$e,favoriteRecipes:et,lastDrillConfig:We,lastAssemblerConfig:qe,lastTreeFarmConfig:Ve,lastFireboxConfig:Ue,lastWasteFacilityConfig:Ft},s=new Blob([JSON.stringify({canvas:o},null,2)],{type:"application/json"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download=`industrialist-canvas-${Date.now()}.json`,l.click(),URL.revokeObjectURL(a)},[t,c,te,p,pe,$e,et,We,qe,Ve,Ue,Ft,wt]);m.useCallback(()=>{const r=c.map(l=>{const{edgePath:d,edgeStyle:f,...g}=l.data||{};return{...l,data:g}}),o=new Blob([JSON.stringify({products:Ye,machines:it,recipes:ot,canvas:{nodes:t.map(wt),edges:r,targetProducts:te,nodeId:p,targetIdCounter:pe,soldProducts:$e,favoriteRecipes:et,lastDrillConfig:We,lastAssemblerConfig:qe,lastTreeFarmConfig:Ve,lastFireboxConfig:Ue,lastWasteFacilityConfig:Ft}},null,2)],{type:"application/json"}),s=URL.createObjectURL(o),a=document.createElement("a");a.href=s,a.download=`industrialist-export-${Date.now()}.json`,a.click(),URL.revokeObjectURL(s)},[t,c,te,p,pe,$e,et,We,qe,Ve,Ue,wt]),m.useCallback(()=>{const r=yo(),o=bo(),s=vo();In(r),Fn(o),En(s),U("node")},[U]);const Zi=m.useCallback(r=>{const o=Je(),s=r.nodes.map(a=>{var f,g,C,M;const l=xe((g=(f=a.data)==null?void 0:f.recipe)==null?void 0:g.machine_id);let d=(C=a.data)==null?void 0:C.recipe;return l&&d&&!((M=d.outputs)!=null&&M.some(F=>F.temperature!==void 0))&&(d=Qt(d,l.id)),{...a,data:{...a.data,recipe:d,machine:l,machineCount:a.data.machineCount??1,displayMode:Me,machineDisplayMode:Ne,...o,globalPollution:b,flows:null,suggestions:[]}}});Pt(),setTimeout(()=>{n(s),u((r.edges||[]).map(a=>{const{edgePath:l,edgeStyle:d,...f}=a.data||{};return{...a,data:{...f,...be}}})),ue(r.targetProducts||[]),Be(r.soldProducts||{}),gt(r.favoriteRecipes||[]),Ae(r.lastDrillConfig||null),He(r.lastAssemblerConfig||null),ze(r.lastTreeFarmConfig||null),Ke(r.lastFireboxConfig||null),tt(r.lastWasteFacilityConfig||null),y(r.nodeId||0),Se(r.targetIdCounter||0),Ge(),U("node")},50)},[Me,Ne,b,Je,Pt,n,u,ue,Be,gt,Ae,He,ze,Ke,tt,y,Se,U]),ea=m.useCallback(()=>{window.confirm("Restore all data to defaults? This will clear the canvas and reset all products, machines, and recipes.")&&(ja(),jo(wa),wo(Ma),Mo(Pa),n([]),u([]),y(0),ue([]),Se(0),Be({}),Ae(null),He(null),ze(null),Ke(null),tt(null),window.location.reload())},[n,u,Ye,it,ot]);m.useEffect(()=>{const r=o=>{if(o.key==="industrialist_theme")try{const s=JSON.parse(o.newValue);At({edgePath:s.edgePath||"orthogonal",edgeStyle:s.edgeStyle||"animated"})}catch(s){console.error("Error parsing theme from storage:",s)}};return window.addEventListener("storage",r),()=>window.removeEventListener("storage",r)},[]),m.useEffect(()=>{if(!je){const r=wr();At({edgePath:r.edgePath||"orthogonal",edgeStyle:r.edgeStyle||"animated"})}},[je]);const ta=Ye.filter(r=>r.name.toLowerCase().includes(L.toLowerCase())&&(O==="all"||r.type===O)).sort((r,o)=>q==="name_asc"?r.name.localeCompare(o.name):q==="name_desc"?o.name.localeCompare(r.name):q==="price_asc"?(r.price==="Variable"?1/0:r.price)-(o.price==="Variable"?1/0:o.price):q==="price_desc"?(o.price==="Variable"?-1/0:o.price)-(r.price==="Variable"?-1/0:r.price):q==="rp_asc"?(r.rp_multiplier==="Variable"?1/0:r.rp_multiplier)-(o.rp_multiplier==="Variable"?1/0:o.rp_multiplier):(o.rp_multiplier==="Variable"?-1/0:o.rp_multiplier)-(r.rp_multiplier==="Variable"?-1/0:r.rp_multiplier)),wn=it.filter(r=>{const o=r.name.toLowerCase().includes(L.toLowerCase()),s=r.id==="m_mineshaft_drill"||r.id==="m_logic_assembler"||r.id==="m_tree_farm"||r.id==="m_underground_waste_facility"||r.id==="m_liquid_dump"||r.id==="m_liquid_burner"||vr(r.id).length>0,a=ie==="all"||r.tier!==void 0&&r.tier.toString()===ie;return o&&s&&a}).sort((r,o)=>r.name.localeCompare(o.name)),ra=r=>{if(r.id==="m_mineshaft_drill")ut(Dn,1);else if(r.id==="m_logic_assembler")ut(Rn,1);else if(r.id==="m_tree_farm")ut(Bn,1);else if(r.id==="m_underground_waste_facility")ut(Xr,1);else if(r.id==="m_liquid_dump")ut(Zr,1);else if(r.id==="m_liquid_burner")ut(en,1);else{H(r);return}fr()},Mn=(B==="product"?jn():vr(I==null?void 0:I.id)).sort((r,o)=>{const s=et.includes(r.id),a=et.includes(o.id);if(s&&!a)return-1;if(!s&&a)return 1;const l=xe(r.machine_id),d=xe(o.machine_id);return((l==null?void 0:l.name)||"").localeCompare((d==null?void 0:d.name)||"")}),na=r=>{gt(o=>o.includes(r)?o.filter(s=>s!==r):[...o,r])};return e.jsxs("div",{style:{width:"100vw",height:"100vh"},children:[e.jsxs(ua,{onNodeDragStart:()=>xr(!0),onNodeDragStop:()=>xr(!1),onConnectStart:()=>xr(!0),onConnectEnd:()=>xr(!1),ref:qt,nodes:t,edges:c,onNodesChange:hi,onEdgesChange:gi,onConnect:_i,onNodeClick:Bi,onNodeDoubleClick:Oi,onMouseMove:Ai,onClick:Hi,onContextMenu:zi,onInit:r=>{dt.current=r,De(r.getZoom())},onMoveEnd:(r,o)=>{De(o.zoom)},nodeTypes:Wo,edgeTypes:qo,panOnDrag:[0,2],panOnScroll:!1,selectionOnDrag:!1,fitView:!0,elevateNodesOnSelect:!1,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,minZoom:.1,maxZoom:4,autoPanOnNodeDrag:!1,zoomOnDoubleClick:!1,preventScrolling:!0,nodeOrigin:[0,0],snapToGrid:!1,onlyRenderVisibleElements:!0,disableKeyboardA11y:!0,deleteKeyCode:null,selectionKeyCode:null,multiSelectionKeyCode:null,panActivationKeyCode:null,zoomActivationKeyCode:null,connectionLineType:be.edgePath==="straight"?"straight":be.edgePath==="orthogonal"?"smoothstep":"default",connectionLineStyle:{stroke:getComputedStyle(document.documentElement).getPropertyValue("--color-primary").trim(),strokeWidth:2,strokeDasharray:be.edgeStyle==="animated"||be.edgeStyle==="dashed"?"8 4":"none"},defaultEdgeOptions:{type:"custom"},children:[e.jsx(pa,{color:"#333",gap:16,size:1}),!oe&&e.jsx(ma,{className:(ft||ht)&&!Ze?"controls-shifted":"",position:"bottom-left"}),!oe&&e.jsx(fa,{nodeColor:()=>getComputedStyle(document.documentElement).getPropertyValue("--color-primary").trim(),maskColor:getComputedStyle(document.documentElement).getPropertyValue("--bg-overlay").trim(),position:"bottom-right"}),e.jsx(Nn,{position:"top-left",style:{margin:oe?"5px":"10px",maxWidth:oe?"calc(100vw - 10px)":"none"},children:e.jsx("div",{className:`left-panel-container ${Ze?"collapsed":""}`,style:oe?{maxWidth:"100%"}:{},children:e.jsxs("div",{style:{display:"flex",gap:"15px",alignItems:"flex-start",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",gap:"15px",alignItems:"flex-start"},children:[e.jsxs("div",{className:"stats-panel",children:[e.jsx("h3",{className:"stats-title",children:fi}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-label",children:"Total Power:"}),e.jsx("div",{className:"stat-value",children:Kr(Mt.totalPower)})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-label",children:"Total Pollution:"}),e.jsxs("div",{className:"stat-value",style:{color:Mt.totalPollution>=0?"var(--stat-negative)":"var(--stat-positive)"},children:[Mt.totalPollution.toFixed(2),"%/hr"]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-label",children:"Total Min Models:"}),e.jsx("div",{className:"stat-value",children:Mt.totalModelCount.toFixed(0)})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-label",children:"Total Profit:"}),e.jsxs("div",{className:"stat-value",style:{color:_n>=0?"var(--stat-positive)":"var(--stat-negative)"},children:["$",at(_n),"/s"]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-label",children:"Total Cost:"}),e.jsxs("div",{className:"stat-value",children:["$",at(bi.totalCost)]})]})]})]}),e.jsxs("div",{className:"flex-col action-buttons-container",children:[e.jsx("button",{onClick:Ci,className:"btn btn-primary",children:"+ Select Recipe"}),e.jsx("button",{onClick:()=>{Fe(!0),Le("targets")},className:"btn btn-secondary",children:"View Recipes"}),e.jsx("button",{onClick:Vi,className:"btn btn-secondary",disabled:St!==null,children:St!==null?"Computing...":"Compute Machines"}),e.jsx("button",{onClick:qi,className:"btn btn-secondary",children:"Auto Layout"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>$t(!ft),className:"btn btn-secondary btn-square",title:ft?"Close more statistics":"Open more statistics",children:ft?"â†“":"â†‘"}),e.jsx("button",{onClick:()=>nr(!Ze),className:"btn btn-secondary btn-square btn-panel-toggle",title:Ze?"Show left panel":"Hide left panel",children:Ze?"â†’":"â†"})]})]})]}),(ft||ht)&&e.jsxs("div",{className:`extended-panel ${ht?"closing":""}`,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:oe?"10px":"15px",borderBottom:"2px solid var(--border-divider)",position:"sticky",top:0,background:"var(--bg-secondary)",zIndex:1,flexWrap:oe?"wrap":"nowrap",gap:oe?"10px":"0"},children:[e.jsx("h3",{style:{color:"var(--color-primary)",fontSize:oe?"var(--font-size-base)":"var(--font-size-md)",fontWeight:700,margin:0},children:"More Statistics"}),oe&&e.jsx("button",{onClick:()=>$t(!1),className:"btn btn-secondary",style:{padding:"6px 12px",fontSize:"var(--font-size-sm)",minWidth:"auto"},children:"Close"}),e.jsxs("div",{style:{display:"flex",gap:oe?"5px":"10px",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>ci(r=>r==="perSecond"?"perCycle":"perSecond"),className:"btn btn-secondary",style:{padding:oe?"6px 10px":"8px 16px",fontSize:oe?"var(--font-size-sm)":"var(--font-size-base)",minWidth:"auto"},title:Me==="perSecond"?"Switch to per-cycle display":"Switch to per-second display",children:Me==="perSecond"?"Per Second":"Per Cycle"}),e.jsx("button",{onClick:()=>di(r=>r==="perMachine"?"total":"perMachine"),className:"btn btn-secondary",style:{padding:oe?"6px 10px":"8px 16px",fontSize:oe?"var(--font-size-sm)":"var(--font-size-base)",minWidth:"auto"},title:Ne==="perMachine"?"Switch to total display":"Switch to per-machine display",children:Ne==="perMachine"?"Per Machine":"Total"})]})]}),e.jsxs("div",{className:"extended-panel-content",children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{htmlFor:"global-pollution",style:{color:"var(--text-primary)",fontSize:"var(--font-size-base)",fontWeight:600,display:"block",marginBottom:"8px"},children:"Global Pollution (%):"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("button",{onClick:()=>or(r=>!r),className:"btn btn-secondary",style:{padding:"10px 16px",minWidth:"auto",fontSize:"var(--font-size-lg)",lineHeight:1},title:It?"Resume pollution change":"Pause pollution change",children:It?"â–¶":"âšâš"}),e.jsx("input",{id:"global-pollution",type:"number",step:"0.0001",value:b,onFocus:()=>ar(!0),onBlur:r=>{ar(!1);const o=r.target.value,s=parseFloat(o);fe(!isNaN(s)&&isFinite(s)?parseFloat(s.toFixed(4)):0)},onChange:r=>fe(r.target.value===""?"":parseFloat(r.target.value)),className:"input",placeholder:"Enter global pollution",style:{flex:1,textAlign:"left"}})]})]}),e.jsxs("div",{style:{marginTop:"30px"},children:[e.jsx("h4",{style:{color:"var(--text-primary)",fontSize:"var(--font-size-base)",fontWeight:600,marginBottom:"12px"},children:"Excess Products:"}),pr.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"var(--font-size-sm)",padding:"15px",textAlign:"center",background:"var(--bg-main)",borderRadius:"var(--radius-sm)"},children:"No excess products. All outputs are consumed by connected inputs."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:pr.map(r=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",background:"var(--bg-main)",borderRadius:"var(--radius-sm)",border:r.isSold?"2px solid var(--color-primary)":"2px solid var(--border-light)"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{color:"var(--text-primary)",fontSize:"var(--font-size-sm)",fontWeight:600},children:r.product.name}),e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"var(--font-size-xs)",marginTop:"2px"},children:[at(r.excessRate),"/s"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[typeof r.product.price=="number"&&e.jsxs("div",{style:{color:r.isSold?"var(--color-primary)":"var(--text-muted)",fontSize:"var(--font-size-sm)",fontWeight:600},children:["$",at(r.product.price*r.excessRate),"/s"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",color:"var(--text-primary)",fontSize:"var(--font-size-sm)"},children:[e.jsx("input",{type:"checkbox",checked:r.isSold,onChange:o=>Be(s=>({...s,[r.productId]:o.target.checked})),style:{width:"18px",height:"18px",cursor:"pointer",accentColor:"var(--color-primary)"}}),"Sell"]})]})]},r.productId))})]}),e.jsxs("div",{style:{marginTop:"30px"},children:[e.jsx("h4",{style:{color:"var(--text-primary)",fontSize:"var(--font-size-base)",fontWeight:600,marginBottom:"12px"},children:"Deficient Products:"}),yn.length===0?e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"var(--font-size-sm)",padding:"15px",textAlign:"center",background:"var(--bg-main)",borderRadius:"var(--radius-sm)"},children:"No deficient products. All inputs are fully supplied by connected outputs."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:yn.map(r=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",background:"var(--bg-main)",borderRadius:"var(--radius-sm)",border:"2px solid #fca5a5"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{color:"var(--text-primary)",fontSize:"var(--font-size-sm)",fontWeight:600},children:r.product.name}),e.jsxs("div",{style:{color:"#fca5a5",fontSize:"var(--font-size-xs)",marginTop:"2px"},children:["Shortage: ",at(r.deficiencyRate),"/s"]})]}),e.jsxs("div",{style:{color:"#fca5a5",fontSize:"var(--font-size-xs)",fontWeight:600,textAlign:"right"},children:[r.affectedNodes.length," node",r.affectedNodes.length!==1?"s":""," affected"]})]},r.productId))})]})]})]})]})})}),e.jsxs(Nn,{position:"top-right",style:{margin:oe?"5px":"10px",maxWidth:oe?"calc(100vw - 10px)":"none"},children:[oe&&e.jsxs("div",{className:"mobile-controls-container",children:[e.jsx("button",{onClick:()=>Ht(r=>r==="target"?"pan":"target"),className:`btn ${Ee==="target"?"btn-primary":"btn-secondary"}`,title:"Target mode - Tap nodes to mark as targets",children:"ðŸŽ¯"}),e.jsx("button",{onClick:()=>Ht(r=>r==="delete"?"pan":"delete"),className:`btn ${Ee==="delete"?"btn-primary":"btn-secondary"}`,title:"Delete mode - Tap nodes to delete",children:"ðŸ—‘ï¸"})]}),e.jsxs("div",{className:`menu-container ${Ce?"":"closed"}`,style:oe?{maxWidth:"calc(100vw - 10px)"}:{},children:[e.jsx("button",{onClick:()=>_e(!Ce),className:"btn btn-secondary btn-menu-toggle",style:oe?{fontSize:"var(--font-size-sm)",padding:"6px 10px"}:{},children:Ce?">":"<"}),e.jsxs("div",{className:"menu-buttons",style:oe?{maxHeight:"calc(100vh - 100px)",overflowY:"auto"}:{},children:[e.jsx("button",{onClick:()=>{Pt(),U("node")},className:"btn btn-secondary",children:"Clear All"}),e.jsx("button",{onClick:()=>tr(!0),className:"btn btn-secondary",children:"Saves"}),e.jsx("button",{onClick:()=>rr(!0),className:"btn btn-secondary",children:"Data"}),e.jsx("button",{onClick:ea,className:"btn btn-secondary",children:"Restore Defaults"}),e.jsx("button",{onClick:()=>we(!0),className:"btn btn-secondary",children:"Theme Editor"}),e.jsx("button",{onClick:()=>Lt(!0),className:"btn btn-secondary",children:"Help"})]})]})]})]}),e.jsx("input",{ref:mi,type:"file",accept:".json",style:{display:"none"},onChange:Yi}),(ct||$)&&e.jsx("div",{className:"modal-overlay",onClick:Sn,children:ct&&e.jsxs("div",{className:"modal",onClick:r=>r.stopPropagation(),style:{width:"450px"},children:[e.jsx("h2",{className:"modal-title",children:"Edit Machine Count"}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",color:"var(--text-primary)",fontSize:"var(--font-size-base)",fontWeight:600,marginBottom:"10px"},children:"Machine Count:"}),e.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[e.jsx("button",{onClick:()=>{const r=["free","capped","locked"],s=(r.indexOf(le)+1)%r.length,a=r[s];ge(a)},className:"btn btn-secondary",style:{minWidth:"80px",padding:"10px",fontWeight:600,background:le==="locked"?"#ef4444":le==="capped"?"#f59e0b":"var(--bg-secondary)",color:le==="free"?"var(--text-primary)":"#fff"},title:`Mode: ${le==="free"?"Free (LP/suggestions can change)":le==="capped"?"Capped (LP/suggestions cannot exceed cap)":"Locked (LP/suggestions cannot change)"}`,children:le==="free"?"ðŸ”“ Free":le==="capped"?"ðŸ“Š Cap":"ðŸ”’ Lock"}),e.jsx("input",{type:"number",min:"0",step:"0.1",value:ye,onChange:r=>he(r.target.value),onKeyPress:r=>{r.key==="Enter"&&Ur(!1)},className:"input",placeholder:"Enter machine count",autoFocus:!0,style:{flex:1}})]}),e.jsxs("p",{style:{marginTop:"8px",fontSize:"var(--font-size-sm)",color:"var(--text-secondary)"},children:[le==="free"&&"Free: LP solver and suggestions can modify this count",le==="capped"&&`Capped: LP/suggestions cannot exceed ${parseFloat(ye)||0} (the value when Apply is pressed)`,le==="locked"&&"Locked: LP solver and suggestions cannot modify this count"]})]}),X&&!se&&e.jsx("div",{style:{marginBottom:"20px",padding:"12px",background:"rgba(212, 166, 55, 0.1)",borderRadius:"var(--radius-sm)",border:"1px solid var(--border-divider)"},children:e.jsxs("div",{style:{fontSize:"var(--font-size-sm)",color:"var(--text-secondary)",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Apply:"})," Applies machine count and lock/cap mode to this node only"]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Apply to All:"})," Applies machine count to this node and propagates count changes to connected nodes. Lock/cap mode only applies to this node."]}),e.jsx("div",{style:{fontSize:"11px",fontStyle:"italic",color:"var(--text-muted)"},children:"Note: Lock/cap mode is never propagated to other nodes"})]})}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:Sn,className:"btn btn-secondary",style:{flex:1},children:"Cancel"}),e.jsx("button",{onClick:()=>Ur(!1),className:"btn btn-primary",style:{flex:1},children:"Apply"}),X&&!se&&e.jsx("button",{onClick:()=>Ur(!0),className:"btn btn-primary",style:{flex:1,background:"var(--color-primary-hover)",fontWeight:700},title:"Apply changes and propagate to connected nodes",children:"Apply to All"})]})]})}),D&&e.jsx("div",{className:"modal-overlay",onClick:fr,children:e.jsxs("div",{className:"modal",onClick:r=>r.stopPropagation(),children:[e.jsx("h2",{className:"modal-title",children:k?`Recipes for ${k.name}`:I?`Recipes for ${I.name}`:"Select Product or Machine"}),!k&&!I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-lg",children:e.jsxs("div",{className:"flex-row",style:{gap:"10px",marginBottom:"15px"},children:[e.jsx("button",{onClick:()=>w("product"),className:`btn ${B==="product"?"btn-primary":"btn-secondary"}`,style:{flex:1},children:"By Products"}),e.jsx("button",{onClick:()=>w("machine"),className:`btn ${B==="machine"?"btn-primary":"btn-secondary"}`,style:{flex:1},children:"By Machines"})]})}),B==="product"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-lg flex-col",children:[e.jsx("input",{type:"text",placeholder:"Search products...",value:L,onChange:r=>A(r.target.value),className:"input"}),e.jsxs("div",{className:"flex-row",children:[e.jsxs("select",{value:O,onChange:r=>K(r.target.value),className:"select",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"item",children:"Items Only"}),e.jsx("option",{value:"fluid",children:"Fluids Only"})]}),e.jsxs("select",{value:q,onChange:r=>Y(r.target.value),className:"select",children:[e.jsx("option",{value:"name_asc",children:"Name â†‘ (A-Z)"}),e.jsx("option",{value:"name_desc",children:"Name â†“ (Z-A)"}),e.jsx("option",{value:"price_asc",children:"Price â†‘ (Low-High)"}),e.jsx("option",{value:"price_desc",children:"Price â†“ (High-Low)"}),e.jsx("option",{value:"rp_asc",children:"RP Mult â†‘ (Low-High)"}),e.jsx("option",{value:"rp_desc",children:"RP Mult â†“ (High-Low)"})]})]})]}),e.jsxs("div",{className:"modal-content",style:{maxHeight:"400px"},children:[e.jsxs("div",{className:"product-table-header",children:[e.jsx("div",{children:"Product"}),e.jsx("div",{className:"text-right",children:"Price"}),e.jsx("div",{className:"text-right",children:"RP Mult"})]}),ta.map(r=>e.jsxs("div",{onClick:()=>W(r),className:"product-row",children:[e.jsxs("div",{children:[e.jsx("div",{className:"product-name",children:r.name}),e.jsx("div",{className:"product-type",children:r.type==="item"?"ðŸ“¦ Item":"ðŸ’§ Fluid"})]}),e.jsx("div",{className:"text-right",style:{alignSelf:"center"},children:r.price==="Variable"?"Variable":`${at(r.price)}`}),e.jsx("div",{className:"text-right",style:{alignSelf:"center"},children:r.rp_multiplier==="Variable"?"Variable":r.rp_multiplier>=1e3?`${at(r.rp_multiplier)}x`:`${r.rp_multiplier.toFixed(1)}x`})]},r.id))]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-lg",style:{display:"flex",gap:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Search machines...",value:L,onChange:r=>A(r.target.value),className:"input",style:{flex:3}}),e.jsxs("select",{value:ie,onChange:r=>de(r.target.value),className:"select",style:{flex:1},children:[e.jsx("option",{value:"all",children:"All Tiers"}),e.jsx("option",{value:"1",children:"Tier 1"}),e.jsx("option",{value:"2",children:"Tier 2"}),e.jsx("option",{value:"3",children:"Tier 3"}),e.jsx("option",{value:"4",children:"Tier 4"}),e.jsx("option",{value:"5",children:"Tier 5"})]})]}),e.jsx("div",{className:"modal-content flex-col",style:{maxHeight:"400px"},children:wn.length===0?e.jsx("div",{className:"empty-state",children:"No machines found"}):wn.map(r=>e.jsxs("div",{onClick:()=>ra(r),className:"recipe-card",style:{cursor:"pointer"},children:[e.jsx("div",{className:"recipe-machine",style:{color:r.tier===1?"var(--tier-1-color)":r.tier===2?"var(--tier-2-color)":r.tier===3?"var(--tier-3-color)":r.tier===4?"var(--tier-4-color)":(r.tier===5,"var(--tier-5-color)")},children:r.name}),e.jsx("div",{className:"recipe-details",style:{color:"#999"},children:r.id==="m_mineshaft_drill"||r.id==="m_logic_assembler"||r.id==="m_tree_farm"?"Click to create box":`${vr(r.id).length} recipe(s)`})]},r.id))})]})]}):e.jsxs(e.Fragment,{children:[V==="button"&&e.jsx("button",{onClick:()=>{W(null),H(null)},className:"btn btn-secondary btn-back",children:"â† Back"}),k&&e.jsx("div",{className:"mb-lg",children:e.jsxs("select",{value:re,onChange:r=>ne(r.target.value),className:"select",children:[e.jsx("option",{value:"all",children:"All Recipes"}),e.jsxs("option",{value:"producers",children:["Producers (Outputs ",k.name,")"]}),e.jsxs("option",{value:"consumers",children:["Consumers (Uses ",k.name,")"]}),e.jsx("option",{value:"disposal",children:"Disposal"})]})}),e.jsx("div",{className:"modal-content flex-col",style:{maxHeight:"400px"},children:Mn.length===0?e.jsx("div",{className:"empty-state",children:"No recipes found"}):Mn.map(r=>{const o=xe(r.machine_id),s=et.includes(r.id),a=Rr[r.id]??1;return o&&r.inputs&&r.outputs?e.jsxs("div",{className:"recipe-card",style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),na(r.id)},style:{background:"none",border:"none",fontSize:"20px",cursor:"pointer",padding:"4px",lineHeight:1,filter:s?"none":"grayscale(100%)",opacity:s?1:.4,transition:"all 0.2s"},onMouseEnter:l=>{l.currentTarget.style.transform="scale(1.2)",l.currentTarget.style.opacity="1"},onMouseLeave:l=>{l.currentTarget.style.transform="scale(1)",l.currentTarget.style.opacity=s?"1":"0.4"},title:s?"Remove from favorites":"Add to favorites",children:"â­"}),e.jsx("div",{onClick:l=>{l.stopPropagation();const d=a<=0?1:a,f=ut(r,d);S(!0),N(!1),setTimeout(()=>{Re(f),ee(f),he(String(d)),J(!0),S(!1)},50)},style:{minWidth:"70px",padding:"10px 12px",background:E&&a<=0?"var(--delete-bg)":"var(--color-primary)",color:E&&a<=0?"var(--delete-color)":"var(--color-primary-dark)",borderRadius:"var(--radius-sm)",fontWeight:700,fontSize:"18px",textAlign:"center",cursor:"pointer",transition:"all 0.2s",userSelect:"none",border:E&&a<=0?"2px solid var(--delete-color)":"2px solid transparent"},onMouseEnter:l=>{E&&a<=0?(l.currentTarget.style.background="var(--delete-hover-bg)",l.currentTarget.style.color="var(--delete-hover-color)"):(l.currentTarget.style.background="var(--color-primary-hover)",l.currentTarget.style.transform="scale(1.05)",l.currentTarget.style.borderColor="var(--color-primary-hover)")},onMouseLeave:l=>{E&&a<=0?(l.currentTarget.style.background="var(--delete-bg)",l.currentTarget.style.color="var(--delete-color)"):(l.currentTarget.style.background="var(--color-primary)",l.currentTarget.style.transform="scale(1)",l.currentTarget.style.borderColor="transparent")},title:E?a<=0?"Cannot create: machine count is 0":`Click to edit before creating (${Number.isInteger(a)?a:a.toFixed(2)} calculated)`:"Click to set machine count",children:Number.isInteger(a)?a:a.toFixed(2)}),e.jsxs("div",{style:{flex:1,cursor:"pointer",minWidth:0},onClick:l=>{if(l.stopPropagation(),a<=0){const f=ut(r,1);S(!0),N(!1),setTimeout(()=>{Re(f),ee(f),he("1"),J(!0),S(!1)},50)}else ut(r),fr()},children:[e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"8px",marginBottom:"4px"},children:[e.jsx("div",{className:"recipe-machine",style:{color:o.tier===1?"var(--tier-1-color)":o.tier===2?"var(--tier-2-color)":o.tier===3?"var(--tier-3-color)":o.tier===4?"var(--tier-4-color)":(o.tier===5,"var(--tier-5-color)")},children:o.name}),r.power_type==="HV"&&e.jsx("div",{style:{fontSize:"12px",color:"var(--text-primary)",fontWeight:500},children:"HV"})]}),e.jsxs("div",{className:"recipe-details",children:[e.jsx("span",{className:"recipe-label-input",children:"Inputs: "}),e.jsx("span",{children:r.inputs.map(l=>An(l,ve)).join(", ")})]}),e.jsxs("div",{className:"recipe-details",children:[e.jsx("span",{className:"recipe-label-output",children:"Outputs: "}),e.jsx("span",{children:r.outputs.map(l=>An(l,ve)).join(", ")})]})]})]},r.id):null})})]}),e.jsx("button",{onClick:fr,className:"btn btn-secondary",style:{marginTop:"20px"},children:"Close"})]})}),Tt&&e.jsx("div",{className:"modal-overlay",onClick:()=>lt(!1),children:e.jsxs("div",{className:"modal",onClick:r=>r.stopPropagation(),style:{width:"800px",maxHeight:"85vh",display:"flex",flexDirection:"column"},children:[e.jsx("h2",{className:"modal-title",children:"Target Products"}),e.jsx("div",{className:"modal-content flex-col",style:{flex:1,overflowY:"auto",paddingBottom:"20px",marginBottom:"0"},children:te.length===0?e.jsx("div",{className:"empty-state",children:"No target products yet. Shift+Click a recipe box to mark it as a target."}):te.map(r=>{var F;const o=t.find(x=>x.id===r.recipeBoxId);if(!o)return null;const{recipe:s,machine:a,machineCount:l=0}=o.data||{};if(!s)return null;let d=s.cycle_time;if((typeof d!="number"||d<=0)&&(d=1),mt(a==null?void 0:a.id)){const x=bt[a.id];if((x==null?void 0:x.type)==="steam_input"&&vt(s)){const _=s.tempDependentInputTemp??st;d=yt(a.id,_,d)}}(typeof d!="number"||d<=0)&&(d=1);const g=s.isMineshaftDrill||s.id==="r_mineshaft_drill",C=(F=G==null?void 0:G.flows)==null?void 0:F.byNode[r.recipeBoxId],M={inputs:{},outputs:{}};return s.inputs.forEach((x,_)=>{var j;if(typeof x.quantity=="number"){const P=(g?x.quantity:x.quantity/d)*l,R=((j=C==null?void 0:C.inputFlows[_])==null?void 0:j.connected)||0;M.inputs[_]={totalRate:P,connectedFlow:R,deficiency:Math.max(0,P-R)}}}),s.outputs.forEach((x,_)=>{var v;const j=x.quantity;if(typeof j=="number"){const R=(g?j:j/d)*l,T=((v=C==null?void 0:C.outputFlows[_])==null?void 0:v.connected)||0;M.outputs[_]={totalRate:R,connectedFlow:T,excess:Math.max(0,R-T)}}}),e.jsxs("div",{style:{padding:"20px",background:"var(--bg-main)",border:"2px solid var(--border-primary)",borderRadius:"var(--radius-md)",marginBottom:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--text-primary)",fontSize:"16px",fontWeight:600},children:s.name}),e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"4px"},children:["Machine Count: ",l.toFixed(4)]})]}),e.jsx("button",{onClick:()=>Cn(r.id),className:"btn btn-delete",style:{padding:"6px 12px"},children:"Remove"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",borderTop:"1px solid var(--border-divider)",paddingTop:"15px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--input-text)",fontSize:"14px",fontWeight:600,marginBottom:"12px",textAlign:"center"},children:"Inputs"}),s.inputs.map((x,_)=>{const j=M.inputs[_];return j?e.jsx(Cr,{productName:pt(x.product_id,ve),connectedFlow:j.connectedFlow,currentExcess:j.deficiency,onTargetExcessCommit:v=>hr(r.id,"input",_,v),styleType:"input"},_):null})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--output-text)",fontSize:"14px",fontWeight:600,marginBottom:"12px",textAlign:"center"},children:"Outputs"}),s.outputs.map((x,_)=>{const j=M.outputs[_];return j?e.jsx(Cr,{productName:pt(x.product_id,ve),connectedFlow:j.connectedFlow,currentExcess:j.excess,onTargetExcessCommit:v=>hr(r.id,"output",_,v),styleType:"output"},_):null})]})]})]},r.id)})}),e.jsx("button",{onClick:()=>lt(!1),className:"btn btn-secondary",style:{width:"100%"},children:"Close"})]})}),Xe&&e.jsx("div",{className:"modal-overlay",onClick:()=>Fe(!1),children:e.jsxs("div",{className:"modal",onClick:r=>r.stopPropagation(),style:{width:"1400px",maxWidth:"95vw",maxHeight:"90vh"},children:[e.jsx("h2",{className:"modal-title",children:"Recipes"}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px",borderBottom:"2px solid var(--border-divider)"},children:[e.jsx("button",{onClick:()=>Le("targets"),className:Te==="targets"?"btn btn-primary":"btn btn-secondary",style:{flex:1,borderRadius:"var(--radius-sm) var(--radius-sm) 0 0",borderBottom:Te==="targets"?"3px solid var(--color-primary)":"none",minWidth:"auto"},children:"Solver & Targets"}),e.jsx("button",{onClick:()=>Le("canvas"),className:Te==="canvas"?"btn btn-primary":"btn btn-secondary",style:{flex:1,borderRadius:"var(--radius-sm) var(--radius-sm) 0 0",borderBottom:Te==="canvas"?"3px solid var(--color-primary)":"none",minWidth:"auto"},children:"Canvas Recipes"})]}),Te==="canvas"&&e.jsx("div",{style:{marginBottom:"15px"},children:e.jsxs("select",{value:sr,onChange:r=>ui(r.target.value),className:"select",style:{width:"100%"},children:[e.jsx("option",{value:"all",children:"All Recipes"}),e.jsx("option",{value:"excess",children:"Has Excess"}),e.jsx("option",{value:"deficiency",children:"Has Deficiency"})]})}),e.jsx("div",{style:{maxHeight:"calc(90vh - 300px)",marginBottom:"20px"},children:Te==="targets"?e.jsxs("div",{style:{display:"flex",gap:"0",height:"calc(90vh - 180px)"},children:[e.jsxs("div",{style:{flex:"0 0 25%",display:"flex",flexDirection:"column",paddingRight:"20px"},children:[e.jsx("h3",{style:{color:"var(--color-primary)",fontSize:"var(--font-size-lg)",fontWeight:700,marginBottom:"15px",textAlign:"center"},children:"Solver Configuration"}),e.jsxs("div",{style:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column",gap:"15px"},children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:e.jsx("button",{onClick:()=>{Wt(["Deficiencies","Model Count","Excesses","Pollution","Power","Cost"]),Ar([])},className:"btn btn-secondary",style:{padding:"8px 12px",fontSize:"var(--font-size-sm)"},children:"Restore to Defaults"})}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--text-primary)",fontSize:"var(--font-size-sm)",fontWeight:600,marginBottom:"8px"},children:"Objective Priority (Top = Highest)"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[...Et,...$r].map(o=>{const s=Et.includes(o),a=o==="Deficiencies",l=Et.indexOf(o),d=Et.length,f=d>1?l/(d-1):0,g=Math.round(239-205*f),C=Math.round(68+129*f),M=Math.round(68+26*f),F=s?`rgb(${g}, ${C}, ${M})`:"var(--border-light)",x=s&&!a&&l>1,_=s&&!a&&l<d-1,j=()=>{Wt(T=>{const z=[...T],Z=z.indexOf(o);return[z[Z-1],z[Z]]=[z[Z],z[Z-1]],z})},v=()=>{Wt(T=>{const z=[...T],Z=z.indexOf(o);return[z[Z+1],z[Z]]=[z[Z],z[Z+1]],z})},P=()=>{s?(Wt(T=>T.filter(z=>z!==o)),Ar(T=>[...T,o])):(Ar(T=>T.filter(z=>z!==o)),Wt(T=>[...T,o]))},R={width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"var(--radius-sm)",border:"1px solid var(--border-primary)",background:"var(--bg-main)",color:"var(--text-primary)",cursor:"pointer",fontSize:"14px",lineHeight:1,flexShrink:0,transition:"opacity 0.15s",padding:0};return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"7px 10px",background:"var(--bg-secondary)",border:`2px solid ${F}`,borderRadius:"var(--radius-sm)",opacity:s?1:.5,transition:"opacity 0.2s, border-color 0.2s"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[e.jsx("button",{onClick:j,disabled:!x,style:{...R,opacity:x?1:.25,cursor:x?"pointer":"default"},title:"Move up",children:"â†‘"}),e.jsx("button",{onClick:v,disabled:!_,style:{...R,opacity:_?1:.25,cursor:_?"pointer":"default"},title:"Move down",children:"â†“"})]}),e.jsx("span",{style:{flex:1,fontWeight:600,fontSize:"var(--font-size-sm)",color:s?"var(--text-primary)":"var(--text-secondary)",userSelect:"none"},children:o}),e.jsx("button",{onClick:a?void 0:P,disabled:a,title:a?"Deficiencies must always be active":s?"Disable":"Enable",style:{...R,width:"52px",fontSize:"11px",fontWeight:600,opacity:a?.25:1,cursor:a?"default":"pointer",color:s?"#fca5a5":"#86efac",borderColor:s?"rgba(239,68,68,0.4)":"rgba(34,197,94,0.4)"},children:a?"â€”":s?"Disable":"Enable"})]},o)})})]})]})]}),e.jsx("div",{style:{width:"2px",background:"var(--border-divider)",margin:"0 20px"}}),e.jsxs("div",{style:{flex:"0 0 calc(75% - 42px)",display:"flex",flexDirection:"column"},children:[e.jsx("h3",{style:{color:"var(--color-primary)",fontSize:"var(--font-size-lg)",fontWeight:700,marginBottom:"15px",textAlign:"center"},children:"Target Products"}),e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",maxHeight:"calc(90vh - 350px)"},children:te.length===0?e.jsx("div",{className:"empty-state",children:"No target products yet. Shift+Click a recipe box to mark it as a target."}):te.map(r=>{var F;const o=t.find(x=>x.id===r.recipeBoxId);if(!o)return null;const{recipe:s,machine:a,machineCount:l=0}=o.data||{};if(!s)return null;let d=s.cycle_time;if((typeof d!="number"||d<=0)&&(d=1),mt(a==null?void 0:a.id)){const x=bt[a.id];if((x==null?void 0:x.type)==="steam_input"&&vt(s)){const _=s.tempDependentInputTemp??st;d=yt(a.id,_,d)}}(typeof d!="number"||d<=0)&&(d=1);const g=s.isMineshaftDrill||s.id==="r_mineshaft_drill",C=(F=G==null?void 0:G.flows)==null?void 0:F.byNode[r.recipeBoxId],M={inputs:{},outputs:{}};return s.inputs.forEach((x,_)=>{var j;if(typeof x.quantity=="number"){const P=(g?x.quantity:x.quantity/d)*l,R=((j=C==null?void 0:C.inputFlows[_])==null?void 0:j.connected)||0;M.inputs[_]={totalRate:P,connectedFlow:R,deficiency:Math.max(0,P-R)}}}),s.outputs.forEach((x,_)=>{var v;const j=x.quantity;if(typeof j=="number"){const R=(g?j:j/d)*l,T=((v=C==null?void 0:C.outputFlows[_])==null?void 0:v.connected)||0;M.outputs[_]={totalRate:R,connectedFlow:T,excess:Math.max(0,R-T)}}}),e.jsxs("div",{style:{padding:"20px",background:"var(--bg-main)",border:"2px solid var(--border-primary)",borderRadius:"var(--radius-md)",marginBottom:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--text-primary)",fontSize:"16px",fontWeight:600},children:s.name}),e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"4px"},children:["Machine Count: ",l.toFixed(4)]})]}),e.jsx("button",{onClick:()=>Cn(r.id),className:"btn btn-delete",style:{padding:"6px 12px"},children:"Remove"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",borderTop:"1px solid var(--border-divider)",paddingTop:"15px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--input-text)",fontSize:"14px",fontWeight:600,marginBottom:"12px",textAlign:"center"},children:"Inputs"}),s.inputs.map((x,_)=>{const j=M.inputs[_];return j?e.jsx(Cr,{productName:pt(x.product_id,ve),connectedFlow:j.connectedFlow,currentExcess:j.deficiency,onTargetExcessCommit:v=>hr(r.id,"input",_,v),styleType:"input"},_):null})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--output-text)",fontSize:"14px",fontWeight:600,marginBottom:"12px",textAlign:"center"},children:"Outputs"}),s.outputs.map((x,_)=>{const j=M.outputs[_];return j?e.jsx(Cr,{productName:pt(x.product_id,ve),connectedFlow:j.connectedFlow,currentExcess:j.excess,onTargetExcessCommit:v=>hr(r.id,"output",_,v),styleType:"output"},_):null})]})]})]},r.id)})})]})]}):e.jsx("div",{style:{height:"calc(90vh - 300px)",overflowY:"auto",overflowX:"hidden",paddingBottom:"20px"},children:t.length===0?e.jsx("div",{className:"empty-state",children:"No recipes on canvas"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",paddingBottom:"20px"},children:t.filter(r=>{var C;if(sr==="all")return!0;const{recipe:o,machineCount:s=0}=r.data||{};if(!o)return!1;let a=o.cycle_time;(typeof a!="number"||a<=0)&&(a=1);const l=(C=G==null?void 0:G.flows)==null?void 0:C.byNode[r.id];if(!l)return!1;const d=o.isMineshaftDrill||o.id==="r_mineshaft_drill";let f=!1,g=!1;return o.inputs.forEach((M,F)=>{var x;if(typeof M.quantity=="number"){const j=(d?M.quantity:M.quantity/a)*s,v=((x=l.inputFlows[F])==null?void 0:x.connected)||0;Math.max(0,j-v)>.001&&(g=!0)}}),o.outputs.forEach((M,F)=>{var _;const x=M.originalQuantity!==void 0?M.originalQuantity:M.quantity;if(typeof x=="number"){const v=(d?x:x/a)*s,P=((_=l.outputFlows[F])==null?void 0:_.connected)||0;Math.max(0,v-P)>.001&&(f=!0)}}),sr==="excess"?f:sr==="deficiency"?g:!0}).map(r=>{const{recipe:o,machine:s,machineCount:a=0,machineCountMode:l="free",cappedMachineCount:d}=r.data||{};if(!o||!s)return null;let f=o.cycle_time;if((typeof f!="number"||f<=0)&&(f=1),mt(s==null?void 0:s.id)){const x=bt[s.id];if((x==null?void 0:x.type)==="steam_input"&&vt(o)){const _=o.tempDependentInputTemp??st;f=yt(s.id,_,f)}}const C=o.power_consumption;let M="Variable";typeof C=="number"?M=Kr(C*a):typeof C=="object"&&C!==null&&"max"in C&&(M=`${Kr(C.max*a)} (max)`);const F=typeof o.pollution=="number"?o.pollution*a:0;return e.jsxs("div",{style:{padding:"15px 20px",background:"var(--bg-main)",border:"2px solid var(--border-primary)",borderRadius:"var(--radius-md)",display:"flex",alignItems:"center",gap:"15px"},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{color:"var(--text-primary)",fontSize:"15px",fontWeight:600,marginBottom:"4px"},children:o.name}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("div",{style:{color:s.tier===1?"var(--tier-1-color)":s.tier===2?"var(--tier-2-color)":s.tier===3?"var(--tier-3-color)":s.tier===4?"var(--tier-4-color)":(s.tier===5,"var(--tier-5-color)"),fontSize:"13px",fontWeight:500},children:s.name}),e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"11px",marginTop:"2px"},children:["Cost: $",at(Math.ceil(a)*(typeof s.cost=="number"?s.cost:0))]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px",fontSize:"12px",color:"var(--text-secondary)"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontWeight:600},children:"Cycle:"})," ",typeof f=="number"?`${f.toFixed(2)}s`:"Variable"]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontWeight:600},children:"Power:"})," ",M]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-primary)",fontWeight:600},children:"Pollution:"})," ",F.toFixed(2),"%/hr"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginTop:"12px",paddingTop:"12px",borderTop:"1px solid var(--border-divider)"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--input-text)",fontSize:"11px",fontWeight:600,marginBottom:"6px"},children:"Inputs"}),o.inputs.map((x,_)=>{var ce,ke;const j=o.isMineshaftDrill||o.id==="r_mineshaft_drill",v=x.quantity,R=(typeof v=="number"?j?v:v/f:0)*a,T=(ce=G==null?void 0:G.flows)==null?void 0:ce.byNode[r.id],z=((ke=T==null?void 0:T.inputFlows[_])==null?void 0:ke.connected)||0,me=Math.max(0,R-z)>.001;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",padding:"4px 6px",background:"var(--bg-secondary)",borderRadius:"var(--radius-sm)",marginBottom:"4px",border:me?"1px solid var(--delete-color)":"1px solid var(--border-light)"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:me?"var(--delete-color)":"var(--handle-input-supplied)",flexShrink:0}}),e.jsx("div",{style:{flex:1,color:"var(--text-primary)",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:pt(x.product_id,ve)}),e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"10px",whiteSpace:"nowrap"},children:[typeof v=="number"?at(R):"Var","/s"]})]},_)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--output-text)",fontSize:"11px",fontWeight:600,marginBottom:"6px"},children:"Outputs"}),o.outputs.map((x,_)=>{var ce,ke;const j=o.isMineshaftDrill||o.id==="r_mineshaft_drill",v=x.originalQuantity!==void 0?x.originalQuantity:x.quantity,R=(typeof v=="number"?j?v:v/f:0)*a,T=(ce=G==null?void 0:G.flows)==null?void 0:ce.byNode[r.id],z=((ke=T==null?void 0:T.outputFlows[_])==null?void 0:ke.connected)||0,me=Math.max(0,R-z)>.001;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",padding:"4px 6px",background:"var(--bg-secondary)",borderRadius:"var(--radius-sm)",marginBottom:"4px",border:me?"1px solid var(--handle-output-excess)":"1px solid var(--border-light)"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:me?"var(--handle-output-excess)":"var(--handle-output-connected)",flexShrink:0}}),e.jsx("div",{style:{flex:1,color:"var(--text-primary)",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:pt(x.product_id,ve)}),e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"10px",whiteSpace:"nowrap"},children:[typeof v=="number"?at(R):"Var","/s"]})]},_)})]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[e.jsx("div",{style:{fontSize:"11px",color:"var(--text-muted)",fontWeight:600},children:"Machine Count"}),e.jsx("input",{type:"number",min:"0",step:"0.1",value:Or[r.id]!==void 0?Or[r.id]:a.toFixed(2),onFocus:()=>{Lr(x=>({...x,[r.id]:a.toFixed(2)}))},onChange:x=>{Lr(_=>({..._,[r.id]:x.target.value}))},onBlur:()=>{const x=parseFloat(Or[r.id]);!isNaN(x)&&x>=0&&(rt(r.id,_=>({..._,machineCount:x})),U("machineCount")),Lr(_=>{const j={..._};return delete j[r.id],j})},onKeyPress:x=>{x.key==="Enter"&&x.target.blur()},className:"input",style:{width:"100px",padding:"8px",fontSize:"13px",textAlign:"center"}})]}),e.jsx("button",{onClick:()=>{const x=["free","capped","locked"],j=(x.indexOf(l)+1)%x.length,v=x[j];n(P=>P.map(R=>R.id!==r.id?R:{...R,data:{...R.data,machineCountMode:v,cappedMachineCount:v==="free"?void 0:a}}))},className:"btn btn-secondary",style:{minWidth:"70px",padding:"8px",fontWeight:600,fontSize:"12px",background:l==="locked"?"#ef4444":l==="capped"?"#f59e0b":"var(--bg-secondary)",color:l==="free"?"var(--text-primary)":"#fff",border:l==="free"?"2px solid var(--border-primary)":"none"},title:l==="free"?"Free: LP/suggestions can change":l==="capped"?`Capped: Max ${(d==null?void 0:d.toFixed(2))||a.toFixed(2)}`:"Locked: Cannot be changed",children:l==="free"?"ðŸ”“ Free":l==="capped"?"ðŸ“Š Cap":"ðŸ”’ Lock"}),e.jsx("button",{onClick:()=>{dt.current&&(dt.current.fitView({nodes:[{id:r.id}],padding:.5,duration:500}),Fe(!1))},className:"btn btn-primary",style:{minWidth:"80px",padding:"8px 12px",fontSize:"12px"},title:"Locate this recipe on canvas",children:"ðŸ“ Locate"})]})]},r.id)})})})}),e.jsx("button",{onClick:()=>Fe(!1),className:"btn btn-secondary",children:"Close"})]})}),e.jsxs(Ot.Suspense,{fallback:e.jsx(zo,{}),children:[St&&e.jsx(Ho,{phase:St.phase,nodeSnapshot:St.nodeSnapshot,result:St.result,deficiencyResult:St.deficiencyResult,onCancel:Ui,onConfirmDeficiency:Ki,onApply:Qi,onLocateNode:Ji}),je&&e.jsx(uo,{onClose:()=>we(!1)}),Nt&&e.jsx(Lo,{onClose:()=>Lt(!1)}),er&&e.jsx($o,{onClose:()=>tr(!1),onLoad:Zi,currentCanvas:{nodes:t.map(wt),edges:c,targetProducts:te,nodeId:p,targetIdCounter:pe,soldProducts:$e,favoriteRecipes:et,lastDrillConfig:We,lastAssemblerConfig:qe,lastTreeFarmConfig:Ve,lastFireboxConfig:Ue,lastWasteFacilityConfig:Ft},onImport:Gi,onExportCanvas:Xi}),un&&e.jsx(Ao,{onClose:()=>rr(!1)})]}),oe&&Ee!=="pan"&&e.jsxs("div",{style:{position:"fixed",bottom:"120px",left:"50%",transform:"translateX(-50%)",background:"var(--bg-secondary)",border:"2px solid var(--border-primary)",borderRadius:"var(--radius-md)",padding:"8px 16px",color:"var(--color-primary)",fontSize:"14px",fontWeight:600,zIndex:1e3,pointerEvents:"none",boxShadow:"var(--shadow-lg)"},children:[Ee==="target"&&"ðŸŽ¯ Target Mode: Tap nodes to mark as targets",Ee==="delete"&&"ðŸ—‘ï¸ Delete Mode: Tap nodes to delete"]}),Qe&&e.jsxs("div",{className:"pending-node-preview",style:{left:`${fn.x+20}px`,top:`${fn.y+20}px`},children:[e.jsx("div",{className:"pending-node-recipe-name",children:Qe.recipe.name}),e.jsx("div",{className:"pending-node-machine-name",children:Qe.machine.name}),e.jsxs("div",{className:"pending-node-machine-name",children:["Count: ",Qe.machineCount]}),e.jsx("div",{className:"pending-node-hint",children:"Left-click to place | Right-click to cancel"})]})]})}oa.createRoot(document.getElementById("root")).render(e.jsx(Ot.StrictMode,{children:e.jsx(Vo,{})}));export{rs as a,yo as b,bo as c,es as d,vo as e,fo as g,Zo as l,ts as r,Xo as s};
