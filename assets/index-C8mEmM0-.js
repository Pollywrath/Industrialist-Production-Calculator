const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HelpModal-aQHrwfcs.js","assets/vendor-react-sS2eXbVN.js","assets/ComputeModal-BAdoJ3BY.js","assets/SaveManager-Bv9lZya9.js","assets/vendor-xyflow-DS7HY60D.js","assets/vendor-xyflow-BZV40eAE.css","assets/game-data-dkqy868O.js","assets/solvers-BVGGMuln.js","assets/vendor-elk-CE1VHGi0.js","assets/DataManager-0Iv2IVSX.js","assets/RecipesModal-DWPUIT9e.js"])))=>i.map(i=>d[i]);
import{j as t,a as m,b as ni,R as ht,d as ai}from"./vendor-react-sS2eXbVN.js";import{H as ii,P as bn,u as oi,a as vn,b as si,c as li,d as _n,i as ci,B as di,C as ui,M as pi,e as Cn}from"./vendor-xyflow-DS7HY60D.js";import{p as Ye,b as Ar,c as Ut,a as Hr,d as Kt,e as Sr,f as mi,h as zr,i as qr,g as Me,F as fi,j as Wn,k as Xr,l as jr,m as Vn,n as Un,o as Zr,q as Kn,r as Jn,s as Gt,D as hi,C as gi,t as xi,u as yi,v as at,w as Wr,x as Vr,y as Ur,z as ge,A as Gn,B as br,E as Kr,M as bi,G as vi,H as nt,I as _i,J as Sn,K as jn,L as wn,N as Ci,O as Pn,P as Mn,Q as kn,R as Si,S as ji,T as wi}from"./game-data-dkqy868O.js";import{H as mt,g as Tn,c as en,f as wr,n as Pi,a as Mi,h as wt,T as Dt,r as Rt,D as ft,b as Ft,i as Qn,d as ki,e as jt,j as Yn,k as Qe,s as Nn,l as Ti,m as Ni,o as Ii,p as Fi}from"./solvers-BVGGMuln.js";import{E as Ei}from"./vendor-elk-CE1VHGi0.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))s(u);new MutationObserver(u=>{for(const f of u)if(f.type==="childList")for(const p of f.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&s(p)}).observe(document,{childList:!0,subtree:!0});function a(u){const f={};return u.integrity&&(f.integrity=u.integrity),u.referrerPolicy&&(f.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?f.credentials="include":u.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function s(u){if(u.ep)return;u.ep=!0;const f=a(u);fetch(u.href,f)}})();const Di="modulepreload",Ri=function(e){return"/Industrialist-Production-Calculator/"+e},In={},Xt=function(n,a,s){let u=Promise.resolve();if(a&&a.length>0){let p=function(w){return Promise.all(w.map(L=>Promise.resolve(L).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const x=document.querySelector("meta[property=csp-nonce]"),N=(x==null?void 0:x.nonce)||(x==null?void 0:x.getAttribute("nonce"));u=p(a.map(w=>{if(w=Ri(w),w in In)return;In[w]=!0;const L=w.endsWith(".css"),b=L?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${w}"]${b}`))return;const S=document.createElement("link");if(S.rel=L?"stylesheet":Di,L||(S.as="script"),S.crossOrigin="",S.href=w,N&&S.setAttribute("nonce",N),document.head.appendChild(S),L)return new Promise((H,P)=>{S.addEventListener("load",H),S.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${w}`)))})}))}function f(p){const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=p,window.dispatchEvent(x),!x.defaultPrevented)throw p}return u.then(p=>{for(const x of p||[])x.status==="rejected"&&f(x.reason);return n().catch(f)})},tn=e=>e==="Variable"||typeof e=="string"&&e.toLowerCase().includes("variable"),Bi=e=>e==="p_variableproduct",Qt=(e,n,a)=>{if(Bi(e))return a==="item"?"Variable Item":a==="fluid"?"Variable Fluid":"Variable Product";if(e==="p_any_item")return"Variable Item";if(e==="p_any_fluid")return"Variable Fluid";const s=n(e);return s?s.name:"Unknown Product"},Li=e=>tn(e)?"Variable":typeof e=="number"?e.toString():e,qt=e=>typeof e=="number"?e>=1e6?`${(e/1e6).toFixed(2)}MMF/s`:e>=1e3?`${(e/1e3).toFixed(2)}kMF/s`:`${e.toFixed(2)}MF/s`:e,Oi=e=>{if(tn(e))return"Variable";if(typeof e=="object"&&e!==null){if("drilling"in e&&"idle"in e)return{drilling:qt(e.drilling),idle:qt(e.idle)};if("max"in e&&"average"in e)return{max:qt(e.max),average:qt(e.average)}}return qt(e)},$i=e=>tn(e)?"Variable":typeof e=="number"?`${e.toFixed(3)}%/hr`:typeof e=="string"?e.includes("%")?e:`${e}%/hr`:e,Fn=(e,n)=>{const a=Li(e.quantity),s=Qt(e.product_id,n);return`${a}x ${s}`},En=e=>e?e>=1e6?`${(e/1e6).toFixed(1)} MMF/s`:e>=1e3?`${(e/1e3).toFixed(1)} kMF/s`:`${e.toFixed(0)} MF/s`:"N/A",Ai=(e,n,a)=>{switch(e){case"drill":return Hi();case"assembler":return zi();case"treeFarm":return qi(a);case"firebox":return Wi(n);case"temperature":return Vi(n);case"boiler":return Ui();case"chemicalPlant":return Ki();case"wasteFacility":return Ji();case"liquidDump":return Gi();case"liquidBurner":return Qi();default:return null}},Hi=()=>({title:"Mineshaft Drill Settings",defaultSettings:{drillHead:"",consumable:"none",machineOil:!1,depth:""},fields:[{type:"select",key:"drillHead",label:"Drill Head:",options:[{value:"",label:"None (Variable)"},...hi.map(e=>({value:e.id,label:e.name}))]},{type:"select",key:"consumable",label:"Consumable:",options:gi.map(e=>({value:e.id,label:e.name}))},{type:"checkbox",key:"machineOil",label:"Machine Oil (2/s)"},{type:"select",key:"depth",label:"Target Depth:",options:[{value:"",label:"None (Variable)"},...xi().map(e=>({value:e.toString(),label:`${e} m`}))]}],calculateMetrics:e=>e.drillHead&&e.depth?Gt(e.drillHead,e.consumable,e.machineOil,parseInt(e.depth)):null,renderMetrics:e=>t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{color:"#f5d56a",fontWeight:600,marginBottom:"12px"},children:"Calculated Metrics:"}),t.jsxs("div",{style:{color:"#999",lineHeight:"1.6",marginBottom:"12px"},children:[t.jsxs("div",{children:["Deterioration: ",e.deteriorationRate.toFixed(4),"%/s"]}),t.jsxs("div",{children:["Life Time: ",e.lifeTime.toFixed(2),"s"]}),t.jsxs("div",{children:["Replacement: ",e.replacementTime.toFixed(2),"s"]}),t.jsxs("div",{children:["Travel Time: ",e.travelTime.toFixed(2),"s"]}),t.jsxs("div",{children:["Total Cycle: ",e.totalCycleTime.toFixed(2),"s"]}),t.jsxs("div",{children:["Efficiency: ",(e.dutyCycle*100).toFixed(1),"%"]})]})]}),onApply:e=>{const n=Kn(e.drillHead,e.consumable,e.machineOil,e.depth?parseInt(e.depth):null),a=Jn(e.drillHead,e.consumable,e.machineOil,e.depth?parseInt(e.depth):null),s=e.drillHead&&e.depth?Gt(e.drillHead,e.consumable,e.machineOil,parseInt(e.depth)):null;return{settings:e,inputs:n,outputs:a,metrics:s}}}),zi=()=>({title:"Logic Assembler Settings",defaultSettings:{outerStage:"",innerStage:"",machineOil:!1,tickCircuitDelay:0},fields:[{type:"dual-select",key:"microchip",outerKey:"outerStage",innerKey:"innerStage",label:"Target Microchip:",outerOptions:[1,2,3,4,5,6,7,8],innerOptions:[2,4,8,16,32,64],suffix:"Microchip",renderPreview:e=>{const n=e.outerStage,a=e.innerStage,s=n&&a?parseInt(n)===1?`${a}x Microchip`:`${n}x${a}x Microchip`:"";return s?t.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:s}):null}},{type:"checkbox",key:"machineOil",label:"Machine Oil (0.3/s, 5x speed)"},{type:"number",key:"tickCircuitDelay",label:"Tick Circuit Delay (ticks):",min:0,step:.1,placeholder:"0",parse:e=>e===""?0:parseFloat(e)}],calculateMetrics:e=>{const a=!e.outerStage||!e.innerStage?"":e.outerStage==="1"||parseInt(e.outerStage)===1?`p_${e.innerStage}x_microchip`:`p_${e.outerStage}x${e.innerStage}x_microchip`;return a?Zr(a,e.machineOil,e.tickCircuitDelay):null},renderMetrics:e=>t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{color:"#f5d56a",fontWeight:600,marginBottom:"12px"},children:"Calculated Metrics:"}),t.jsxs("div",{style:{color:"#999",lineHeight:"1.6",marginBottom:"12px"},children:[t.jsxs("div",{children:["Total Stages: ",e.totalStages]}),t.jsxs("div",{children:["Total Steps: ",e.totalSteps]}),t.jsxs("div",{children:["Avg Step Time: ",e.avgStepTime,"s"]}),t.jsxs("div",{children:["Cycle Time: ",e.cycleTime.toFixed(2),"s"]})]}),t.jsxs("div",{style:{borderTop:"1px solid rgba(212, 166, 55, 0.3)",paddingTop:"10px",marginBottom:"10px"},children:[t.jsx("div",{style:{color:"#f5d56a",fontWeight:600,marginBottom:"6px"},children:"Power Consumption:"}),t.jsxs("div",{style:{color:"#999",lineHeight:"1.6",paddingLeft:"10px"},children:[t.jsxs("div",{children:["Max: ",(e.maxPowerConsumption/1e3).toFixed(2)," kMF/s"]}),t.jsxs("div",{children:["Avg: ",(e.avgPowerConsumption/1e3).toFixed(2)," kMF/s"]})]})]}),t.jsxs("div",{style:{borderTop:"1px solid rgba(212, 166, 55, 0.3)",paddingTop:"10px"},children:[t.jsx("div",{style:{color:"var(--settings-input-label)",fontWeight:600,marginBottom:"6px"},children:"Materials per Cycle:"}),t.jsxs("div",{style:{color:"#999",lineHeight:"1.5",fontSize:"12px",paddingLeft:"10px"},children:[t.jsxs("div",{children:["Logic Plates: ",e.logicPlates]}),t.jsxs("div",{children:["Copper Wires: ",e.copperWires]}),t.jsxs("div",{children:["Semiconductors: ",e.semiconductors]}),t.jsxs("div",{children:["Gold Wires: ",e.goldWires]})]})]})]}),onApply:e=>{var p,x;const n={outerStage:e.outerStage||((p=e.microchip)==null?void 0:p.outer)||"",innerStage:e.innerStage||((x=e.microchip)==null?void 0:x.inner)||"",machineOil:e.machineOil,tickCircuitDelay:e.tickCircuitDelay},s=!n.outerStage||!n.innerStage?"":parseInt(n.outerStage)===1?`p_${n.innerStage}x_microchip`:`p_${n.outerStage}x${n.innerStage}x_microchip`,u=Vn(s,n.machineOil),f=Un(s,n.machineOil);return{settings:n,inputs:u,outputs:f,metrics:null}}}),qi=e=>({title:"Tree Farm Settings",defaultSettings:{trees:450,harvesters:20,sprinklers:24,outputs:8,controller:1},fields:[{type:"number",key:"trees",label:"Trees (max 500):",min:1,max:500,step:1,hasError:n=>n>500||n<1},{type:"number",key:"harvesters",label:"Harvesters:",min:1,step:1,hasError:n=>n<1},{type:"number",key:"sprinklers",label:"Sprinklers:",min:1,step:1,hasError:n=>n<1,hint:function(n){const a=yi(n);return`Requires ${a} water tank${a!==1?"s":""} (3 sprinklers per tank)`}},{type:"number",key:"outputs",label:"Outputs:",min:1,step:1,hasError:n=>n<1},{type:"number",key:"controller",label:"Controller:",min:1,max:1,step:1,disabled:()=>!0}],calculateMetrics:n=>jr(n.trees,n.harvesters,n.sprinklers,n.outputs,n.controller,e),renderMetrics:(n,a)=>t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{color:"#f5d56a",fontWeight:600,marginBottom:"12px"},children:"Calculated Metrics:"}),t.jsxs("div",{style:{color:"#999",lineHeight:"1.6",marginBottom:"12px"},children:[t.jsxs("div",{children:["Growth Time: ",n.growthTime,"s (at ",typeof e=="number"?e.toFixed(1):e,"% pollution)"]}),t.jsxs("div",{children:["Water Tanks: ",n.waterTanks]}),t.jsxs("div",{children:["Sustainable Rate: ",n.sustainableHarvestRate.toFixed(4)," trees/s"]}),t.jsxs("div",{children:["Max Harvest Rate: ",n.maxHarvestRate.toFixed(4)," trees/s"]}),t.jsxs("div",{children:["Actual Rate: ",n.actualHarvestRate.toFixed(4)," trees/s"]}),t.jsxs("div",{children:["Power: ",(n.avgPowerConsumption/1e3).toFixed(2)," kMF/s"]}),n.isTreeLimited&&t.jsx("div",{style:{color:"var(--settings-output-label)",marginTop:"8px",fontStyle:"italic"},children:"âš ï¸ Limited by tree regrowth rate"})]})]}),hasErrors:n=>n.trees>500||n.trees<1||n.harvesters<1||n.sprinklers<1||n.outputs<1,onApply:(n,a)=>{const s=Wn(n.sprinklers),u=Xr(n.trees,n.harvesters,e);return{settings:n,inputs:s,outputs:u,metrics:null}}}),Wi=e=>({title:"Industrial Firebox Settings",defaultSettings:{fuel:"p_coal"},fields:[{type:"select",key:"fuel",label:"Fuel Type:",options:fi.map(n=>({value:n.id,label:`${n.name} (${(n.energy/1e3).toFixed(0)}k energy)`}))}],calculateMetrics:n=>zr(e.id,n.fuel),renderMetrics:(n,a)=>t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{color:"#f5d56a",fontWeight:600,marginBottom:"12px"},children:"Calculated Metrics:"}),t.jsxs("div",{style:{color:"#999",lineHeight:"1.6",marginBottom:"12px"},children:[t.jsxs("div",{children:["Energy Needed: ",(n.energyNeeded/1e3).toFixed(0),"k"]}),t.jsxs("div",{children:["Fuel Energy: ",(n.fuelEnergy/1e3).toFixed(0),"k per unit"]}),t.jsxs("div",{children:["Wait Time: ",n.waitTime.toFixed(2),"s"]}),n.additionalWait>0&&t.jsxs("div",{children:["Additional Wait: +",n.additionalWait,"s"]}),t.jsxs("div",{style:{fontWeight:600,marginTop:"8px",color:"#f5d56a"},children:["Total Cycle: ",n.cycleTime.toFixed(2),"s"]}),t.jsxs("div",{children:["Fuel Per Cycle: ",n.fuelPerCycle.toFixed(2)," units"]}),t.jsxs("div",{style:{fontSize:"11px",fontStyle:"italic",marginTop:"8px",color:"var(--text-muted)"},children:["Rate: ",(1/n.cycleTime).toFixed(4)," cycles/s"]})]}),t.jsxs("div",{style:{borderTop:"1px solid rgba(212, 166, 55, 0.3)",paddingTop:"12px"},children:[t.jsx("div",{style:{color:"var(--settings-input-label)",fontWeight:600,marginBottom:"8px",fontSize:"12px"},children:"Inputs (per cycle):"}),t.jsx("div",{style:{color:"#999",lineHeight:"1.5",fontSize:"12px"},children:qr(e.inputs,a.fuel,e.id).map((s,u)=>{const f=typeof s.quantity=="number"?s.quantity.toFixed(4):s.quantity,p=Qt(s.product_id,Me);return t.jsxs("div",{children:[f,"x ",p]},u)})})]})]}),onApply:(n,a)=>{const s=zr(a.id,n.fuel),u=qr(a.inputs,n.fuel,a.id);return{settings:n,inputs:u,outputs:[],metrics:s}}}),Vi=e=>{var s,u;const n=e.machine_id,a=mt[n];return{title:`${a.name} Settings`,defaultSettings:{temperature:((u=(s=a.tempOptions)==null?void 0:s[0])==null?void 0:u.temp)||120},fields:[{type:"select",key:"temperature",label:"Output Temperature:",parse:f=>parseInt(f),options:a.tempOptions.map(f=>({value:f.temp,label:`${wr(f.temp)} - ${En(f.power)}`}))},{type:"info-box",key:"temperature",title:"Preview:",render:(f,p)=>{const x=p.temperature,N=Tn(n,x);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:["Output Temperature: ",wr(x)]}),t.jsxs("div",{children:["Power Consumption: ",En(N)]})]})}}],onApply:(f,p)=>{const x=Tn(n,f.temperature),N=p.outputs.map(w=>({...w,temperature:en(n,f)}));return{settings:f,inputs:[],outputs:N,metrics:x}}}},Ui=()=>({title:"Boiler Settings",defaultSettings:{heatLoss:0},fields:[{type:"number",key:"heatLoss",label:"Heat Loss (Â°C):",min:0,max:50,step:.1,placeholder:"8",hint:"Temperature loss when converting hot water to steam. Default is 0Â°C."},{type:"info-box",title:"How it works:",render:e=>t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:["â€¢ Boiler uses the ",t.jsx("strong",{children:"second input"})," (hot water coolant) temperature"]}),t.jsxs("div",{children:["â€¢ Steam output temp = Coolant temp - ",e,"Â°C"]}),t.jsx("div",{children:"â€¢ If output temp < 100Â°C, no steam is produced"}),t.jsx("div",{children:"â€¢ Water output is cooled (no temperature)"}),t.jsxs("div",{style:{marginTop:"8px",fontStyle:"italic",fontSize:"12px"},children:["Tip: For 100Â°C steam with ",e,"Â°C loss, use ",100+e,"Â°C coolant"]})]})}],onApply:e=>({settings:e,inputs:[],outputs:[],metrics:null})}),Ki=()=>({title:"Chemical Plant Settings",defaultSettings:{speedFactor:100,efficiencyFactor:100},fields:[{type:"number-buttons",key:"speedFactor",label:"Speed Factor",min:50,max:200,step:5,defaultValue:100},{type:"number-buttons",key:"efficiencyFactor",label:"Efficiency Factor",min:80,max:120,step:5,defaultValue:100}],calculateMetrics:e=>mi(e.speedFactor,e.efficiencyFactor),renderMetrics:e=>t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{color:"#f5d56a",fontWeight:600,marginBottom:"12px"},children:"Applied Multipliers:"}),t.jsxs("div",{style:{color:"#999",lineHeight:"1.6"},children:[t.jsxs("div",{children:["Input Multiplier: ",e.inputMultiplier.toFixed(4),"x"]}),t.jsxs("div",{children:["Output Multiplier: ",e.outputMultiplier.toFixed(4),"x"]}),t.jsxs("div",{children:["Power Multiplier: ",e.powerMultiplier.toFixed(4),"x"]})]}),t.jsxs("div",{style:{marginTop:"12px",fontSize:"11px",color:"var(--text-muted)",fontStyle:"italic"},children:[t.jsx("div",{children:"â€¢ Speed affects input/output quantities and power"}),t.jsx("div",{children:"â€¢ Efficiency affects input quantities and power"}),t.jsx("div",{children:"â€¢ Effects combine additively"})]})]}),onApply:e=>({settings:e,inputs:[],outputs:[],metrics:null})}),Ji=()=>{const e=Ye.filter(a=>a.type==="item").sort((a,s)=>a.name.localeCompare(s.name)),n=Ye.filter(a=>a.type==="fluid").sort((a,s)=>a.name.localeCompare(s.name));return{title:"Underground Waste Facility Settings",defaultSettings:{itemProductId:"p_any_item",fluidProductId:"p_any_fluid",itemSearchTerm:"",fluidSearchTerm:""},fields:[{type:"text-input",key:"itemSearchTerm",label:"Search Items:",placeholder:"Search items...",noMargin:!0},{type:"select",key:"itemProductId",label:"Item Input Product:",options:[{value:"p_any_item",label:"Any Item"},...e.map(a=>({value:a.id,label:a.name}))]},{type:"text-input",key:"fluidSearchTerm",label:"Search Fluids:",placeholder:"Search fluids...",noMargin:!0},{type:"select",key:"fluidProductId",label:"Fluid Input Product:",options:[{value:"p_any_fluid",label:"Any Fluid"},...n.map(a=>({value:a.id,label:a.name}))]},{type:"info-box",title:"ðŸ’¡ How it works:",background:"rgba(59, 130, 246, 0.1)",titleColor:"#60a5fa",render:()=>t.jsxs(t.Fragment,{children:[t.jsx("div",{children:"â€¢ Each input accepts up to 240/s"}),t.jsx("div",{children:"â€¢ Fixed requirements per cycle:"}),t.jsx("div",{style:{marginLeft:"15px"},children:"- 4.8 Concrete Blocks/s"}),t.jsx("div",{style:{marginLeft:"15px"},children:"- 2.4 Lead Ingots/s"})]})}],onApply:a=>{const s=Sr(0,0,a.itemProductId,a.fluidProductId);return{settings:a,inputs:s,outputs:[],metrics:null}}}},Gi=()=>{const e=Ye.filter(n=>n.type==="fluid").sort((n,a)=>n.name.localeCompare(a.name));return{title:"Liquid Dump Info",defaultSettings:{fluidProductId0:"p_any_fluid",fluidProductId1:"p_any_fluid",searchTerm:""},fields:[{type:"text-input",key:"searchTerm",label:"Search Products:",placeholder:"Search fluids...",noMargin:!0},...Array(2).fill(0).map((n,a)=>({type:"select",key:`fluidProductId${a}`,label:`Input ${a+1} Product:`,options:[{value:"p_any_fluid",label:"Any Fluid"},...e.map(s=>({value:s.id,label:s.name}))]})),{type:"info-box",title:"Pollution Calculation:",render:(n,a)=>{const s=[a.fluidProductId0,a.fluidProductId1],u=Hr(s),f=Kt(u);return t.jsxs(t.Fragment,{children:[t.jsx("div",{children:"â€¢ Water variants: 0%/hr"}),t.jsx("div",{children:"â€¢ Residue: 8.64%/hr per /s"}),t.jsx("div",{children:"â€¢ Other fluids: 0.0216%/hr per /s"}),t.jsx("div",{style:{marginTop:"10px",paddingTop:"10px",borderTop:"1px solid rgba(212, 166, 55, 0.3)"},children:t.jsxs("strong",{children:["Current Pollution: ",f.toFixed(4),"%/hr"]})})]})}},{type:"info-box",title:"ðŸ’¡ How it works:",background:"rgba(59, 130, 246, 0.1)",titleColor:"#60a5fa",render:()=>t.jsxs(t.Fragment,{children:[t.jsx("div",{children:"â€¢ Each input accepts up to 15/s of the selected fluid"}),t.jsx("div",{children:"â€¢ Connect fluids to dispose of them"}),t.jsx("div",{children:"â€¢ Water variants produce no pollution"})]})}],onApply:n=>{const a=[n.fluidProductId0,n.fluidProductId1],s=Hr(a);return{settings:{fluidProductIds:a,searchTerm:n.searchTerm},inputs:s,outputs:[],metrics:null}}}},Qi=()=>{const e=Ye.filter(n=>n.type==="fluid").sort((n,a)=>n.name.localeCompare(a.name));return{title:"Liquid Burner Info",defaultSettings:{fluidProductId0:"p_any_fluid",fluidProductId1:"p_any_fluid",fluidProductId2:"p_any_fluid",fluidProductId3:"p_any_fluid",fluidProductId4:"p_any_fluid",fluidProductId5:"p_any_fluid",fluidProductId6:"p_any_fluid",fluidProductId7:"p_any_fluid",searchTerm:""},fields:[{type:"text-input",key:"searchTerm",label:"Search Products:",placeholder:"Search fluids...",noMargin:!0},...Array(8).fill(0).map((n,a)=>({type:"select",key:`fluidProductId${a}`,label:`Input ${a+1} Product:`,options:[{value:"p_any_fluid",label:"Any Fluid"},...e.map(s=>({value:s.id,label:s.name}))]})),{type:"info-box",title:"Pollution Calculation:",render:(n,a)=>{const s=Array(8).fill(0).map((p,x)=>a[`fluidProductId${x}`]),u=Ar(s),f=Ut(u);return t.jsxs(t.Fragment,{children:[t.jsx("div",{children:"â€¢ Water variants: 0%/hr"}),t.jsx("div",{children:"â€¢ Residue: 8.64%/hr per /s"}),t.jsx("div",{children:"â€¢ Other fluids: 0.0216%/hr per /s"}),t.jsx("div",{style:{marginTop:"10px",paddingTop:"10px",borderTop:"1px solid rgba(212, 166, 55, 0.3)"},children:t.jsxs("strong",{children:["Current Pollution: ",f.toFixed(4),"%/hr"]})})]})}},{type:"info-box",title:"ðŸ’¡ How it works:",background:"rgba(59, 130, 246, 0.1)",titleColor:"#60a5fa",render:()=>t.jsxs(t.Fragment,{children:[t.jsx("div",{children:"â€¢ Each input accepts up to 15/s of the selected fluid"}),t.jsx("div",{children:"â€¢ Connect fluids to burn them for energy disposal"}),t.jsx("div",{children:"â€¢ Water variants produce no pollution"})]})}],onApply:n=>{const a=Array(8).fill(0).map((u,f)=>n[`fluidProductId${f}`]),s=Ar(a);return{settings:{fluidProductIds:a,searchTerm:n.searchTerm},inputs:s,outputs:[],metrics:null}}}},Yi=({recipeType:e,nodeId:n,currentSettings:a,recipe:s,globalPollution:u,onSettingsChange:f,onClose:p})=>{var I;const x=Ai(e,s,u),[N,w]=m.useState(a||x.defaultSettings),L=m.useRef(null),b=v=>{const W=L.current;if(!W)return;const K=W.scrollHeight>W.clientHeight,B=W.scrollTop===0&&v.deltaY<0,O=W.scrollTop+W.clientHeight>=W.scrollHeight&&v.deltaY>0;K&&!B&&!O||v.preventDefault(),v.stopPropagation()},S=(v,W)=>{w(typeof v=="object"?K=>({...K,...v}):K=>({...K,[v]:W}))},H=()=>{const v=x.onApply(N,s);switch(e){case"drill":case"assembler":case"treeFarm":case"wasteFacility":case"liquidDump":case"liquidBurner":f(n,v.settings,v.inputs,v.outputs);break;case"firebox":f(n,v.settings,v.inputs,v.metrics);break;case"temperature":f(n,v.settings,v.outputs,v.metrics);break;case"boiler":case"chemicalPlant":f(n,v.settings);break;default:f(n,v.settings,v.inputs,v.outputs,v.metrics)}p()},P=()=>{w(x.defaultSettings)},A=x.calculateMetrics?x.calculateMetrics(N,s):null;return ni.createPortal(t.jsx("div",{className:"drill-settings-overlay",onClick:p,children:t.jsxs("div",{ref:L,className:"drill-settings-bubble",onClick:v=>v.stopPropagation(),onDoubleClick:v=>v.stopPropagation(),onWheel:b,children:[t.jsx("h3",{className:"drill-settings-title",children:x.title}),t.jsxs("div",{className:"drill-settings-content",children:[x.fields.map((v,W)=>t.jsx(Xi,{field:v,value:N[v.key],settings:N,onChange:(K,B)=>{v.type==="dual-select"?S(K,B):S(v.key,K)}},W)),A&&x.renderMetrics&&t.jsx("div",{className:"drill-setting-group",style:{marginTop:"20px",padding:"12px",background:"rgba(212, 166, 55, 0.1)",borderRadius:"8px",fontSize:"13px"},children:x.renderMetrics(A,N)})]}),t.jsxs("div",{className:"drill-settings-buttons",children:[t.jsx("button",{onClick:P,className:"btn btn-secondary",children:"Reset"}),t.jsx("button",{onClick:H,className:"btn btn-primary",disabled:(I=x.hasErrors)==null?void 0:I.call(x,N),children:"Apply"})]})]})}),document.body)},Xi=({field:e,value:n,settings:a,onChange:s})=>{var u,f;switch(e.type){case"select":return t.jsxs("div",{className:"drill-setting-group",children:[t.jsx("label",{className:"drill-setting-label",children:e.label}),t.jsx("select",{value:n,onChange:p=>s(e.parse?e.parse(p.target.value):p.target.value),className:"select",disabled:(u=e.disabled)==null?void 0:u.call(e,a),children:e.options.map(p=>t.jsx("option",{value:p.value,children:p.label},p.value))}),e.hint&&t.jsx("p",{style:{fontSize:"11px",color:"var(--text-secondary)",marginTop:"4px"},children:typeof e.hint=="function"?e.hint(n,a):e.hint})]});case"checkbox":return t.jsx("div",{className:"drill-setting-group drill-setting-checkbox",children:t.jsxs("label",{className:"drill-setting-label",children:[t.jsx("input",{type:"checkbox",checked:n,onChange:p=>s(p.target.checked),className:"drill-checkbox"}),t.jsx("span",{children:e.label})]})});case"number":return t.jsxs("div",{className:"drill-setting-group",children:[t.jsx("label",{className:"drill-setting-label",children:e.label}),t.jsx("input",{type:"number",min:e.min,max:e.max,step:e.step,value:n,onChange:p=>s(e.parse?e.parse(p.target.value):parseFloat(p.target.value)),className:"input",placeholder:e.placeholder,style:(f=e.hasError)!=null&&f.call(e,n)?{borderColor:"#ef4444"}:{}}),e.hint&&t.jsx("p",{style:{fontSize:"11px",color:"var(--text-secondary)",marginTop:"4px"},children:typeof e.hint=="function"?e.hint(n,a):e.hint})]});case"number-buttons":return t.jsxs("div",{className:"drill-setting-group",children:[t.jsx("label",{className:"drill-setting-label",children:e.label}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("button",{onClick:()=>s(Math.max(e.min,n-e.step)),disabled:n<=e.min,className:"btn btn-secondary",style:{padding:"8px 16px",minWidth:"auto",fontSize:"18px",opacity:n<=e.min?.5:1,cursor:n<=e.min?"not-allowed":"pointer"},children:"â–¼"}),t.jsx("div",{style:{flex:1,textAlign:"center",padding:"12px",background:"var(--bg-main)",border:"2px solid var(--border-primary)",borderRadius:"var(--radius-sm)",color:"var(--text-primary)",fontSize:"20px",fontWeight:700},children:n}),t.jsx("button",{onClick:()=>s(Math.min(e.max,n+e.step)),disabled:n>=e.max,className:"btn btn-secondary",style:{padding:"8px 16px",minWidth:"auto",fontSize:"18px",opacity:n>=e.max?.5:1,cursor:n>=e.max?"not-allowed":"pointer"},children:"â–²"})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"var(--text-secondary)",marginTop:"8px"},children:[t.jsxs("span",{children:["Min: ",e.min]}),t.jsxs("span",{children:["Default: ",e.defaultValue]}),t.jsxs("span",{children:["Max: ",e.max]})]})]});case"text-input":return t.jsxs("div",{className:"drill-setting-group",children:[t.jsx("label",{className:"drill-setting-label",children:e.label}),t.jsx("input",{type:"text",value:n,onChange:p=>s(p.target.value),placeholder:e.placeholder,className:"input",style:{marginBottom:e.noMargin?0:"15px"}})]});case"dual-select":return t.jsxs("div",{className:"drill-setting-group",children:[t.jsx("label",{className:"drill-setting-label",children:e.label}),t.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[t.jsxs("select",{value:a[e.outerKey]||"",onChange:p=>{const x=p.target.value;s(e.outerKey,x),x&&parseInt(x)>1&&s(e.innerKey,"64")},className:"select",style:{flex:1},children:[t.jsx("option",{value:"",children:"Outer"}),e.outerOptions.map(p=>t.jsxs("option",{value:p,children:[p,"x"]},p))]}),t.jsxs("select",{value:a[e.innerKey]||"",onChange:p=>s(e.innerKey,p.target.value),className:"select",style:{flex:1},disabled:a[e.outerKey]&&parseInt(a[e.outerKey])>1,children:[t.jsx("option",{value:"",children:"Inner"}),a[e.outerKey]&&parseInt(a[e.outerKey])>1?t.jsx("option",{value:"64",children:"64x"}):e.innerOptions.map(p=>t.jsxs("option",{value:p,children:[p,"x"]},p))]}),t.jsx("span",{style:{color:"#f5d56a",fontWeight:600,whiteSpace:"nowrap"},children:e.suffix})]}),e.renderPreview&&e.renderPreview(a)]});case"info-box":return t.jsxs("div",{className:"drill-setting-group",style:{marginTop:e.marginTop||"20px",padding:"12px",background:e.background||"rgba(212, 166, 55, 0.1)",borderRadius:"8px",fontSize:"13px"},children:[t.jsx("div",{style:{color:e.titleColor||"#f5d56a",fontWeight:600,marginBottom:"8px"},children:e.title}),t.jsx("div",{style:{color:"#999",lineHeight:"1.6"},children:e.render(n,a)})]});default:return null}},Jt=44,Jr=8,Dn=10,Rn=20,Bn=380,Zi=120,mr=e=>typeof e=="number"?Math.round(e*1e4)/1e4:e,eo=m.memo(({data:e,id:n})=>{var Ze,rr,ie,nr,Ne,$t;const{recipe:a,machine:s,machineCount:u,displayMode:f,machineDisplayMode:p,onInputClick:x,onOutputClick:N,isTarget:w,onDrillSettingsChange:L,onLogicAssemblerSettingsChange:b,onTreeFarmSettingsChange:S,onIndustrialFireboxSettingsChange:H,onTemperatureSettingsChange:P,onBoilerSettingsChange:A,onChemicalPlantSettingsChange:I,globalPollution:v,flows:W,isMobile:K,mobileActionMode:B,onMachineCountModeChange:O,zoomLevel:z}=e,G=!z||z>=.25,[D,V]=m.useState(null);if(!(a!=null&&a.inputs)||!(a!=null&&a.outputs)||!s)return null;const te=a.isMineshaftDrill||a.id==="r_mineshaft_drill",re=a.isLogicAssembler||a.id==="r_logic_assembler",ne=a.isTreeFarm||a.id==="r_tree_farm",ce=a.isWasteFacility||a.id==="r_underground_waste_facility",k=a.isLiquidDump||a.id==="r_liquid_dump",ae=a.isLiquidBurner||a.id==="r_liquid_burner",ee=te||re||ne||ce||k||ae,de=Pi(s.id),Pt=Mi(s.id),it=mt[s.id],Xe=s.id==="m_industrial_firebox"&&a.id!=="r_industrial_firebox_07",Fe=s.id==="m_chemical_plant",Ae=wt(s.id),He=Ae?Dt[s.id]:null;let ue=a.cycle_time;const Ce=ue==="Variable"||typeof ue!="number"||ue<=0;if(Ce&&!ee?ue="Variable":Ce&&ee&&(ue=1),Ae&&(He==null?void 0:He.type)==="steam_input"&&typeof ue=="number"&&!(s.id==="m_steam_cracking_plant"&&!Rt(a))){const y=a.tempDependentInputTemp??ft;ue=Ft(s.id,y,ue)}const ot={outputs:[]};if(it){const y=it.type==="boiler",pe=(Ze=a.outputs)==null?void 0:Ze.some(Ie=>["p_water","p_filtered_water","p_distilled_water"].includes(Ie.product_id)),xt=(rr=a.outputs)==null?void 0:rr.some(Ie=>["p_steam","p_low_pressure_steam","p_high_pressure_steam"].includes(Ie.product_id)),ar=(ie=a.inputs)==null?void 0:ie.some(Ie=>["p_water","p_filtered_water","p_distilled_water"].includes(Ie.product_id)),kt=a.id==="r_industrial_firebox_07",ir=s.id==="m_industrial_firebox";(!ir||ir&&!kt&&(ar||pe))&&((nr=a.outputs)==null||nr.forEach((Ie,Be)=>{if(Qn(Ie.product_id)&&Ie.temperature!=null){const De=["p_water","p_filtered_water","p_distilled_water"].includes(Ie.product_id),we=["p_steam","p_low_pressure_steam","p_high_pressure_steam"].includes(Ie.product_id);y?we&&xt&&ot.outputs.push({temp:Ie.temperature,index:Be}):(De&&pe||we&&xt)&&ot.outputs.push({temp:Ie.temperature,index:Be})}}))}const J=m.useCallback(y=>{if(y==="Variable")return"Variable";if(typeof y!="number")return String(y);if(ue==="Variable")return f==="perSecond"?"Variable":String(mr(y));let pe=f==="perSecond"?y/ue:y;return p==="total"&&(pe*=u||0),String(mr(pe))},[ue,f,p,u]),Q=m.useCallback(y=>{if(y==="Variable"||typeof y!="number")return y;if(f==="perSecond")return"1s";if(y>=60){const pe=Math.floor(y/60),xt=y%60;return`${pe}m ${mr(xt)}s`}return`${mr(y)}s`},[f]),Y=m.useMemo(()=>Q(ue),[ue,Q]);let xe=a.power_consumption,me=a.pollution;p==="total"&&typeof u=="number"&&u>0&&(typeof a.power_consumption=="number"?xe=a.power_consumption*u:typeof a.power_consumption=="object"&&a.power_consumption!==null&&a.power_consumption!=="Variable"&&("drilling"in a.power_consumption&&"idle"in a.power_consumption?xe={drilling:typeof a.power_consumption.drilling=="number"?a.power_consumption.drilling*u:a.power_consumption.drilling,idle:typeof a.power_consumption.idle=="number"?a.power_consumption.idle*u:a.power_consumption.idle}:"max"in a.power_consumption&&"average"in a.power_consumption&&(xe={max:typeof a.power_consumption.max=="number"?a.power_consumption.max*u:a.power_consumption.max,average:typeof a.power_consumption.average=="number"?a.power_consumption.average*u:a.power_consumption.average})),typeof a.pollution=="number"&&(me=a.pollution*u));const se=Oi(xe),Ee=typeof se=="object"&&se!==null&&("drilling"in se&&"idle"in se||"max"in se&&"average"in se),le=a.power_type==="HV"?" HV":"",fe=a.inputs.length,ve=a.outputs.length,be=Math.max(fe,ve,1),Se=fe>0,je=ve>0,Mt=Bn-Dn*2,Bt=Se&&je?Math.floor((Mt-Rn)/2):Se?Mt:0,Zt=Se&&je?Math.floor((Mt-Rn)/2):je?Mt:0,er=Bn,tr=be*Jt+(be-1)*Jr+24,Lt=Zi+tr+12,ye=u??0,Ot=Number.isInteger(ye)?ye.toString():ye.toFixed(2),ut=e.machineCountMode||"free",nn=p==="total"?{color:"var(--text-muted)",opacity:.5}:{};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`custom-node ${w?"target":""}`,style:{width:er,height:Lt},onMouseDownCapture:y=>{y.button===1&&(y.preventDefault(),y.stopPropagation(),e.onMiddleClick&&e.onMiddleClick(n))},children:[t.jsxs("div",{className:"node-info-area",children:[ot.outputs.length>0&&t.jsx("div",{onDoubleClick:y=>y.stopPropagation(),style:{position:"absolute",top:"10px",left:"10px",background:"var(--bg-secondary)",border:"2px solid var(--border-primary)",borderRadius:"var(--radius-sm)",padding:"4px 8px",fontSize:"11px",fontWeight:700,color:"var(--output-text)",zIndex:5},children:ot.outputs.map((y,pe)=>t.jsx("div",{children:wr(y.temp)},`output-${pe}`))}),Ae&&(He==null?void 0:He.type)==="steam_input"&&Rt(a)&&t.jsx("div",{onDoubleClick:y=>y.stopPropagation(),style:{position:"absolute",top:"10px",left:"10px",background:"var(--bg-secondary)",border:"2px solid var(--input-border)",borderRadius:"var(--radius-sm)",padding:"4px 8px",fontSize:"11px",fontWeight:700,color:"var(--input-text)",zIndex:5},children:wr(a.tempDependentInputTemp??ft)}),te&&t.jsx("button",{onClick:y=>{y.stopPropagation(),V("drill")},onDoubleClick:y=>y.stopPropagation(),className:"drill-settings-button",title:"Configure Drill",children:"âš™ï¸"}),re&&t.jsx("button",{onClick:y=>{y.stopPropagation(),V("assembler")},onDoubleClick:y=>y.stopPropagation(),className:"drill-settings-button",title:"Configure Assembler",children:"âš™ï¸"}),ne&&t.jsx("button",{onClick:y=>{y.stopPropagation(),V("treeFarm")},onDoubleClick:y=>y.stopPropagation(),className:"drill-settings-button",title:"Configure Tree Farm",children:"âš™ï¸"}),Xe&&t.jsx("button",{onClick:y=>{y.stopPropagation(),V("firebox")},onDoubleClick:y=>y.stopPropagation(),className:"drill-settings-button",title:"Configure Firebox",children:"âš™ï¸"}),Fe&&t.jsx("button",{onClick:y=>{y.stopPropagation(),V("chemicalPlant")},onDoubleClick:y=>y.stopPropagation(),className:"drill-settings-button",title:"Configure Chemical Plant",children:"âš™ï¸"}),ce&&t.jsx("button",{onClick:y=>{y.stopPropagation(),V("wasteFacility")},onDoubleClick:y=>y.stopPropagation(),className:"drill-settings-button",title:"Configure Waste Facility",children:"âš™ï¸"}),k&&t.jsx("button",{onClick:y=>{y.stopPropagation(),V("liquidDump")},onDoubleClick:y=>y.stopPropagation(),className:"drill-settings-button",title:"Liquid Dump Info",children:"âš™ï¸"}),ae&&t.jsx("button",{onClick:y=>{y.stopPropagation(),V("liquidBurner")},onDoubleClick:y=>y.stopPropagation(),className:"drill-settings-button",title:"Liquid Burner Info",children:"âš™ï¸"}),de&&t.jsx("button",{onClick:y=>{y.stopPropagation(),V("temperature")},onDoubleClick:y=>y.stopPropagation(),className:"drill-settings-button",title:"Configure Temperature",children:"âš™ï¸"}),Pt&&t.jsx("button",{onClick:y=>{y.stopPropagation(),V("boiler")},onDoubleClick:y=>y.stopPropagation(),className:"drill-settings-button",title:"Configure Boiler",style:{right:"10px"},children:"âš™ï¸"}),t.jsx("div",{className:"node-recipe-name",title:a.name,children:a.name}),t.jsxs("div",{className:"node-stats-row",children:[t.jsxs("div",{className:"node-stats",style:{gap:Ee?"1px":"3px",minHeight:"65px",visibility:G?"visible":"hidden"},children:[t.jsxs("div",{className:"node-stat-row",children:[t.jsx("span",{className:"node-stat-label",children:"Cycle:"})," ",Y]}),Ee?"drilling"in se?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"node-stat-row",children:[t.jsx("span",{className:"node-stat-label",children:"Power (Drilling):"})," ",se.drilling,le]}),t.jsxs("div",{className:"node-stat-row",children:[t.jsx("span",{className:"node-stat-label",children:"Power (Idle):"})," ",se.idle,le]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"node-stat-row",children:[t.jsx("span",{className:"node-stat-label",children:"Power (Max):"})," ",se.max,le]}),t.jsxs("div",{className:"node-stat-row",children:[t.jsx("span",{className:"node-stat-label",children:"Power (Avg):"})," ",se.average,le]})]}):t.jsxs("div",{className:"node-stat-row",children:[t.jsx("span",{className:"node-stat-label",children:"Power:"})," ",se,le]}),t.jsxs("div",{className:"node-stat-row",children:[t.jsx("span",{className:"node-stat-label",children:"Pollution:"})," ",$i(me)]})]}),t.jsxs("div",{className:"node-machine-info",style:{visibility:G?"visible":"hidden"},children:[t.jsx("div",{className:"node-machine-name",title:s.name,style:{color:s.tier===1?"var(--tier-1-color)":s.tier===2?"var(--tier-2-color)":s.tier===3?"var(--tier-3-color)":s.tier===4?"var(--tier-4-color)":(s.tier===5,"var(--tier-5-color)")},children:s.name}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[t.jsx("div",{className:"node-machine-count",style:nn,title:p==="total"?"Machine count (display mode: Total)":"Double-click node to edit",children:Ot}),ut!=="free"&&t.jsx("button",{onClick:y=>{y.stopPropagation(),O&&O(n,ut,u)},onDoubleClick:y=>y.stopPropagation(),style:{background:"none",border:"none",cursor:"pointer",fontSize:"14px",lineHeight:1,opacity:.8,padding:"2px",display:"flex",alignItems:"center",transition:"opacity 0.2s"},onMouseEnter:y=>y.currentTarget.style.opacity="1",onMouseLeave:y=>y.currentTarget.style.opacity="0.8",title:ut==="locked"?`Locked: LP/suggestions cannot change (cap: ${((Ne=e.cappedMachineCount)==null?void 0:Ne.toFixed(2))||u.toFixed(2)})
Click to unlock`:`Capped: LP/suggestions max ${(($t=e.cappedMachineCount)==null?void 0:$t.toFixed(2))||u.toFixed(2)}
Click to lock`,children:ut==="locked"?"ðŸ”’":"ðŸ“Š"})]})]})]})]}),t.jsxs("div",{className:"node-io-area",children:[t.jsxs("div",{className:"node-io-columns",style:{gridTemplateColumns:Se&&je?`${Bt}px 1fr ${Zt}px`:"1fr",padding:`0 ${Dn}px`},children:[Se&&t.jsx("div",{className:"node-io-column node-io-left",children:a.inputs.map((y,pe)=>t.jsx("div",{className:"node-rect-wrapper",children:t.jsx(Ln,{side:"left",index:pe,width:Bt,input:y,onClick:x,nodeId:n,formatQuantity:J,isMobile:e.isMobile,mobileActionMode:e.mobileActionMode})},`left-${n}-${pe}-${y.product_id}`))}),Se&&je&&t.jsx("div",{className:"node-io-gap"}),je&&t.jsx("div",{className:"node-io-column node-io-right",children:a.outputs.map((y,pe)=>t.jsx("div",{className:"node-rect-wrapper",children:t.jsx(Ln,{side:"right",index:pe,width:Zt,input:y,onClick:N,nodeId:n,formatQuantity:J,isMobile:e.isMobile,mobileActionMode:e.mobileActionMode})},`right-${n}-${pe}-${y.product_id}`))})]}),t.jsxs("div",{className:"node-handles-container",children:[a.inputs.map((y,pe)=>t.jsx(On,{side:"left",index:pe,onClick:x,nodeId:n,productId:y.product_id,flows:e.flows,onHandleDoubleClick:e.onHandleDoubleClick,suggestions:e.suggestions,input:y,data:e,leftCount:fe,rightCount:ve},`handle-left-${n}-${pe}`)),a.outputs.map((y,pe)=>t.jsx(On,{side:"right",index:pe,onClick:N,nodeId:n,productId:y.product_id,flows:e.flows,onHandleDoubleClick:e.onHandleDoubleClick,suggestions:e.suggestions,input:y,data:e,leftCount:fe,rightCount:ve},`handle-right-${n}-${pe}`))]})]})]}),D&&t.jsx(Yi,{recipeType:D,nodeId:n,currentSettings:D==="drill"?a.drillSettings:D==="assembler"?a.assemblerSettings:D==="treeFarm"?a.treeFarmSettings:D==="firebox"?a.fireboxSettings:D==="temperature"||D==="boiler"?a.temperatureSettings:D==="chemicalPlant"?a.chemicalPlantSettings:D==="wasteFacility"?a.wasteFacilitySettings:D==="liquidDump"?a.liquidDumpSettings:D==="liquidBurner"?a.liquidBurnerSettings:{},recipe:a,globalPollution:v||0,onSettingsChange:D==="drill"?L:D==="assembler"?b:D==="treeFarm"?S:D==="firebox"?H:D==="temperature"?P:D==="boiler"?A:D==="chemicalPlant"?I:D==="wasteFacility"?e.onWasteFacilitySettingsChange:D==="liquidDump"?e.onLiquidDumpSettingsChange:D==="liquidBurner"?e.onLiquidBurnerSettingsChange:()=>{},onClose:()=>V(null)})]})},(e,n)=>{if(e.data===n.data&&e.id===n.id)return!0;if(e.id!==n.id)return!1;const a=e.data,s=n.data;return!(a.recipe!==s.recipe||a.machineCount!==s.machineCount||a.flows!==s.flows||a.suggestions!==s.suggestions||a.displayMode!==s.displayMode||a.machineDisplayMode!==s.machineDisplayMode||a.isTarget!==s.isTarget||a.zoomLevel!==s.zoomLevel||a.machineCountMode!==s.machineCountMode)}),Ln=({side:e,index:n,width:a,input:s,onClick:u,nodeId:f,formatQuantity:p,isMobile:x,mobileActionMode:N})=>{const w=e==="left",L=Qt(s.product_id,Me,s.acceptedType),b=p(s.quantity),S=!x||N==="pan";return t.jsx("div",{onClick:H=>{u&&S&&(H.stopPropagation(),u(s.product_id,f,n,H))},title:`${b}x ${L}`,className:`node-rect ${w?"input":"output"} ${u?"clickable":""}`,style:{width:`${a}px`,height:`${Jt}px`,minWidth:`${a}px`},children:t.jsxs("span",{className:"node-rect-text",children:[b,"x ",L]})})},On=({side:e,index:n,onClick:a,nodeId:s,productId:u,flows:f,onHandleDoubleClick:p,suggestions:x,input:N,data:w,leftCount:L,rightCount:b})=>{var ne,ce;const P=(k,ae)=>{const ee=Math.max(Math.abs(k),Math.abs(ae))*1e-4,de=Math.max(ee,1e-6);return Math.abs(k)>de},A=getComputedStyle(document.documentElement),I=A.getPropertyValue("--handle-input-supplied").trim(),v=A.getPropertyValue("--handle-input-deficient").trim(),W=A.getPropertyValue("--handle-output-connected").trim(),K=A.getPropertyValue("--handle-output-excess").trim();let B=e==="left"?I:W;if(f){const k=e==="left"?(ne=f.inputFlows)==null?void 0:ne[n]:(ce=f.outputFlows)==null?void 0:ce[n];if(k){const ae=e==="left"?k.needed-k.connected:k.produced-k.connected,ee=e==="left"?k.needed:k.produced;P(ae,ee)&&ae>0&&(B=e==="left"?v:K)}}const O=Me(u),G=(O==null?void 0:O.type)==="fluid"||u==="p_any_fluid"?"50%":"2px",re=12+(Math.max(L,b)-(e==="left"?L:b))*(Jt+Jr)/2+n*(Jt+Jr)+Jt/2+11;return t.jsx(ii,{type:e==="left"?"target":"source",position:e==="left"?bn.Left:bn.Right,id:`${e}-${n}`,style:{background:B,width:"12px",height:"12px",border:"2px solid #1a1a1a",borderRadius:G,cursor:"pointer",position:"absolute",[e==="left"?"left":"right"]:"0",top:`${re}px`,transform:e==="left"?"translate(-50%, -50%)":"translate(50%, -50%)"},onClick:k=>{a&&k.ctrlKey&&(k.stopPropagation(),a(u,s,n,k))},onDoubleClick:k=>{p&&(k.stopPropagation(),p(s,e,n,u,x))}})},to=e=>{if(e.length<2)return"";if(e.length===2){const a=e[1].x-e[0].x,s=e[0].x+a/3,u=e[1].x-a/3;return`M ${e[0].x} ${e[0].y} C ${s} ${e[0].y} ${u} ${e[1].y} ${e[1].x} ${e[1].y}`}let n=`M ${e[0].x} ${e[0].y}`;for(let a=0;a<e.length-1;a++){const s=e[Math.max(0,a-1)],u=e[a],f=e[a+1],p=e[Math.min(e.length-1,a+2)],x=u.x+(f.x-s.x)/6,N=u.y+(f.y-s.y)/6,w=f.x-(p.x-u.x)/6,L=f.y-(p.y-u.y)/6;n+=` C ${x} ${N} ${w} ${L} ${f.x} ${f.y}`}return n},ro=(e,n,a)=>{const s=a.x-n.x,u=a.y-n.y,f=s*s+u*u;if(f===0)return Math.hypot(e.x-n.x,e.y-n.y);const p=Math.max(0,Math.min(1,((e.x-n.x)*s+(e.y-n.y)*u)/f));return Math.hypot(e.x-(n.x+p*s),e.y-(n.y+p*u))},no=(e,n)=>{let a=1/0,s=1;for(let u=0;u<n.length-1;u++){const f=ro(e,n[u],n[u+1]);f<a&&(a=f,s=u+1)}return s};let Wt=!1,vr=!1;const fr=e=>{vr=e},ao=({id:e,sourceX:n,sourceY:a,targetX:s,targetY:u,data:f,selected:p})=>{const x=(f==null?void 0:f.edgePath)||"orthogonal",N=(f==null?void 0:f.edgeStyle)||"animated",w=(f==null?void 0:f.bezierPoints)??[],L=(f==null?void 0:f.orthoMidX)??null,b=(f==null?void 0:f.orthoMidY)??null,[S,H]=m.useState(!1),[P,A]=m.useState(!1),[I,v]=m.useState(null),[W,K]=m.useState(null),B=m.useRef(!1),O=m.useRef(null),z=m.useRef(-1),G=m.useRef(null),D=m.useRef(null),V=m.useRef(null),{setEdges:te,screenToFlowPosition:re}=oi(),ne=vn(J=>J.nodes.some(Q=>Q.dragging)),ce=vn(J=>J.connectionNodeId!=null),k=s-n,ae=x==="orthogonal"&&k<60,ee=40,de=m.useMemo(()=>{if(ae)return null;if(L!==null){const J=Math.min(n,s)+20,Q=Math.max(n,s)-20;return Math.max(J,Math.min(Q,L))}return(n+s)/2},[n,s,L,ae]),Pt=m.useMemo(()=>ae?b??(a+u)/2:null,[a,u,b,ae]),{pathD:it,handlePos:Xe,midlineSegment:Fe}=m.useMemo(()=>{if(x==="straight")return{pathD:`M ${n} ${a} L ${s} ${u}`,handlePos:null};if(x==="bezier"){const J=[{x:n,y:a},...w,{x:s,y:u}];return{pathD:to(J),handlePos:null,midlineSegment:null}}if(ae){const J=n+ee,Q=s-ee,Y=Pt;return{pathD:`M ${n} ${a} L ${J} ${a} L ${J} ${Y} L ${Q} ${Y} L ${Q} ${u} L ${s} ${u}`,handlePos:{x:(J+Q)/2,y:Y},midlineSegment:{pathD:`M ${J} ${Y} L ${Q} ${Y}`,clampMinX:Math.min(J,Q),clampMaxX:Math.max(J,Q)}}}return{pathD:`M ${n} ${a} L ${de} ${a} L ${de} ${u} L ${s} ${u}`,handlePos:{x:de,y:(a+u)/2},midlineSegment:{pathD:`M ${de} ${Math.min(a,u)} L ${de} ${Math.max(a,u)}`,clampMinY:Math.min(a,u),clampMaxY:Math.max(a,u)}}},[x,n,a,s,u,w,de,Pt,ae]),Ae=m.useMemo(()=>{if(!Xe)return null;const J=P?O.current:I;return!J||!Fe?Xe:ae?{x:Math.max(Fe.clampMinX,Math.min(Fe.clampMaxX,J.x)),y:Xe.y}:{x:Xe.x,y:Math.max(Fe.clampMinY,Math.min(Fe.clampMaxY,J.y))}},[P,I,Fe,Xe,ae]),He=m.useCallback((J,Q)=>{const Y=G.current;if(!Y)return null;const xe=Y.getTotalLength();if(xe===0)return null;const me=Y.getScreenCTM();if(!me)return null;const se=Math.min(120,Math.ceil(xe/8)+20);let Ee=1/0,le=null;for(let fe=0;fe<=se;fe++){const ve=Y.getPointAtLength(fe/se*xe),be=me.a*ve.x+me.c*ve.y+me.e,Se=me.b*ve.x+me.d*ve.y+me.f,je=Math.hypot(be-J,Se-Q);je<Ee&&(Ee=je,le={x:ve.x,y:ve.y})}return{screenDist:Ee,flowPoint:le}},[]),ue=m.useCallback((J,Q,Y=-1)=>{if(J.button!==0||vr||Wt&&!B.current)return;J.stopPropagation(),J.preventDefault();const xe=re({x:J.clientX,y:J.clientY}),me=Q==="bezier-new"&&D.current?D.current:xe;O.current=me,v(me),B.current=!0,A(!0),Wt=!0,Q==="bezier-new"?te(le=>le.map(fe=>{if(fe.id!==e)return fe;const ve=fe.data.bezierPoints||[],be=[{x:n,y:a},...ve,{x:s,y:u}],Se=no(me,be)-1;z.current=Se;const je=[...ve];return je.splice(Se,0,{x:me.x,y:me.y}),{...fe,data:{...fe.data,bezierPoints:je}}})):Q==="bezier-move"&&(z.current=Y);const se=le=>{if(!B.current)return;const fe=re({x:le.clientX,y:le.clientY});te(ve=>ve.map(be=>{if(be.id!==e)return be;if(Q==="bezier-new"||Q==="bezier-move"){const Se=z.current;if(Se<0)return be;const je=[...be.data.bezierPoints||[]];return Se>=je.length?be:(je[Se]={x:fe.x,y:fe.y},{...be,data:{...be.data,bezierPoints:je}})}return Q==="ortho"?{...be,data:{...be.data,orthoMidX:fe.x}}:Q==="orthoY"?{...be,data:{...be.data,orthoMidY:fe.y}}:be}))},Ee=()=>{B.current=!1,A(!1),Wt=!1,O.current=null,z.current=-1,v(null),K(null),window.removeEventListener("mousemove",se),window.removeEventListener("mouseup",Ee)};window.addEventListener("mousemove",se),window.addEventListener("mouseup",Ee)},[e,n,a,s,u,te,re]),Ce=m.useCallback(J=>{te(Q=>Q.map(Y=>{if(Y.id!==e)return Y;const xe=(Y.data.bezierPoints||[]).filter((me,se)=>se!==J);return{...Y,data:{...Y.data,bezierPoints:xe}}}))},[e,te]),ot=N==="animated"?"custom-edge custom-edge-animated":N==="dashed"?"custom-edge custom-edge-dashed":"custom-edge custom-edge-solid";return t.jsxs("g",{onMouseEnter:()=>H(!0),onMouseLeave:()=>{B.current||H(!1)},children:[t.jsx("path",{id:e,className:ot,d:it,fill:"none"}),t.jsx("path",{d:it,fill:"none",stroke:"transparent",strokeWidth:20,style:{cursor:"pointer"},pointerEvents:"stroke"}),x==="bezier"&&t.jsxs(t.Fragment,{children:[t.jsx("path",{ref:G,d:it,fill:"none",stroke:"transparent",strokeWidth:6,style:{cursor:W?"crosshair":"default"},pointerEvents:"stroke",onMouseMove:J=>{if(vr||Wt&&!B.current)return;const Q=J.clientX,Y=J.clientY;V.current||(V.current=requestAnimationFrame(()=>{V.current=null;const xe=He(Q,Y);xe&&xe.screenDist<=5?(D.current=xe.flowPoint,K(xe.flowPoint)):(D.current=null,K(null))}))},onMouseLeave:()=>{B.current||(V.current&&(cancelAnimationFrame(V.current),V.current=null),K(null),D.current=null)},onMouseDown:J=>{D.current&&ue(J,"bezier-new")}}),W&&!P&&t.jsx("circle",{cx:W.x,cy:W.y,r:5,fill:"var(--color-primary)",opacity:.5,pointerEvents:"none"}),(S||p||P)&&w.map((J,Q)=>t.jsxs("g",{children:[t.jsx("circle",{cx:J.x,cy:J.y,r:6,fill:"var(--bg-secondary)",stroke:"var(--color-primary)",strokeWidth:2,style:{cursor:"grab"},pointerEvents:"all",onMouseDown:Y=>{if(Y.stopPropagation(),Y.ctrlKey||Y.metaKey){Ce(Q);return}ue(Y,"bezier-move",Q)},onDoubleClick:Y=>{Y.stopPropagation(),Ce(Q)}}),t.jsx("circle",{cx:J.x,cy:J.y,r:20,fill:"transparent",stroke:"none",pointerEvents:"all",onMouseEnter:()=>H(!0),onMouseLeave:()=>{B.current||H(!1)},onMouseDown:Y=>{if(Y.stopPropagation(),Y.ctrlKey||Y.metaKey){Ce(Q);return}ue(Y,"bezier-move",Q)},onDoubleClick:Y=>{Y.stopPropagation(),Ce(Q)}})]},Q))]}),x==="orthogonal"&&Xe&&Fe&&t.jsxs(t.Fragment,{children:[t.jsx("path",{d:Fe.pathD,fill:"none",stroke:"transparent",strokeWidth:16,style:{cursor:ae?"ns-resize":"ew-resize"},pointerEvents:"stroke",onMouseMove:J=>{vr||Wt&&!B.current||v(re({x:J.clientX,y:J.clientY}))},onMouseLeave:()=>{B.current||v(null)},onMouseDown:J=>ue(J,ae?"orthoY":"ortho")}),(I!==null||P)&&!ne&&!ce&&Ae&&(ae?t.jsx("rect",{x:Ae.x-14,y:Ae.y-5,width:28,height:10,rx:3,fill:"var(--bg-secondary)",stroke:"var(--color-primary)",strokeWidth:2,style:{cursor:"ns-resize"},pointerEvents:"none"}):t.jsx("rect",{x:Ae.x-5,y:Ae.y-14,width:10,height:28,rx:3,fill:"var(--bg-secondary)",stroke:"var(--color-primary)",strokeWidth:2,style:{cursor:"ew-resize"},pointerEvents:"none"}))]})]})},io=m.memo(ao),Et={colorPrimary:"#d4a637",colorPrimaryHover:"#f5d56a",colorPrimaryDark:"#0a0a0a",colorSecondary:"#1a1a1a",bgMain:"#0a0a0a",bgSecondary:"#1a1a1a",textPrimary:"#f5d56a",textSecondary:"#999999",textMuted:"#aaaaaa",statValue:"#e0e0e0",borderPrimary:"#d4a637",borderLight:"#333333",borderDivider:"#d4a63755",inputBg:"#1a3a2a",inputBorder:"#22c55e",inputText:"#86efac",outputBg:"#3a1a1a",outputBorder:"#ef4444",outputText:"#fca5a5",deleteBg:"#3a1a1a",deleteColor:"#ef4444",deleteHoverBg:"#ef4444",deleteHoverColor:"#0a0a0a",nodeBg:"#1a1a1a",nodeBorder:"#d4a637",nodeTargetBg:"#2d2416",nodeTargetBorder:"#f5d56a",handleInputSupplied:"#22c55e",handleInputDeficient:"#ef4444",handleOutputConnected:"#ef4444",handleOutputExcess:"#22c55e",statPositive:"#86efac",statNegative:"#fca5a5",settingsInputLabel:"#86efac",settingsOutputLabel:"#fca5a5",tier1Color:"#888888",tier2Color:"#4ade80",tier3Color:"#60a5fa",tier4Color:"#c084fc",tier5Color:"#fbbf24",edgePath:"orthogonal",edgeStyle:"animated"},oo=[{id:"default",name:"Golden Industrial (Default)",description:"Original golden theme with warm tones",theme:Et},{id:"dracula",name:"Dracula",description:"Grimace Shake",theme:{colorPrimary:"#bd93f9",colorPrimaryHover:"#d6acff",colorPrimaryDark:"#282a36",colorSecondary:"#44475a",bgMain:"#282a36",bgSecondary:"#44475a",textPrimary:"#f8f8f2",textSecondary:"#6272a4",textMuted:"#6272a4",statValue:"#f8f8f2",borderPrimary:"#bd93f9",borderLight:"#44475a",borderDivider:"#bd93f955",inputBg:"#1a2a3a",inputBorder:"#50fa7b",inputText:"#50fa7b",outputBg:"#3a1a2a",outputBorder:"#ff5555",outputText:"#ff79c6",deleteBg:"#44475a",deleteColor:"#ff5555",deleteHoverBg:"#ff5555",deleteHoverColor:"#282a36",nodeBg:"#44475a",nodeBorder:"#bd93f9",nodeTargetBg:"#5a4a6a",nodeTargetBorder:"#ff79c6",handleInputSupplied:"#50fa7b",handleInputDeficient:"#ff5555",handleOutputConnected:"#ff5555",handleOutputExcess:"#50fa7b",statPositive:"#50fa7b",statNegative:"#ff5555",settingsInputLabel:"#50fa7b",settingsOutputLabel:"#ff79c6",tier1Color:"#999999",tier2Color:"#50fa7b",tier3Color:"#8be9fd",tier4Color:"#bd93f9",tier5Color:"#f1fa8c",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"nord",name:"Nord",description:"Cool arctic bluish palette",theme:{colorPrimary:"#88c0d0",colorPrimaryHover:"#8fbcbb",colorPrimaryDark:"#2e3440",colorSecondary:"#3b4252",bgMain:"#2e3440",bgSecondary:"#3b4252",textPrimary:"#eceff4",textSecondary:"#d8dee9",textMuted:"#4c566a",statValue:"#e5e9f0",borderPrimary:"#88c0d0",borderLight:"#4c566a",borderDivider:"#88c0d055",inputBg:"#2a3a3a",inputBorder:"#a3be8c",inputText:"#a3be8c",outputBg:"#3a2a2a",outputBorder:"#bf616a",outputText:"#d08770",deleteBg:"#3b4252",deleteColor:"#bf616a",deleteHoverBg:"#bf616a",deleteHoverColor:"#2e3440",nodeBg:"#3b4252",nodeBorder:"#88c0d0",nodeTargetBg:"#4c5a68",nodeTargetBorder:"#8fbcbb",handleInputSupplied:"#a3be8c",handleInputDeficient:"#bf616a",handleOutputConnected:"#bf616a",handleOutputExcess:"#a3be8c",statPositive:"#a3be8c",statNegative:"#bf616a",settingsInputLabel:"#a3be8c",settingsOutputLabel:"#d08770",tier1Color:"#999999",tier2Color:"#a3be8c",tier3Color:"#88c0d0",tier4Color:"#b48ead",tier5Color:"#ebcb8b",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"solarized-dark",name:"Solarized Dark",description:"Precision dark theme with balanced contrast",theme:{colorPrimary:"#268bd2",colorPrimaryHover:"#2aa198",colorPrimaryDark:"#002b36",colorSecondary:"#073642",bgMain:"#002b36",bgSecondary:"#073642",textPrimary:"#839496",textSecondary:"#586e75",textMuted:"#657b83",statValue:"#93a1a1",borderPrimary:"#268bd2",borderLight:"#073642",borderDivider:"#268bd255",inputBg:"#073a3a",inputBorder:"#859900",inputText:"#859900",outputBg:"#3a0707",outputBorder:"#dc322f",outputText:"#cb4b16",deleteBg:"#073642",deleteColor:"#dc322f",deleteHoverBg:"#dc322f",deleteHoverColor:"#002b36",nodeBg:"#073642",nodeBorder:"#268bd2",nodeTargetBg:"#0f4a52",nodeTargetBorder:"#2aa198",handleInputSupplied:"#859900",handleInputDeficient:"#dc322f",handleOutputConnected:"#dc322f",handleOutputExcess:"#859900",statPositive:"#859900",statNegative:"#dc322f",settingsInputLabel:"#859900",settingsOutputLabel:"#cb4b16",tier1Color:"#93a1a1",tier2Color:"#859900",tier3Color:"#268bd2",tier4Color:"#6c71c4",tier5Color:"#b58900",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"solarized-light",name:"Solarized Light",description:"For those who want to burn their eyes out",theme:{colorPrimary:"#268bd2",colorPrimaryHover:"#2aa198",colorPrimaryDark:"#fdf6e3",colorSecondary:"#eee8d5",bgMain:"#fdf6e3",bgSecondary:"#eee8d5",textPrimary:"#657b83",textSecondary:"#586e75",textMuted:"#93a1a1",statValue:"#073642",borderPrimary:"#268bd2",borderLight:"#93a1a1",borderDivider:"#268bd255",inputBg:"#e5f5e5",inputBorder:"#859900",inputText:"#859900",outputBg:"#f5e5e5",outputBorder:"#dc322f",outputText:"#cb4b16",deleteBg:"#eee8d5",deleteColor:"#dc322f",deleteHoverBg:"#dc322f",deleteHoverColor:"#fdf6e3",nodeBg:"#eee8d5",nodeBorder:"#268bd2",nodeTargetBg:"#d9d2c2",nodeTargetBorder:"#2aa198",handleInputSupplied:"#859900",handleInputDeficient:"#dc322f",handleOutputConnected:"#dc322f",handleOutputExcess:"#859900",statPositive:"#859900",statNegative:"#dc322f",settingsInputLabel:"#859900",settingsOutputLabel:"#cb4b16",tier1Color:"#839496",tier2Color:"#859900",tier3Color:"#268bd2",tier4Color:"#6c71c4",tier5Color:"#b58900",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"midnight",name:"Midnight Blue",description:"Deep blue dark theme",theme:{colorPrimary:"#4a9eff",colorPrimaryHover:"#70b4ff",colorPrimaryDark:"#0a0e1a",colorSecondary:"#151a2e",bgMain:"#0a0e1a",bgSecondary:"#151a2e",textPrimary:"#e0e6ff",textSecondary:"#8892b0",textMuted:"#a8b2d1",statValue:"#ccd6f6",borderPrimary:"#4a9eff",borderLight:"#233554",borderDivider:"#4a9eff55",inputBg:"#1a2a3a",inputBorder:"#64ffda",inputText:"#64ffda",outputBg:"#3a1a2a",outputBorder:"#ff6b9d",outputText:"#ffa7c4",deleteBg:"#151a2e",deleteColor:"#ff6b9d",deleteHoverBg:"#ff6b9d",deleteHoverColor:"#0a0e1a",nodeBg:"#151a2e",nodeBorder:"#4a9eff",nodeTargetBg:"#1e2a45",nodeTargetBorder:"#70b4ff",handleInputSupplied:"#64ffda",handleInputDeficient:"#ff6b9d",handleOutputConnected:"#ff6b9d",handleOutputExcess:"#64ffda",statPositive:"#64ffda",statNegative:"#ff6b9d",settingsInputLabel:"#64ffda",settingsOutputLabel:"#ffa7c4",tier1Color:"#9099b0",tier2Color:"#64ffda",tier3Color:"#4a9eff",tier4Color:"#c792ea",tier5Color:"#ffcb6b",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"forest",name:"Forest Green",description:"Natural green theme",theme:{colorPrimary:"#5fb573",colorPrimaryHover:"#7fc794",colorPrimaryDark:"#0a1a0f",colorSecondary:"#152820",bgMain:"#0a1a0f",bgSecondary:"#152820",textPrimary:"#c8e6c9",textSecondary:"#81c784",textMuted:"#a5d6a7",statValue:"#e0f2e0",borderPrimary:"#5fb573",borderLight:"#2e4a35",borderDivider:"#5fb57355",inputBg:"#1a3a2a",inputBorder:"#66bb6a",inputText:"#a5d6a7",outputBg:"#3a1a1a",outputBorder:"#ef5350",outputText:"#ff8a80",deleteBg:"#152820",deleteColor:"#ef5350",deleteHoverBg:"#ef5350",deleteHoverColor:"#0a1a0f",nodeBg:"#152820",nodeBorder:"#5fb573",nodeTargetBg:"#243a2d",nodeTargetBorder:"#7fc794",handleInputSupplied:"#66bb6a",handleInputDeficient:"#ef5350",handleOutputConnected:"#ef5350",handleOutputExcess:"#66bb6a",statPositive:"#a5d6a7",statNegative:"#ff8a80",settingsInputLabel:"#a5d6a7",settingsOutputLabel:"#ff8a80",tier1Color:"#9e9e9e",tier2Color:"#66bb6a",tier3Color:"#42a5f5",tier4Color:"#ab47bc",tier5Color:"#ffca28",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"sunset",name:"Sunset Orange",description:"Warm sunset-inspired theme, steampunk-esque",theme:{colorPrimary:"#ff8c42",colorPrimaryHover:"#ffaa6f",colorPrimaryDark:"#1a0f0a",colorSecondary:"#281912",bgMain:"#1a0f0a",bgSecondary:"#281912",textPrimary:"#ffe4d1",textSecondary:"#ffb88c",textMuted:"#ffc9a3",statValue:"#fff0e0",borderPrimary:"#ff8c42",borderLight:"#4a2e1f",borderDivider:"#ff8c4255",inputBg:"#2a3a1a",inputBorder:"#a3e048",inputText:"#c6f68d",outputBg:"#3a1a1a",outputBorder:"#ff5555",outputText:"#ff8787",deleteBg:"#281912",deleteColor:"#ff5555",deleteHoverBg:"#ff5555",deleteHoverColor:"#1a0f0a",nodeBg:"#281912",nodeBorder:"#ff8c42",nodeTargetBg:"#3d2a1a",nodeTargetBorder:"#ffaa6f",handleInputSupplied:"#a3e048",handleInputDeficient:"#ff5555",handleOutputConnected:"#ff5555",handleOutputExcess:"#a3e048",statPositive:"#c6f68d",statNegative:"#ff8787",settingsInputLabel:"#c6f68d",settingsOutputLabel:"#ff8787",tier1Color:"#a89984",tier2Color:"#a3e048",tier3Color:"#83a598",tier4Color:"#d3869b",tier5Color:"#fabd2f",edgePath:"orthogonal",edgeStyle:"animated"}},{id:"cyberpunk",name:"Cyberpunk",description:"Neon-inspired futuristic theme",theme:{colorPrimary:"#00ff9f",colorPrimaryHover:"#00ffbf",colorPrimaryDark:"#0a0a15",colorSecondary:"#1a1a2e",bgMain:"#0a0a15",bgSecondary:"#1a1a2e",textPrimary:"#00ff9f",textSecondary:"#00d4aa",textMuted:"#00b494",statValue:"#d0fff0",borderPrimary:"#00ff9f",borderLight:"#16213e",borderDivider:"#00ff9f55",inputBg:"#1a2a3a",inputBorder:"#00ff9f",inputText:"#00ffbf",outputBg:"#3a1a2a",outputBorder:"#ff006e",outputText:"#ff4d9d",deleteBg:"#1a1a2e",deleteColor:"#ff006e",deleteHoverBg:"#ff006e",deleteHoverColor:"#0a0a15",nodeBg:"#1a1a2e",nodeBorder:"#00ff9f",nodeTargetBg:"#2a2a45",nodeTargetBorder:"#00ffbf",handleInputSupplied:"#00ff9f",handleInputDeficient:"#ff006e",handleOutputConnected:"#ff006e",handleOutputExcess:"#00ff9f",statPositive:"#00ffbf",statNegative:"#ff4d9d",settingsInputLabel:"#00ffbf",settingsOutputLabel:"#ff4d9d",tier1Color:"#9999aa",tier2Color:"#00ff9f",tier3Color:"#00d4ff",tier4Color:"#d946ef",tier5Color:"#ffd700",edgePath:"orthogonal",edgeStyle:"animated"}}],Pr=e=>{const n=document.documentElement;Object.entries(e).forEach(([a,s])=>{const u="--"+a.replace(/([A-Z])/g,"-$1").toLowerCase();n.style.setProperty(u,s)})},_r=()=>{try{const e=localStorage.getItem("industrialist_theme");return e?JSON.parse(e):Et}catch{return Et}},Gr=e=>localStorage.setItem("industrialist_theme",JSON.stringify(e)),so=()=>(Pr(Et),Gr(Et),Et),lo=({onClose:e})=>{const[n,a]=m.useState(_r()),[s,u]=m.useState(!1),f=b=>{const S={edgePath:n.edgePath||"orthogonal",edgeStyle:n.edgeStyle||"animated"},H={...b.theme,...S};a(H),Pr(H),Gr(H)},p=(b,S)=>{const H={...n,[b]:S};a(H),Pr(H),Gr(H)},x=()=>{const b=so();a(b)},N=[{title:"Primary Colors",colors:[{key:"colorPrimary",label:"Primary"},{key:"colorPrimaryHover",label:"Primary Hover"},{key:"colorPrimaryDark",label:"Primary Dark"},{key:"colorSecondary",label:"Secondary"}]},{title:"Background Colors",colors:[{key:"bgMain",label:"Main Background"},{key:"bgSecondary",label:"Secondary Background"}]},{title:"Text Colors",colors:[{key:"textPrimary",label:"Primary Text"},{key:"textSecondary",label:"Secondary Text"},{key:"textMuted",label:"Muted Text"},{key:"statValue",label:"Stat Values (Cycle/Power/Pollution)"}]},{title:"Border Colors",colors:[{key:"borderPrimary",label:"Primary Border"},{key:"borderLight",label:"Light Border"},{key:"borderDivider",label:"Divider"}]},{title:"Input/Output Colors",colors:[{key:"inputBg",label:"Input Background"},{key:"inputBorder",label:"Input Border"},{key:"inputText",label:"Input Text"},{key:"outputBg",label:"Output Background"},{key:"outputBorder",label:"Output Border"},{key:"outputText",label:"Output Text"}]},{title:"Node Colors",colors:[{key:"nodeBg",label:"Node Background"},{key:"nodeBorder",label:"Node Border"},{key:"nodeTargetBg",label:"Target Node Background"},{key:"nodeTargetBorder",label:"Target Node Border"}]},{title:"Delete Button",colors:[{key:"deleteBg",label:"Background"},{key:"deleteColor",label:"Color"},{key:"deleteHoverBg",label:"Hover Background"},{key:"deleteHoverColor",label:"Hover Color"}]},{title:"Node Handles",colors:[{key:"handleInputSupplied",label:"Input Supplied"},{key:"handleInputDeficient",label:"Input Deficient"},{key:"handleOutputConnected",label:"Output Connected"},{key:"handleOutputExcess",label:"Output Excess"}]},{title:"Statistics & Settings",colors:[{key:"statPositive",label:"Positive Stats"},{key:"statNegative",label:"Negative Stats"},{key:"settingsInputLabel",label:"Settings Input Label"},{key:"settingsOutputLabel",label:"Settings Output Label"}]},{title:"Machine Tier Colors",colors:[{key:"tier1Color",label:"Tier 1 (Grey)"},{key:"tier2Color",label:"Tier 2 (Green)"},{key:"tier3Color",label:"Tier 3 (Blue)"},{key:"tier4Color",label:"Tier 4 (Purple)"},{key:"tier5Color",label:"Tier 5 (Yellow)"}]}],w=[{value:"bezier",label:"Bezier (Curved)"},{value:"straight",label:"Straight"},{value:"orthogonal",label:"Orthogonal (90Â° angles)"}],L=[{value:"animated",label:"Animated Dash"},{value:"dashed",label:"Static Dash"},{value:"solid",label:"Solid Line"}];return t.jsx("div",{className:"modal-overlay",onClick:e,children:t.jsxs("div",{className:"modal",onClick:b=>b.stopPropagation(),style:{width:s?"700px":"600px",maxHeight:"85vh"},children:[t.jsx("h2",{className:"modal-title",children:"Theme Editor"}),s?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>u(!1),className:"btn btn-secondary btn-back",children:"â† Back to Presets"}),t.jsxs("div",{className:"modal-content",style:{maxHeight:"55vh"},children:[t.jsxs("div",{className:"theme-group",children:[t.jsx("h3",{className:"theme-group-title",children:"Edge Settings"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[t.jsxs("div",{children:[t.jsx("label",{className:"theme-color-label",children:"Path Type:"}),t.jsx("select",{value:n.edgePath||"bezier",onChange:b=>p("edgePath",b.target.value),className:"select",style:{marginTop:"6px"},children:w.map(b=>t.jsx("option",{value:b.value,children:b.label},b.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"theme-color-label",children:"Line Style:"}),t.jsx("select",{value:n.edgeStyle||"animated",onChange:b=>p("edgeStyle",b.target.value),className:"select",style:{marginTop:"6px"},children:L.map(b=>t.jsx("option",{value:b.value,children:b.label},b.value))})]})]})]}),N.map(b=>t.jsxs("div",{className:"theme-group",children:[t.jsx("h3",{className:"theme-group-title",children:b.title}),t.jsx("div",{className:"theme-color-grid",children:b.colors.map(S=>{const H=n[S.key]||"#000000",P=H.length>7?H.substring(0,7):H;return t.jsxs("div",{className:"theme-color-item",children:[t.jsx("label",{className:"theme-color-label",children:S.label}),t.jsxs("div",{className:"theme-color-inputs",children:[t.jsx("input",{type:"color",value:P,onChange:A=>{const I=n[S.key];if(I&&I.length>7){const v=I.substring(7);p(S.key,A.target.value+v)}else p(S.key,A.target.value)},className:"theme-color-picker"}),t.jsx("input",{type:"text",value:n[S.key],onChange:A=>p(S.key,A.target.value),className:"input theme-color-text"})]})]},S.key)})})]},b.title))]}),t.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"20px"},children:[t.jsx("button",{onClick:x,className:"btn btn-secondary",style:{flex:1},children:"Reset to Default"}),t.jsx("button",{onClick:e,className:"btn btn-primary",style:{flex:1},children:"Done"})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"modal-content",style:{maxHeight:"60vh"},children:[t.jsx("div",{style:{marginBottom:"20px"},children:t.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"14px",marginBottom:"15px",textAlign:"center"},children:"Choose a preset theme or customize your own"})}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:oo.map(b=>t.jsx("div",{onClick:()=>f(b),className:"theme-preset-card",style:{padding:"15px",background:"var(--bg-main)",border:"2px solid var(--border-primary)",borderRadius:"8px",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s"},onMouseEnter:S=>{S.currentTarget.style.transform="scale(1.02)",S.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)"},onMouseLeave:S=>{S.currentTarget.style.transform="scale(1)",S.currentTarget.style.boxShadow="none"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"4px"},children:b.name}),t.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:b.description})]}),t.jsx("div",{style:{display:"flex",gap:"6px"},children:[b.theme.colorPrimary,b.theme.bgMain,b.theme.inputBorder,b.theme.outputBorder].map((S,H)=>t.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"4px",background:S,border:"1px solid rgba(255,255,255,0.2)"}},H))})]})},b.id))})]}),t.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"20px"},children:[t.jsx("button",{onClick:()=>u(!0),className:"btn btn-secondary",style:{flex:1},children:"Advanced Editing"}),t.jsx("button",{onClick:e,className:"btn btn-primary",style:{flex:1},children:"Close"})]})]})]})})},co="industrialist_db",uo=1,Te="canvas_saves",Yt="industrialist_current_save_id";let hr=null;const gt=()=>new Promise((e,n)=>{if(hr){e(hr);return}const a=indexedDB.open(co,uo);a.onerror=()=>{console.error("IndexedDB failed to open:",a.error),n(a.error)},a.onsuccess=()=>{hr=a.result,e(hr)},a.onupgradeneeded=s=>{const u=s.target.result;if(!u.objectStoreNames.contains(Te)){const f=u.createObjectStore(Te,{keyPath:"id"});f.createIndex("timestamp","timestamp",{unique:!1}),f.createIndex("name","name",{unique:!1})}}}),po=async()=>{try{const e=await gt();return new Promise((n,a)=>{const f=e.transaction([Te],"readonly").objectStore(Te).getAll();f.onsuccess=()=>{const p=f.result,x={};p.forEach(N=>{x[N.id]=N}),n(x)},f.onerror=()=>{console.error("Error getting saves:",f.error),a(f.error)}})}catch(e){return console.error("Error accessing IndexedDB:",e),{}}},Zo=async(e,n)=>{var a;try{const s=await gt(),u=`save_${Date.now()}`,f=(n.edges||[]).map(x=>{const{edgePath:N,edgeStyle:w,...L}=x.data||{};return{...x,data:L}}),p={id:u,name:e||"Untitled Save",timestamp:Date.now(),nodeCount:((a=n.nodes)==null?void 0:a.length)||0,data:{...n,edges:f}};return new Promise((x,N)=>{const b=s.transaction([Te],"readwrite").objectStore(Te).add(p);b.onsuccess=()=>{localStorage.setItem(Yt,u),x(p)},b.onerror=()=>{console.error("Error saving canvas:",b.error),N(b.error)}})}catch(s){return console.error("Error saving to IndexedDB:",s),null}},es=async e=>{try{const n=await gt();return new Promise((a,s)=>{const p=n.transaction([Te],"readonly").objectStore(Te).get(e);p.onsuccess=()=>{const x=p.result;x?(localStorage.setItem(Yt,e),a(x.data)):a(null)},p.onerror=()=>{console.error("Error loading save:",p.error),s(p.error)}})}catch(n){return console.error("Error loading from IndexedDB:",n),null}},ts=async e=>{try{const n=await gt();return new Promise((a,s)=>{const p=n.transaction([Te],"readwrite").objectStore(Te).delete(e);p.onsuccess=()=>{localStorage.getItem(Yt)===e&&localStorage.removeItem(Yt),a(!0)},p.onerror=()=>{console.error("Error deleting save:",p.error),s(p.error)}})}catch(n){return console.error("Error deleting from IndexedDB:",n),!1}},rs=async(e,n)=>{try{const a=await gt();return new Promise((s,u)=>{const p=a.transaction([Te],"readwrite").objectStore(Te),x=p.get(e);x.onsuccess=()=>{const N=x.result;if(N){N.name=n;const w=p.put(N);w.onsuccess=()=>s(!0),w.onerror=()=>{console.error("Error updating save:",w.error),u(w.error)}}else s(!1)},x.onerror=()=>{console.error("Error getting save for rename:",x.error),u(x.error)}})}catch(a){return console.error("Error renaming in IndexedDB:",a),!1}},ns=async()=>{try{const e=localStorage.getItem(Yt);if(!e)return"Untitled";const n=await gt();return new Promise(a=>{const f=n.transaction([Te],"readonly").objectStore(Te).get(e);f.onsuccess=()=>{const p=f.result;a((p==null?void 0:p.name)||"Untitled")},f.onerror=()=>{console.error("Error getting current save name:",f.error),a("Untitled")}})}catch{return"Untitled"}},mo=async()=>{const e="industrialist_saves";try{const n=localStorage.getItem(e);if(!n)return;const a=JSON.parse(n),s=Object.keys(a);if(s.length===0){localStorage.removeItem(e);return}const u=await gt(),f=await po();if(Object.keys(f).length>0){localStorage.removeItem(e);return}for(const p of s){const x=a[p];await new Promise((N,w)=>{const S=u.transaction([Te],"readwrite").objectStore(Te).add(x);S.onsuccess=()=>N(),S.onerror=()=>{console.error(`Error migrating save ${p}:`,S.error),N()}})}localStorage.removeItem(e),console.log(`Migrated ${s.length} saves from localStorage to IndexedDB`)}catch(n){console.error("Error during migration:",n)}},fo=async()=>{try{await gt(),await mo()}catch(e){console.error("Failed to initialize save system:",e)}},Mr="industrialist_custom_products",kr="industrialist_custom_machines",Tr="industrialist_custom_recipes",ho=(e,n,a)=>{localStorage.getItem(Mr)||localStorage.setItem(Mr,JSON.stringify(e)),localStorage.getItem(kr)||localStorage.setItem(kr,JSON.stringify(n)),localStorage.getItem(Tr)||localStorage.setItem(Tr,JSON.stringify(a))},go=()=>{try{const e=localStorage.getItem(Mr);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading custom products:",e),[]}},xo=()=>{try{const e=localStorage.getItem(kr);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading custom machines:",e),[]}},yo=()=>{try{const e=localStorage.getItem(Tr);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading custom recipes:",e),[]}},bo=e=>{try{return localStorage.setItem(Mr,JSON.stringify(e)),!0}catch(n){return console.error("Error saving custom products:",n),!1}},vo=e=>{try{return localStorage.setItem(kr,JSON.stringify(e)),!0}catch(n){return console.error("Error saving custom machines:",n),!1}},_o=e=>{try{return localStorage.setItem(Tr,JSON.stringify(e)),!0}catch(n){return console.error("Error saving custom recipes:",n),!1}},Co=e=>bo(e),So=e=>vo(e),jo=e=>_o(e),gr=e=>typeof e=="number"?Math.round(e*1e4)/1e4:e,St=e=>typeof e!="number"?e:e>=1e9?gr(e/1e9)+"B":e>=1e6?gr(e/1e6)+"M":e>=1e3?gr(e/1e3)+"k":gr(e),wo=e=>e>=1e6?`${(e/1e6).toFixed(2)} MMF/s`:e>=1e3?`${(e/1e3).toFixed(2)} kMF/s`:`${e.toFixed(2)} MF/s`,Po=e=>{const n=["p_coal","p_coke_fuel","p_planks","p_oak_log"],a=["r_industrial_firebox_01","r_industrial_firebox_02","r_industrial_firebox_03","r_industrial_firebox_04","r_industrial_firebox_05","r_industrial_firebox_06"];return at.filter(u=>{if(["r_mineshaft_drill_01","r_logic_assembler_01"].includes(u.id))return!1;const f=["r_liquid_dump","r_liquid_burner"].includes(u.id),p=u.id==="r_underground_waste_facility"&&["p_concrete_block","p_lead_ingot"].includes(e);if(f||u.id==="r_underground_waste_facility"&&!p)return!1;const x=u.inputs.some(w=>w.product_id===e&&w.product_id!=="p_variableproduct"),N=n.includes(e)&&a.includes(u.id)&&u.inputs.some(w=>w.product_id==="p_variableproduct");return x||N||p})},Mo=e=>at.filter(n=>!["r_mineshaft_drill_01","r_logic_assembler_01"].includes(n.id)&&n.outputs.some(a=>a.product_id===e&&a.product_id!=="p_variableproduct")),xr=e=>{const n=at.filter(a=>a.machine_id===e);return e==="m_underground_waste_facility"?[Wr]:e==="m_liquid_dump"?[Vr]:e==="m_liquid_burner"?[Ur]:n},Xn=(e,n,a,s,u=Yn)=>{const f=(s==null?void 0:s.minSteamTemp)||100;return e.map(p=>{if(a){if(p.product_id==="p_steam"){const x=Math.max(n,u),N=p.originalQuantity!==void 0?p.originalQuantity:p.quantity;return x<f?{...p,temperature:x,quantity:0,originalQuantity:N}:{...p,temperature:x,quantity:N,originalQuantity:N}}return p}if(Qn(p.product_id)){const x=Math.max(n,u);return{...p,temperature:x}}return p})},Vt=(e,n)=>{let a={...e};const s=mt[n];if(s){const f=ki(n),p=s.type==="boiler",x=p?jt:Yn,N=p?{...f,coolantTemp:jt}:f;let w=null;if(s.type==="product_dependent"&&e.inputs){const S=e.inputs.find(H=>["p_water","p_filtered_water","p_distilled_water"].includes(H.product_id));w=(S==null?void 0:S.product_id)||null}const L=en(n,N,x,w,p?jt:null),b=Xn(e.outputs,L,p,s,x);a={...a,outputs:b,temperatureSettings:N}}if(wt(n)){const f=Dt[n];(f==null?void 0:f.type)==="steam_input"&&(a={...a,tempDependentInputTemp:ft})}return a},ko=(e,n,a,s,u,f,p)=>{if(!a||!n)return 1;const x=n.data.recipe,N=n.data.machineCount||0,w=ge(x.machine_id);let L=x.cycle_time;if((typeof L!="number"||L<=0)&&(L=1),w&&wt(w.id)){const I=Dt[w.id];if((I==null?void 0:I.type)==="steam_input"&&(w.id!=="m_steam_cracking_plant"||Rt(x))){const v=x.tempDependentInputTemp??ft;L=Ft(w.id,v,L)}}const b=Zn(e,a,null,u,f,s);let S=b.cycle_time;(typeof S!="number"||S<=0)&&(S=1);const H=ge(b.machine_id);if(H&&wt(H.id)){const I=Dt[H.id];if((I==null?void 0:I.type)==="steam_input"&&(H.id!=="m_steam_cracking_plant"||Rt(b))){const v=b.tempDependentInputTemp??ft;S=Ft(H.id,v,S)}}let P=0,A=!1;if(p&&p.byNode&&p.byNode[n.id]){const I=p.byNode[n.id];if(a.isOutput){const v=I.outputFlows[a.outputIndex];if(v){A=!0;const W=v.produced-v.connected;P=Math.max(0,W)}}else{const v=I.inputFlows[a.inputIndex];if(v){A=!0;const W=v.needed-v.connected;P=Math.max(0,W)}}}if(A&&P===0)return 0;if(!A)if(a.isOutput){const I=x.outputs[a.outputIndex];if(I){const v=I.originalQuantity!==void 0?I.originalQuantity:I.quantity;typeof v=="number"&&(P=v/L*N)}}else{const I=x.inputs[a.inputIndex];I&&typeof I.quantity=="number"&&(P=I.quantity/L*N)}if(a.isOutput){const I=b.inputs.find(v=>v.product_id===a.productId);if(I&&typeof I.quantity=="number"&&I.quantity>0){const v=I.quantity/S;return P/v}}else{const I=b.outputs.find(v=>v.product_id===a.productId);if(I){const v=I.originalQuantity!==void 0?I.originalQuantity:I.quantity;if(typeof v=="number"&&v>0){const W=v/S;return P/W}}}return 1},Zn=(e,n,a,s,u,f)=>{var N,w,L,b,S,H,P,A,I,v,W,K;let p={...e};const x=ge(e.machine_id);if(!ea(p))return p;if((x==null?void 0:x.id)==="m_industrial_firebox"&&Gn(e.id)){const B=["p_coal","p_coke_fuel","p_planks","p_oak_log"];let O=((N=s==null?void 0:s.fireboxConfig)==null?void 0:N.fuel)||"p_coke_fuel";const z=(n==null?void 0:n.productId)||(a==null?void 0:a.id);z&&B.includes(z)&&(O=z);const G=zr(e.id,O);return G&&(p={...p,inputs:qr(e.inputs,O,e.id),fireboxSettings:{fuel:O},cycle_time:G.cycleTime,power_consumption:0}),p}if(e.isMineshaftDrill||e.id==="r_mineshaft_drill"){const B=((w=s==null?void 0:s.drillConfig)==null?void 0:w.drillHead)||"steel",O=((L=s==null?void 0:s.drillConfig)==null?void 0:L.consumable)||"hydrochloric_acid",z=((b=s==null?void 0:s.drillConfig)==null?void 0:b.machineOil)!==void 0?s.drillConfig.machineOil:!0,G=["p_copper_drill_head","p_iron_drill_head","p_steel_drill_head","p_tungsten_carbide_drill_head"],D={p_copper_drill_head:"copper",p_iron_drill_head:"iron",p_steel_drill_head:"steel",p_tungsten_carbide_drill_head:"tungsten_carbide"};let V=B,te=100;const re=(n==null?void 0:n.productId)||(a==null?void 0:a.id);if(re)if(G.includes(re))V=D[re];else if(n!=null&&n.isOutput)te=100;else{const ae=f(re,V,O,z);ae&&(te=ae)}const ne=Kn(V,O,z,te),ce=Jn(V,O,z,te),k=Gt(V,O,z,te);return p={...p,inputs:ne.length>0?ne:[{product_id:"p_variableproduct",quantity:"Variable"}],outputs:ce.length>0?ce:[{product_id:"p_variableproduct",quantity:"Variable"}],drillSettings:{drillHead:V,consumable:O,machineOil:z,depth:te},cycle_time:1,power_consumption:k?{max:k.drillingPower*1e6,average:(k.drillingPower*k.lifeTime+k.idlePower*(k.replacementTime+k.travelTime))/k.totalCycleTime*1e6}:"Variable",pollution:k?k.pollution:"Variable"},p}if(e.isLogicAssembler||e.id==="r_logic_assembler"){const B=((S=s==null?void 0:s.assemblerConfig)==null?void 0:S.outerStage)||1,O=((H=s==null?void 0:s.assemblerConfig)==null?void 0:H.innerStage)||2,z=((P=s==null?void 0:s.assemblerConfig)==null?void 0:P.machineOil)!==void 0?s.assemblerConfig.machineOil:!0,G=((A=s==null?void 0:s.assemblerConfig)==null?void 0:A.tickCircuitDelay)||0;let D=B===1?`p_${O}x_microchip`:`p_${B}x${O}x_microchip`;const V=(n==null?void 0:n.productId)||(a==null?void 0:a.id);V&&V.includes("microchip")&&(D=V);const te=Vn(D,z),re=Un(D,z),ne=Zr(D,z,G),ce=D.match(/p_(?:(\d+)x)?(\d+)x_microchip/),k=ce&&ce[1]?parseInt(ce[1]):1,ae=ce?parseInt(ce[2]):O;return p={...p,inputs:te.length>0?te:[{product_id:"p_logic_plate",quantity:"Variable"},{product_id:"p_copper_wire",quantity:"Variable"},{product_id:"p_semiconductor",quantity:"Variable"},{product_id:"p_gold_wire",quantity:"Variable"}],outputs:re.length>0?re:[{product_id:"p_variableproduct",quantity:"Variable"}],assemblerSettings:{outerStage:k,innerStage:ae,machineOil:z,tickCircuitDelay:G},cycle_time:ne?ne.cycleTime:"Variable",power_consumption:ne?{max:ne.maxPowerConsumption,average:ne.avgPowerConsumption}:"Variable"},p}if(e.isTreeFarm||e.id==="r_tree_farm"){const B=((I=s==null?void 0:s.treeFarmConfig)==null?void 0:I.trees)||450,O=((v=s==null?void 0:s.treeFarmConfig)==null?void 0:v.harvesters)||20,z=((W=s==null?void 0:s.treeFarmConfig)==null?void 0:W.sprinklers)||24,G=((K=s==null?void 0:s.treeFarmConfig)==null?void 0:K.outputs)||8,D=1,V=Wn(z),te=Xr(B,O,u),re=jr(B,O,z,G,D,u);return p={...p,inputs:V.length>0?V:[{product_id:"p_water",quantity:"Variable"}],outputs:te.length>0?te:[{product_id:"p_oak_log",quantity:"Variable"}],treeFarmSettings:{trees:B,harvesters:O,sprinklers:z,outputs:G,controller:D},cycle_time:1,power_consumption:re?re.avgPowerConsumption:"Variable",pollution:0},p}if(e.isWasteFacility||e.id==="r_underground_waste_facility"){let B="p_any_item",O="p_any_fluid";const z=(n==null?void 0:n.productId)||(a==null?void 0:a.id);if(z)if(z==="p_concrete_block"||z==="p_lead_ingot")B="p_fission_byproducts",O="p_depleted_uf6_waste";else{const V=Me(z);(V==null?void 0:V.type)==="item"?(B=z,O="p_any_fluid"):(V==null?void 0:V.type)==="fluid"&&(B="p_any_item",O=z)}else B="p_fission_byproducts",O="p_depleted_uf6_waste";const G=Sr(0,0,B,O),D=br(0,0);return p={...p,inputs:G,outputs:[],wasteFacilitySettings:{itemProductId:B,fluidProductId:O,itemFlowRate:0,fluidFlowRate:0},cycle_time:D.cycleTime,power_consumption:1e6,pollution:0},p}if(e.isLiquidDump||e.id==="r_liquid_dump"){let B=["p_water","p_residue"];const O=(n==null?void 0:n.productId)||(a==null?void 0:a.id);if(O){const D=Me(O);(D==null?void 0:D.type)==="fluid"&&(B=[O,O])}const z=Hr(B),G=Kt(z);return p={...p,inputs:z,outputs:[],liquidDumpSettings:{fluidProductIds:B},cycle_time:1,power_consumption:0,pollution:G},p}if(e.isLiquidBurner||e.id==="r_liquid_burner"){let B=["p_water","p_filtered_water","p_distilled_water","p_steam","p_oxygen","p_hydrogen","p_residue","p_depleted_uf6_waste"];const O=(n==null?void 0:n.productId)||(a==null?void 0:a.id);if(O){const D=Me(O);(D==null?void 0:D.type)==="fluid"&&(B=Array(8).fill(O))}const z=Ar(B),G=Ut(z);return p={...p,inputs:z,outputs:[],liquidBurnerSettings:{fluidProductIds:B},cycle_time:1,power_consumption:0,pollution:G},p}return p},To=e=>e==="r_mineshaft_drill"?["p_copper_drill_head","p_iron_drill_head","p_steel_drill_head","p_tungsten_carbide_drill_head","p_water","p_acetic_acid","p_hydrochloric_acid","p_sulfuric_acid","p_machine_oil"]:e==="r_logic_assembler"?["p_logic_plate","p_copper_wire","p_semiconductor","p_gold_wire","p_machine_oil"]:e==="r_tree_farm"?["p_water"]:["r_industrial_firebox_01","r_industrial_firebox_02","r_industrial_firebox_03","r_industrial_firebox_04","r_industrial_firebox_05","r_industrial_firebox_06"].includes(e)?["p_coal","p_coke_fuel","p_planks","p_oak_log"]:e==="r_underground_waste_facility"?["p_any_item","p_any_fluid","p_concrete_blocks","p_lead_ingot"]:e==="r_liquid_dump"||e==="r_liquid_burner"?["p_any_fluid"]:[],No=e=>{if(e==="r_mineshaft_drill"){const n=new Set;return Object.values(Kr).forEach(a=>{a.forEach(s=>n.add(s.product_id))}),Array.from(n)}return e==="r_logic_assembler"?bi.map(n=>n.productId):e==="r_tree_farm"?["p_oak_log"]:[]},ea=e=>e.isMineshaftDrill||e.id==="r_mineshaft_drill"||e.isLogicAssembler||e.id==="r_logic_assembler"||e.isTreeFarm||e.id==="r_tree_farm"||e.isWasteFacility||e.id==="r_underground_waste_facility"||e.isLiquidDump||e.id==="r_liquid_dump"||e.isLiquidBurner||e.id==="r_liquid_burner"||e.machine_id==="m_industrial_firebox"&&Gn(e.id),$n=1e-6,Io=(e,n,a,s,u,f=null)=>{if(n<$n)return new Map([[e,a]]);const p=a/n,x=new Map;x.set(e,a);const N=new Map;N.set(e,p);const w=new Set([e]),L=[e];for(;L.length>0;){const P=L.shift(),A=s.nodes[P];A&&(A.outputs.forEach(I=>{var W;(((W=s.products[I.productId])==null?void 0:W.connections.filter(K=>K.sourceNodeId===P))||[]).forEach(K=>{w.has(K.targetNodeId)||(w.add(K.targetNodeId),L.push(K.targetNodeId))})}),A.inputs.forEach(I=>{var W;(((W=s.products[I.productId])==null?void 0:W.connections.filter(K=>K.targetNodeId===P))||[]).forEach(K=>{w.has(K.sourceNodeId)||(w.add(K.sourceNodeId),L.push(K.sourceNodeId))})}))}const b=10;let S=0,H=!0;for(;H&&S<b;)H=!1,S++,w.forEach(P=>{var G;if(P===e)return;const A=s.nodes[P];if(!A)return;const I=(G=f==null?void 0:f.find(D=>D.id===P))==null?void 0:G.data,v=(I==null?void 0:I.machineCountMode)||A.machineCountMode||"free";if(v==="locked")return;const W=A.machineCount||0;if(W<$n)return;const K=[],B=[];if(A.outputs.forEach((D,V)=>{var re;(((re=s.products[D.productId])==null?void 0:re.connections.filter(ne=>ne.sourceNodeId===P&&ne.sourceOutputIndex===V))||[]).forEach(ne=>{const ce=N.get(ne.targetNodeId);ce!==void 0&&(K.push(ce),B.push({type:"output",productId:D.productId,targetNodeId:ne.targetNodeId,ratio:ce}))})}),A.inputs.forEach((D,V)=>{var re;(((re=s.products[D.productId])==null?void 0:re.connections.filter(ne=>ne.targetNodeId===P&&ne.targetInputIndex===V))||[]).forEach(ne=>{const ce=N.get(ne.sourceNodeId);ce!==void 0&&(K.push(ce),B.push({type:"input",productId:D.productId,sourceNodeId:ne.sourceNodeId,ratio:ce}))})}),K.length===0)return;const O=Math.max(...K),z=N.get(P)||1;if(Math.abs(O-z)>1e-4){N.set(P,O);let D=W*O;if(v==="capped"){const V=(I==null?void 0:I.cappedMachineCount)||A.cappedMachineCount;typeof V=="number"&&(D=Math.min(D,V))}x.set(P,D),H=!0}});return x},Qr=44,ta=8,Yr=120,Cr=380,Fo=new Ei,ra=e=>{var f,p,x;const n=(f=e.data)==null?void 0:f.recipe;if(!n)return Yr+100;const a=Math.max(((p=n.inputs)==null?void 0:p.length)||0,((x=n.outputs)==null?void 0:x.length)||0,1),u=a*Qr+(a-1)*ta+24;return Yr+u+12},An=e=>Yr+12+e*(Qr+ta)+Qr/2,Eo=(e,n)=>{const a=new Map;e.forEach(f=>a.set(f.id,new Set)),n.forEach(f=>{a.has(f.source)&&a.has(f.target)&&(a.get(f.source).add(f.target),a.get(f.target).add(f.source))});const s=new Set,u=[];return e.forEach(f=>{var N;if(s.has(f.id))return;const p=new Set,x=[f.id];for(;x.length>0;){const w=x.pop();s.has(w)||(s.add(w),p.add(w),(N=a.get(w))==null||N.forEach(L=>{s.has(L)||x.push(L)}))}u.push(p)}),u},Do=async(e,n,a={})=>{const s=a.edgePath||"orthogonal",u=s==="straight"?"POLYLINE":"ORTHOGONAL",f=s==="straight"?"260":"200",p=e.map(b=>{var K,B,O;const S=Cr,H=ra(b),P=(K=b.data)==null?void 0:K.recipe,A=((B=P==null?void 0:P.inputs)==null?void 0:B.length)||0,I=((O=P==null?void 0:P.outputs)==null?void 0:O.length)||0,v=Array.from({length:A},(z,G)=>({id:`${b.id}__left-${G}`,properties:{"port.side":"WEST","port.index":G},x:0,y:An(G)})),W=Array.from({length:I},(z,G)=>({id:`${b.id}__right-${G}`,properties:{"port.side":"EAST","port.index":G},x:S,y:An(G)}));return{id:b.id,width:S,height:H,ports:[...v,...W],properties:{portConstraints:"FIXED_POS"}}}),x=new Map;e.forEach((b,S)=>x.set(b.id,S));const N=n.map(b=>{const S=x.get(b.source)??0,H=x.get(b.target)??0;return{id:b.id,sources:[`${b.source}__${b.sourceHandle||"right-0"}`],targets:[`${b.target}__${b.targetHandle||"left-0"}`],properties:H<=S?{"elk.layered.feedbackEdge":"true"}:{}}}),w={id:"root",properties:{algorithm:"layered","elk.direction":"RIGHT","elk.edgeRouting":u,"elk.layered.crossingMinimization.strategy":"LAYER_SWEEP","elk.layered.nodePlacement.strategy":"BRANDES_KOEPF","elk.layered.spacing.nodeNodeBetweenLayers":f,"elk.spacing.nodeNode":f,"elk.layered.spacing.edgeNodeBetweenLayers":"100","elk.layered.spacing.edgeEdgeBetweenLayers":s==="straight"?"40":"20","elk.spacing.edgeNode":s==="orthogonal"?"80":"20","elk.layered.feedbackEdges":"true","elk.padding":"[top=120, left=120, bottom=120, right=120]"},children:p,edges:N},L=await Fo.layout(w);return{children:L.children||[],edges:L.edges||[]}},Ro=e=>{var N;const n=[...e].sort((w,L)=>L.bounds.width-w.bounds.width),a=200,s=Math.max(3e3,(((N=n[0])==null?void 0:N.bounds.width)||0)+a*2),u=new Map;let f=0,p=0,x=0;return n.forEach((w,L)=>{f>0&&f+w.bounds.width>s&&(p+=x+a,f=0,x=0),u.set(L,{offsetX:f,offsetY:p}),f+=w.bounds.width+a,x=Math.max(x,w.bounds.height)}),{sorted:n,positions:u}},Bo=async(e,n,a={})=>{if(!e||e.length===0)return{nodes:e,edges:n};const s=a.edgePath||"orthogonal",u=Eo(e,n),f=new Map(e.map(P=>[P.id,P])),p=new Map(n.map(P=>[P.id,P])),x=await Promise.all(u.map(async P=>{const A=[...P].map(v=>f.get(v)),I=n.filter(v=>P.has(v.source)&&P.has(v.target));try{const{children:v,edges:W}=await Do(A,I,a);let K=1/0,B=1/0,O=-1/0,z=-1/0;return v.forEach(G=>{K=Math.min(K,G.x),B=Math.min(B,G.y),O=Math.max(O,G.x+G.width),z=Math.max(z,G.y+G.height)}),{layoutedChildren:v,layoutedEdges:W,bounds:{x:K,y:B,width:O-K,height:z-B}}}catch(v){return console.error("ELK layout failed for component:",v),{layoutedChildren:A.map(W=>({id:W.id,x:W.position.x,y:W.position.y,width:Cr,height:ra(W)})),layoutedEdges:[],bounds:{x:0,y:0,width:Cr,height:200}}}})),{sorted:N,positions:w}=Ro(x),L=new Map;N.forEach((P,A)=>{const{offsetX:I,offsetY:v}=w.get(A);P.layoutedChildren.forEach(W=>{L.set(W.id,{x:W.x-P.bounds.x+I,y:W.y-P.bounds.y+v})})});const b=new Map;N.forEach((P,A)=>{const{offsetX:I,offsetY:v}=w.get(A),W=B=>B-P.bounds.x+I,K=B=>B-P.bounds.y+v;P.layoutedEdges.forEach(B=>{var z;const O=p.get(B.id);if(O){if(s==="bezier"){b.set(B.id,{bezierPoints:[],orthoMidX:void 0,orthoMidY:void 0});return}if(s==="orthogonal"){const G=(z=B.sections)==null?void 0:z[0];if(!G)return;const D=(G.bendPoints||[]).map(k=>({x:W(k.x),y:K(k.y)}));if(D.length===0)return;const V=L.get(O.source),te=L.get(O.target);if(!V||!te)return;const re=V.x+Cr;if(te.x<=re+60){const k=D.slice(1,-1);if(k.length>0){const ae=k.reduce((ee,de)=>ee+de.y,0)/k.length;b.set(B.id,{orthoMidY:ae,orthoMidX:void 0})}}else{const k=D.reduce((ae,ee)=>ae+ee.x,0)/D.length;b.set(B.id,{orthoMidX:k,orthoMidY:void 0})}}}})});const S=e.map(P=>{const A=L.get(P.id);return A?{...P,position:A}:P}),H=n.map(P=>{const A=b.get(P.id);return A?{...P,data:{...P.data,...A}}:P});return{nodes:S,edges:H}},Lo=ht.lazy(()=>Xt(()=>import("./HelpModal-aQHrwfcs.js"),__vite__mapDeps([0,1,2]))),Oo=ht.lazy(()=>Xt(()=>import("./SaveManager-Bv9lZya9.js"),__vite__mapDeps([3,1,4,5,6,7,8]))),$o=ht.lazy(()=>Xt(()=>import("./DataManager-0Iv2IVSX.js"),__vite__mapDeps([9,1,4,5,6,7,8]))),Ao=ht.lazy(()=>Xt(()=>import("./ComputeModal-BAdoJ3BY.js"),__vite__mapDeps([2,1]))),Ho=ht.lazy(()=>Xt(()=>import("./RecipesModal-DWPUIT9e.js"),__vite__mapDeps([10,1,6,7,4,5,8]))),Hn=()=>t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",background:"var(--bg-secondary)",border:"2px solid var(--border-primary)",borderRadius:"var(--radius-lg)",padding:"40px 60px",boxShadow:"var(--shadow-lg)"},children:[t.jsxs("svg",{width:"52",height:"52",style:{animation:"lp-spin 1.1s linear infinite"},viewBox:"0 0 52 52",children:[t.jsx("style",{children:"@keyframes lp-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"}),Array.from({length:10}).map((e,n)=>{const a=n/10*2*Math.PI-Math.PI/2,s=26+20*Math.cos(a),u=26+20*Math.sin(a);return t.jsx("circle",{cx:s,cy:u,r:1+n/9*1.75,fill:"var(--color-primary)",opacity:.2+n/9*.8},n)})]}),t.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"var(--font-size-sm)"},children:"Loading..."})]})}),zo={custom:eo},qo={custom:io},yr=e=>typeof e=="number"?e.toFixed(4):"0",zn=({productName:e,connectedFlow:n,currentExcess:a,onTargetExcessCommit:s,styleType:u})=>{const[f,p]=m.useState(""),[x,N]=m.useState(!1),w=x?f:yr(a),L=()=>{if(!x)return;const A=parseFloat(f);isNaN(A)||s(A),N(!1),p("")},b=u==="input",S=b?"var(--input-bg)":"var(--output-bg)",H=b?"var(--input-border)":"var(--output-border)",P=b?"var(--input-text)":"var(--output-text)";return t.jsxs("div",{style:{marginBottom:"10px",padding:"8px",background:S,border:`1px solid ${H}`,borderRadius:"var(--radius-sm)"},children:[t.jsx("div",{style:{color:P,fontSize:"12px",marginBottom:"6px",fontWeight:600},children:e}),t.jsxs("div",{style:{fontSize:"11px",color:"var(--text-muted)",marginBottom:"6px"},children:["Connected: ",yr(n),"/s"]}),t.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)",marginBottom:"6px"},children:[b?"Current Deficiency:":"Current Excess:"," ",yr(Math.abs(a)),"/s"]}),t.jsx("div",{style:{fontSize:"10px",color:"var(--text-muted)",marginBottom:"4px"},children:b?"Target Additional Demand:":"Target Excess:"}),t.jsx("input",{type:"text",value:w,onFocus:()=>{N(!0),p(yr(a))},onChange:A=>p(A.target.value),onBlur:L,onKeyPress:A=>A.key==="Enter"&&L(),className:"input",style:{padding:"6px",fontSize:"13px",width:"100%"}}),t.jsx("div",{style:{color:"var(--text-muted)",fontSize:"10px",marginTop:"4px",textAlign:"right"},children:"/s"})]})},qn=e=>{if(e<0)return 0;const n=1+5429*e/7322;return Math.pow(Math.log(n),1.1)};function Wo(){const[e,n,a]=si([]),[s,u,f]=li([]),[p,x]=m.useState(0),[N,w]=m.useState(!1),[L,b]=m.useState(!1),[S,H]=m.useState(null),[P,A]=m.useState(null),[I,v]=m.useState("product"),[W,K]=m.useState("button"),[B,O]=m.useState(""),[z,G]=m.useState("name_asc"),[D,V]=m.useState("all"),[te,re]=m.useState("all"),[ne,ce]=m.useState("all"),[k,ae]=m.useState(null),[ee,de]=m.useState([]),[Pt,it]=m.useState(!1),[Xe,Fe]=m.useState(!1),[Ae,He]=m.useState("targets"),[ue,Ce]=m.useState(0),[ot,J]=m.useState(!1),[Q,Y]=m.useState(null),[xe,me]=m.useState(""),[se,Ee]=m.useState(null),[le,fe]=m.useState("free"),[ve,be]=m.useState(!1),[Se,je]=m.useState(!1),[Mt,Bt]=m.useState(!1),[Zt,er]=m.useState(!1),[rn,tr]=m.useState(!1),[dt,Lt]=m.useState(!1),[ye,Ot]=m.useState(()=>{const r=_r();return{edgePath:r.edgePath||"orthogonal",edgeStyle:r.edgeStyle||"animated"}}),[ut,nn]=m.useState(!1),[Ze,rr]=m.useState(!1),[ie,nr]=m.useState(!1),[Ne,$t]=m.useState("pan"),[y,pe]=m.useState(0),[xt,ar]=m.useState(!1);m.useEffect(()=>{ie&&Ze&&dt&&Lt(!1)},[ie,Ze,dt]);const[kt,ir]=m.useState(!0),[At,Ie]=m.useState(1),[Be,De]=m.useState({}),[we,na]=m.useState("perSecond"),[ke,aa]=m.useState("total"),[et,pt]=m.useState([]),[ze,Le]=m.useState(null),[qe,Oe]=m.useState(null),[We,$e]=m.useState(null),[Ve,Ue]=m.useState(null),[Tt,tt]=m.useState(null),[Nr,an]=m.useState({}),[Ke,Ir]=m.useState(null),[Vo,Uo]=m.useState({}),[ia,oa]=m.useState("all"),[Fr,sa]=m.useState(["Deficiencies","Model Count","Excesses","Pollution","Power","Cost"]),[Er,la]=m.useState([]),[on,ca]=m.useState({x:0,y:0}),[yt,bt]=m.useState(null),Ht=m.useRef(null),st=m.useRef(null),da=m.useRef(null),Nt=m.useRef(null),ua=getComputedStyle(document.documentElement).getPropertyValue("--color-primary").trim().toLowerCase()==="#5fb573"?"Plant Statistics":"Plan Statistics",Dr=m.useRef(null),or=m.useRef([]),pa=m.useCallback(r=>{const o=r.filter(l=>l.type!=="remove"),c=o.filter(l=>l.type==="position"),i=o.filter(l=>l.type!=="position");c.length>0&&a(c),i.length>0&&(or.current.push(...i),Dr.current&&clearTimeout(Dr.current),Dr.current=setTimeout(()=>{or.current.length>0&&(a(or.current),or.current=[])},50))},[a]),ma=m.useCallback(r=>{f(r)},[f]);m.useEffect(()=>{const r=_r();Pr(r),Ot({edgePath:r.edgePath||"orthogonal",edgeStyle:r.edgeStyle||"animated"}),ho(Ye,nt,at);const o=()=>{const l="ontouchstart"in window||navigator.maxTouchPoints>0,d=window.matchMedia("(pointer: coarse)").matches,h=window.matchMedia("(hover: none)").matches,g=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);nr(l&&d||l&&h||g)};o(),window.addEventListener("resize",o);const c=window.matchMedia("(pointer: coarse)"),i=window.matchMedia("(hover: none)");return c.addEventListener("change",o),i.addEventListener("change",o),()=>{window.removeEventListener("resize",o),c.removeEventListener("change",o),i.removeEventListener("change",o)}},[]);const Je=m.useCallback(()=>({onInputClick:va,onOutputClick:_a,isMobile:ie,mobileActionMode:Ne,onDrillSettingsChange:Ca,onLogicAssemblerSettingsChange:Sa,onTreeFarmSettingsChange:ja,onIndustrialFireboxSettingsChange:wa,onTemperatureSettingsChange:Pa,onBoilerSettingsChange:Ma,onChemicalPlantSettingsChange:Ta,onWasteFacilitySettingsChange:Na,onLiquidDumpSettingsChange:Ia,onLiquidBurnerSettingsChange:Fa,onMiddleClick:La,onHandleDoubleClick:ka,onMachineCountModeChange:Ha}),[ie,Ne]);m.useEffect(()=>{fo().catch(i=>{console.error("Failed to initialize save system:",i)});const r=vi();if(!(r!=null&&r.nodes))return;const o=Je(),c=r.nodes.map(i=>{var h,g,j,T;const l=ge((g=(h=i.data)==null?void 0:h.recipe)==null?void 0:g.machine_id);let d=(j=i.data)==null?void 0:j.recipe;return l&&d&&!((T=d.outputs)!=null&&T.some(F=>F.temperature!==void 0))&&(d=Vt(d,l.id)),{...i,data:{...i.data,recipe:d,machine:l,machineCount:i.data.machineCount??1,displayMode:we,machineDisplayMode:ke,...o,globalPollution:y,flows:null,suggestions:[]}}});n(c),u((r.edges||[]).map(i=>{const{edgePath:l,edgeStyle:d,...h}=i.data||{};return{...i,data:{...h,...ye}}})),de(r.targetProducts||[]),De(r.soldProducts||{}),pt(r.favoriteRecipes||[]),Le(r.lastDrillConfig||null),Oe(r.lastAssemblerConfig||null),$e(r.lastTreeFarmConfig||null),Ue(r.lastFireboxConfig||null),tt(r.lastWasteFacilityConfig||null),x(r.nodeId||0),Ce(r.targetIdCounter||0)},[]),m.useEffect(()=>{n(r=>{let o=!1;const c=r.map(i=>i.data.displayMode===we&&i.data.machineDisplayMode===ke&&i.data.zoomLevel===At?i:(o=!0,{...i,data:{...i.data,displayMode:we,machineDisplayMode:ke,zoomLevel:At}}));return o?c:r})},[we,ke,At,n]),m.useEffect(()=>{u(r=>{let o=!1;const c=r.map(i=>{var l,d;return((l=i.data)==null?void 0:l.edgePath)===ye.edgePath&&((d=i.data)==null?void 0:d.edgeStyle)===ye.edgeStyle?i:(o=!0,{...i,data:ye})});return o?c:r})},[ye,u]);const vt=m.useCallback(r=>({id:r.id,type:r.type,position:r.position,sourcePosition:r.sourcePosition,targetPosition:r.targetPosition,data:{recipe:r.data.recipe,machineCount:r.data.machineCount,machineCountMode:r.data.machineCountMode,cappedMachineCount:r.data.cappedMachineCount,isTarget:r.data.isTarget,leftHandles:r.data.leftHandles,rightHandles:r.data.rightHandles}}),[]);m.useEffect(()=>{const r={nodes:e.map(vt),edges:s,targetProducts:ee,nodeId:p,targetIdCounter:ue,soldProducts:Be,favoriteRecipes:et,lastDrillConfig:ze,lastAssemblerConfig:qe,lastTreeFarmConfig:We,lastFireboxConfig:Ve,lastWasteFacilityConfig:Tt};localStorage.setItem("industrialist_canvas_state",JSON.stringify(r))},[e,s,ee,p,ue,Be,et,ze,qe,We,Ve,Tt,vt]);const fa=m.useCallback(()=>{var l,d;let r=0,o=0,c=0;const i=e.length;for(let h=0;h<i;h++){const g=e[h],{recipe:j,machine:T,machineCount:F=0}=g.data||{};if(!j)continue;const _=typeof j.pollution=="number"?j.pollution:parseFloat(j.pollution);!isNaN(_)&&isFinite(_)&&(o+=_*F);const R=(((l=j.inputs)==null?void 0:l.length)||0)+(((d=j.outputs)==null?void 0:d.length)||0),E=Math.ceil(F);if((T==null?void 0:T.id)==="m_industrial_firebox"){c+=E*(1+R*2);continue}if((T==null?void 0:T.id)==="m_tree_farm"&&j.treeFarmSettings){const{trees:$,harvesters:Z,sprinklers:oe,controller:_e,outputs:he}=j.treeFarmSettings,Ge=typeof j.power_consumption=="number"?j.power_consumption:0;r+=Ge*F;const Re=Math.ceil(oe/3),Pe=j.power_type==="HV"?2:Math.ceil(Ge/15e5)*2,zt=$+Z+oe+Re*3+_e+he*3+Pe;c+=E*zt;continue}const C=j.power_consumption;let M=0;typeof C=="number"?(M=C,r+=C*F):typeof C=="object"&&C!==null&&"max"in C&&(M=C.max,r+=M*F);const q=j.power_type==="HV"?2:Math.ceil(M/15e5)*2;c+=E*(1+q+R*2)}return{totalPower:r,totalPollution:o,totalModelCount:c}},[e]),_t=m.useMemo(()=>fa(),[e]);m.useEffect(()=>{if(kt||_t.totalPollution===0)return;const r=setInterval(()=>{if(xt)return;const o=_t.totalPollution/3600;pe(c=>{if(typeof c!="number"||isNaN(c)||!isFinite(c))return c;const i=parseFloat((c+o).toFixed(4));return i!==c?i:c})},1e3);return()=>clearInterval(r)},[_t.totalPollution,xt,kt]),m.useEffect(()=>{const r=setInterval(Qe,2e4);return()=>clearInterval(r)},[]);const sr=m.useRef(null),sn=m.useRef(y);m.useEffect(()=>{if(!(Math.abs(y-sn.current)<.01))return sn.current=y,sr.current&&clearTimeout(sr.current),sr.current=setTimeout(()=>{n(r=>{let o=!1;const c=r.map(i=>{const{recipe:l,machine:d,globalPollution:h}=i.data||{};if(l!=null&&l.isTreeFarm&&l.treeFarmSettings){const{trees:g,harvesters:j,sprinklers:T,outputs:F,controller:_}=l.treeFarmSettings,R=Xr(g,j,y),E=jr(g,j,T,F,_,y);return o=!0,{...i,data:{...i.data,recipe:{...l,outputs:R,power_consumption:E?E.avgPowerConsumption:"Variable"},globalPollution:y}}}if((d==null?void 0:d.id)==="m_air_separation_unit"){const g=qn(y),j=l.outputs.map(T=>T.product_id==="p_residue"?{...T,quantity:parseFloat(g.toFixed(6))}:T);return o=!0,{...i,data:{...i.data,recipe:{...l,outputs:j},globalPollution:y}}}return h!==y?(o=!0,{...i,data:{...i.data,globalPollution:y}}):i});return o?c:r})},250),()=>clearTimeout(sr.current)},[y,n]);const[X,ha]=m.useState(()=>Nn([],[],{skipTemperature:!0})),lr=m.useRef(null),ln=m.useRef(""),Rr=m.useRef(!1),Br=m.useRef(null),U=m.useCallback((r="general")=>{Br.current=r,Rr.current=!0},[]);m.useEffect(()=>{if(Rr.current)return lr.current&&clearTimeout(lr.current),lr.current=setTimeout(()=>{const r=`${e.length}-${s.length}-${e.map(o=>{var c,i,l,d,h,g,j,T,F,_,R,E,C;return`${o.id}:${(c=o.data)==null?void 0:c.machineCount}:${JSON.stringify(((l=(i=o.data)==null?void 0:i.recipe)==null?void 0:l.temperatureSettings)||{})}:${JSON.stringify(((h=(d=o.data)==null?void 0:d.recipe)==null?void 0:h.drillSettings)||{})}:${JSON.stringify(((j=(g=o.data)==null?void 0:g.recipe)==null?void 0:j.assemblerSettings)||{})}:${JSON.stringify(((F=(T=o.data)==null?void 0:T.recipe)==null?void 0:F.treeFarmSettings)||{})}:${JSON.stringify(((R=(_=o.data)==null?void 0:_.recipe)==null?void 0:R.fireboxSettings)||{})}:${JSON.stringify(((C=(E=o.data)==null?void 0:E.recipe)==null?void 0:C.chemicalPlantSettings)||{})}`}).join(",")}`;if(r!==ln.current){const o=Br.current||"general",c=["connection","node","temperatureSettings","boilerSettings"].includes(o);console.log(`[Recalculation] Reason: ${o}, Temperature propagation: ${c}`);const i=Nn(e,s,{skipTemperature:!c,previousTemperatureData:c?null:X==null?void 0:X.temperatureData});ha(i),ln.current=r}Rr.current=!1,Br.current=null},100),()=>clearTimeout(lr.current)},[e,s,X]);const cn=m.useMemo(()=>Ti(X),[X]),dn=m.useMemo(()=>Ni(X),[X]),cr=m.useRef(null),un=m.useRef(null),pn=m.useCallback((r,o,c)=>{var g,j,T,F,_,R;const i=(g=r.data)==null?void 0:g.recipe,l=o.byNode[r.id];if(r.data.flows===l&&r.data.suggestions===c)return r;const d=r.data.flows!==l,h=r.data.suggestions!==c&&(((j=r.data.suggestions)==null?void 0:j.length)!==(c==null?void 0:c.length)||JSON.stringify(r.data.suggestions)!==JSON.stringify(c||[]));if(i!=null&&i.isWasteFacility){const E=Math.min(((T=l==null?void 0:l.inputFlows[0])==null?void 0:T.connected)||0,240),C=Math.min(((F=l==null?void 0:l.inputFlows[1])==null?void 0:F.connected)||0,240),M=i.wasteFacilitySettings||{};if(!d&&!h&&M.itemFlowRate===E&&M.fluidFlowRate===C)return r;const q=br(E,C),$=Sr(E,C,i.inputs[0].product_id,i.inputs[1].product_id);return{...r,data:{...r.data,recipe:{...i,inputs:$,cycle_time:q.cycleTime,wasteFacilitySettings:{...M,itemFlowRate:E,fluidFlowRate:C}},flows:l||null,suggestions:c||[],zoomLevel:r.data.zoomLevel}}}if(i!=null&&i.isLiquidDump){const E=((_=r.data)==null?void 0:_.machineCount)||1,C=i.inputs.map((q,$)=>{var oe;return Math.min(((oe=l==null?void 0:l.inputFlows[$])==null?void 0:oe.connected)||0,15*E)/E}),M=Kt(i.inputs,C);return!d&&!h&&i.pollution===M?r:{...r,data:{...r.data,recipe:{...i,pollution:M},flows:l||null,suggestions:c||[],zoomLevel:r.data.zoomLevel}}}if(i!=null&&i.isLiquidBurner){const E=((R=r.data)==null?void 0:R.machineCount)||1,C=i.inputs.map((q,$)=>{var oe;return Math.min(((oe=l==null?void 0:l.inputFlows[$])==null?void 0:oe.connected)||0,15*E)/E}),M=Ut(i.inputs,C);return!d&&!h&&i.pollution===M?r:{...r,data:{...r.data,recipe:{...i,pollution:M},flows:l||null,suggestions:c||[],zoomLevel:r.data.zoomLevel}}}return!d&&!h?r:{...r,data:{...r.data,flows:l||null,suggestions:c||[],zoomLevel:r.data.zoomLevel}}},[]);m.useEffect(()=>{var r;if((r=X==null?void 0:X.flows)!=null&&r.byNode&&un.current!==X.flows)return un.current=X.flows,cr.current&&clearTimeout(cr.current),cr.current=setTimeout(()=>{n(o=>{let c=o;X.temperatureData&&(c=Ii(o,X.temperatureData,X.graph));let i=!1;const l=c.map(d=>{const h=pn(d,X.flows,X.suggestions);return h!==d&&(i=!0),h});return i?l:o})},250),()=>clearTimeout(cr.current)},[X,n,pn]);const dr=m.useMemo(()=>cn.map(r=>{const o=ee.some(c=>{var l,d,h;const i=e.find(g=>g.id===c.recipeBoxId);return(h=(d=(l=i==null?void 0:i.data)==null?void 0:l.recipe)==null?void 0:d.outputs)==null?void 0:h.some(g=>g.product_id===r.productId)});return{...r,isSold:Be[r.productId]??(o&&typeof r.product.price=="number"&&r.product.price>1)}}),[cn,Be,ee,e]),mn=m.useMemo(()=>dr.reduce((r,o)=>o.isSold&&typeof o.product.price=="number"?r+o.product.price*o.excessRate:r,0),[dr]),ga=m.useMemo(()=>{const r=new Map,o=new Map,c=(l,d,h)=>{r.set(l,(r.get(l)||0)+d),o.has(l)||o.set(l,h)};e.forEach(l=>{var j,T,F,_,R,E;const{machine:d,machineCount:h=0,recipe:g}=l.data||{};if(d){if(d.id==="m_tree_farm"&&(g!=null&&g.treeFarmSettings)){const{trees:C,harvesters:M,sprinklers:q,outputs:$,controller:Z}=g.treeFarmSettings,oe=Math.ceil(q/3);c("m_tree",Math.ceil(C*h),((j=ge("m_tree"))==null?void 0:j.cost)||0),c("m_farm_harvester",Math.ceil(M*h),((T=ge("m_farm_harvester"))==null?void 0:T.cost)||0),c("m_tree_farm_sprinkler",Math.ceil(q*h),((F=ge("m_tree_farm_sprinkler"))==null?void 0:F.cost)||0),c("m_tree_farm_water_tank",Math.ceil(oe*h),((_=ge("m_tree_farm_water_tank"))==null?void 0:_.cost)||0),c("m_tree_farm_output",Math.ceil($*h),((R=ge("m_tree_farm_output"))==null?void 0:R.cost)||0),c("m_tree_farm_controller",Math.ceil(Z*h),((E=ge("m_tree_farm_controller"))==null?void 0:E.cost)||0);return}c(d.id,Math.ceil(h),typeof d.cost=="number"?d.cost:0)}});const i=Array.from(r.entries()).map(([l,d])=>{const h=nt.find(j=>j.id===l),g=o.get(l);return{machineId:l,machine:h,count:d,cost:g,totalCost:d*g}}).sort((l,d)=>l.machine.name.localeCompare(d.machine.name));return{stats:i,totalCost:i.reduce((l,d)=>l+d.totalCost,0)}},[e,nt]),lt=(r,o)=>n(c=>c.map(i=>i.id===r?{...i,data:o(i.data)}:i)),ur=m.useCallback((r,o,c,i)=>{const l=Object.keys(Kr).map(g=>parseInt(g));let d=null,h=0;return l.forEach(g=>{const T=Kr[g].find(F=>F.product_id===r);if(T){const F=Gt(o,c,i,g);if(F){const _=i?1.1:1,R=T.quantity*_*F.dutyCycle;R>h&&(h=R,d=g)}}}),d},[]),xa=m.useCallback((r,o,c)=>{const i={drillConfig:ze,assemblerConfig:qe,treeFarmConfig:We,fireboxConfig:Ve},l=(X==null?void 0:X.flows)||null;return ko(r,o,c,ur,i,y,l)},[ze,qe,We,Ve,ur,y,X]),ya=m.useCallback(r=>{const o=e.find(d=>d.id===r.source),c=e.find(d=>d.id===r.target);if(!o||!c)return;const i=o.data.recipe.outputs[parseInt(r.sourceHandle.split("-")[1])],l=c.data.recipe.inputs[parseInt(r.targetHandle.split("-")[1])];if(!(!i||!l)){if(l.isAnyProduct){const d=Me(i.product_id);if(l.acceptedType&&(d==null?void 0:d.type)!==l.acceptedType)return;n(h=>h.map(g=>{var F;if(g.id!==c.id)return g;const j=parseInt(r.targetHandle.split("-")[1]),T=[...g.data.recipe.inputs];if(T[j]={...T[j],product_id:i.product_id,isAnyProduct:!1},g.data.recipe.isWasteFacility){const _=g.data.recipe.wasteFacilitySettings||{},R=(F=X==null?void 0:X.flows)==null?void 0:F.byNode[r.source],E=parseInt(r.sourceHandle.split("-")[1]),C=R!=null&&R.outputFlows[E]?R.outputFlows[E].produced-R.outputFlows[E].connected:0,M=Math.min(C,240);j===0?_.itemFlowRate=M:j===1&&(_.fluidFlowRate=M);const q=br(_.itemFlowRate||0,_.fluidFlowRate||0),$=Sr(_.itemFlowRate||0,_.fluidFlowRate||0,j===0?i.product_id:T[0].product_id,j===1?i.product_id:T[1].product_id);return{...g,data:{...g.data,recipe:{...g.data.recipe,inputs:$,cycle_time:q.cycleTime,wasteFacilitySettings:_}}}}if(g.data.recipe.isLiquidDump||g.data.recipe.isLiquidBurner){const _=g.data.recipe.isLiquidDump?Kt(T):Ut(T);return{...g,data:{...g.data,recipe:{...g.data.recipe,inputs:T,pollution:_}}}}return{...g,data:{...g.data,recipe:{...g.data.recipe,inputs:T}}}}))}else if(i.product_id!==l.product_id)return;u(d=>_n({...r,type:"custom",animated:!1,data:ye},d)),Qe(),U("connection")}},[u,e,ye,U,n,X]),pr=()=>{w(!1),H(null),A(null),v("product"),O(""),G("name_asc"),V("all"),re("all"),ae(null),K("button"),an({}),ce("all")},ba=m.useCallback(()=>{w(!0),ae(null),K("button")},[]),va=m.useCallback((r,o,c,i)=>{if(i!=null&&i.ctrlKey){u(d=>d.filter(h=>!(h.target===o&&h.targetHandle===`left-${c}`))),Qe(),U("connection");return}const l=Me(r);l&&(w(!0),H(l),ae({nodeId:o,inputIndex:c,productId:r}),K("rectangle"),re("producers"))},[u,ie,Ne,U]),_a=m.useCallback((r,o,c,i)=>{var j,T;if(i!=null&&i.ctrlKey){u(F=>F.filter(_=>!(_.source===o&&_.sourceHandle===`right-${c}`))),Qe(),U("connection");return}const l=Or.current.find(F=>F.id===o),d=(T=(j=l==null?void 0:l.data)==null?void 0:j.recipe)==null?void 0:T.machine_id,h=d&&mt[d],g=Me(r);g&&(w(!0),H(g),ae({nodeId:o,outputIndex:c,productId:r,isOutput:!0,isFromHeatSource:!!h}),K("rectangle"),re("consumers"))},[u,ie,Ne,U]),rt=m.useCallback((r,o,c)=>{u(i=>{const l=i.filter(d=>{var h,g,j,T;if(d.source===r){const F=parseInt(d.sourceHandle.split("-")[1]);if(F>=c.length)return!1;const _=c[F],R=e.find(M=>M.id===d.target);if(!R)return!1;const E=parseInt(d.targetHandle.split("-")[1]),C=(g=(h=R.data)==null?void 0:h.recipe)==null?void 0:g.inputs[E];if(!C||C.product_id!==_.product_id)return!1}if(d.target===r){const F=parseInt(d.targetHandle.split("-")[1]);if(F>=o.length)return!1;const _=o[F],R=e.find(M=>M.id===d.source);if(!R)return!1;const E=parseInt(d.sourceHandle.split("-")[1]),C=(T=(j=R.data)==null?void 0:j.recipe)==null?void 0:T.outputs[E];if(!C||C.product_id!==_.product_id)return!1}return!0});return l.length!==i.length&&(Qe(),U("connection")),l})},[u,e,U]),Ca=m.useCallback((r,o,c,i)=>{Le({drillHead:o.drillHead,consumable:o.consumable,machineOil:o.machineOil});const l=o.drillHead&&o.depth?Gt(o.drillHead,o.consumable,o.machineOil,o.depth):null;lt(r,d=>({...d,recipe:{...d.recipe,inputs:c.length>0?c:[{product_id:"p_variableproduct",quantity:"Variable"}],outputs:i.length>0?i:[{product_id:"p_variableproduct",quantity:"Variable"}],drillSettings:o,cycle_time:1,power_consumption:l?{max:l.drillingPower*1e6,average:(l.drillingPower*l.lifeTime+l.idlePower*(l.replacementTime+l.travelTime))/l.totalCycleTime*1e6}:"Variable",pollution:l?l.pollution:"Variable"},leftHandles:Math.max(c.length,1),rightHandles:Math.max(i.length,1)})),rt(r,c,i),U("settings")},[rt,U]),Sa=m.useCallback((r,o,c,i)=>{Oe({outerStage:o.outerStage,innerStage:o.innerStage,machineOil:o.machineOil,tickCircuitDelay:o.tickCircuitDelay});const d=!o.outerStage||!o.innerStage?"":o.outerStage===1?`p_${o.innerStage}x_microchip`:`p_${o.outerStage}x${o.innerStage}x_microchip`,h=d?Zr(d,o.machineOil,o.tickCircuitDelay):null;lt(r,g=>({...g,recipe:{...g.recipe,inputs:c.length>0?c:[{product_id:"p_logic_plate",quantity:"Variable"},{product_id:"p_copper_wire",quantity:"Variable"},{product_id:"p_semiconductor",quantity:"Variable"},{product_id:"p_gold_wire",quantity:"Variable"}],outputs:i.length>0?i:[{product_id:"p_variableproduct",quantity:"Variable"}],assemblerSettings:o,cycle_time:h?h.cycleTime:"Variable",power_consumption:h?{max:h.maxPowerConsumption,average:h.avgPowerConsumption}:"Variable"},leftHandles:Math.max(c.length,1),rightHandles:Math.max(i.length,1)})),rt(r,c,i),U("settings")},[rt,U]),ja=m.useCallback((r,o,c,i)=>{$e({trees:o.trees,harvesters:o.harvesters,sprinklers:o.sprinklers,outputs:o.outputs});const l=jr(o.trees,o.harvesters,o.sprinklers,o.outputs,o.controller,y);lt(r,d=>({...d,recipe:{...d.recipe,inputs:c.length>0?c:[{product_id:"p_water",quantity:"Variable"}],outputs:i.length>0?i:[{product_id:"p_oak_log",quantity:"Variable"}],treeFarmSettings:o,cycle_time:1,power_consumption:l?l.avgPowerConsumption:"Variable",pollution:0},leftHandles:Math.max(c.length,1),rightHandles:Math.max(i.length,1)})),u(d=>d.filter(h=>{if(h.source===r||h.target===r){const g=parseInt((h.source===r?h.sourceHandle:h.targetHandle).split("-")[1]);return h.source===r?g<i.length:g<c.length}return!0})),U("settings")},[u,y,U]),wa=m.useCallback((r,o,c,i)=>{Ue({fuel:o.fuel}),lt(r,l=>({...l,recipe:{...l.recipe,inputs:c,fireboxSettings:o,cycle_time:i?i.cycleTime:l.recipe.cycle_time,power_consumption:0}})),U("settings")},[U]),Pa=m.useCallback((r,o,c,i)=>{n(l=>l.map(d=>{if(d.id!==r)return d;const h=ge(d.data.recipe.machine_id),g=wt(h==null?void 0:h.id);let j=d.data.recipe.power_type;(h==null?void 0:h.id)==="m_electric_water_heater"&&(j=o.temperature>=320?"HV":"MV");let T={...d.data.recipe,outputs:c,temperatureSettings:o,power_consumption:i??d.data.recipe.power_consumption,power_type:j};if((h==null?void 0:h.id)==="m_water_treatment_plant"&&g){const F=o.temperature||ft,_=Ft(h.id,F,1),R=90*_,E=17.6,C=17.6;T={...T,inputs:T.inputs.map(M=>M.product_id==="p_water"?{...M,quantity:E*_,originalQuantity:E}:M.product_id==="p_distilled_water"?{...M,quantity:C*_,originalQuantity:C}:M),outputs:T.outputs.map(M=>M.product_id==="p_steam"?{...M,quantity:R,originalQuantity:90}:M)}}return{...d,data:{...d.data,recipe:T}}})),U("temperatureSettings")},[n,U]),Ma=m.useCallback((r,o)=>{n(c=>c.map(i=>{if(i.id!==r)return i;const l=ge(i.data.recipe.machine_id),d=mt[l==null?void 0:l.id];return!d||d.type!=="boiler"?i:{...i,data:{...i.data,recipe:{...i.data.recipe,temperatureSettings:o}}}})),U("boilerSettings")},[n,U]),ka=m.useCallback((r,o,c,i,l)=>{const d=o==="right"?"output":"input",h=l==null?void 0:l.find(g=>g.nodeId===r&&g.handleType===d&&g.handleIndex===c);h&&(n(g=>g.map(j=>{var R,E;if(j.id!==r)return j;const T=((R=j.data)==null?void 0:R.machineCountMode)||"free",F=(E=j.data)==null?void 0:E.cappedMachineCount;if(T==="locked")return console.log(`Node ${r} is locked - suggestion ignored`),j;let _=h.suggestedMachineCount;return T==="capped"&&typeof F=="number"&&_>F&&(console.log(`Node ${r} is capped at ${F} - clamping suggestion from ${_} to ${F}`),_=F),{...j,data:{...j.data,machineCount:_}}})),U("machineCount"))},[n,U]),Ta=m.useCallback((r,o)=>{n(c=>c.map(i=>{if(i.id!==r)return i;const l=ge(i.data.recipe.machine_id);if((l==null?void 0:l.id)!=="m_chemical_plant")return i;const d=at.find(g=>g.id===i.data.recipe.id);if(!d)return i;const h=_i(d,o.speedFactor,o.efficiencyFactor);return{...i,data:{...i.data,recipe:h}}})),U("settings")},[n,U]),Na=m.useCallback((r,o,c,i)=>{tt({itemProductId:o.itemProductId,fluidProductId:o.fluidProductId}),n(l=>l.map(d=>{if(d.id!==r)return d;const h=d.data.recipe.wasteFacilitySettings||{},g=h.itemFlowRate||0,j=h.fluidFlowRate||0,T=br(g,j);return{...d,data:{...d.data,recipe:{...d.data.recipe,inputs:c.length>0?c:d.data.recipe.inputs,wasteFacilitySettings:{...o,itemFlowRate:g,fluidFlowRate:j},cycle_time:T.cycleTime},leftHandles:Math.max(c.length,1)}}})),rt(r,c,i),U("settings")},[rt,U,n]),Ia=m.useCallback((r,o,c,i)=>{n(l=>l.map(d=>d.id!==r?d:{...d,data:{...d.data,recipe:{...d.data.recipe,inputs:c.length>0?c:d.data.recipe.inputs,liquidDumpSettings:o,pollution:Kt(c)},leftHandles:Math.max(c.length,1)}})),rt(r,c,i),U("settings")},[rt,U,n]),Fa=m.useCallback((r,o,c,i)=>{n(l=>l.map(d=>d.id!==r?d:{...d,data:{...d.data,recipe:{...d.data.recipe,inputs:c.length>0?c:d.data.recipe.inputs,liquidBurnerSettings:o,pollution:Ut(c)},leftHandles:Math.max(c.length,1)}})),rt(r,c,i),U("settings")},[rt,U,n]),ct=m.useCallback((r,o=null)=>{var R,E;const c=ge(r.machine_id);if(!c||!r.inputs||!r.outputs){alert("Error: Invalid machine or recipe data");return}let i=Vt(r,c.id);const l=`node-${p}`,d=k?e.find(C=>C.id===k.nodeId):null;let h;if(d)h={x:d.position.x+(k.isOutput?400:-400),y:d.position.y};else if(st.current&&Ht.current){const C=Ht.current.getBoundingClientRect(),M=st.current.screenToFlowPosition({x:C.left+C.width/2,y:C.top+C.height/2}),q=320,$=300,Z=50;let oe={x:M.x-q/2,y:M.y-$/2},_e=0;for(;_e<20&&e.some(Pe=>{const zt=Math.abs(Pe.position.x-oe.x),ri=Math.abs(Pe.position.y-oe.y);return zt<q+Z&&ri<$+Z});){const Ge=_e/20*Math.PI*2,Re=100+_e*50;oe={x:M.x-q/2+Math.cos(Ge)*Re,y:M.y-$/2+Math.sin(Ge)*Re},_e++}h=oe}else h={x:Math.random()*400+100,y:Math.random()*300+100};if(((R=mt[c.id])==null?void 0:R.type)==="boiler"){const C={heatLoss:((E=i.temperatureSettings)==null?void 0:E.heatLoss)??0,coolantTemp:jt},M=en(c.id,C,jt,null,jt),q=mt[c.id],$=Xn(i.outputs,M,!0,q,jt);i={...i,outputs:$,temperatureSettings:C}}const j={drillConfig:ze,assemblerConfig:qe,treeFarmConfig:We,fireboxConfig:Ve};if(ea(i)&&(i=Zn(i,k,S,j,y,ur),i.drillSettings&&Le({drillHead:i.drillSettings.drillHead,consumable:i.drillSettings.consumable,machineOil:i.drillSettings.machineOil}),i.assemblerSettings&&Oe({outerStage:i.assemblerSettings.outerStage,innerStage:i.assemblerSettings.innerStage,machineOil:i.assemblerSettings.machineOil,tickCircuitDelay:i.assemblerSettings.tickCircuitDelay}),i.treeFarmSettings&&$e({trees:i.treeFarmSettings.trees,harvesters:i.treeFarmSettings.harvesters,sprinklers:i.treeFarmSettings.sprinklers,outputs:i.treeFarmSettings.outputs}),i.fireboxSettings&&Ue({fuel:i.fireboxSettings.fuel})),c.id==="m_air_separation_unit"){const C=qn(y),M=i.outputs.map(q=>q.product_id==="p_residue"?{...q,quantity:parseFloat(C.toFixed(6))}:q);i={...i,outputs:M}}const T=o!==null?o:Nr[r.id]??1,F=Je(),_={id:l,type:"custom",position:h,data:{recipe:i,machine:c,machineCount:T,machineCountMode:"free",cappedMachineCount:void 0,displayMode:we,machineDisplayMode:ke,leftHandles:Math.max(i.inputs.length,1),rightHandles:Math.max(i.outputs.length,1),...F,globalPollution:y,isTarget:!1,flows:null,suggestions:[],zoomLevel:At},sourcePosition:"right",targetPosition:"left"};return n(C=>{const M=[...C,_];return U("node"),k&&T>0&&setTimeout(()=>{var Z,oe,_e;const q=k.isOutput?"inputs":"outputs";let $=-1;if((i.isWasteFacility||i.id==="r_underground_waste_facility")&&!k.isOutput)k.productId==="p_concrete_block"?$=2:k.productId==="p_lead_ingot"?$=3:$=i[q].findIndex(he=>he.product_id===k.productId);else if(k.isOutput&&k.isFromHeatSource){const he=ge(i.machine_id);if(he&&((Z=mt[he.id])==null?void 0:Z.type)==="boiler"&&i.inputs.length>=2){const Re=(oe=i.inputs[0])==null?void 0:oe.product_id,Pe=(_e=i.inputs[1])==null?void 0:_e.product_id;Re===Pe&&Pe===k.productId||Pe===k.productId?$=1:$=i[q].findIndex(zt=>zt.product_id===k.productId)}else $=i[q].findIndex(Re=>Re.product_id===k.productId)}else $=i[q].findIndex(he=>he.product_id===k.productId);if($!==-1){const he=k.isOutput?k.outputIndex:$,Ge=k.isOutput?$:k.inputIndex,Re={source:k.isOutput?k.nodeId:l,sourceHandle:`right-${he}`,target:k.isOutput?l:k.nodeId,targetHandle:`left-${Ge}`,type:"custom",animated:!1,data:ye};u(Pe=>_n(Re,Pe)),Qe(),U("connection")}},50),M}),x(C=>C+1),U(),l},[p,e,n,u,we,ke,ze,qe,We,Ve,ur,Nr,y,S,U,k,ye,Je]),It=m.useCallback(r=>{n(o=>o.filter(c=>c.id!==r)),u(o=>o.filter(c=>c.source!==r&&c.target!==r)),de(o=>o.filter(c=>c.recipeBoxId!==r)),Qe(),U("node")},[n,u,U]),Lr=m.useCallback(r=>{var c;ee.find(i=>i.recipeBoxId===r.id)?(de(i=>i.filter(l=>l.recipeBoxId!==r.id)),n(i=>i.map(l=>l.id===r.id?{...l,data:{...l.data,isTarget:!1}}:l))):(c=r.data)!=null&&c.recipe&&(de(i=>[...i,{id:`target_${ue}`,recipeBoxId:r.id}]),Ce(i=>i+1),n(i=>i.map(l=>l.id===r.id?{...l,data:{...l.data,isTarget:!0}}:l)))},[ee,ue,n]),fn=m.useCallback((r,o,c,i)=>{var q;const l=ee.find($=>$.id===r);if(!l)return;const d=e.find($=>$.id===l.recipeBoxId);if(!d)return;const{recipe:h,machine:g,machineCount:j=0}=d.data||{};if(!h)return;const T=h.isMineshaftDrill||h.id==="r_mineshaft_drill";let F=h.cycle_time;if((typeof F!="number"||F<=0)&&(F=1),wt(g==null?void 0:g.id)){const $=Dt[g.id];if(($==null?void 0:$.type)==="steam_input"&&Rt(h)){const Z=h.tempDependentInputTemp??ft;F=Ft(g.id,Z,F)}}(typeof F!="number"||F<=0)&&(F=1);const R=(q=X==null?void 0:X.flows)==null?void 0:q.byNode[l.recipeBoxId];if(!R)return;let E=0,C=0;if(o==="output"){const $=R.outputFlows[c];if(!$)return;E=$.connected;const Z=h.outputs[c],oe=Z.originalQuantity!==void 0?Z.originalQuantity:Z.quantity;C=T?oe:oe/F}else{const $=R.inputFlows[c];if(!$)return;E=$.connected;const Z=h.inputs[c];C=T?Z.quantity:Z.quantity/F}if(C<=0)return;const M=(E+i)/C;lt(l.recipeBoxId,$=>({...$,machineCount:M})),U("machineCount")},[ee,e,X,U]),Ea=m.useCallback(r=>{const o=ee.find(c=>c.id===r);o&&(de(c=>c.filter(i=>i.id!==r)),lt(o.recipeBoxId,c=>({...c,isTarget:!1})))},[ee]),Da=m.useCallback((r,o)=>{if(ie){if(Ne==="target"){Lr(o);return}else if(Ne==="delete"){It(o.id);return}}r.shiftKey&&!r.ctrlKey&&!r.altKey?Lr(o):r.ctrlKey&&r.altKey&&It(o.id)},[ie,Ne,Lr,It]),Ra=m.useCallback((r,o)=>{var c,i;r.stopPropagation(),Y(o.id),me(String(((c=o.data)==null?void 0:c.machineCount)??0)),fe(((i=o.data)==null?void 0:i.machineCountMode)||"free"),J(!0)},[]),Or=m.useRef(e),Ba=m.useRef(s);m.useEffect(()=>{Or.current=e},[e]),m.useEffect(()=>{Ba.current=s},[s]);const La=m.useCallback(r=>{const o=Or.current.find(c=>c.id===r);o&&Ir({recipe:{...o.data.recipe},machine:o.data.machine,machineCount:o.data.machineCount})},[]),Oa=m.useCallback(r=>{if(!Ht.current)return;const o=Ht.current.getBoundingClientRect();ca({x:r.clientX-o.left,y:r.clientY-o.top})},[]),$a=m.useCallback(r=>{if(!Ke||r.button!==0||(r.stopPropagation(),!st.current))return;const o=st.current.screenToFlowPosition({x:r.clientX,y:r.clientY});o.x-=160,o.y-=150;const c=`node-${p}`,i=Je(),l={id:c,type:"custom",position:o,data:{recipe:Ke.recipe,machine:Ke.machine,machineCount:Ke.machineCount,displayMode:we,machineDisplayMode:ke,leftHandles:Ke.recipe.inputs.length,rightHandles:Ke.recipe.outputs.length,...i,globalPollution:y,isTarget:!1,flows:null,suggestions:[]},sourcePosition:"right",targetPosition:"left"};n(d=>[...d,l]),x(d=>d+1),Ir(null),U("node")},[Ke,p,we,ke,y,n,Je,U]),Aa=m.useCallback(r=>{r.button===2&&Ir(null)},[]),$r=m.useCallback((r=!1)=>{var c,i;let o=parseFloat(xe);if(isNaN(o)||o<0){if(se){alert("Machine count must be 0 or greater. Please enter a valid number.");return}o=0}if(Q&&!se){const l=e.find(g=>g.id===Q),d=((c=l==null?void 0:l.data)==null?void 0:c.machineCount)||0;let h=(i=l==null?void 0:l.data)==null?void 0:i.cappedMachineCount;if(le==="capped"?h=o:le==="free"&&(h=void 0),r&&d>0&&o!==d){const g=Fi(e,s),j=X==null?void 0:X.flows;if(j){const T=Io(Q,d,o,g,j,e);n(F=>F.map(_=>{const R=T.get(_.id);return _.id===Q?{..._,data:{..._.data,machineCount:o,machineCountMode:le,cappedMachineCount:h}}:R!==void 0?{..._,data:{..._.data,machineCount:R}}:_}))}else lt(Q,T=>({...T,machineCount:o,machineCountMode:le,cappedMachineCount:h}))}else lt(Q,g=>({...g,machineCount:o,machineCountMode:le,cappedMachineCount:h}))}else se&&lt(se,l=>({...l,machineCount:o}));J(!1),Y(null),me(""),fe("free"),Ee(null),U("machineCount")},[Q,xe,le,se,e,s,X,n,It,U]),hn=m.useCallback(()=>{se&&(It(se),w(!0),H(null),A(null),v("product")),J(!1),Y(null),me(""),fe("free"),Ee(null)},[se,It]),Ha=m.useCallback((r,o,c)=>{let i,l;o==="free"?(i="capped",l=c):o==="capped"?(i="locked",l=c):(i="free",l=void 0),n(d=>d.map(h=>h.id!==r?h:{...h,data:{...h.data,machineCountMode:i,cappedMachineCount:l}}))},[n]),za=m.useCallback(async()=>{const{nodes:r,edges:o}=await Bo(e,s,ye);n(r),u(o)},[e,s,ye,n,u]),qa=m.useCallback(()=>{if(ee.length===0){alert("No target recipes. Please add target recipes (Shift+Click a node) before computing.");return}const r=e.map(d=>{var h;return{id:d.id,data:{recipe:d.data.recipe,machineCount:d.data.machineCount,machineName:((h=d.data.machine)==null?void 0:h.name)||""}}}),o=Date.now();bt({phase:"loading",nodeSnapshot:r});const c=e.map(d=>({id:d.id,data:{recipe:d.data.recipe,machine:d.data.machine,machineCount:d.data.machineCount,machineCountMode:d.data.machineCountMode,cappedMachineCount:d.data.cappedMachineCount}})),i=s.map(d=>({id:d.id,source:d.source,target:d.target,sourceHandle:d.sourceHandle,targetHandle:d.targetHandle})),l=new Worker(new URL("/Industrialist-Production-Calculator/assets/lpWorker-OrhV5hQw.js",import.meta.url),{type:"module"});Nt.current=l,l.onmessage=d=>{Nt.current=null,l.terminate();const h=Date.now()-o,{result:g,deficiencyResult:j}=d.data,T={...g,elapsedMs:h},F=j?{...j,elapsedMs:h}:null;if(!g.success&&g.hasDeficiency){bt(_=>({..._,phase:"deficiency_confirm",result:T,deficiencyResult:F}));return}bt(_=>({..._,phase:"results",result:T}))},l.onerror=d=>{Nt.current=null,l.terminate(),bt(null),console.error("[LP Worker] Error:",d),alert("An error occurred while computing. Check the console for details.")},l.postMessage({nodes:c,edges:i,targetProducts:ee,activeWeights:Fr,unusedWeights:Er,machines:nt})},[ee,e,s,Fr,Er,n,U]),Wa=m.useCallback(()=>{Nt.current&&(Nt.current.terminate(),Nt.current=null),bt(null)},[]),Va=m.useCallback(()=>{bt(r=>r?{...r,phase:"results",result:r.deficiencyResult}:null)},[]),Ua=m.useCallback(r=>{r!=null&&r.success&&(n(o=>o.map(c=>{const i=r.updates.get(c.id);return i!==void 0?{...c,data:{...c.data,machineCount:i}}:c})),U("machineCount")),bt(null)},[n,U]),Ka=m.useCallback(r=>{st.current&&st.current.fitView({nodes:[{id:r}],padding:.6,duration:600,maxZoom:1.5})},[]),gn=()=>{if(!S)return[];const r=Me(S.id),o=Mo(S.id),c=Po(S.id),i=[Pn,Mn,kn,Wr,Vr,Ur],l=i.filter(g=>No(g.id).includes(S.id)),d=i.filter(g=>{if(To(g.id).includes(S.id))return!0;if(r){if(g.id==="r_underground_waste_facility")return!!["p_concrete_block","p_lead_ingot"].includes(S.id);if(g.id==="r_liquid_dump"||g.id==="r_liquid_burner")return!1}return!1}),h=i.filter(g=>g.id==="r_liquid_dump"||g.id==="r_liquid_burner"?(r==null?void 0:r.type)==="fluid":g.id==="r_underground_waste_facility"?!["p_concrete_block","p_lead_ingot"].includes(S.id):!1);return te==="producers"?[...o,...l]:te==="consumers"?[...c,...d]:te==="disposal"?h:Array.from(new Map([...o,...c,...l,...d,...h].map(g=>[g.id,g])).values())};m.useEffect(()=>{if(N){const r=I==="product"?gn():xr(P==null?void 0:P.id),o=k?e.find(i=>i.id===k.nodeId):null,c={};r.forEach(i=>{c[i.id]=xa(i,o,k)}),an(c)}},[N,I,S,P,k,e,te]);const Ct=m.useCallback(()=>{n([]),u([]),x(0),de([]),Ce(0),De({}),Le(null),Oe(null),$e(null),Ue(null),tt(null),Qe()},[n,u,x,de,Ce,De,Le,Oe,$e,Ue,tt]),Ja=m.useCallback(()=>{const r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=o=>{var l;const c=(l=o.target.files)==null?void 0:l[0];if(!c)return;const i=new FileReader;i.onload=d=>{try{const h=JSON.parse(d.target.result);if(!h.canvas){alert("This file does not contain canvas data. Please use the Data Manager to import game data (products, machines, recipes).");return}const g=h.canvas.nodes||[],j=[];if(g.forEach(_=>{var E,C,M,q,$,Z,oe,_e;const R=(C=(E=_.data)==null?void 0:E.recipe)==null?void 0:C.machine_id;R&&!ge(R)&&j.push(`Machine: ${R}`),($=(q=(M=_.data)==null?void 0:M.recipe)==null?void 0:q.inputs)==null||$.forEach(he=>{he.product_id!=="p_variableproduct"&&!Me(he.product_id)&&j.push(`Product: ${he.product_id}`)}),(_e=(oe=(Z=_.data)==null?void 0:Z.recipe)==null?void 0:oe.outputs)==null||_e.forEach(he=>{he.product_id!=="p_variableproduct"&&!Me(he.product_id)&&j.push(`Product: ${he.product_id}`)})}),j.length>0){const _=[...new Set(j)];alert(`Cannot import canvas - missing items:
${_.slice(0,10).join(`
`)}${_.length>10?`
...and ${_.length-10} more`:""}`);return}if(!window.confirm("Import this canvas? Your current canvas will be replaced."))return;const T=Je(),F=g.map(_=>{var C,M,q,$;const R=ge((M=(C=_.data)==null?void 0:C.recipe)==null?void 0:M.machine_id);let E=(q=_.data)==null?void 0:q.recipe;return R&&E&&!(($=E.outputs)!=null&&$.some(Z=>Z.temperature!==void 0))&&(E=Vt(E,R.id)),{..._,data:{..._.data,recipe:E,machine:R,machineCount:_.data.machineCount??1,displayMode:we,machineDisplayMode:ke,...T,globalPollution:y,flows:null,suggestions:[]}}});Ct(),setTimeout(()=>{n(F),u((h.canvas.edges||[]).map(_=>{const{edgePath:R,edgeStyle:E,...C}=_.data||{};return{..._,data:{...C,...ye}}})),de(h.canvas.targetProducts||[]),De(h.canvas.soldProducts||{}),pt(h.canvas.favoriteRecipes||[]),Le(h.canvas.lastDrillConfig||null),Oe(h.canvas.lastAssemblerConfig||null),$e(h.canvas.lastTreeFarmConfig||null),Ue(h.canvas.lastFireboxConfig||null),tt(h.canvas.lastWasteFacilityConfig||null),x(h.canvas.nodeId||0),Ce(h.canvas.targetIdCounter||0),Qe(),U("node")},50),alert("Canvas imported successfully!")}catch(h){alert(`Import failed: ${h.message}`)}},i.readAsText(c)},r.click()},[we,ke,y,Je,Ct,n,u,de,De,pt,Le,Oe,$e,Ue,tt,x,Ce,U]),Ga=m.useCallback(r=>{var i;const o=(i=r.target.files)==null?void 0:i[0];if(!o)return;const c=new FileReader;c.onload=l=>{var d,h;try{const g=JSON.parse(l.target.result),j=g.products||g.machines||g.recipes,T=g.canvas;if(j){const F=new Map((g.products||[]).map(M=>[M.id,M])),_=Array.from(F.values()),R=new Set(((d=g.machines)==null?void 0:d.map(M=>M.id))||[]),E=(g.recipes||[]).filter(M=>R.has(M.machine_id)),C=[...Ye];if(_.forEach(M=>{const q=C.findIndex($=>$.id===M.id);q>=0?C[q]=M:C.push(M)}),Sn(C),((h=g.machines)==null?void 0:h.length)>0){const M=[...nt],q=new Set(g.machines.map(Z=>Z.id)),$=at.filter(Z=>!q.has(Z.machine_id));g.machines.forEach(Z=>{const oe=M.findIndex(_e=>_e.id===Z.id);oe>=0?M[oe]=Z:M.push(Z)}),jn(M),wn([...$,...E])}if(!T){alert("Data import successful!"),window.location.reload();return}}if(T){const F=g.canvas.nodes||[],_=[];if(F.forEach(C=>{var q,$,Z,oe,_e,he,Ge,Re;const M=($=(q=C.data)==null?void 0:q.recipe)==null?void 0:$.machine_id;M&&!ge(M)&&_.push(`Machine: ${M}`),(_e=(oe=(Z=C.data)==null?void 0:Z.recipe)==null?void 0:oe.inputs)==null||_e.forEach(Pe=>{Pe.product_id!=="p_variableproduct"&&!Me(Pe.product_id)&&_.push(`Product: ${Pe.product_id}`)}),(Re=(Ge=(he=C.data)==null?void 0:he.recipe)==null?void 0:Ge.outputs)==null||Re.forEach(Pe=>{Pe.product_id!=="p_variableproduct"&&!Me(Pe.product_id)&&_.push(`Product: ${Pe.product_id}`)})}),_.length>0){const C=[...new Set(_)];alert(`Cannot import canvas - missing items:
${C.slice(0,10).join(`
`)}${C.length>10?`
...and ${C.length-10} more`:""}`),r.target.value="";return}if(!window.confirm("Clear current canvas and load imported layout?")){r.target.value="";return}const R=Je(),E=F.map(C=>{var $,Z,oe,_e;const M=ge((Z=($=C.data)==null?void 0:$.recipe)==null?void 0:Z.machine_id);let q=(oe=C.data)==null?void 0:oe.recipe;return M&&q&&!((_e=q.outputs)!=null&&_e.some(he=>he.temperature!==void 0))&&(q=Vt(q,M.id)),{...C,data:{...C.data,recipe:q,machine:M,machineCount:C.data.machineCount??1,displayMode:we,machineDisplayMode:ke,...R,globalPollution:y,flows:null,suggestions:[]}}});Ct(),setTimeout(()=>{n(E),u((g.canvas.edges||[]).map(C=>{const{edgePath:M,edgeStyle:q,...$}=C.data||{};return{...C,data:{...$,...ye}}})),de(g.canvas.targetProducts||[]),De(g.canvas.soldProducts||{}),pt(g.canvas.favoriteRecipes||[]),Le(g.canvas.lastDrillConfig||null),Oe(g.canvas.lastAssemblerConfig||null),$e(g.canvas.lastTreeFarmConfig||null),Ue(g.canvas.lastFireboxConfig||null),tt(g.canvas.lastWasteFacilityConfig||null),x(g.canvas.nodeId||0),Ce(g.canvas.targetIdCounter||0),Qe(),U("node")},50),alert("Canvas import successful!")}}catch(g){alert(`Import failed: ${g.message}`)}},c.readAsText(o),r.target.value=""},[we,ke,y,Je,Ct,n,u,de,De,pt,Le,Oe,$e,x,Ce]);m.useCallback(()=>{const r=new Blob([JSON.stringify({products:Ye,machines:nt,recipes:at},null,2)],{type:"application/json"}),o=URL.createObjectURL(r),c=document.createElement("a");c.href=o,c.download=`industrialist-data-${Date.now()}.json`,c.click(),URL.revokeObjectURL(o)},[Ye,nt,at]);const Qa=m.useCallback(()=>{const r=s.map(d=>{const{edgePath:h,edgeStyle:g,...j}=d.data||{};return{...d,data:j}}),o={nodes:e.map(vt),edges:r,targetProducts:ee,nodeId:p,targetIdCounter:ue,soldProducts:Be,favoriteRecipes:et,lastDrillConfig:ze,lastAssemblerConfig:qe,lastTreeFarmConfig:We,lastFireboxConfig:Ve,lastWasteFacilityConfig:Tt},c=new Blob([JSON.stringify({canvas:o},null,2)],{type:"application/json"}),i=URL.createObjectURL(c),l=document.createElement("a");l.href=i,l.download=`industrialist-canvas-${Date.now()}.json`,l.click(),URL.revokeObjectURL(i)},[e,s,ee,p,ue,Be,et,ze,qe,We,Ve,Tt,vt]);m.useCallback(()=>{const r=s.map(l=>{const{edgePath:d,edgeStyle:h,...g}=l.data||{};return{...l,data:g}}),o=new Blob([JSON.stringify({products:Ye,machines:nt,recipes:at,canvas:{nodes:e.map(vt),edges:r,targetProducts:ee,nodeId:p,targetIdCounter:ue,soldProducts:Be,favoriteRecipes:et,lastDrillConfig:ze,lastAssemblerConfig:qe,lastTreeFarmConfig:We,lastFireboxConfig:Ve,lastWasteFacilityConfig:Tt}},null,2)],{type:"application/json"}),c=URL.createObjectURL(o),i=document.createElement("a");i.href=c,i.download=`industrialist-export-${Date.now()}.json`,i.click(),URL.revokeObjectURL(c)},[e,s,ee,p,ue,Be,et,ze,qe,We,Ve,vt]),m.useCallback(()=>{const r=go(),o=xo(),c=yo();Sn(r),jn(o),wn(c),U("node")},[U]);const Ya=m.useCallback(r=>{const o=Je(),c=r.nodes.map(i=>{var h,g,j,T;const l=ge((g=(h=i.data)==null?void 0:h.recipe)==null?void 0:g.machine_id);let d=(j=i.data)==null?void 0:j.recipe;return l&&d&&!((T=d.outputs)!=null&&T.some(F=>F.temperature!==void 0))&&(d=Vt(d,l.id)),{...i,data:{...i.data,recipe:d,machine:l,machineCount:i.data.machineCount??1,displayMode:we,machineDisplayMode:ke,...o,globalPollution:y,flows:null,suggestions:[]}}});Ct(),setTimeout(()=>{n(c),u((r.edges||[]).map(i=>{const{edgePath:l,edgeStyle:d,...h}=i.data||{};return{...i,data:{...h,...ye}}})),de(r.targetProducts||[]),De(r.soldProducts||{}),pt(r.favoriteRecipes||[]),Le(r.lastDrillConfig||null),Oe(r.lastAssemblerConfig||null),$e(r.lastTreeFarmConfig||null),Ue(r.lastFireboxConfig||null),tt(r.lastWasteFacilityConfig||null),x(r.nodeId||0),Ce(r.targetIdCounter||0),Qe(),U("node")},50)},[we,ke,y,Je,Ct,n,u,de,De,pt,Le,Oe,$e,Ue,tt,x,Ce,U]),Xa=m.useCallback(()=>{window.confirm("Restore all data to defaults? This will clear the canvas and reset all products, machines, and recipes.")&&(Ci(),Co(Si),So(ji),jo(wi),n([]),u([]),x(0),de([]),Ce(0),De({}),Le(null),Oe(null),$e(null),Ue(null),tt(null),window.location.reload())},[n,u,Ye,nt,at]);m.useEffect(()=>{const r=o=>{if(o.key==="industrialist_theme")try{const c=JSON.parse(o.newValue);Ot({edgePath:c.edgePath||"orthogonal",edgeStyle:c.edgeStyle||"animated"})}catch(c){console.error("Error parsing theme from storage:",c)}};return window.addEventListener("storage",r),()=>window.removeEventListener("storage",r)},[]),m.useEffect(()=>{if(!Se){const r=_r();Ot({edgePath:r.edgePath||"orthogonal",edgeStyle:r.edgeStyle||"animated"})}},[Se]);const Za=Ye.filter(r=>r.name.toLowerCase().includes(B.toLowerCase())&&(D==="all"||r.type===D)).sort((r,o)=>z==="name_asc"?r.name.localeCompare(o.name):z==="name_desc"?o.name.localeCompare(r.name):z==="price_asc"?(r.price==="Variable"?1/0:r.price)-(o.price==="Variable"?1/0:o.price):z==="price_desc"?(o.price==="Variable"?-1/0:o.price)-(r.price==="Variable"?-1/0:r.price):z==="rp_asc"?(r.rp_multiplier==="Variable"?1/0:r.rp_multiplier)-(o.rp_multiplier==="Variable"?1/0:o.rp_multiplier):(o.rp_multiplier==="Variable"?-1/0:o.rp_multiplier)-(r.rp_multiplier==="Variable"?-1/0:r.rp_multiplier)),xn=nt.filter(r=>{const o=r.name.toLowerCase().includes(B.toLowerCase()),c=r.id==="m_mineshaft_drill"||r.id==="m_logic_assembler"||r.id==="m_tree_farm"||r.id==="m_underground_waste_facility"||r.id==="m_liquid_dump"||r.id==="m_liquid_burner"||xr(r.id).length>0,i=ne==="all"||r.tier!==void 0&&r.tier.toString()===ne;return o&&c&&i}).sort((r,o)=>r.name.localeCompare(o.name)),ei=r=>{if(r.id==="m_mineshaft_drill")ct(Pn,1);else if(r.id==="m_logic_assembler")ct(Mn,1);else if(r.id==="m_tree_farm")ct(kn,1);else if(r.id==="m_underground_waste_facility")ct(Wr,1);else if(r.id==="m_liquid_dump")ct(Vr,1);else if(r.id==="m_liquid_burner")ct(Ur,1);else{A(r);return}pr()},yn=(I==="product"?gn():xr(P==null?void 0:P.id)).sort((r,o)=>{const c=et.includes(r.id),i=et.includes(o.id);if(c&&!i)return-1;if(!c&&i)return 1;const l=ge(r.machine_id),d=ge(o.machine_id);return((l==null?void 0:l.name)||"").localeCompare((d==null?void 0:d.name)||"")}),ti=r=>{pt(o=>o.includes(r)?o.filter(c=>c!==r):[...o,r])};return t.jsxs("div",{style:{width:"100vw",height:"100vh"},children:[t.jsxs(ci,{onNodeDragStart:()=>fr(!0),onNodeDragStop:()=>fr(!1),onConnectStart:()=>fr(!0),onConnectEnd:()=>fr(!1),ref:Ht,nodes:e,edges:s,onNodesChange:pa,onEdgesChange:ma,onConnect:ya,onNodeClick:Da,onNodeDoubleClick:Ra,onMouseMove:Oa,onClick:$a,onContextMenu:Aa,onInit:r=>{st.current=r,Ie(r.getZoom())},onMoveEnd:(r,o)=>{Ie(o.zoom)},nodeTypes:zo,edgeTypes:qo,panOnDrag:[0,2],panOnScroll:!1,selectionOnDrag:!1,fitView:!0,elevateNodesOnSelect:!1,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,minZoom:.1,maxZoom:4,autoPanOnNodeDrag:!1,zoomOnDoubleClick:!1,preventScrolling:!0,nodeOrigin:[0,0],snapToGrid:!1,onlyRenderVisibleElements:!0,disableKeyboardA11y:!0,deleteKeyCode:null,selectionKeyCode:null,multiSelectionKeyCode:null,panActivationKeyCode:null,zoomActivationKeyCode:null,connectionLineType:ye.edgePath==="straight"?"straight":ye.edgePath==="orthogonal"?"smoothstep":"default",connectionLineStyle:{stroke:getComputedStyle(document.documentElement).getPropertyValue("--color-primary").trim(),strokeWidth:2,strokeDasharray:ye.edgeStyle==="animated"||ye.edgeStyle==="dashed"?"8 4":"none"},defaultEdgeOptions:{type:"custom"},children:[t.jsx(di,{color:"#333",gap:16,size:1}),!ie&&t.jsx(ui,{className:(dt||ut)&&!Ze?"controls-shifted":"",position:"bottom-left"}),!ie&&t.jsx(pi,{nodeColor:()=>getComputedStyle(document.documentElement).getPropertyValue("--color-primary").trim(),maskColor:getComputedStyle(document.documentElement).getPropertyValue("--bg-overlay").trim(),position:"bottom-right"}),t.jsx(Cn,{position:"top-left",style:{margin:ie?"5px":"10px",maxWidth:ie?"calc(100vw - 10px)":"none"},children:t.jsx("div",{className:`left-panel-container ${Ze?"collapsed":""}`,style:ie?{maxWidth:"100%"}:{},children:t.jsxs("div",{style:{display:"flex",gap:"15px",alignItems:"flex-start",flexDirection:"column"},children:[t.jsxs("div",{style:{display:"flex",gap:"15px",alignItems:"flex-start"},children:[t.jsxs("div",{className:"stats-panel",children:[t.jsx("h3",{className:"stats-title",children:ua}),t.jsxs("div",{className:"stats-grid",children:[t.jsxs("div",{className:"stat-item",children:[t.jsx("div",{className:"stat-label",children:"Total Power:"}),t.jsx("div",{className:"stat-value",children:wo(_t.totalPower)})]}),t.jsxs("div",{className:"stat-item",children:[t.jsx("div",{className:"stat-label",children:"Total Pollution:"}),t.jsxs("div",{className:"stat-value",style:{color:_t.totalPollution>=0?"var(--stat-negative)":"var(--stat-positive)"},children:[_t.totalPollution.toFixed(2),"%/hr"]})]}),t.jsxs("div",{className:"stat-item",children:[t.jsx("div",{className:"stat-label",children:"Total Min Models:"}),t.jsx("div",{className:"stat-value",children:_t.totalModelCount.toFixed(0)})]}),t.jsxs("div",{className:"stat-item",children:[t.jsx("div",{className:"stat-label",children:"Total Profit:"}),t.jsxs("div",{className:"stat-value",style:{color:mn>=0?"var(--stat-positive)":"var(--stat-negative)"},children:["$",St(mn),"/s"]})]}),t.jsxs("div",{className:"stat-item",children:[t.jsx("div",{className:"stat-label",children:"Total Cost:"}),t.jsxs("div",{className:"stat-value",children:["$",St(ga.totalCost)]})]})]})]}),t.jsxs("div",{className:"flex-col action-buttons-container",children:[t.jsx("button",{onClick:ba,className:"btn btn-primary",children:"+ Select Recipe"}),t.jsx("button",{onClick:()=>{Fe(!0),He("targets")},className:"btn btn-secondary",children:"View Recipes"}),t.jsx("button",{onClick:qa,className:"btn btn-secondary",disabled:yt!==null,children:yt!==null?"Computing...":"Compute Machines"}),t.jsx("button",{onClick:za,className:"btn btn-secondary",children:"Auto Layout"}),t.jsxs("div",{style:{display:"flex",gap:"10px"},children:[t.jsx("button",{onClick:()=>Lt(!dt),className:"btn btn-secondary btn-square",title:dt?"Close more statistics":"Open more statistics",children:dt?"â†“":"â†‘"}),t.jsx("button",{onClick:()=>rr(!Ze),className:"btn btn-secondary btn-square btn-panel-toggle",title:Ze?"Show left panel":"Hide left panel",children:Ze?"â†’":"â†"})]})]})]}),(dt||ut)&&t.jsxs("div",{className:`extended-panel ${ut?"closing":""}`,children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:ie?"10px":"15px",borderBottom:"2px solid var(--border-divider)",position:"sticky",top:0,background:"var(--bg-secondary)",zIndex:1,flexWrap:ie?"wrap":"nowrap",gap:ie?"10px":"0"},children:[t.jsx("h3",{style:{color:"var(--color-primary)",fontSize:ie?"var(--font-size-base)":"var(--font-size-md)",fontWeight:700,margin:0},children:"More Statistics"}),ie&&t.jsx("button",{onClick:()=>Lt(!1),className:"btn btn-secondary",style:{padding:"6px 12px",fontSize:"var(--font-size-sm)",minWidth:"auto"},children:"Close"}),t.jsxs("div",{style:{display:"flex",gap:ie?"5px":"10px",flexWrap:"wrap"},children:[t.jsx("button",{onClick:()=>na(r=>r==="perSecond"?"perCycle":"perSecond"),className:"btn btn-secondary",style:{padding:ie?"6px 10px":"8px 16px",fontSize:ie?"var(--font-size-sm)":"var(--font-size-base)",minWidth:"auto"},title:we==="perSecond"?"Switch to per-cycle display":"Switch to per-second display",children:we==="perSecond"?"Per Second":"Per Cycle"}),t.jsx("button",{onClick:()=>aa(r=>r==="perMachine"?"total":"perMachine"),className:"btn btn-secondary",style:{padding:ie?"6px 10px":"8px 16px",fontSize:ie?"var(--font-size-sm)":"var(--font-size-base)",minWidth:"auto"},title:ke==="perMachine"?"Switch to total display":"Switch to per-machine display",children:ke==="perMachine"?"Per Machine":"Total"})]})]}),t.jsxs("div",{className:"extended-panel-content",children:[t.jsxs("div",{style:{marginBottom:"20px"},children:[t.jsx("label",{htmlFor:"global-pollution",style:{color:"var(--text-primary)",fontSize:"var(--font-size-base)",fontWeight:600,display:"block",marginBottom:"8px"},children:"Global Pollution (%):"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("button",{onClick:()=>ir(r=>!r),className:"btn btn-secondary",style:{padding:"10px 16px",minWidth:"auto",fontSize:"var(--font-size-lg)",lineHeight:1},title:kt?"Resume pollution change":"Pause pollution change",children:kt?"â–¶":"âšâš"}),t.jsx("input",{id:"global-pollution",type:"number",step:"0.0001",value:y,onFocus:()=>ar(!0),onBlur:r=>{ar(!1);const o=r.target.value,c=parseFloat(o);pe(!isNaN(c)&&isFinite(c)?parseFloat(c.toFixed(4)):0)},onChange:r=>pe(r.target.value===""?"":parseFloat(r.target.value)),className:"input",placeholder:"Enter global pollution",style:{flex:1,textAlign:"left"}})]})]}),t.jsxs("div",{style:{marginTop:"30px"},children:[t.jsx("h4",{style:{color:"var(--text-primary)",fontSize:"var(--font-size-base)",fontWeight:600,marginBottom:"12px"},children:"Excess Products:"}),dr.length===0?t.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"var(--font-size-sm)",padding:"15px",textAlign:"center",background:"var(--bg-main)",borderRadius:"var(--radius-sm)"},children:"No excess products. All outputs are consumed by connected inputs."}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:dr.map(r=>t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",background:"var(--bg-main)",borderRadius:"var(--radius-sm)",border:r.isSold?"2px solid var(--color-primary)":"2px solid var(--border-light)"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{color:"var(--text-primary)",fontSize:"var(--font-size-sm)",fontWeight:600},children:r.product.name}),t.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"var(--font-size-xs)",marginTop:"2px"},children:[St(r.excessRate),"/s"]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[typeof r.product.price=="number"&&t.jsxs("div",{style:{color:r.isSold?"var(--color-primary)":"var(--text-muted)",fontSize:"var(--font-size-sm)",fontWeight:600},children:["$",St(r.product.price*r.excessRate),"/s"]}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",color:"var(--text-primary)",fontSize:"var(--font-size-sm)"},children:[t.jsx("input",{type:"checkbox",checked:r.isSold,onChange:o=>De(c=>({...c,[r.productId]:o.target.checked})),style:{width:"18px",height:"18px",cursor:"pointer",accentColor:"var(--color-primary)"}}),"Sell"]})]})]},r.productId))})]}),t.jsxs("div",{style:{marginTop:"30px"},children:[t.jsx("h4",{style:{color:"var(--text-primary)",fontSize:"var(--font-size-base)",fontWeight:600,marginBottom:"12px"},children:"Deficient Products:"}),dn.length===0?t.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"var(--font-size-sm)",padding:"15px",textAlign:"center",background:"var(--bg-main)",borderRadius:"var(--radius-sm)"},children:"No deficient products. All inputs are fully supplied by connected outputs."}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:dn.map(r=>t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",background:"var(--bg-main)",borderRadius:"var(--radius-sm)",border:"2px solid #fca5a5"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{color:"var(--text-primary)",fontSize:"var(--font-size-sm)",fontWeight:600},children:r.product.name}),t.jsxs("div",{style:{color:"#fca5a5",fontSize:"var(--font-size-xs)",marginTop:"2px"},children:["Shortage: ",St(r.deficiencyRate),"/s"]})]}),t.jsxs("div",{style:{color:"#fca5a5",fontSize:"var(--font-size-xs)",fontWeight:600,textAlign:"right"},children:[r.affectedNodes.length," node",r.affectedNodes.length!==1?"s":""," affected"]})]},r.productId))})]})]})]})]})})}),t.jsxs(Cn,{position:"top-right",style:{margin:ie?"5px":"10px",maxWidth:ie?"calc(100vw - 10px)":"none"},children:[ie&&t.jsxs("div",{className:"mobile-controls-container",children:[t.jsx("button",{onClick:()=>$t(r=>r==="target"?"pan":"target"),className:`btn ${Ne==="target"?"btn-primary":"btn-secondary"}`,title:"Target mode - Tap nodes to mark as targets",children:"ðŸŽ¯"}),t.jsx("button",{onClick:()=>$t(r=>r==="delete"?"pan":"delete"),className:`btn ${Ne==="delete"?"btn-primary":"btn-secondary"}`,title:"Delete mode - Tap nodes to delete",children:"ðŸ—‘ï¸"})]}),t.jsxs("div",{className:`menu-container ${ve?"":"closed"}`,style:ie?{maxWidth:"calc(100vw - 10px)"}:{},children:[t.jsx("button",{onClick:()=>be(!ve),className:"btn btn-secondary btn-menu-toggle",style:ie?{fontSize:"var(--font-size-sm)",padding:"6px 10px"}:{},children:ve?">":"<"}),t.jsxs("div",{className:"menu-buttons",style:ie?{maxHeight:"calc(100vh - 100px)",overflowY:"auto"}:{},children:[t.jsx("button",{onClick:()=>{Ct(),U("node")},className:"btn btn-secondary",children:"Clear All"}),t.jsx("button",{onClick:()=>er(!0),className:"btn btn-secondary",children:"Saves"}),t.jsx("button",{onClick:()=>tr(!0),className:"btn btn-secondary",children:"Data"}),t.jsx("button",{onClick:Xa,className:"btn btn-secondary",children:"Restore Defaults"}),t.jsx("button",{onClick:()=>je(!0),className:"btn btn-secondary",children:"Theme Editor"}),t.jsx("button",{onClick:()=>Bt(!0),className:"btn btn-secondary",children:"Help"})]})]})]})]}),t.jsx("input",{ref:da,type:"file",accept:".json",style:{display:"none"},onChange:Ga}),(ot||L)&&t.jsx("div",{className:"modal-overlay",onClick:hn,children:ot&&t.jsxs("div",{className:"modal",onClick:r=>r.stopPropagation(),style:{width:"450px"},children:[t.jsx("h2",{className:"modal-title",children:"Edit Machine Count"}),t.jsxs("div",{style:{marginBottom:"20px"},children:[t.jsx("label",{style:{display:"block",color:"var(--text-primary)",fontSize:"var(--font-size-base)",fontWeight:600,marginBottom:"10px"},children:"Machine Count:"}),t.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[t.jsx("button",{onClick:()=>{const r=["free","capped","locked"],c=(r.indexOf(le)+1)%r.length,i=r[c];fe(i)},className:"btn btn-secondary",style:{minWidth:"80px",padding:"10px",fontWeight:600,background:le==="locked"?"#ef4444":le==="capped"?"#f59e0b":"var(--bg-secondary)",color:le==="free"?"var(--text-primary)":"#fff"},title:`Mode: ${le==="free"?"Free (LP/suggestions can change)":le==="capped"?"Capped (LP/suggestions cannot exceed cap)":"Locked (LP/suggestions cannot change)"}`,children:le==="free"?"ðŸ”“ Free":le==="capped"?"ðŸ“Š Cap":"ðŸ”’ Lock"}),t.jsx("input",{type:"number",min:"0",step:"0.1",value:xe,onChange:r=>me(r.target.value),onKeyPress:r=>{r.key==="Enter"&&$r(!1)},className:"input",placeholder:"Enter machine count",autoFocus:!0,style:{flex:1}})]}),t.jsxs("p",{style:{marginTop:"8px",fontSize:"var(--font-size-sm)",color:"var(--text-secondary)"},children:[le==="free"&&"Free: LP solver and suggestions can modify this count",le==="capped"&&`Capped: LP/suggestions cannot exceed ${parseFloat(xe)||0} (the value when Apply is pressed)`,le==="locked"&&"Locked: LP solver and suggestions cannot modify this count"]})]}),Q&&!se&&t.jsx("div",{style:{marginBottom:"20px",padding:"12px",background:"rgba(212, 166, 55, 0.1)",borderRadius:"var(--radius-sm)",border:"1px solid var(--border-divider)"},children:t.jsxs("div",{style:{fontSize:"var(--font-size-sm)",color:"var(--text-secondary)",lineHeight:"1.6"},children:[t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("strong",{style:{color:"var(--text-primary)"},children:"Apply:"})," Applies machine count and lock/cap mode to this node only"]}),t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("strong",{style:{color:"var(--text-primary)"},children:"Apply to All:"})," Applies machine count to this node and propagates count changes to connected nodes. Lock/cap mode only applies to this node."]}),t.jsx("div",{style:{fontSize:"11px",fontStyle:"italic",color:"var(--text-muted)"},children:"Note: Lock/cap mode is never propagated to other nodes"})]})}),t.jsxs("div",{style:{display:"flex",gap:"10px"},children:[t.jsx("button",{onClick:hn,className:"btn btn-secondary",style:{flex:1},children:"Cancel"}),t.jsx("button",{onClick:()=>$r(!1),className:"btn btn-primary",style:{flex:1},children:"Apply"}),Q&&!se&&t.jsx("button",{onClick:()=>$r(!0),className:"btn btn-primary",style:{flex:1,background:"var(--color-primary-hover)",fontWeight:700},title:"Apply changes and propagate to connected nodes",children:"Apply to All"})]})]})}),N&&t.jsx("div",{className:"modal-overlay",onClick:pr,children:t.jsxs("div",{className:"modal",onClick:r=>r.stopPropagation(),children:[t.jsx("h2",{className:"modal-title",children:S?`Recipes for ${S.name}`:P?`Recipes for ${P.name}`:"Select Product or Machine"}),!S&&!P?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mb-lg",children:t.jsxs("div",{className:"flex-row",style:{gap:"10px",marginBottom:"15px"},children:[t.jsx("button",{onClick:()=>v("product"),className:`btn ${I==="product"?"btn-primary":"btn-secondary"}`,style:{flex:1},children:"By Products"}),t.jsx("button",{onClick:()=>v("machine"),className:`btn ${I==="machine"?"btn-primary":"btn-secondary"}`,style:{flex:1},children:"By Machines"})]})}),I==="product"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-lg flex-col",children:[t.jsx("input",{type:"text",placeholder:"Search products...",value:B,onChange:r=>O(r.target.value),className:"input"}),t.jsxs("div",{className:"flex-row",children:[t.jsxs("select",{value:D,onChange:r=>V(r.target.value),className:"select",children:[t.jsx("option",{value:"all",children:"All Types"}),t.jsx("option",{value:"item",children:"Items Only"}),t.jsx("option",{value:"fluid",children:"Fluids Only"})]}),t.jsxs("select",{value:z,onChange:r=>G(r.target.value),className:"select",children:[t.jsx("option",{value:"name_asc",children:"Name â†‘ (A-Z)"}),t.jsx("option",{value:"name_desc",children:"Name â†“ (Z-A)"}),t.jsx("option",{value:"price_asc",children:"Price â†‘ (Low-High)"}),t.jsx("option",{value:"price_desc",children:"Price â†“ (High-Low)"}),t.jsx("option",{value:"rp_asc",children:"RP Mult â†‘ (Low-High)"}),t.jsx("option",{value:"rp_desc",children:"RP Mult â†“ (High-Low)"})]})]})]}),t.jsxs("div",{className:"modal-content",style:{maxHeight:"400px"},children:[t.jsxs("div",{className:"product-table-header",children:[t.jsx("div",{children:"Product"}),t.jsx("div",{className:"text-right",children:"Price"}),t.jsx("div",{className:"text-right",children:"RP Mult"})]}),Za.map(r=>t.jsxs("div",{onClick:()=>H(r),className:"product-row",children:[t.jsxs("div",{children:[t.jsx("div",{className:"product-name",children:r.name}),t.jsx("div",{className:"product-type",children:r.type==="item"?"ðŸ“¦ Item":"ðŸ’§ Fluid"})]}),t.jsx("div",{className:"text-right",style:{alignSelf:"center"},children:r.price==="Variable"?"Variable":`${St(r.price)}`}),t.jsx("div",{className:"text-right",style:{alignSelf:"center"},children:r.rp_multiplier==="Variable"?"Variable":r.rp_multiplier>=1e3?`${St(r.rp_multiplier)}x`:`${r.rp_multiplier.toFixed(1)}x`})]},r.id))]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-lg",style:{display:"flex",gap:"10px"},children:[t.jsx("input",{type:"text",placeholder:"Search machines...",value:B,onChange:r=>O(r.target.value),className:"input",style:{flex:3}}),t.jsxs("select",{value:ne,onChange:r=>ce(r.target.value),className:"select",style:{flex:1},children:[t.jsx("option",{value:"all",children:"All Tiers"}),t.jsx("option",{value:"1",children:"Tier 1"}),t.jsx("option",{value:"2",children:"Tier 2"}),t.jsx("option",{value:"3",children:"Tier 3"}),t.jsx("option",{value:"4",children:"Tier 4"}),t.jsx("option",{value:"5",children:"Tier 5"})]})]}),t.jsx("div",{className:"modal-content flex-col",style:{maxHeight:"400px"},children:xn.length===0?t.jsx("div",{className:"empty-state",children:"No machines found"}):xn.map(r=>t.jsxs("div",{onClick:()=>ei(r),className:"recipe-card",style:{cursor:"pointer"},children:[t.jsx("div",{className:"recipe-machine",style:{color:r.tier===1?"var(--tier-1-color)":r.tier===2?"var(--tier-2-color)":r.tier===3?"var(--tier-3-color)":r.tier===4?"var(--tier-4-color)":(r.tier===5,"var(--tier-5-color)")},children:r.name}),t.jsx("div",{className:"recipe-details",style:{color:"#999"},children:r.id==="m_mineshaft_drill"||r.id==="m_logic_assembler"||r.id==="m_tree_farm"?"Click to create box":`${xr(r.id).length} recipe(s)`})]},r.id))})]})]}):t.jsxs(t.Fragment,{children:[W==="button"&&t.jsx("button",{onClick:()=>{H(null),A(null)},className:"btn btn-secondary btn-back",children:"â† Back"}),S&&t.jsx("div",{className:"mb-lg",children:t.jsxs("select",{value:te,onChange:r=>re(r.target.value),className:"select",children:[t.jsx("option",{value:"all",children:"All Recipes"}),t.jsxs("option",{value:"producers",children:["Producers (Outputs ",S.name,")"]}),t.jsxs("option",{value:"consumers",children:["Consumers (Uses ",S.name,")"]}),t.jsx("option",{value:"disposal",children:"Disposal"})]})}),t.jsx("div",{className:"modal-content flex-col",style:{maxHeight:"400px"},children:yn.length===0?t.jsx("div",{className:"empty-state",children:"No recipes found"}):yn.map(r=>{const o=ge(r.machine_id),c=et.includes(r.id),i=Nr[r.id]??1;return o&&r.inputs&&r.outputs?t.jsxs("div",{className:"recipe-card",style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("button",{onClick:l=>{l.stopPropagation(),ti(r.id)},style:{background:"none",border:"none",fontSize:"20px",cursor:"pointer",padding:"4px",lineHeight:1,filter:c?"none":"grayscale(100%)",opacity:c?1:.4,transition:"all 0.2s"},onMouseEnter:l=>{l.currentTarget.style.transform="scale(1.2)",l.currentTarget.style.opacity="1"},onMouseLeave:l=>{l.currentTarget.style.transform="scale(1)",l.currentTarget.style.opacity=c?"1":"0.4"},title:c?"Remove from favorites":"Add to favorites",children:"â­"}),t.jsx("div",{onClick:l=>{l.stopPropagation();const d=i<=0?1:i,h=ct(r,d);b(!0),w(!1),setTimeout(()=>{Ee(h),Y(h),me(String(d)),J(!0),b(!1)},50)},style:{minWidth:"70px",padding:"10px 12px",background:k&&i<=0?"var(--delete-bg)":"var(--color-primary)",color:k&&i<=0?"var(--delete-color)":"var(--color-primary-dark)",borderRadius:"var(--radius-sm)",fontWeight:700,fontSize:"18px",textAlign:"center",cursor:"pointer",transition:"all 0.2s",userSelect:"none",border:k&&i<=0?"2px solid var(--delete-color)":"2px solid transparent"},onMouseEnter:l=>{k&&i<=0?(l.currentTarget.style.background="var(--delete-hover-bg)",l.currentTarget.style.color="var(--delete-hover-color)"):(l.currentTarget.style.background="var(--color-primary-hover)",l.currentTarget.style.transform="scale(1.05)",l.currentTarget.style.borderColor="var(--color-primary-hover)")},onMouseLeave:l=>{k&&i<=0?(l.currentTarget.style.background="var(--delete-bg)",l.currentTarget.style.color="var(--delete-color)"):(l.currentTarget.style.background="var(--color-primary)",l.currentTarget.style.transform="scale(1)",l.currentTarget.style.borderColor="transparent")},title:k?i<=0?"Cannot create: machine count is 0":`Click to edit before creating (${Number.isInteger(i)?i:i.toFixed(2)} calculated)`:"Click to set machine count",children:Number.isInteger(i)?i:i.toFixed(2)}),t.jsxs("div",{style:{flex:1,cursor:"pointer",minWidth:0},onClick:l=>{if(l.stopPropagation(),i<=0){const h=ct(r,1);b(!0),w(!1),setTimeout(()=>{Ee(h),Y(h),me("1"),J(!0),b(!1)},50)}else ct(r),pr()},children:[t.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"8px",marginBottom:"4px"},children:[t.jsx("div",{className:"recipe-machine",style:{color:o.tier===1?"var(--tier-1-color)":o.tier===2?"var(--tier-2-color)":o.tier===3?"var(--tier-3-color)":o.tier===4?"var(--tier-4-color)":(o.tier===5,"var(--tier-5-color)")},children:o.name}),r.power_type==="HV"&&t.jsx("div",{style:{fontSize:"12px",color:"var(--text-primary)",fontWeight:500},children:"HV"})]}),t.jsxs("div",{className:"recipe-details",children:[t.jsx("span",{className:"recipe-label-input",children:"Inputs: "}),t.jsx("span",{children:r.inputs.map(l=>Fn(l,Me)).join(", ")})]}),t.jsxs("div",{className:"recipe-details",children:[t.jsx("span",{className:"recipe-label-output",children:"Outputs: "}),t.jsx("span",{children:r.outputs.map(l=>Fn(l,Me)).join(", ")})]})]})]},r.id):null})})]}),t.jsx("button",{onClick:pr,className:"btn btn-secondary",style:{marginTop:"20px"},children:"Close"})]})}),Pt&&t.jsx("div",{className:"modal-overlay",onClick:()=>it(!1),children:t.jsxs("div",{className:"modal",onClick:r=>r.stopPropagation(),style:{width:"800px",maxHeight:"85vh",display:"flex",flexDirection:"column"},children:[t.jsx("h2",{className:"modal-title",children:"Target Products"}),t.jsx("div",{className:"modal-content flex-col",style:{flex:1,overflowY:"auto",paddingBottom:"20px",marginBottom:"0"},children:ee.length===0?t.jsx("div",{className:"empty-state",children:"No target products yet. Shift+Click a recipe box to mark it as a target."}):ee.map(r=>{var F;const o=e.find(_=>_.id===r.recipeBoxId);if(!o)return null;const{recipe:c,machine:i,machineCount:l=0}=o.data||{};if(!c)return null;let d=c.cycle_time;if((typeof d!="number"||d<=0)&&(d=1),wt(i==null?void 0:i.id)){const _=Dt[i.id];if((_==null?void 0:_.type)==="steam_input"&&Rt(c)){const R=c.tempDependentInputTemp??ft;d=Ft(i.id,R,d)}}(typeof d!="number"||d<=0)&&(d=1);const g=c.isMineshaftDrill||c.id==="r_mineshaft_drill",j=(F=X==null?void 0:X.flows)==null?void 0:F.byNode[r.recipeBoxId],T={inputs:{},outputs:{}};return c.inputs.forEach((_,R)=>{var E;if(typeof _.quantity=="number"){const M=(g?_.quantity:_.quantity/d)*l,q=((E=j==null?void 0:j.inputFlows[R])==null?void 0:E.connected)||0;T.inputs[R]={totalRate:M,connectedFlow:q,deficiency:Math.max(0,M-q)}}}),c.outputs.forEach((_,R)=>{var C;const E=_.quantity;if(typeof E=="number"){const q=(g?E:E/d)*l,$=((C=j==null?void 0:j.outputFlows[R])==null?void 0:C.connected)||0;T.outputs[R]={totalRate:q,connectedFlow:$,excess:Math.max(0,q-$)}}}),t.jsxs("div",{style:{padding:"20px",background:"var(--bg-main)",border:"2px solid var(--border-primary)",borderRadius:"var(--radius-md)",marginBottom:"15px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{color:"var(--text-primary)",fontSize:"16px",fontWeight:600},children:c.name}),t.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"4px"},children:["Machine Count: ",l.toFixed(4)]})]}),t.jsx("button",{onClick:()=>Ea(r.id),className:"btn btn-delete",style:{padding:"6px 12px"},children:"Remove"})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",borderTop:"1px solid var(--border-divider)",paddingTop:"15px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{color:"var(--input-text)",fontSize:"14px",fontWeight:600,marginBottom:"12px",textAlign:"center"},children:"Inputs"}),c.inputs.map((_,R)=>{const E=T.inputs[R];return E?t.jsx(zn,{productName:Qt(_.product_id,Me),connectedFlow:E.connectedFlow,currentExcess:E.deficiency,onTargetExcessCommit:C=>fn(r.id,"input",R,C),styleType:"input"},R):null})]}),t.jsxs("div",{children:[t.jsx("div",{style:{color:"var(--output-text)",fontSize:"14px",fontWeight:600,marginBottom:"12px",textAlign:"center"},children:"Outputs"}),c.outputs.map((_,R)=>{const E=T.outputs[R];return E?t.jsx(zn,{productName:Qt(_.product_id,Me),connectedFlow:E.connectedFlow,currentExcess:E.excess,onTargetExcessCommit:C=>fn(r.id,"output",R,C),styleType:"output"},R):null})]})]})]},r.id)})}),t.jsx("button",{onClick:()=>it(!1),className:"btn btn-secondary",style:{width:"100%"},children:"Close"})]})}),Xe&&t.jsx(ht.Suspense,{fallback:t.jsx(Hn,{}),children:t.jsx(Ho,{onClose:()=>Fe(!1),tab:Ae,onTabChange:He,activeWeights:Fr,unusedWeights:Er,setActiveWeights:sa,setUnusedWeights:la,targetProducts:ee,productionSolution:X,nodes:e,edges:s,recipeTabFilter:ia,setRecipeTabFilter:oa,onLocateNode:r=>{Fe(!1),st.current&&st.current.fitView({nodes:[{id:r}],padding:.5,duration:500})}})}),t.jsxs(ht.Suspense,{fallback:t.jsx(Hn,{}),children:[yt&&t.jsx(Ao,{phase:yt.phase,nodeSnapshot:yt.nodeSnapshot,result:yt.result,deficiencyResult:yt.deficiencyResult,onCancel:Wa,onConfirmDeficiency:Va,onApply:Ua,onLocateNode:Ka}),Se&&t.jsx(lo,{onClose:()=>je(!1)}),Mt&&t.jsx(Lo,{onClose:()=>Bt(!1)}),Zt&&t.jsx(Oo,{onClose:()=>er(!1),onLoad:Ya,currentCanvas:{nodes:e.map(vt),edges:s,targetProducts:ee,nodeId:p,targetIdCounter:ue,soldProducts:Be,favoriteRecipes:et,lastDrillConfig:ze,lastAssemblerConfig:qe,lastTreeFarmConfig:We,lastFireboxConfig:Ve,lastWasteFacilityConfig:Tt},onImport:Ja,onExportCanvas:Qa}),rn&&t.jsx($o,{onClose:()=>tr(!1)})]}),ie&&Ne!=="pan"&&t.jsxs("div",{style:{position:"fixed",bottom:"120px",left:"50%",transform:"translateX(-50%)",background:"var(--bg-secondary)",border:"2px solid var(--border-primary)",borderRadius:"var(--radius-md)",padding:"8px 16px",color:"var(--color-primary)",fontSize:"14px",fontWeight:600,zIndex:1e3,pointerEvents:"none",boxShadow:"var(--shadow-lg)"},children:[Ne==="target"&&"ðŸŽ¯ Target Mode: Tap nodes to mark as targets",Ne==="delete"&&"ðŸ—‘ï¸ Delete Mode: Tap nodes to delete"]}),Ke&&t.jsxs("div",{className:"pending-node-preview",style:{left:`${on.x+20}px`,top:`${on.y+20}px`},children:[t.jsx("div",{className:"pending-node-recipe-name",children:Ke.recipe.name}),t.jsx("div",{className:"pending-node-machine-name",children:Ke.machine.name}),t.jsxs("div",{className:"pending-node-machine-name",children:["Count: ",Ke.machineCount]}),t.jsx("div",{className:"pending-node-hint",children:"Left-click to place | Right-click to cancel"})]})]})}ai.createRoot(document.getElementById("root")).render(t.jsx(ht.StrictMode,{children:t.jsx(Wo,{})}));export{ns as a,go as b,xo as c,ts as d,yo as e,Qt as f,po as g,wo as h,es as l,rs as r,Zo as s};
